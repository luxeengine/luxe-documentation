<!DOCTYPE html><html lang="en" dir="ltr" data-theme="dark" data-has-toc data-has-sidebar class="astro-bguv2lll"> <head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Match 3 - After the prototype | luxe docs</title><link rel="canonical"/><link rel="shortcut icon" href="/favicon.svg" type="image/svg+xml"/><meta name="generator" content="Astro v5.15.5"/><meta name="generator" content="Starlight v0.36.2"/><meta property="og:title" content="Match 3 - After the prototype"/><meta property="og:type" content="article"/><meta property="og:url"/><meta property="og:locale" content="en"/><meta property="og:description" content="A tutorial on making a match 3"/><meta property="og:site_name" content="luxe docs"/><meta name="twitter:card" content="summary_large_image"/><meta name="description" content="A tutorial on making a match 3"/><script>
	window.StarlightThemeProvider = (() => {
		const storedTheme =
			typeof localStorage !== 'undefined' && localStorage.getItem('starlight-theme');
		const theme =
			storedTheme ||
			(window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
		document.documentElement.dataset.theme = theme === 'light' ? 'light' : 'dark';
		return {
			updatePickers(theme = storedTheme || 'auto') {
				document.querySelectorAll('starlight-theme-select').forEach((picker) => {
					const select = picker.querySelector('select');
					if (select) select.value = theme;
					/** @type {HTMLTemplateElement | null} */
					const tmpl = document.querySelector(`#theme-icons`);
					const newIcon = tmpl && tmpl.content.querySelector('.' + theme);
					if (newIcon) {
						const oldIcon = picker.querySelector('svg.label-icon');
						if (oldIcon) {
							oldIcon.replaceChildren(...newIcon.cloneNode(true).childNodes);
						}
					}
				});
			},
		};
	})();
</script><template id="theme-icons"><svg aria-hidden="true" class="light astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M5 12a1 1 0 0 0-1-1H3a1 1 0 0 0 0 2h1a1 1 0 0 0 1-1Zm.64 5-.71.71a1 1 0 0 0 0 1.41 1 1 0 0 0 1.41 0l.71-.71A1 1 0 0 0 5.64 17ZM12 5a1 1 0 0 0 1-1V3a1 1 0 0 0-2 0v1a1 1 0 0 0 1 1Zm5.66 2.34a1 1 0 0 0 .7-.29l.71-.71a1 1 0 1 0-1.41-1.41l-.66.71a1 1 0 0 0 0 1.41 1 1 0 0 0 .66.29Zm-12-.29a1 1 0 0 0 1.41 0 1 1 0 0 0 0-1.41l-.71-.71a1.004 1.004 0 1 0-1.43 1.41l.73.71ZM21 11h-1a1 1 0 0 0 0 2h1a1 1 0 0 0 0-2Zm-2.64 6A1 1 0 0 0 17 18.36l.71.71a1 1 0 0 0 1.41 0 1 1 0 0 0 0-1.41l-.76-.66ZM12 6.5a5.5 5.5 0 1 0 5.5 5.5A5.51 5.51 0 0 0 12 6.5Zm0 9a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7Zm0 3.5a1 1 0 0 0-1 1v1a1 1 0 0 0 2 0v-1a1 1 0 0 0-1-1Z"/></svg><svg aria-hidden="true" class="dark astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.64 13a1 1 0 0 0-1.05-.14 8.049 8.049 0 0 1-3.37.73 8.15 8.15 0 0 1-8.14-8.1 8.59 8.59 0 0 1 .25-2A1 1 0 0 0 8 2.36a10.14 10.14 0 1 0 14 11.69 1 1 0 0 0-.36-1.05Zm-9.5 6.69A8.14 8.14 0 0 1 7.08 5.22v.27a10.15 10.15 0 0 0 10.14 10.14 9.784 9.784 0 0 0 2.1-.22 8.11 8.11 0 0 1-7.18 4.32v-.04Z"/></svg><svg aria-hidden="true" class="auto astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg></template> <script>
  window.StarlightKbdProvider = (() => {
    return {
      updateKbdPickers(type) {
        for (const select of document.querySelectorAll('starlight-kbd-picker select')) {
          const isKnownType = Array.from(select.options).some((option) => option.value === type)
          if (!isKnownType) return
          select.value = type
        }
      },
    }
  })()
</script><link rel="stylesheet" href="/_astro/print.DNXP8c50.css" media="print"><link rel="stylesheet" href="/_astro/index.CQqvigv2.css">
<style>@layer starlight.components{:root{--sl-badge-default-border: var(--sl-color-accent);--sl-badge-default-bg: var(--sl-color-accent-low);--sl-badge-default-text: #fff;--sl-badge-note-border: var(--sl-color-blue);--sl-badge-note-bg: var(--sl-color-blue-low);--sl-badge-note-text: #fff;--sl-badge-danger-border: var(--sl-color-red);--sl-badge-danger-bg: var(--sl-color-red-low);--sl-badge-danger-text: #fff;--sl-badge-success-border: var(--sl-color-green);--sl-badge-success-bg: var(--sl-color-green-low);--sl-badge-success-text: #fff;--sl-badge-caution-border: var(--sl-color-orange);--sl-badge-caution-bg: var(--sl-color-orange-low);--sl-badge-caution-text: #fff;--sl-badge-tip-border: var(--sl-color-purple);--sl-badge-tip-bg: var(--sl-color-purple-low);--sl-badge-tip-text: #fff}[data-theme=light]:root{--sl-badge-default-bg: var(--sl-color-accent-high);--sl-badge-note-bg: var(--sl-color-blue-high);--sl-badge-danger-bg: var(--sl-color-red-high);--sl-badge-success-bg: var(--sl-color-green-high);--sl-badge-caution-bg: var(--sl-color-orange-high);--sl-badge-tip-bg: var(--sl-color-purple-high)}.sl-badge:where(.astro-avdet4wd){display:inline-block;border:1px solid var(--sl-color-border-badge);border-radius:.25rem;font-family:var(--sl-font-system-mono);line-height:normal;color:var(--sl-color-text-badge);background-color:var(--sl-color-bg-badge);overflow-wrap:anywhere}.sidebar-content .sl-badge:where(.astro-avdet4wd){line-height:1;font-size:var(--sl-text-xs);padding:.125rem .375rem}.sidebar-content a[aria-current=page]>.sl-badge:where(.astro-avdet4wd){--sl-color-bg-badge: transparent;--sl-color-border-badge: currentColor;color:inherit}.default:where(.astro-avdet4wd){--sl-color-bg-badge: var(--sl-badge-default-bg);--sl-color-border-badge: var(--sl-badge-default-border);--sl-color-text-badge: var(--sl-badge-default-text)}.note:where(.astro-avdet4wd){--sl-color-bg-badge: var(--sl-badge-note-bg);--sl-color-border-badge: var(--sl-badge-note-border);--sl-color-text-badge: var(--sl-badge-note-text)}.danger:where(.astro-avdet4wd){--sl-color-bg-badge: var(--sl-badge-danger-bg);--sl-color-border-badge: var(--sl-badge-danger-border);--sl-color-text-badge: var(--sl-badge-danger-text)}.success:where(.astro-avdet4wd){--sl-color-bg-badge: var(--sl-badge-success-bg);--sl-color-border-badge: var(--sl-badge-success-border);--sl-color-text-badge: var(--sl-badge-success-text)}.tip:where(.astro-avdet4wd){--sl-color-bg-badge: var(--sl-badge-tip-bg);--sl-color-border-badge: var(--sl-badge-tip-border);--sl-color-text-badge: var(--sl-badge-tip-text)}.caution:where(.astro-avdet4wd){--sl-color-bg-badge: var(--sl-badge-caution-bg);--sl-color-border-badge: var(--sl-badge-caution-border);--sl-color-text-badge: var(--sl-badge-caution-text)}.small:where(.astro-avdet4wd){font-size:var(--sl-text-xs);padding:.125rem .25rem}.medium:where(.astro-avdet4wd){font-size:var(--sl-text-sm);padding:.175rem .35rem}.large:where(.astro-avdet4wd){font-size:var(--sl-text-base);padding:.225rem .45rem}.sl-markdown-content :is(h1,h2,h3,h4,h5,h6) .sl-badge:where(.astro-avdet4wd){vertical-align:middle}}
@layer starlight.components{.card:where(.astro-v5tidmuc){--sl-card-border: var(--sl-color-purple);--sl-card-bg: var(--sl-color-purple-low);border:1px solid var(--sl-color-gray-5);background-color:var(--sl-color-black);padding:clamp(1rem,calc(.125rem + 3vw),2.5rem);flex-direction:column;gap:clamp(.5rem,calc(.125rem + 1vw),1rem)}.card:where(.astro-v5tidmuc):nth-child(4n+1){--sl-card-border: var(--sl-color-orange);--sl-card-bg: var(--sl-color-orange-low)}.card:where(.astro-v5tidmuc):nth-child(4n+3){--sl-card-border: var(--sl-color-green);--sl-card-bg: var(--sl-color-green-low)}.card:where(.astro-v5tidmuc):nth-child(4n+4){--sl-card-border: var(--sl-color-red);--sl-card-bg: var(--sl-color-red-low)}.card:where(.astro-v5tidmuc):nth-child(4n+5){--sl-card-border: var(--sl-color-blue);--sl-card-bg: var(--sl-color-blue-low)}.title:where(.astro-v5tidmuc){font-weight:600;font-size:var(--sl-text-h4);color:var(--sl-color-white);line-height:var(--sl-line-height-headings);gap:1rem;align-items:center}.card:where(.astro-v5tidmuc) .icon:where(.astro-v5tidmuc){border:1px solid var(--sl-card-border);background-color:var(--sl-card-bg);padding:.2em;border-radius:.25rem;flex-shrink:0}.card:where(.astro-v5tidmuc) .body:where(.astro-v5tidmuc){margin:0;font-size:clamp(var(--sl-text-sm),calc(.5rem + 1vw),var(--sl-text-body))}}
@layer starlight.components{svg:where(.astro-c6vsoqas){color:var(--sl-icon-color);font-size:var(--sl-icon-size, 1em);width:1em;height:1em}}
.sl-markdown-content starlight-kbd-picker:where(.astro-k5ijk5yq){display:inline-block}
@layer starlight.components{.sl-link-card:where(.astro-mf7fz2mj){display:grid;grid-template-columns:1fr auto;gap:.5rem;border:1px solid var(--sl-color-gray-5);border-radius:.5rem;padding:1rem;box-shadow:var(--sl-shadow-sm);position:relative}a:where(.astro-mf7fz2mj){text-decoration:none;line-height:var(--sl-line-height-headings)}a:where(.astro-mf7fz2mj):before{content:"";position:absolute;inset:0}.stack:where(.astro-mf7fz2mj){flex-direction:column;gap:.5rem}.title:where(.astro-mf7fz2mj){color:var(--sl-color-white);font-weight:600;font-size:var(--sl-text-lg)}.description:where(.astro-mf7fz2mj){color:var(--sl-color-gray-3);line-height:1.5}.icon:where(.astro-mf7fz2mj){color:var(--sl-color-gray-3)}.sl-link-card:where(.astro-mf7fz2mj):hover{background:var(--sl-color-gray-7, var(--sl-color-gray-6));border-color:var(--sl-color-gray-2)}.sl-link-card:where(.astro-mf7fz2mj):hover .icon:where(.astro-mf7fz2mj){color:var(--sl-color-white)}}
label:where(.astro-e2vmghfl){--sl-label-icon-size: 1rem;--sl-caret-size: 1.25rem;--sl-inline-padding: .5rem;align-items:center;color:var(--sl-color-gray-1);display:inline-flex;gap:.25rem;position:relative}label:where(.astro-e2vmghfl):hover:not(:where(.sl-markdown-content *)){color:var(--sl-color-gray-2)}.sl-markdown-content label:where(.astro-e2vmghfl):hover{color:var(--sl-color-text-accent)}.icon:where(.astro-e2vmghfl){color:var(--sl-icon-color);font-size:var(--sl-icon-size, 1em);height:1em;pointer-events:none;position:absolute;top:50%;transform:translateY(-50%);width:1em}.label-icon:where(.astro-e2vmghfl){font-size:var(--sl-label-icon-size);inset-inline-start:0}.sl-markdown-content .label-icon:where(.astro-e2vmghfl){left:var(--sl-inline-padding)}.caret:where(.astro-e2vmghfl){font-size:var(--sl-caret-size);inset-inline-end:0}.sl-markdown-content .caret:where(.astro-e2vmghfl){right:var(--sl-inline-padding)}select:where(.astro-e2vmghfl){appearance:none;background-color:transparent;border:0;color:inherit;cursor:pointer;padding-block:.25rem;padding-inline:calc(var(--sl-label-icon-size) + var(--sl-inline-padding) + .25rem) calc(var(--sl-caret-size) + var(--sl-inline-padding) + .25rem);text-overflow:ellipsis}.sl-markdown-content select:where(.astro-e2vmghfl){border:1px solid var(--sl-color-white);border-radius:999rem;outline-offset:.1875rem}.sl-markdown-content label:where(.astro-e2vmghfl):hover select:where(.astro-e2vmghfl){border-color:var(--sl-color-text-accent)}option:where(.astro-e2vmghfl){background-color:var(--sl-color-bg-nav);color:var(--sl-color-gray-1)}@media (min-width: 50rem){select:where(.astro-e2vmghfl){font-size:var(--sl-text-sm)}}select:where(.astro-e2vmghfl):not(:where(.sl-markdown-content *)){margin-inline:calc(var(--sl-inline-padding) * -1);padding-block:.625rem}
@layer starlight.components{.sl-steps{--bullet-size: calc(var(--sl-line-height) * 1rem);--bullet-margin: .375rem;list-style:none;counter-reset:steps-counter var(--sl-steps-start, 0);padding-inline-start:0}.sl-steps>li{counter-increment:steps-counter;position:relative;padding-inline-start:calc(var(--bullet-size) + 1rem);padding-bottom:1px;min-height:calc(var(--bullet-size) + var(--bullet-margin))}.sl-steps>li+li{margin-top:0}.sl-steps>li:before{content:counter(steps-counter);position:absolute;top:0;inset-inline-start:0;width:var(--bullet-size);height:var(--bullet-size);line-height:var(--bullet-size);font-size:var(--sl-text-xs);font-weight:600;text-align:center;color:var(--sl-color-white);background-color:var(--sl-color-gray-6);border-radius:99rem;box-shadow:inset 0 0 0 1px var(--sl-color-gray-5)}.sl-steps>li:after{--guide-width: 1px;content:"";position:absolute;top:calc(var(--bullet-size) + var(--bullet-margin));bottom:var(--bullet-margin);inset-inline-start:calc((var(--bullet-size) - var(--guide-width)) / 2);width:var(--guide-width);background-color:var(--sl-color-hairline-light)}}@layer starlight.content{.sl-steps>li>:first-child{--lh: calc(1em * var(--sl-line-height));--shift-y: calc(.5 * (var(--bullet-size) - var(--lh)));transform:translateY(var(--shift-y));margin-bottom:var(--shift-y)}.sl-steps>li>:first-child:where(h1,h2,h3,h4,h5,h6){--lh: calc(1em * var(--sl-line-height-headings))}@supports (--prop: 1lh){.sl-steps>li>:first-child{--lh: 1lh}}}
@layer starlight.components{starlight-file-tree:where(.astro-p67cqifm){--x-space: 1.5rem;--y-space: .125rem;--y-pad: 0;display:block;border:1px solid var(--sl-color-gray-5);padding:1rem;background-color:var(--sl-color-gray-6);font-size:var(--sl-text-xs);font-family:var(--__sl-font-mono);overflow-x:auto}starlight-file-tree:where(.astro-p67cqifm) .directory>details{border:0;padding:0;padding-inline-start:var(--x-space);background:transparent}starlight-file-tree:where(.astro-p67cqifm) .directory>details>summary{margin-inline-start:calc(-1 * var(--x-space));border:0;padding:var(--y-pad) .625rem;font-weight:400;color:var(--sl-color-white);max-width:100%}starlight-file-tree:where(.astro-p67cqifm) .directory>details>summary::marker,starlight-file-tree:where(.astro-p67cqifm) .directory>details>summary::-webkit-details-marker{color:var(--sl-color-gray-3)}starlight-file-tree:where(.astro-p67cqifm) .directory>details>summary:hover,starlight-file-tree:where(.astro-p67cqifm) .directory>details>summary:hover .tree-icon{cursor:pointer;color:var(--sl-color-text-accent);fill:currentColor}starlight-file-tree:where(.astro-p67cqifm) .directory>details>summary:hover~ul{border-color:var(--sl-color-gray-4)}starlight-file-tree:where(.astro-p67cqifm) .directory>details>summary:hover .highlight .tree-icon{color:var(--sl-color-text-invert);fill:currentColor}starlight-file-tree:where(.astro-p67cqifm) ul{margin-inline-start:.5rem;border-inline-start:1px solid var(--sl-color-gray-5);padding:0;padding-inline-start:.125rem;list-style:none}starlight-file-tree:where(.astro-p67cqifm)>ul{margin:0;border:0;padding:0}starlight-file-tree:where(.astro-p67cqifm) li{margin:var(--y-space) 0;padding:var(--y-pad) 0}starlight-file-tree:where(.astro-p67cqifm) .file{margin-inline-start:calc(var(--x-space) - .125rem);color:var(--sl-color-white)}starlight-file-tree:where(.astro-p67cqifm) .tree-entry{display:inline-flex;align-items:flex-start;flex-wrap:wrap;max-width:calc(100% - 1rem)}@media (min-width: 30em){starlight-file-tree:where(.astro-p67cqifm) .tree-entry{flex-wrap:nowrap}}starlight-file-tree:where(.astro-p67cqifm) .tree-entry>:first-child{flex-shrink:0}starlight-file-tree:where(.astro-p67cqifm) .empty{color:var(--sl-color-gray-3);padding-inline-start:.375rem}starlight-file-tree:where(.astro-p67cqifm) .comment{color:var(--sl-color-gray-3);padding-inline-start:1.625rem;max-width:24rem;min-width:12rem}starlight-file-tree:where(.astro-p67cqifm) .highlight{display:inline-block;border-radius:.25rem;padding-inline-end:.5rem;color:var(--sl-color-text-invert);background-color:var(--sl-color-text-accent)}starlight-file-tree:where(.astro-p67cqifm) svg{display:inline;fill:var(--sl-color-gray-3);vertical-align:middle;margin-inline:.25rem .375rem;width:.875rem;height:.875rem}starlight-file-tree:where(.astro-p67cqifm) .highlight svg.tree-icon{fill:currentColor}}
@layer starlight.components{.sl-link-button:where(.astro-xwgiixxa){align-items:center;border:1px solid transparent;border-radius:999rem;display:inline-flex;font-size:var(--sl-text-sm);gap:.5em;line-height:1.1875;outline-offset:.25rem;padding:.4375rem 1.125rem;text-decoration:none}.sl-link-button:where(.astro-xwgiixxa).primary{background:var(--sl-color-text-accent);border-color:var(--sl-color-text-accent);color:var(--sl-color-black)}.sl-link-button:where(.astro-xwgiixxa).primary:hover{color:var(--sl-color-black)}.sl-link-button:where(.astro-xwgiixxa).secondary{border-color:inherit;color:var(--sl-color-white)}.sl-link-button:where(.astro-xwgiixxa).minimal{color:var(--sl-color-white);padding-inline:0}.sl-link-button:where(.astro-xwgiixxa) svg{flex-shrink:0}@media (min-width: 50rem){.sl-link-button:where(.astro-xwgiixxa){font-size:var(--sl-text-base);padding:.9375rem 1.25rem}}.sl-markdown-content .sl-link-button:where(.astro-xwgiixxa){margin-inline-end:1rem}.sl-markdown-content .sl-link-button:where(.astro-xwgiixxa):not(:where(p *)){margin-block:1rem}}
</style><script type="module" src="/_astro/page.B1D-nYk3.js"></script></head> <body class="astro-bguv2lll"> <a href="#_top" class="astro-7q3lir66">Skip to content</a>  <div class="page sl-flex astro-vrdttmbt"> <header class="header astro-vrdttmbt"><div class="header astro-kmkmnagf"> <div class="title-wrapper sl-flex astro-kmkmnagf"> <a href="/" class="site-title sl-flex astro-m46x6ez3">  <img class="astro-m46x6ez3" alt src="/_astro/luxe-dark.NVYNGKCT.svg" width="239" height="380">  <span class="astro-m46x6ez3" translate="no"> luxe docs </span> </a>  </div> <div class="sl-flex print:hidden astro-kmkmnagf"> <site-search class="astro-kmkmnagf astro-v37mnknz" data-translations="{&#34;placeholder&#34;:&#34;Search&#34;}"> <button data-open-modal disabled aria-label="Search" aria-keyshortcuts="Control+K" class="astro-v37mnknz"> <svg aria-hidden="true" class="astro-v37mnknz astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.71 20.29 18 16.61A9 9 0 1 0 16.61 18l3.68 3.68a.999.999 0 0 0 1.42 0 1 1 0 0 0 0-1.39ZM11 18a7 7 0 1 1 0-14 7 7 0 0 1 0 14Z"/></svg> <span class="sl-hidden md:sl-block astro-v37mnknz" aria-hidden="true">Search</span> <kbd class="sl-hidden md:sl-flex astro-v37mnknz" style="display: none;"> <kbd class="astro-v37mnknz">Ctrl</kbd><kbd class="astro-v37mnknz">K</kbd> </kbd> </button> <dialog style="padding:0" aria-label="Search" class="astro-v37mnknz"> <div class="dialog-frame sl-flex astro-v37mnknz">  <button data-close-modal class="sl-flex md:sl-hidden astro-v37mnknz"> Cancel </button> <div class="search-container astro-v37mnknz"> <div id="starlight__search" class="astro-v37mnknz"></div> </div> </div> </dialog> </site-search>  <script>
	(() => {
		const openBtn = document.querySelector('button[data-open-modal]');
		const shortcut = openBtn?.querySelector('kbd');
		if (!openBtn || !(shortcut instanceof HTMLElement)) return;
		const platformKey = shortcut.querySelector('kbd');
		if (platformKey && /(Mac|iPhone|iPod|iPad)/i.test(navigator.platform)) {
			platformKey.textContent = 'âŒ˜';
			openBtn.setAttribute('aria-keyshortcuts', 'Meta+K');
		}
		shortcut.style.display = '';
	})();
</script> <script type="module" src="/_astro/Search.astro_astro_type_script_index_0_lang.cjYDvRdi.js"></script>   </div> <div class="sl-hidden md:sl-flex print:hidden right-group astro-kmkmnagf"> <div class="sl-flex social-icons astro-kmkmnagf"> <a href="https://github.com/withastro/starlight" rel="me" class="sl-flex astro-wy4te6ga"><span class="sr-only astro-wy4te6ga">GitHub</span><svg aria-hidden="true" class="astro-wy4te6ga astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"/></svg></a> </div> <starlight-kbd-picker class="astro-k5ijk5yq"> <label class="not-content astro-e2vmghfl"> <span class="sr-only astro-e2vmghfl">Select keyboard type</span> <svg xmlns="http://www.w3.org/2000/svg" class="icon label-icon astro-e2vmghfl" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"> <path d="M6.21 13.29a.93.93 0 0 0-.33-.21 1 1 0 0 0-.76 0 .9.9 0 0 0-.54.54 1 1 0 1 0 1.84 0 1 1 0 0 0-.21-.33ZM13.5 11h1a1 1 0 0 0 0-2h-1a1 1 0 0 0 0 2Zm-4 0h1a1 1 0 0 0 0-2h-1a1 1 0 0 0 0 2Zm-3-2h-1a1 1 0 0 0 0 2h1a1 1 0 0 0 0-2ZM20 5H4a3 3 0 0 0-3 3v8a3 3 0 0 0 3 3h16a3 3 0 0 0 3-3V8a3 3 0 0 0-3-3Zm1 11a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1h16a1 1 0 0 1 1 1Zm-6-3H9a1 1 0 0 0 0 2h6a1 1 0 0 0 0-2Zm3.5-4h-1a1 1 0 0 0 0 2h1a1 1 0 0 0 0-2Zm.71 4.29a1 1 0 0 0-.33-.21 1 1 0 0 0-.76 0 .93.93 0 0 0-.33.21 1 1 0 0 0-.21.33 1 1 0 1 0 1.92.38.84.84 0 0 0-.08-.38 1 1 0 0 0-.21-.33Z" class="astro-e2vmghfl"></path> </svg> <select autocomplete="off" value="default" class="astro-e2vmghfl"> <option selected value="default" class="astro-e2vmghfl">Default Keys</option><option value="windows" class="astro-e2vmghfl">Windows</option><option value="mac" class="astro-e2vmghfl">macOS</option> </select> <svg aria-hidden="true" class="icon caret astro-e2vmghfl astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg> </label>  </starlight-kbd-picker> <script>
  StarlightKbdProvider.updateKbdPickers(typeof localStorage !== 'undefined' && localStorage.getItem('sl-kbd-type'))
</script> <script type="module">customElements.define("starlight-kbd-picker",class extends HTMLElement{constructor(){super(),this.querySelector("select")?.addEventListener("change",e=>{if(e.currentTarget instanceof HTMLSelectElement){StarlightKbdProvider.updateKbdPickers(e.currentTarget.value);for(const t of document.querySelectorAll("[data-sl-kbd-type]"))t.getAttribute("data-sl-kbd-type")===e.currentTarget.value?t.setAttribute("data-sl-kbd-active",""):t.removeAttribute("data-sl-kbd-active");typeof localStorage<"u"&&localStorage.setItem("sl-kbd-type",e.currentTarget.value)}})}});</script>  <starlight-theme-select>  <label style="--sl-select-width: 6.25em" class="astro-4yphtoen"> <span class="sr-only astro-4yphtoen">Select theme</span> <svg aria-hidden="true" class="icon label-icon astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg> <select autocomplete="off" class="astro-4yphtoen"> <option value="dark" class="astro-4yphtoen">Dark</option><option value="light" class="astro-4yphtoen">Light</option><option value="auto" selected class="astro-4yphtoen">Auto</option> </select> <svg aria-hidden="true" class="icon caret astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg> </label>  </starlight-theme-select>  <script>
	StarlightThemeProvider.updatePickers();
</script> <script type="module">const r="starlight-theme",o=e=>e==="auto"||e==="dark"||e==="light"?e:"auto",c=()=>o(typeof localStorage<"u"&&localStorage.getItem(r));function n(e){typeof localStorage<"u"&&localStorage.setItem(r,e==="light"||e==="dark"?e:"")}const l=()=>matchMedia("(prefers-color-scheme: light)").matches?"light":"dark";function t(e){StarlightThemeProvider.updatePickers(e),document.documentElement.dataset.theme=e==="auto"?l():e,n(e)}matchMedia("(prefers-color-scheme: light)").addEventListener("change",()=>{c()==="auto"&&t("auto")});class s extends HTMLElement{constructor(){super(),t(c()),this.querySelector("select")?.addEventListener("change",a=>{a.currentTarget instanceof HTMLSelectElement&&t(o(a.currentTarget.value))})}}customElements.define("starlight-theme-select",s);</script> <script type="module">class s extends HTMLElement{constructor(){super();const e=this.querySelector("select");e&&(e.addEventListener("change",t=>{t.currentTarget instanceof HTMLSelectElement&&(window.location.pathname=t.currentTarget.value)}),window.addEventListener("pageshow",t=>{if(!t.persisted)return;const n=e.querySelector("option[selected]")?.index;n!==e.selectedIndex&&(e.selectedIndex=n??0)}))}}customElements.define("starlight-lang-select",s);</script> </div> </div> </header> <nav class="sidebar print:hidden astro-vrdttmbt" aria-label="Main"> <starlight-menu-button class="print:hidden astro-jif73yzw"> <button aria-expanded="false" aria-label="Menu" aria-controls="starlight__sidebar" class="sl-flex md:sl-hidden astro-jif73yzw"> <svg aria-hidden="true" class="open-menu astro-jif73yzw astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M3 8h18a1 1 0 1 0 0-2H3a1 1 0 0 0 0 2Zm18 8H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Zm0-5H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Z"/></svg> <svg aria-hidden="true" class="close-menu astro-jif73yzw astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="m13.41 12 6.3-6.29a1.004 1.004 0 1 0-1.42-1.42L12 10.59l-6.29-6.3a1.004 1.004 0 0 0-1.42 1.42l6.3 6.29-6.3 6.29a1 1 0 0 0 0 1.42.998.998 0 0 0 1.42 0l6.29-6.3 6.29 6.3a.999.999 0 0 0 1.42 0 1 1 0 0 0 0-1.42L13.41 12Z"/></svg> </button> </starlight-menu-button> <script type="module">class s extends HTMLElement{constructor(){super(),this.btn=this.querySelector("button"),this.btn.addEventListener("click",()=>this.toggleExpanded());const t=this.closest("nav");t&&t.addEventListener("keyup",e=>this.closeOnEscape(e))}setExpanded(t){this.setAttribute("aria-expanded",String(t)),document.body.toggleAttribute("data-mobile-menu-expanded",t)}toggleExpanded(){this.setExpanded(this.getAttribute("aria-expanded")!=="true")}closeOnEscape(t){t.code==="Escape"&&(this.setExpanded(!1),this.btn.focus())}}customElements.define("starlight-menu-button",s);</script>   <div id="starlight__sidebar" class="sidebar-pane astro-vrdttmbt"> <div class="sidebar-content sl-flex astro-vrdttmbt"> <sl-sidebar-state-persist data-hash="1i3tmxa" class="astro-kku4brbg"> <script aria-hidden="true">
		(() => {
			try {
				if (!matchMedia('(min-width: 50em)').matches) return;
				/** @type {HTMLElement | null} */
				const target = document.querySelector('sl-sidebar-state-persist');
				const state = JSON.parse(sessionStorage.getItem('sl-sidebar-state') || '0');
				if (!target || !state || target.dataset.hash !== state.hash) return;
				window._starlightScrollRestore = state.scroll;
				customElements.define(
					'sl-sidebar-restore',
					class SidebarRestore extends HTMLElement {
						connectedCallback() {
							try {
								const idx = parseInt(this.dataset.index || '');
								const details = this.closest('details');
								if (details && typeof state.open[idx] === 'boolean') details.open = state.open[idx];
							} catch {}
						}
					}
				);
			} catch {}
		})();
	</script>  <ul class="top-level astro-3ii7xxms"> <li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Welcome</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="0"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/welcome/about/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">About</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/welcome/get/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Installing Luxe</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Getting Started</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="1"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/getting-started/luxe-101/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Luxe 101</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/getting-started/create-a-project/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Create and run a project</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/getting-started/draw-and-input/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Drawing and input</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/getting-started/world/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">World systems</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/getting-started/luxe-editor/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">The luxe editor</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/getting-started/build/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Making a build</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/getting-started/audio/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Adding sounds</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Tutorials</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="2"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Concepts</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="3"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/tutorials/concepts/overview/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Overview</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/tutorials/concepts/yarn/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Dialogue</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Cards &amp; Decks</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="4"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/tutorials/cards--decks/cardsdecks/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Cards &amp; Decks</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Match 3</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="5"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/tutorials/match-3/part1/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Match 3 - Game logic</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/tutorials/match-3/part2/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Match 3 - Animating changes</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/tutorials/match-3/part3/" aria-current="page" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Match 3 - After the prototype</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/tutorials/match-3/part4/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Match 3 - Sprite visuals</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Platformer</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="6"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/tutorials/platformer/platformer-first-steps/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">First steps</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/tutorials/platformer/platformer-next-steps/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Next steps</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/tutorials/platformer/platformer-the-rest/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">The rest</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Top down</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="7"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/tutorials/topdown/topdown-first-steps/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">First steps</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/tutorials/topdown/topdown-next-steps/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Next steps</span>  </a> </li> </ul>  </details> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Manual</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="8"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/manual/overview/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Overview</span>  </a> </li><li class="astro-3ii7xxms"> <details class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">modules</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="9"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/manual/modules/modules/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Using Modules</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">project</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="10"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/manual/project/anatomy/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Anatomy</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">render</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="11"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/manual/render/draw/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Draw tool</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">scripting</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="12"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/manual/scripting/multiple-files/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Multiple wren files</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/manual/scripting/random/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Random numbers</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">tools</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="13"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/manual/tools/save/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Save data</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">world</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="14"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/manual/world/camera/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Camera</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/manual/world/custom-modifiers/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Custom Modifiers</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/manual/world/states/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">States</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/manual/world/tilemaps/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Tile maps</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/manual/world/ui/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">UI</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/manual/world/wires/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Wires (events)</span>  </a> </li> </ul>  </details> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <a href="https://api.luxeengine.com/" aria-current="false" class="large astro-3ii7xxms"> <span class="astro-3ii7xxms">API reference</span>  </a> </li> </ul>   <script aria-hidden="true">
		(() => {
			const scroller = document.getElementById('starlight__sidebar');
			if (!window._starlightScrollRestore || !scroller) return;
			scroller.scrollTop = window._starlightScrollRestore;
			delete window._starlightScrollRestore;
		})();
	</script> </sl-sidebar-state-persist>  <div class="md:sl-hidden"> <div class="mobile-preferences sl-flex astro-wu23bvmt"> <div class="social-icons astro-wu23bvmt"> <a href="https://github.com/withastro/starlight" rel="me" class="sl-flex astro-wy4te6ga"><span class="sr-only astro-wy4te6ga">GitHub</span><svg aria-hidden="true" class="astro-wy4te6ga astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"/></svg></a> </div> <starlight-kbd-picker class="astro-k5ijk5yq"> <label class="not-content astro-e2vmghfl"> <span class="sr-only astro-e2vmghfl">Select keyboard type</span> <svg xmlns="http://www.w3.org/2000/svg" class="icon label-icon astro-e2vmghfl" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"> <path d="M6.21 13.29a.93.93 0 0 0-.33-.21 1 1 0 0 0-.76 0 .9.9 0 0 0-.54.54 1 1 0 1 0 1.84 0 1 1 0 0 0-.21-.33ZM13.5 11h1a1 1 0 0 0 0-2h-1a1 1 0 0 0 0 2Zm-4 0h1a1 1 0 0 0 0-2h-1a1 1 0 0 0 0 2Zm-3-2h-1a1 1 0 0 0 0 2h1a1 1 0 0 0 0-2ZM20 5H4a3 3 0 0 0-3 3v8a3 3 0 0 0 3 3h16a3 3 0 0 0 3-3V8a3 3 0 0 0-3-3Zm1 11a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1h16a1 1 0 0 1 1 1Zm-6-3H9a1 1 0 0 0 0 2h6a1 1 0 0 0 0-2Zm3.5-4h-1a1 1 0 0 0 0 2h1a1 1 0 0 0 0-2Zm.71 4.29a1 1 0 0 0-.33-.21 1 1 0 0 0-.76 0 .93.93 0 0 0-.33.21 1 1 0 0 0-.21.33 1 1 0 1 0 1.92.38.84.84 0 0 0-.08-.38 1 1 0 0 0-.21-.33Z" class="astro-e2vmghfl"></path> </svg> <select autocomplete="off" value="default" class="astro-e2vmghfl"> <option selected value="default" class="astro-e2vmghfl">Default Keys</option><option value="windows" class="astro-e2vmghfl">Windows</option><option value="mac" class="astro-e2vmghfl">macOS</option> </select> <svg aria-hidden="true" class="icon caret astro-e2vmghfl astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg> </label>  </starlight-kbd-picker> <script>
  StarlightKbdProvider.updateKbdPickers(typeof localStorage !== 'undefined' && localStorage.getItem('sl-kbd-type'))
</script>   <starlight-theme-select>  <label style="--sl-select-width: 6.25em" class="astro-4yphtoen"> <span class="sr-only astro-4yphtoen">Select theme</span> <svg aria-hidden="true" class="icon label-icon astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg> <select autocomplete="off" class="astro-4yphtoen"> <option value="dark" class="astro-4yphtoen">Dark</option><option value="light" class="astro-4yphtoen">Light</option><option value="auto" selected class="astro-4yphtoen">Auto</option> </select> <svg aria-hidden="true" class="icon caret astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg> </label>  </starlight-theme-select>  <script>
	StarlightThemeProvider.updatePickers();
</script>   </div>  </div> </div> </div> </nav> <div class="main-frame astro-vrdttmbt">  <script type="module">const a=document.getElementById("starlight__sidebar"),n=a?.querySelector("sl-sidebar-state-persist"),o="sl-sidebar-state",i=()=>{let t=[];const e=n?.dataset.hash||"";try{const s=sessionStorage.getItem(o),r=JSON.parse(s||"{}");Array.isArray(r.open)&&r.hash===e&&(t=r.open)}catch{}return{hash:e,open:t,scroll:a?.scrollTop||0}},c=t=>{try{sessionStorage.setItem(o,JSON.stringify(t))}catch{}},d=()=>c(i()),l=(t,e)=>{const s=i();s.open[e]=t,c(s)};n?.addEventListener("click",t=>{if(!(t.target instanceof Element))return;const e=t.target.closest("summary")?.closest("details");if(!e)return;const s=e.querySelector("sl-sidebar-restore"),r=parseInt(s?.dataset.index||"");isNaN(r)||l(!e.open,r)});addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&d()});addEventListener("pageHide",d);</script> <div class="lg:sl-flex astro-67yu43on"> <aside class="right-sidebar-container print:hidden astro-67yu43on"> <div class="right-sidebar astro-67yu43on"> <div class="lg:sl-hidden astro-pb3aqygn"><mobile-starlight-toc data-min-h="2" data-max-h="3" class="astro-doynk5tl"><nav aria-labelledby="starlight__on-this-page--mobile" class="astro-doynk5tl"><details id="starlight__mobile-toc" class="astro-doynk5tl"><summary id="starlight__on-this-page--mobile" class="sl-flex astro-doynk5tl"><span class="toggle sl-flex astro-doynk5tl">On this page<svg aria-hidden="true" class="caret astro-doynk5tl astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg></span><span class="display-current astro-doynk5tl"></span></summary><div class="dropdown astro-doynk5tl"><ul class="isMobile astro-g2bywc46" style="--depth: 0;"> <li class="astro-g2bywc46" style="--depth: 0;"> <a href="#_top" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Overview</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#see-it-in-motion" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">See it in motion</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#grid-input-ownership" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Grid Input ownership</span> </a> <ul class="isMobile astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#grid-changes" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Grid changes</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#the-grid-api" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">The Grid API</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#the-implementation-details" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">The implementation details</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#cleaning-up-the-tick-function" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Cleaning up the tick function</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#the-input-system" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">The input system</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#the-input-handling-logic" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">The input handling logic</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#grid-visuals" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Grid Visuals</span> </a> <ul class="isMobile astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#the-imports" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">The imports</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#the-data" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">The data</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#the-grid-visuals-api" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">The grid visuals API</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#the-grid-visuals-system" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">The grid visuals System</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#conversion-helpers" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Conversion helpers</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#the-actual-drawing" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">The actual drawing</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#the-gridinput-changes" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">The GridInput changes</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#something-for-nothing" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Something for Nothing</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#brief-detour-the-debug-module" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Brief detour: the Debug module</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#using-transform" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Using Transform</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#next-time" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Next time!</span> </a>  </li> </ul> </div></details></nav></mobile-starlight-toc><script type="module" src="/_astro/MobileTableOfContents.astro_astro_type_script_index_0_lang.C181hMzK.js"></script></div><div class="right-sidebar-panel sl-hidden lg:sl-block astro-pb3aqygn"><div class="sl-container astro-pb3aqygn"><starlight-toc data-min-h="2" data-max-h="3"><nav aria-labelledby="starlight__on-this-page"><h2 id="starlight__on-this-page">On this page</h2><ul class="astro-g2bywc46" style="--depth: 0;"> <li class="astro-g2bywc46" style="--depth: 0;"> <a href="#_top" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Overview</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#see-it-in-motion" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">See it in motion</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#grid-input-ownership" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Grid Input ownership</span> </a> <ul class="astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#grid-changes" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Grid changes</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#the-grid-api" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">The Grid API</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#the-implementation-details" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">The implementation details</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#cleaning-up-the-tick-function" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Cleaning up the tick function</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#the-input-system" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">The input system</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#the-input-handling-logic" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">The input handling logic</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#grid-visuals" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Grid Visuals</span> </a> <ul class="astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#the-imports" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">The imports</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#the-data" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">The data</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#the-grid-visuals-api" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">The grid visuals API</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#the-grid-visuals-system" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">The grid visuals System</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#conversion-helpers" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Conversion helpers</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#the-actual-drawing" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">The actual drawing</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#the-gridinput-changes" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">The GridInput changes</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#something-for-nothing" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Something for Nothing</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#brief-detour-the-debug-module" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Brief detour: the Debug module</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#using-transform" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Using Transform</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#next-time" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Next time!</span> </a>  </li> </ul> </nav></starlight-toc><script type="module" src="/_astro/TableOfContents.astro_astro_type_script_index_0_lang.CKWWgpjV.js"></script></div></div> </div> </aside> <div class="main-pane astro-67yu43on">  <main data-pagefind-body class="astro-bguv2lll" lang="en" dir="ltr">    <div class="content-panel astro-7nkwcw3z"> <div class="sl-container astro-7nkwcw3z"> <h1 id="_top" class="astro-j6tvhyss">Match 3 - After the prototype</h1>  </div> </div>  <div class="content-panel astro-7nkwcw3z"> <div class="sl-container astro-7nkwcw3z"> <div class="sl-markdown-content"> <span class="sl-badge success small astro-avdet4wd">Complexity: low</span>
<span class="sl-badge tip small astro-avdet4wd">Game Tutorial</span>
<br>
<br>
<aside aria-label="Outcome / Goals" class="starlight-aside starlight-aside--tip"><p class="starlight-aside__title" aria-hidden="true"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="starlight-aside__icon"><path d="M17 22H5a3 3 0 0 1-3-3V9a3 3 0 0 1 3-3h1a4 4 0 0 1 7.3-2.18c.448.64.692 1.4.7 2.18h3a1 1 0 0 1 1 1v3a4 4 0 0 1 2.18 7.3A3.86 3.86 0 0 1 18 18v3a1 1 0 0 1-1 1ZM5 8a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h11v-3.18a1 1 0 0 1 1.33-.95 1.77 1.77 0 0 0 1.74-.23 2 2 0 0 0 .93-1.37 2 2 0 0 0-.48-1.59 1.89 1.89 0 0 0-2.17-.55 1 1 0 0 1-1.33-.95V8h-3.2a1 1 0 0 1-1-1.33 1.77 1.77 0 0 0-.23-1.74 1.939 1.939 0 0 0-3-.43A2 2 0 0 0 8 6c.002.23.046.456.13.67A1 1 0 0 1 7.18 8H5Z"></path></svg>Outcome / Goals</p><div class="starlight-aside__content"><p>In this tutorial weâ€™ll:</p><ul>
<li>Convert our prototype code into a more structured game</li>
<li>add a <code dir="auto">GridInput</code> and <code dir="auto">GridVisuals</code> system to do so</li>
</ul></div></aside>
<div class="sl-heading-wrapper level-h2"><h2 id="see-it-in-motion">See it in motion</h2><a class="sl-anchor-link" href="#see-it-in-motion"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œSee it in motionâ€</span></a></div>
<p>Part 3 is largely about re-organizing our code into a neater structure.</p>
<video preload="auto" autoplay controls muted playinsline="true" loop style="max-width:100%; width:auto; margin:auto; display:block;"><source src="/video/tutorials/match3/timings.mp4" type="video/mp4"/></video>
<div class="sl-heading-wrapper level-h2"><h2 id="grid-input-ownership">Grid Input ownership</h2><a class="sl-anchor-link" href="#grid-input-ownership"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œGrid Input ownershipâ€</span></a></div>
<p>Instead of having a bunch of code inside our grid logic tick function,
we can move the logic into a modifier dedicated to handling input for the grid.</p>
<p>This allows the input handling to be more nuanced, exposing itâ€™s own API and tools for the game to use without muddying up the grid logic.</p>
<aside aria-label="Note" class="starlight-aside starlight-aside--note"><p class="starlight-aside__title" aria-hidden="true"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="starlight-aside__icon"><path d="M12 11C11.7348 11 11.4804 11.1054 11.2929 11.2929C11.1054 11.4804 11 11.7348 11 12V16C11 16.2652 11.1054 16.5196 11.2929 16.7071C11.4804 16.8946 11.7348 17 12 17C12.2652 17 12.5196 16.8946 12.7071 16.7071C12.8946 16.5196 13 16.2652 13 16V12C13 11.7348 12.8946 11.4804 12.7071 11.2929C12.5196 11.1054 12.2652 11 12 11ZM12.38 7.08C12.1365 6.97998 11.8635 6.97998 11.62 7.08C11.4973 7.12759 11.3851 7.19896 11.29 7.29C11.2017 7.3872 11.1306 7.49882 11.08 7.62C11.024 7.73868 10.9966 7.86882 11 8C10.9992 8.13161 11.0245 8.26207 11.0742 8.38391C11.124 8.50574 11.1973 8.61656 11.29 8.71C11.3872 8.79833 11.4988 8.86936 11.62 8.92C11.7715 8.98224 11.936 9.00632 12.099 8.99011C12.2619 8.97391 12.4184 8.91792 12.5547 8.82707C12.691 8.73622 12.8029 8.61328 12.8805 8.46907C12.9582 8.32486 12.9992 8.16378 13 8C12.9963 7.73523 12.8927 7.48163 12.71 7.29C12.6149 7.19896 12.5028 7.12759 12.38 7.08ZM12 2C10.0222 2 8.08879 2.58649 6.4443 3.6853C4.79981 4.78412 3.51809 6.3459 2.76121 8.17317C2.00433 10.0004 1.8063 12.0111 2.19215 13.9509C2.578 15.8907 3.53041 17.6725 4.92894 19.0711C6.32746 20.4696 8.10929 21.422 10.0491 21.8079C11.9889 22.1937 13.9996 21.9957 15.8268 21.2388C17.6541 20.4819 19.2159 19.2002 20.3147 17.5557C21.4135 15.9112 22 13.9778 22 12C22 10.6868 21.7413 9.38642 21.2388 8.17317C20.7363 6.95991 19.9997 5.85752 19.0711 4.92893C18.1425 4.00035 17.0401 3.26375 15.8268 2.7612C14.6136 2.25866 13.3132 2 12 2ZM12 20C10.4178 20 8.87104 19.5308 7.55544 18.6518C6.23985 17.7727 5.21447 16.5233 4.60897 15.0615C4.00347 13.5997 3.84504 11.9911 4.15372 10.4393C4.4624 8.88743 5.22433 7.46197 6.34315 6.34315C7.46197 5.22433 8.88743 4.4624 10.4393 4.15372C11.9911 3.84504 13.5997 4.00346 15.0615 4.60896C16.5233 5.21447 17.7727 6.23984 18.6518 7.55544C19.5308 8.87103 20 10.4177 20 12C20 14.1217 19.1572 16.1566 17.6569 17.6569C16.1566 19.1571 14.1217 20 12 20Z"></path></svg>Note</p><div class="starlight-aside__content"><p>We use the word ownership because thinking about which code/system owns a responsibility helps keep our code well structured.</p></div></aside>
<div class="sl-heading-wrapper level-h3"><h3 id="grid-changes">Grid changes</h3><a class="sl-anchor-link" href="#grid-changes"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œGrid changesâ€</span></a></div>
<p>The grid doesnâ€™t really care about <em>input</em> specifically, it cares about a <em>cursor</em> location and a <em>selected</em> location.</p>
<p>Weâ€™ll start by changing our <code dir="auto">grid.modifier.wren</code>, specifically the <code dir="auto">Data</code> class, to add a cursor:</p>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.9unvh.css"><script type="module" src="/_astro/ec.p1z7b.js"></script><figure class="frame has-title not-content"><figcaption class="header"><span class="title">system/grid.modifier.wren...Data</span></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#81C8BE;--1:#116E73">...</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//existing code</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">#doc = "Currently selected cell"</span></div></div><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> selected: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Float2</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> [</span><span style="--0:#EF9F76;--1:#AB4307">-1</span><span style="--0:#C6D0F5;--1:#4C4F69">,</span><span style="--0:#EF9F76;--1:#AB4307">-1</span><span style="--0:#C6D0F5;--1:#4C4F69">]</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">#doc = "Currently highlighted cell"</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> cursor: </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Float2</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> [</span><span style="--0:#f0a57f;--1:#833305">-1</span><span style="--0:#C6D0F5;--1:#474a62">,</span><span style="--0:#f0a57f;--1:#833305">-1</span><span style="--0:#C6D0F5;--1:#474a62">]</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="... //existing code#doc = &#x22;Currently selected cell&#x22;var selected: Float2 = [-1,-1]#doc = &#x22;Currently highlighted cell&#x22;var cursor: Float2 = [-1,-1]"><div></div></button></div></figure></div>
<p>This allows us to set the cursor from the grid input system.</p>
<div class="sl-heading-wrapper level-h3"><h3 id="the-grid-api">The Grid API</h3><a class="sl-anchor-link" href="#the-grid-api"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œThe Grid APIâ€</span></a></div>
<p>Weâ€™ll also need to speak to the grid from elsewhere in our game, which is what the <code dir="auto">API</code> class is for!
Thereâ€™s a few pieces of the puzzle that weâ€™ll need.</p>
<aside aria-label="Iterative change" class="starlight-aside starlight-aside--tip"><p class="starlight-aside__title" aria-hidden="true"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="starlight-aside__icon"><path d="M17 22H5a3 3 0 0 1-3-3V9a3 3 0 0 1 3-3h1a4 4 0 0 1 7.3-2.18c.448.64.692 1.4.7 2.18h3a1 1 0 0 1 1 1v3a4 4 0 0 1 2.18 7.3A3.86 3.86 0 0 1 18 18v3a1 1 0 0 1-1 1ZM5 8a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h11v-3.18a1 1 0 0 1 1.33-.95 1.77 1.77 0 0 0 1.74-.23 2 2 0 0 0 .93-1.37 2 2 0 0 0-.48-1.59 1.89 1.89 0 0 0-2.17-.55 1 1 0 0 1-1.33-.95V8h-3.2a1 1 0 0 1-1-1.33 1.77 1.77 0 0 0-.23-1.74 1.939 1.939 0 0 0-3-.43A2 2 0 0 0 8 6c.002.23.046.456.13.67A1 1 0 0 1 7.18 8H5Z"></path></svg>Iterative change</p><div class="starlight-aside__content"><p>Weâ€™re making changes now that are going to be moved around soon after. This is natural, code is squishy!
Weâ€™d like to keep the game working while we iterate, thatâ€™s why weâ€™re doing this in steps.</p></div></aside>
<p>It would be nice to be able to convert coordinates to the grid,
check if a coordinate is within the grid space, and interact with the grid (e.g a select, or swap).
Weâ€™d also need to know if a cell was busy.</p>
<p>The API class is the <em>user facing interface</em> to our system.</p>
<p>What that means is:</p>
<ul>
<li>We should name things clearly</li>
<li>We should add type annotations to describe our intention</li>
<li>We should add documentation to the endpoints</li>
</ul>
<div class="sl-heading-wrapper level-h4"><h4 id="speaking-to-our-system-from-api">Speaking to our system from API</h4><a class="sl-anchor-link" href="#speaking-to-our-system-from-api"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œSpeaking to our system from APIâ€</span></a></div>
<p>Inside our API we have a few helpers to access our system or data for an entity.</p>
<ul>
<li><code dir="auto">system(entity: Entity) : System</code>
<ul>
<li>get our system code from an entity with Grid attached</li>
</ul>
</li>
<li><code dir="auto">system_in(world: World) : System</code>
<ul>
<li>get our system in the given world</li>
</ul>
</li>
<li><code dir="auto">get(entity: Entity) : Data</code>
<ul>
<li>return the data for the given entity</li>
</ul>
</li>
</ul>
<p>This gives us the tools to communicate with the entity, or system based on common inputs to a system.</p>
<aside aria-label="Wrap or not to wrap?" class="starlight-aside starlight-aside--note"><p class="starlight-aside__title" aria-hidden="true"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="starlight-aside__icon"><path d="M12 11C11.7348 11 11.4804 11.1054 11.2929 11.2929C11.1054 11.4804 11 11.7348 11 12V16C11 16.2652 11.1054 16.5196 11.2929 16.7071C11.4804 16.8946 11.7348 17 12 17C12.2652 17 12.5196 16.8946 12.7071 16.7071C12.8946 16.5196 13 16.2652 13 16V12C13 11.7348 12.8946 11.4804 12.7071 11.2929C12.5196 11.1054 12.2652 11 12 11ZM12.38 7.08C12.1365 6.97998 11.8635 6.97998 11.62 7.08C11.4973 7.12759 11.3851 7.19896 11.29 7.29C11.2017 7.3872 11.1306 7.49882 11.08 7.62C11.024 7.73868 10.9966 7.86882 11 8C10.9992 8.13161 11.0245 8.26207 11.0742 8.38391C11.124 8.50574 11.1973 8.61656 11.29 8.71C11.3872 8.79833 11.4988 8.86936 11.62 8.92C11.7715 8.98224 11.936 9.00632 12.099 8.99011C12.2619 8.97391 12.4184 8.91792 12.5547 8.82707C12.691 8.73622 12.8029 8.61328 12.8805 8.46907C12.9582 8.32486 12.9992 8.16378 13 8C12.9963 7.73523 12.8927 7.48163 12.71 7.29C12.6149 7.19896 12.5028 7.12759 12.38 7.08ZM12 2C10.0222 2 8.08879 2.58649 6.4443 3.6853C4.79981 4.78412 3.51809 6.3459 2.76121 8.17317C2.00433 10.0004 1.8063 12.0111 2.19215 13.9509C2.578 15.8907 3.53041 17.6725 4.92894 19.0711C6.32746 20.4696 8.10929 21.422 10.0491 21.8079C11.9889 22.1937 13.9996 21.9957 15.8268 21.2388C17.6541 20.4819 19.2159 19.2002 20.3147 17.5557C21.4135 15.9112 22 13.9778 22 12C22 10.6868 21.7413 9.38642 21.2388 8.17317C20.7363 6.95991 19.9997 5.85752 19.0711 4.92893C18.1425 4.00035 17.0401 3.26375 15.8268 2.7612C14.6136 2.25866 13.3132 2 12 2ZM12 20C10.4178 20 8.87104 19.5308 7.55544 18.6518C6.23985 17.7727 5.21447 16.5233 4.60897 15.0615C4.00347 13.5997 3.84504 11.9911 4.15372 10.4393C4.4624 8.88743 5.22433 7.46197 6.34315 6.34315C7.46197 5.22433 8.88743 4.4624 10.4393 4.15372C11.9911 3.84504 13.5997 4.00346 15.0615 4.60896C16.5233 5.21447 17.7727 6.23984 18.6518 7.55544C19.5308 8.87103 20 10.4177 20 12C20 14.1217 19.1572 16.1566 17.6569 17.6569C16.1566 19.1571 14.1217 20 12 20Z"></path></svg>Wrap or not to wrap?</p><div class="starlight-aside__content"><p>Itâ€™s common for an API function to be a nicer way to access our system or data.</p><p>So a question that comes up: does the logic happen in the <code dir="auto">API</code> class directly,
or do we put all the logic inside the system, and simply forward the call?</p><p>This is really a personal choice! We often wrap the system (like below) and keep all implementation
details inside the <code dir="auto">System</code> class, but thereâ€™s definitely been cases where we have inline API code.</p></div></aside>
<div class="sl-heading-wrapper level-h4"><h4 id="the-api-additions">The API additions</h4><a class="sl-anchor-link" href="#the-api-additions"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œThe API additionsâ€</span></a></div>
<p>Add the following to the our API class:</p>
<div class="expressive-code"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">system/grid.modifier.wren...Grid</span></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">class</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Grid</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#CA9EE6;--1:#8035E0">is</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">API</span><span style="--0:#C6D0F5;--1:#4C4F69"> {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">#doc = "Convert a world space position to grid cell coordinates"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#E5C890;--1:#8B5912">static</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">world_to_grid</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Entity</span><span style="--0:#C6D0F5;--1:#4C4F69">, world_x: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">, world_y: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">) : </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Float2</span><span style="--0:#C6D0F5;--1:#4C4F69"> {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#81C8BE;--1:#116E73">!</span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Grid</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">has</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity)) </span><span style="--0:#CA9EE6;--1:#8035E0">return</span><span style="--0:#C6D0F5;--1:#4C4F69"> [</span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">, </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">]</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> system: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">System</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">system</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity)</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> data: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">get</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">return</span><span style="--0:#C6D0F5;--1:#4C4F69"> system</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">world_to_grid</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, world_x, world_y)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//world_to_grid</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">#doc = "Convert a grid coordinate to world space position"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#E5C890;--1:#8B5912">static</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">grid_to_world</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Entity</span><span style="--0:#C6D0F5;--1:#4C4F69">, grid_x: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">, grid_y: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">) : </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Float2</span><span style="--0:#C6D0F5;--1:#4C4F69"> {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#81C8BE;--1:#116E73">!</span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Grid</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">has</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity)) </span><span style="--0:#CA9EE6;--1:#8035E0">return</span><span style="--0:#C6D0F5;--1:#4C4F69"> [</span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">, </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">]</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> system: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">System</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">system</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity)</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> data: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">get</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">return</span><span style="--0:#C6D0F5;--1:#4C4F69"> system</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">grid_to_world</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, grid_x, grid_y)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//grid_to_world</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">#doc = "Returns a busy task from the given coordinate, if any"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#E5C890;--1:#8B5912">static</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">get_busy</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Entity</span><span style="--0:#C6D0F5;--1:#4C4F69">, grid_x: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">, grid_y: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">) : </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Busy</span><span style="--0:#C6D0F5;--1:#4C4F69"> {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#81C8BE;--1:#116E73">!</span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Grid</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">has</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity)) </span><span style="--0:#CA9EE6;--1:#8035E0">return</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#CA9EE6;--1:#8035E0">null</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> system: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">System</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">system</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">return</span><span style="--0:#C6D0F5;--1:#4C4F69"> system</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">busy_cells[</span><span style="--0:#A6D189;--1:#2D711E">"%(</span><span style="--0:#C6D0F5;--1:#4C4F69">grid_x</span><span style="--0:#A6D189;--1:#2D711E">)-%(</span><span style="--0:#C6D0F5;--1:#4C4F69">grid_y</span><span style="--0:#A6D189;--1:#2D711E">)"</span><span style="--0:#C6D0F5;--1:#4C4F69">]</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//get_busy</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">#doc = "Returns true if the given grid coordinates are within the grid"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#E5C890;--1:#8B5912">static</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">in_grid</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Entity</span><span style="--0:#C6D0F5;--1:#4C4F69">, grid_x: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">, grid_y: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">) : </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Bool</span><span style="--0:#C6D0F5;--1:#4C4F69"> {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#81C8BE;--1:#116E73">!</span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Grid</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">has</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity)) </span><span style="--0:#CA9EE6;--1:#8035E0">return</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#A6D189;--1:#2D711E">false</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> system: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">System</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">system</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity)</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> data: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">get</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">return</span><span style="--0:#C6D0F5;--1:#4C4F69"> system</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">in_grid</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, grid_x, grid_y)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//in_grid</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">#doc = "Interact with the grid, selecting or swapping as needed"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#E5C890;--1:#8B5912">static</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">interact</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Entity</span><span style="--0:#C6D0F5;--1:#4C4F69">) : </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">None</span><span style="--0:#C6D0F5;--1:#4C4F69"> {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#81C8BE;--1:#116E73">!</span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Grid</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">has</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity)) </span><span style="--0:#CA9EE6;--1:#8035E0">return</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> system: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">System</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">system</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">system</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">interact</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//interact</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// Grid</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="class Grid is API {  #doc = &#x22;Convert a world space position to grid cell coordinates&#x22;  static world_to_grid(entity: Entity, world_x: Num, world_y: Num) : Float2 {    if(!Grid.has(entity)) return [0, 0]    var system: System = system(entity)    var data: Data = get(entity)    return system.world_to_grid(data, world_x, world_y)  } //world_to_grid  #doc = &#x22;Convert a grid coordinate to world space position&#x22;  static grid_to_world(entity: Entity, grid_x: Num, grid_y: Num) : Float2 {    if(!Grid.has(entity)) return [0, 0]    var system: System = system(entity)    var data: Data = get(entity)    return system.grid_to_world(data, grid_x, grid_y)  } //grid_to_world  #doc = &#x22;Returns a busy task from the given coordinate, if any&#x22;  static get_busy(entity: Entity, grid_x: Num, grid_y: Num) : Busy {    if(!Grid.has(entity)) return null    var system: System = system(entity)    return system.busy_cells[&#x22;%(grid_x)-%(grid_y)&#x22;]  } //get_busy  #doc = &#x22;Returns true if the given grid coordinates are within the grid&#x22;  static in_grid(entity: Entity, grid_x: Num, grid_y: Num) : Bool {    if(!Grid.has(entity)) return false    var system: System = system(entity)    var data: Data = get(entity)    return system.in_grid(data, grid_x, grid_y)  } //in_grid  #doc = &#x22;Interact with the grid, selecting or swapping as needed&#x22;  static interact(entity: Entity) : None {    if(!Grid.has(entity)) return    var system: System = system(entity)    system.interact(entity)  } //interact} // Grid"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="the-implementation-details">The implementation details</h3><a class="sl-anchor-link" href="#the-implementation-details"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œThe implementation detailsâ€</span></a></div>
<p>Now that weâ€™ve exposed an API forwarding calls to our system,
we should add the implementation details for those functions.</p>
<p>The <code dir="auto">in_grid</code> and coordinate functions already existed, so we only need one: <code dir="auto">interact</code>.</p>
<p>Add the following function to your <code dir="auto">System</code> class.
Note that it takes the entity this time, and is a lot cleaner and easier to understand.</p>
<div class="expressive-code"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">system/grid.modifier.wren...System</span></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">interact</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Entity</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> data: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">get</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity)</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> cursor </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">cursor</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> selected </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">selected</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//trying to select the same cell? deselect and do nothing</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">selected</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">x </span><span style="--0:#81C8BE;--1:#116E73">==</span><span style="--0:#C6D0F5;--1:#4C4F69"> cursor</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">x </span><span style="--0:#81C8BE;--1:#116E73">&#x26;&#x26;</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">selected</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">y </span><span style="--0:#81C8BE;--1:#116E73">==</span><span style="--0:#C6D0F5;--1:#4C4F69"> cursor</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">y) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">selected </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> [</span><span style="--0:#EF9F76;--1:#AB4307">-1</span><span style="--0:#C6D0F5;--1:#4C4F69">, </span><span style="--0:#EF9F76;--1:#AB4307">-1</span><span style="--0:#C6D0F5;--1:#4C4F69">]</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">return</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//if we have a selection, and it's adjacent to the cursor, swap</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">is_adjacent</span><span style="--0:#C6D0F5;--1:#4C4F69">(selected</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">x, selected</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">y, cursor</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">x, cursor</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">y)) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">swap</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, selected</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">x, selected</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">y, cursor</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">x, cursor</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">y)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">selected </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> [</span><span style="--0:#EF9F76;--1:#AB4307">-1</span><span style="--0:#C6D0F5;--1:#4C4F69">, </span><span style="--0:#EF9F76;--1:#AB4307">-1</span><span style="--0:#C6D0F5;--1:#4C4F69">]</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">return</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//no selection, and no swap, update our selection</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">selected </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> [cursor</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">x, cursor</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">y]</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//interact</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="interact(entity: Entity) {  var data: Data = get(entity)  var cursor = data.cursor  var selected = data.selected  //trying to select the same cell? deselect and do nothing  if(data.selected.x == cursor.x &#x26;&#x26; data.selected.y == cursor.y) {    data.selected = [-1, -1]    return  }  //if we have a selection, and it&#x27;s adjacent to the cursor, swap  if(is_adjacent(selected.x, selected.y, cursor.x, cursor.y)) {    swap(data, selected.x, selected.y, cursor.x, cursor.y)    data.selected = [-1, -1]    return  }  //no selection, and no swap, update our selection  data.selected = [cursor.x, cursor.y]} //interact"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="cleaning-up-the-tick-function">Cleaning up the tick function</h3><a class="sl-anchor-link" href="#cleaning-up-the-tick-function"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œCleaning up the tick functionâ€</span></a></div>
<p>Hereâ€™s the code weâ€™ll be removing from the <code dir="auto">tick</code> function in our grid <code dir="auto">System</code> class:</p>
<div class="expressive-code"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">system/grid.modifier.wren...System</span></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// tick busy tasks</span></div></div><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">tick_busy</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, delta)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight del"><div class="code"><span style="--0:#cea5e8;--1:#6028a8">var</span><span style="--0:#C6D0F5;--1:#45485f"> grid_mouse </span><span style="--0:#81C8BE;--1:#0d5356">=</span><span style="--0:#C6D0F5;--1:#45485f"> </span><span style="--0:#99b4f0;--0fs:italic;--1:#1444a4;--1fs:italic">world_to_grid</span><span style="--0:#C6D0F5;--1:#45485f">(data, mouse</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#C6D0F5;--1:#45485f">x, mouse</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#C6D0F5;--1:#45485f">y)</span></div></div><div class="ec-line highlight del"><div class="code"><span style="--0:#cea5e8;--1:#6028a8">var</span><span style="--0:#C6D0F5;--1:#45485f"> valid_mouse </span><span style="--0:#81C8BE;--1:#0d5356">=</span><span style="--0:#C6D0F5;--1:#45485f"> </span><span style="--0:#99b4f0;--0fs:italic;--1:#1444a4;--1fs:italic">in_grid</span><span style="--0:#C6D0F5;--1:#45485f">(data, grid_mouse</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#C6D0F5;--1:#45485f">x, grid_mouse</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#C6D0F5;--1:#45485f">y)</span></div></div><div class="ec-line highlight del"><div class="code">
</div></div><div class="ec-line highlight del"><div class="code"><span style="--0:#cea5e8;--1:#6028a8">var</span><span style="--0:#C6D0F5;--1:#45485f"> selected </span><span style="--0:#81C8BE;--1:#0d5356">=</span><span style="--0:#C6D0F5;--1:#45485f"> data</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#C6D0F5;--1:#45485f">selected</span></div></div><div class="ec-line highlight del"><div class="code"><span style="--0:#cea5e8;--1:#6028a8">var</span><span style="--0:#C6D0F5;--1:#45485f"> had_selected </span><span style="--0:#81C8BE;--1:#0d5356">=</span><span style="--0:#C6D0F5;--1:#45485f"> selected</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#C6D0F5;--1:#45485f">x </span><span style="--0:#81C8BE;--1:#0d5356">!=</span><span style="--0:#C6D0F5;--1:#45485f"> </span><span style="--0:#f0a27a;--1:#803205">-1</span><span style="--0:#C6D0F5;--1:#45485f"> </span><span style="--0:#81C8BE;--1:#0d5356">&#x26;&#x26;</span><span style="--0:#C6D0F5;--1:#45485f"> selected</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#C6D0F5;--1:#45485f">y </span><span style="--0:#81C8BE;--1:#0d5356">!=</span><span style="--0:#C6D0F5;--1:#45485f"> </span><span style="--0:#f0a27a;--1:#803205">-1</span></div></div><div class="ec-line highlight del"><div class="code"><span style="--0:#cea5e8;--1:#6028a8">if</span><span style="--0:#C6D0F5;--1:#45485f">(had_selected) {</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">  </span><span style="--0:#cea5e8;--1:#6028a8">var</span><span style="--0:#C6D0F5;--1:#45485f"> selected_pos </span><span style="--0:#81C8BE;--1:#0d5356">=</span><span style="--0:#C6D0F5;--1:#45485f"> </span><span style="--0:#99b4f0;--0fs:italic;--1:#1444a4;--1fs:italic">grid_to_world</span><span style="--0:#C6D0F5;--1:#45485f">(data, selected</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#C6D0F5;--1:#45485f">x, selected</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#C6D0F5;--1:#45485f">y)</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">  </span><span style="--0:#E5C890;--0fs:italic;--1:#68430e;--1fs:italic">Draw</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#99b4f0;--0fs:italic;--1:#1444a4;--1fs:italic">rect</span><span style="--0:#C6D0F5;--1:#45485f">(draw,</span></div></div><div class="ec-line highlight del"><div class="code"><span style="--1:#45485f"><span class="indent"><span style="--0:#C6D0F5">    </span></span><span style="--0:#C6D0F5">selected_pos</span></span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#C6D0F5;--1:#45485f">x, selected_pos</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#C6D0F5;--1:#45485f">y, </span><span style="--0:#f0a27a;--1:#803205">0</span><span style="--0:#C6D0F5;--1:#45485f">,</span></div></div><div class="ec-line highlight del"><div class="code"><span style="--1:#45485f"><span class="indent"><span style="--0:#C6D0F5">    </span></span><span style="--0:#C6D0F5">block_width, block_height, </span></span><span style="--0:#f0a27a;--1:#803205">0</span><span style="--0:#C6D0F5;--1:#45485f">, style</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#99b4f0;--0fs:italic;--1:#1444a4;--1fs:italic">color</span><span style="--0:#C6D0F5;--1:#45485f">(</span><span style="--0:#E5C890;--0fs:italic;--1:#68430e;--1fs:italic">Color</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#C6D0F5;--1:#45485f">pink))</span></div></div><div class="ec-line highlight del"><div class="code"><span style="--0:#C6D0F5;--1:#45485f">}</span></div></div><div class="ec-line highlight del"><div class="code">
</div></div><div class="ec-line highlight del"><div class="code"><span style="--0:#cea5e8;--1:#6028a8">if</span><span style="--0:#C6D0F5;--1:#45485f">(valid_mouse) {</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">  </span><span style="--0:#cea5e8;--1:#6028a8">var</span><span style="--0:#C6D0F5;--1:#45485f"> mouse_draw_pos </span><span style="--0:#81C8BE;--1:#0d5356">=</span><span style="--0:#C6D0F5;--1:#45485f"> </span><span style="--0:#99b4f0;--0fs:italic;--1:#1444a4;--1fs:italic">grid_to_world</span><span style="--0:#C6D0F5;--1:#45485f">(data, grid_mouse</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#C6D0F5;--1:#45485f">x, grid_mouse</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#C6D0F5;--1:#45485f">y)</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">  </span><span style="--0:#E5C890;--0fs:italic;--1:#68430e;--1fs:italic">Draw</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#99b4f0;--0fs:italic;--1:#1444a4;--1fs:italic">rect</span><span style="--0:#C6D0F5;--1:#45485f">(draw,</span></div></div><div class="ec-line highlight del"><div class="code"><span style="--1:#45485f"><span class="indent"><span style="--0:#C6D0F5">    </span></span><span style="--0:#C6D0F5">mouse_draw_pos</span></span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#C6D0F5;--1:#45485f">x, mouse_draw_pos</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#C6D0F5;--1:#45485f">y, </span><span style="--0:#f0a27a;--1:#803205">0</span><span style="--0:#C6D0F5;--1:#45485f">,</span></div></div><div class="ec-line highlight del"><div class="code"><span style="--1:#45485f"><span class="indent"><span style="--0:#C6D0F5">    </span></span><span style="--0:#C6D0F5">block_width, block_height, </span></span><span style="--0:#f0a27a;--1:#803205">0</span><span style="--0:#C6D0F5;--1:#45485f">, style</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#99b4f0;--0fs:italic;--1:#1444a4;--1fs:italic">color</span><span style="--0:#C6D0F5;--1:#45485f">(</span><span style="--0:#E5C890;--0fs:italic;--1:#68430e;--1fs:italic">Color</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#C6D0F5;--1:#45485f">black))</span></div></div><div class="ec-line highlight del"><div class="code">
</div></div><div class="ec-line highlight del"><div class="code"><span class="indent">  </span><span style="--0:#cea5e8;--1:#6028a8">if</span><span style="--0:#C6D0F5;--1:#45485f">(</span><span style="--0:#E5C890;--0fs:italic;--1:#68430e;--1fs:italic">Input</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#99b4f0;--0fs:italic;--1:#1444a4;--1fs:italic">mouse_state_released</span><span style="--0:#C6D0F5;--1:#45485f">(</span><span style="--0:#E5C890;--0fs:italic;--1:#68430e;--1fs:italic">MouseButton</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#C6D0F5;--1:#45485f">left)) {</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">    </span><span style="--0:#cea5e8;--1:#6028a8">if</span><span style="--0:#C6D0F5;--1:#45485f">(had_selected) {</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">      </span><span style="--0:#cea5e8;--1:#6028a8">var</span><span style="--0:#C6D0F5;--1:#45485f"> allow_swap </span><span style="--0:#81C8BE;--1:#0d5356">=</span><span style="--0:#C6D0F5;--1:#45485f"> </span><span style="--0:#99b4f0;--0fs:italic;--1:#1444a4;--1fs:italic">is_adjacent</span><span style="--0:#C6D0F5;--1:#45485f">(selected</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#C6D0F5;--1:#45485f">x, selected</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#C6D0F5;--1:#45485f">y, grid_mouse</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#C6D0F5;--1:#45485f">x, grid_mouse</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#C6D0F5;--1:#45485f">y)</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">      </span><span style="--0:#cea5e8;--1:#6028a8">if</span><span style="--0:#C6D0F5;--1:#45485f">(selected</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#C6D0F5;--1:#45485f">x </span><span style="--0:#81C8BE;--1:#0d5356">==</span><span style="--0:#C6D0F5;--1:#45485f"> grid_mouse</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#C6D0F5;--1:#45485f">x </span><span style="--0:#81C8BE;--1:#0d5356">&#x26;&#x26;</span><span style="--0:#C6D0F5;--1:#45485f"> selected</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#C6D0F5;--1:#45485f">y </span><span style="--0:#81C8BE;--1:#0d5356">==</span><span style="--0:#C6D0F5;--1:#45485f"> grid_mouse</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#C6D0F5;--1:#45485f">y) {</span></div></div><div class="ec-line highlight del"><div class="code"><span style="--1:#45485f"><span class="indent"><span style="--0:#C6D0F5">        </span></span><span style="--0:#C6D0F5">data</span></span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#C6D0F5;--1:#45485f">selected </span><span style="--0:#81C8BE;--1:#0d5356">=</span><span style="--0:#C6D0F5;--1:#45485f"> [</span><span style="--0:#f0a27a;--1:#803205">-1</span><span style="--0:#C6D0F5;--1:#45485f">, </span><span style="--0:#f0a27a;--1:#803205">-1</span><span style="--0:#C6D0F5;--1:#45485f">]</span></div></div><div class="ec-line highlight del"><div class="code"><span style="--1:#45485f"><span class="indent"><span style="--0:#C6D0F5">      </span></span><span style="--0:#C6D0F5">} </span></span><span style="--0:#cea5e8;--1:#6028a8">else</span><span style="--0:#C6D0F5;--1:#45485f"> </span><span style="--0:#cea5e8;--1:#6028a8">if</span><span style="--0:#C6D0F5;--1:#45485f">(allow_swap) {</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">        </span><span style="--0:#99b4f0;--0fs:italic;--1:#1444a4;--1fs:italic">swap</span><span style="--0:#C6D0F5;--1:#45485f">(data, selected</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#C6D0F5;--1:#45485f">x, selected</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#C6D0F5;--1:#45485f">y, grid_mouse</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#C6D0F5;--1:#45485f">x, grid_mouse</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#C6D0F5;--1:#45485f">y)</span></div></div><div class="ec-line highlight del"><div class="code"><span style="--1:#45485f"><span class="indent"><span style="--0:#C6D0F5">        </span></span><span style="--0:#C6D0F5">data</span></span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#C6D0F5;--1:#45485f">selected </span><span style="--0:#81C8BE;--1:#0d5356">=</span><span style="--0:#C6D0F5;--1:#45485f"> [</span><span style="--0:#f0a27a;--1:#803205">-1</span><span style="--0:#C6D0F5;--1:#45485f">, </span><span style="--0:#f0a27a;--1:#803205">-1</span><span style="--0:#C6D0F5;--1:#45485f">]</span></div></div><div class="ec-line highlight del"><div class="code"><span style="--1:#45485f"><span class="indent"><span style="--0:#C6D0F5">      </span></span><span style="--0:#C6D0F5">}</span></span></div></div><div class="ec-line highlight del"><div class="code"><span style="--1:#45485f"><span class="indent"><span style="--0:#C6D0F5">    </span></span><span style="--0:#C6D0F5">} </span></span><span style="--0:#cea5e8;--1:#6028a8">else</span><span style="--0:#C6D0F5;--1:#45485f"> {</span></div></div><div class="ec-line highlight del"><div class="code"><span style="--1:#45485f"><span class="indent"><span style="--0:#C6D0F5">      </span></span><span style="--0:#C6D0F5">data</span></span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#C6D0F5;--1:#45485f">selected </span><span style="--0:#81C8BE;--1:#0d5356">=</span><span style="--0:#C6D0F5;--1:#45485f"> grid_mouse</span></div></div><div class="ec-line highlight del"><div class="code"><span style="--1:#45485f"><span class="indent"><span style="--0:#C6D0F5">    </span></span><span style="--0:#C6D0F5">}</span></span></div></div><div class="ec-line highlight del"><div class="code"><span style="--1:#45485f"><span class="indent"><span style="--0:#C6D0F5">  </span></span><span style="--0:#C6D0F5">} </span></span><span style="--0:#aeb4cb;--0fs:italic;--1:#494a56;--1fs:italic">//if left click</span></div></div><div class="ec-line highlight del"><div class="code">
</div></div><div class="ec-line highlight del"><div class="code"><span style="--0:#C6D0F5;--1:#45485f">} </span><span style="--0:#aeb4cb;--0fs:italic;--1:#494a56;--1fs:italic">//if valid mouse</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69">(y </span><span style="--0:#CA9EE6;--1:#8035E0">in</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">...</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">height) {</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="// tick busy taskstick_busy(data, delta)var grid_mouse = world_to_grid(data, mouse.x, mouse.y)var valid_mouse = in_grid(data, grid_mouse.x, grid_mouse.y)var selected = data.selectedvar had_selected = selected.x != -1 &#x26;&#x26; selected.y != -1if(had_selected) {  var selected_pos = grid_to_world(data, selected.x, selected.y)  Draw.rect(draw,    selected_pos.x, selected_pos.y, 0,    block_width, block_height, 0, style.color(Color.pink))}if(valid_mouse) {  var mouse_draw_pos = grid_to_world(data, grid_mouse.x, grid_mouse.y)  Draw.rect(draw,    mouse_draw_pos.x, mouse_draw_pos.y, 0,    block_width, block_height, 0, style.color(Color.black))  if(Input.mouse_state_released(MouseButton.left)) {    if(had_selected) {      var allow_swap = is_adjacent(selected.x, selected.y, grid_mouse.x, grid_mouse.y)      if(selected.x == grid_mouse.x &#x26;&#x26; selected.y == grid_mouse.y) {        data.selected = [-1, -1]      } else if(allow_swap) {        swap(data, selected.x, selected.y, grid_mouse.x, grid_mouse.y)        data.selected = [-1, -1]      }    } else {      data.selected = grid_mouse    }  } //if left click} //if valid mousefor(y in 0 ... data.height) {"><div></div></button></div></figure></div>
<p>And hereâ€™s the code that will take itâ€™s place:</p>
<div class="expressive-code"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">system/grid.modifier.wren...System</span></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// tick busy tasks</span></div></div><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">tick_busy</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, delta)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> selected </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> data</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">selected</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> cursor </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> data</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">cursor</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">//if we have a selection, draw it</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#cfa8e9;--1:#6429af">if</span><span style="--0:#C6D0F5;--1:#474a62">(</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">in_grid</span><span style="--0:#C6D0F5;--1:#474a62">(data, selected</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">x, selected</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">y)) {</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> draw_pos </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">grid_to_world</span><span style="--0:#C6D0F5;--1:#474a62">(data, selected</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">x, selected</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">y)</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Draw</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">rect</span><span style="--0:#C6D0F5;--1:#474a62">(draw,</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">    </span></span><span style="--0:#C6D0F5">draw_pos</span></span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">x, draw_pos</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">y, </span><span style="--0:#f0a57f;--1:#833305">0</span><span style="--0:#C6D0F5;--1:#474a62">,</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">    </span></span><span style="--0:#C6D0F5">block_width, block_height, </span></span><span style="--0:#f0a57f;--1:#833305">0</span><span style="--0:#C6D0F5;--1:#474a62">, style</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">color</span><span style="--0:#C6D0F5;--1:#474a62">(</span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Color</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">pink))</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#C6D0F5;--1:#474a62">}</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">//if we have a cursor, draw that</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#cfa8e9;--1:#6429af">if</span><span style="--0:#C6D0F5;--1:#474a62">(</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">in_grid</span><span style="--0:#C6D0F5;--1:#474a62">(data, cursor</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">x, cursor</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">y)) {</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> draw_pos </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">grid_to_world</span><span style="--0:#C6D0F5;--1:#474a62">(data, cursor</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">x, cursor</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">y)</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Draw</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">rect</span><span style="--0:#C6D0F5;--1:#474a62">(draw,</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">    </span></span><span style="--0:#C6D0F5">draw_pos</span></span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">x, draw_pos</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">y, </span><span style="--0:#f0a57f;--1:#833305">0</span><span style="--0:#C6D0F5;--1:#474a62">,</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">    </span></span><span style="--0:#C6D0F5">block_width, block_height, </span></span><span style="--0:#f0a57f;--1:#833305">0</span><span style="--0:#C6D0F5;--1:#474a62">, style</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">color</span><span style="--0:#C6D0F5;--1:#474a62">(</span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Color</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">black))</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#C6D0F5;--1:#474a62">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69">(y </span><span style="--0:#CA9EE6;--1:#8035E0">in</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">...</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">height) {</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="// tick busy taskstick_busy(data, delta)var selected = data.selectedvar cursor = data.cursor//if we have a selection, draw itif(in_grid(data, selected.x, selected.y)) {  var draw_pos = grid_to_world(data, selected.x, selected.y)  Draw.rect(draw,    draw_pos.x, draw_pos.y, 0,    block_width, block_height, 0, style.color(Color.pink))}//if we have a cursor, draw thatif(in_grid(data, cursor.x, cursor.y)) {  var draw_pos = grid_to_world(data, cursor.x, cursor.y)  Draw.rect(draw,    draw_pos.x, draw_pos.y, 0,    block_width, block_height, 0, style.color(Color.black))}for(y in 0 ... data.height) {"><div></div></button></div></figure></div>
<p>Thatâ€™s it for the grid changes! Letâ€™s add the input system.</p>
<div class="sl-heading-wrapper level-h3"><h3 id="the-input-system">The input system</h3><a class="sl-anchor-link" href="#the-input-system"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œThe input systemâ€</span></a></div>
<p>Create a new modifier for the grid input:</p>
<ol role="list" class="sl-steps">
<li>
<div class="sl-heading-wrapper level-h4"><h4 id="systemgrid_inputmodifierwren"><code dir="auto">system/grid_input.modifier.wren</code></h4><a class="sl-anchor-link" href="#systemgrid_inputmodifierwren"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œsystem/grid_input.modifier.wrenâ€</span></a></div>
<p>Create an empty <strong>file</strong> named <code dir="auto">grid_input.modifier.wren</code> in the <code dir="auto">system/</code> folder.</p>
</li>
<li>
<div class="sl-heading-wrapper level-h4"><h4 id="run-the-build">Run the build</h4><a class="sl-anchor-link" href="#run-the-build"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œRun the buildâ€</span></a></div>
<p>This will generate the contents for you to edit.</p>
</li>
<li>
<div class="sl-heading-wrapper level-h4"><h4 id="edit-details">Edit details</h4><a class="sl-anchor-link" href="#edit-details"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œEdit detailsâ€</span></a></div>
<p>We update our system definition with some details.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">#api</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">#display = "</span><ins><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">Match3 Grid Input</span></ins><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">#desc = "</span><ins><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">**Input handling for Match 3 Grid**. Contains the mouse input handling and communicates it to the grid</span></ins><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">#icon = "luxe: image/modifier/modifier.svg"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">class</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><ins><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">GridInput</span></ins><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#CA9EE6;--1:#8035E0">is</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">API</span><span style="--0:#C6D0F5;--1:#4C4F69"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//add public facing API here</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="  #api  #display = &#x22;Match3 Grid Input&#x22;  #desc = &#x22;**Input handling for Match 3 Grid**. Contains the mouse input handling and communicates it to the grid&#x22;  #icon = &#x22;luxe: image/modifier/modifier.svg&#x22;  class GridInput is API {    //add public facing API here  }"><div></div></button></div></figure></div>
</li>
</ol>
<p>And like before, we attach it to the same entity as the grid.
This is an assumption the input system will make.</p>
<p>Back inside of <code dir="auto">game.wren</code>:</p>
<div class="expressive-code"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">game.wren</span></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">import</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#A6D189;--1:#2D711E">"system/grid.modifier"</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Grid</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#cfa8e9;--1:#6429af">import</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#A6D189;--1:#235817">"system/grid_input.modifier"</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#cfa8e9;--1:#6429af">for</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">GridInput</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">class</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Game</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#CA9EE6;--1:#8035E0">is</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Ready</span><span style="--0:#C6D0F5;--1:#4C4F69"> {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> grid: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Entity</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Entity</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">none</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#E5C890;--1:#8B5912">construct</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">ready</span><span style="--0:#C6D0F5;--1:#4C4F69">() {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">super</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#A6D189;--1:#2D711E">"ready! %(</span><span style="--0:#C6D0F5;--1:#4C4F69">width</span><span style="--0:#A6D189;--1:#2D711E">) x %(</span><span style="--0:#C6D0F5;--1:#4C4F69">height</span><span style="--0:#A6D189;--1:#2D711E">) @ %(</span><span style="--0:#C6D0F5;--1:#4C4F69">scale</span><span style="--0:#A6D189;--1:#2D711E">)x"</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">grid </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Entity</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">create</span><span style="--0:#C6D0F5;--1:#4C4F69">(world, </span><span style="--0:#A6D189;--1:#2D711E">"grid"</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Grid</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">create</span><span style="--0:#C6D0F5;--1:#4C4F69">(grid)</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">GridInput</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">create</span><span style="--0:#C6D0F5;--1:#474a62">(grid)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//ready</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import &#x22;system/grid.modifier&#x22; for Gridimport &#x22;system/grid_input.modifier&#x22; for GridInputclass Game is Ready {  var grid: Entity = Entity.none  construct ready() {    super(&#x22;ready! %(width) x %(height) @ %(scale)x&#x22;)    grid = Entity.create(world, &#x22;grid&#x22;)    Grid.create(grid)    GridInput.create(grid)  } //ready"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="the-input-handling-logic">The input handling logic</h3><a class="sl-anchor-link" href="#the-input-handling-logic"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œThe input handling logicâ€</span></a></div>
<p>Back inside of <code dir="auto">grid_input.modifier.wren</code> weâ€™re going to need to add some imports at the top of the file:</p>
<div class="expressive-code"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">system/grid_input.modifier.wren</span></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">import</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#A6D189;--1:#2D711E">"luxe: input"</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Input</span><span style="--0:#C6D0F5;--1:#4C4F69">, </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">MouseButton</span><span style="--0:#C6D0F5;--1:#4C4F69">, </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Key</span></div></div><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">import</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#A6D189;--1:#2D711E">"luxe: world"</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Camera</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//we'll speak to the grid API</span></div></div><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">import</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#A6D189;--1:#2D711E">"system/grid.modifier"</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Grid</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import &#x22;luxe: input&#x22; for Input, MouseButton, Keyimport &#x22;luxe: world&#x22; for Camera//we&#x27;ll speak to the grid APIimport &#x22;system/grid.modifier&#x22; for Grid"><div></div></button></div></figure></div>
<p>And hereâ€™s our tick function, inside of <code dir="auto">System</code>, inside the <code dir="auto">grid_input.modifier.wren</code> file:</p>
<div class="expressive-code"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">system/grid_input.modifier.wren...System</span></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">tick</span><span style="--0:#C6D0F5;--1:#4C4F69">(delta: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> mouse </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Camera</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">screen_point_to_world</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Camera</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">get_default</span><span style="--0:#C6D0F5;--1:#4C4F69">(world), </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Input</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">mouse_x</span><span style="--0:#C6D0F5;--1:#4C4F69">(), </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Input</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">mouse_y</span><span style="--0:#C6D0F5;--1:#4C4F69">())</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> interact </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Input</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">mouse_state_released</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">MouseButton</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">left)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">each {</span><span style="--0:#EA999C;--0fs:italic;--1:#B43641;--1fs:italic">|entity: Entity, data: Data|</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> grid_mouse </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Grid</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">world_to_grid</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity, mouse</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">x, mouse</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">y)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//If the cursor is valid</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Grid</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">in_grid</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity, grid_mouse</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">x, grid_mouse</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">y)) {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//set it before we interact, so it's up to date</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Grid</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">set</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">cursor</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity, grid_mouse)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//Interact with the grid</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(interact) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Grid</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">interact</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">      </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#CA9EE6;--1:#8035E0">else</span><span style="--0:#C6D0F5;--1:#4C4F69"> {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//If not inside the grid, just set it to a well known value</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Grid</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">set</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">cursor</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity, [</span><span style="--0:#EF9F76;--1:#AB4307">-1</span><span style="--0:#C6D0F5;--1:#4C4F69">, </span><span style="--0:#EF9F76;--1:#AB4307">-1</span><span style="--0:#C6D0F5;--1:#4C4F69">])</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//each</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//tick</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="tick(delta: Num) {  var mouse = Camera.screen_point_to_world(Camera.get_default(world), Input.mouse_x(), Input.mouse_y())  var interact = Input.mouse_state_released(MouseButton.left)  each {|entity: Entity, data: Data|    var grid_mouse = Grid.world_to_grid(entity, mouse.x, mouse.y)    //If the cursor is valid    if(Grid.in_grid(entity, grid_mouse.x, grid_mouse.y)) {      //set it before we interact, so it&#x27;s up to date      Grid.set.cursor(entity, grid_mouse)      //Interact with the grid      if(interact) {        Grid.interact(entity)      }    } else {      //If not inside the grid, just set it to a well known value      Grid.set.cursor(entity, [-1, -1])    }  } //each} //tick"><div></div></button></div></figure></div>
<p>We can now run the game, and nothing would have changed! It should work exactly the same.
But, things are much cleaner and clearer.</p>
<div class="sl-heading-wrapper level-h2"><h2 id="grid-visuals">Grid Visuals</h2><a class="sl-anchor-link" href="#grid-visuals"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œGrid Visualsâ€</span></a></div>
<p>The next thing weâ€™re going to do is move our grid drawing into itâ€™s own system.</p>
<p>Create a new system for that:</p>
<ol role="list" class="sl-steps">
<li>
<div class="sl-heading-wrapper level-h4"><h4 id="systemgrid_visualsmodifierwren"><code dir="auto">system/grid_visuals.modifier.wren</code></h4><a class="sl-anchor-link" href="#systemgrid_visualsmodifierwren"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œsystem/grid_visuals.modifier.wrenâ€</span></a></div>
<p>Create an empty <strong>file</strong> named <code dir="auto">grid_visuals.modifier.wren</code> in the <code dir="auto">system/</code> folder.</p>
</li>
<li>
<div class="sl-heading-wrapper level-h4"><h4 id="run-the-build-1">Run the build</h4><a class="sl-anchor-link" href="#run-the-build-1"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œRun the buildâ€</span></a></div>
<p>This will generate the contents for you to edit.</p>
</li>
<li>
<div class="sl-heading-wrapper level-h4"><h4 id="edit-details-1">Edit details</h4><a class="sl-anchor-link" href="#edit-details-1"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œEdit detailsâ€</span></a></div>
<p>We update our system definition with some details.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">#api</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">#display = "</span><ins><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">Match3 Grid Visuals</span></ins><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">#desc = "</span><ins><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">**Visuals for a Match 3 Grid**. Handles displaying the grid state in the game</span></ins><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">#icon = "luxe: image/modifier/modifier.svg"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">class</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><ins><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">GridVisuals</span></ins><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#CA9EE6;--1:#8035E0">is</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">API</span><span style="--0:#C6D0F5;--1:#4C4F69"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//add public facing API here</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="  #api  #display = &#x22;Match3 Grid Visuals&#x22;  #desc = &#x22;**Visuals for a Match 3 Grid**. Handles displaying the grid state in the game&#x22;  #icon = &#x22;luxe: image/modifier/modifier.svg&#x22;  class GridVisuals is API {    //add public facing API here  }"><div></div></button></div></figure></div>
</li>
</ol>
<p>And weâ€™ll add it to the same entity just like before!
Weâ€™ll also add a <code dir="auto">Transform</code>, because weâ€™re going to rely on that for positioning our grid in world space (<code dir="auto">Transform</code> should already be imported).</p>
<p>Back inside of <code dir="auto">game.wren</code>:</p>
<div class="expressive-code"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">game.wren</span></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">import</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#A6D189;--1:#2D711E">"system/grid.modifier"</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Grid</span></div></div><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">import</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#A6D189;--1:#2D711E">"system/grid_input.modifier"</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">GridInput</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#cfa8e9;--1:#6429af">import</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#A6D189;--1:#235817">"system/grid_visuals.modifier"</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#cfa8e9;--1:#6429af">for</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">GridVisuals</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">class</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Game</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#CA9EE6;--1:#8035E0">is</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Ready</span><span style="--0:#C6D0F5;--1:#4C4F69"> {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> grid: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Entity</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Entity</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">none</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#E5C890;--1:#8B5912">construct</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">ready</span><span style="--0:#C6D0F5;--1:#4C4F69">() {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">super</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#A6D189;--1:#2D711E">"ready! %(</span><span style="--0:#C6D0F5;--1:#4C4F69">width</span><span style="--0:#A6D189;--1:#2D711E">) x %(</span><span style="--0:#C6D0F5;--1:#4C4F69">height</span><span style="--0:#A6D189;--1:#2D711E">) @ %(</span><span style="--0:#C6D0F5;--1:#4C4F69">scale</span><span style="--0:#A6D189;--1:#2D711E">)x"</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">grid </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Entity</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">create</span><span style="--0:#C6D0F5;--1:#4C4F69">(world, </span><span style="--0:#A6D189;--1:#2D711E">"grid"</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Grid</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">create</span><span style="--0:#C6D0F5;--1:#4C4F69">(grid)</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">GridInput</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">create</span><span style="--0:#C6D0F5;--1:#4C4F69">(grid)</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">GridVisuals</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">create</span><span style="--0:#C6D0F5;--1:#474a62">(grid)</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Transform</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">create</span><span style="--0:#C6D0F5;--1:#474a62">(grid)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//ready</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import &#x22;system/grid.modifier&#x22; for Gridimport &#x22;system/grid_input.modifier&#x22; for GridInputimport &#x22;system/grid_visuals.modifier&#x22; for GridVisualsclass Game is Ready {  var grid: Entity = Entity.none  construct ready() {    super(&#x22;ready! %(width) x %(height) @ %(scale)x&#x22;)    grid = Entity.create(world, &#x22;grid&#x22;)    Grid.create(grid)    GridInput.create(grid)    GridVisuals.create(grid)    Transform.create(grid)  } //ready"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="the-imports">The imports</h3><a class="sl-anchor-link" href="#the-imports"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œThe importsâ€</span></a></div>
<p>Add these to the top of <code dir="auto">grid_visuals.modifier.wren</code>.</p>
<p>Weâ€™ll speak to the grid, but weâ€™ll also need the Busy task class!</p>
<div class="expressive-code"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">system/grid_visuals.modifier.wren</span></figcaption><pre data-language="wren"><code><div class="ec-line highlight ins"><div class="code"><span style="--0:#cfa8e9;--1:#6429af">import</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#A6D189;--1:#235817">"luxe: draw"</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#cfa8e9;--1:#6429af">for</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Draw</span><span style="--0:#C6D0F5;--1:#474a62">, </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">PathStyle</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#cfa8e9;--1:#6429af">import</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#A6D189;--1:#235817">"luxe: color"</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#cfa8e9;--1:#6429af">for</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Color</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#cfa8e9;--1:#6429af">import</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#A6D189;--1:#235817">"system/grid.modifier"</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#cfa8e9;--1:#6429af">for</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Grid</span><span style="--0:#C6D0F5;--1:#474a62">, </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">GridRow</span><span style="--0:#C6D0F5;--1:#474a62">, </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Busy</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import &#x22;luxe: draw&#x22; for Draw, PathStyleimport &#x22;luxe: color&#x22; for Colorimport &#x22;system/grid.modifier&#x22; for Grid, GridRow, Busy"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="the-data">The data</h3><a class="sl-anchor-link" href="#the-data"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œThe dataâ€</span></a></div>
<p>In our debug visualization / prototype version of the visuals, we held some values like <code dir="auto">block_width</code>, and <code dir="auto">grid_left</code> in the system.</p>
<p>Now that weâ€™re organizing into a more structured approach, this becomes data on our visuals system, so that it becomes configurable.
The <code dir="auto">grid_left</code>/<code dir="auto">grid_bottom</code> are now going to be controlled by a <code dir="auto">Transform</code> on the visual entity, so we can skip those.</p>
<div class="expressive-code"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">system/grid_visuals.modifier.wren...Data</span></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">#block = data</span></div></div><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">class</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#4C4F69"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> block_width: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">64</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> block_height: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">64</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#block = dataclass Data {  var block_width: Num = 64  var block_height: Num = 64}"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="the-grid-visuals-api">The grid visuals <code dir="auto">API</code></h3><a class="sl-anchor-link" href="#the-grid-visuals-api"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œThe grid visuals APIâ€</span></a></div>
<aside aria-label="Iterative change" class="starlight-aside starlight-aside--tip"><p class="starlight-aside__title" aria-hidden="true"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="starlight-aside__icon"><path d="M17 22H5a3 3 0 0 1-3-3V9a3 3 0 0 1 3-3h1a4 4 0 0 1 7.3-2.18c.448.64.692 1.4.7 2.18h3a1 1 0 0 1 1 1v3a4 4 0 0 1 2.18 7.3A3.86 3.86 0 0 1 18 18v3a1 1 0 0 1-1 1ZM5 8a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h11v-3.18a1 1 0 0 1 1.33-.95 1.77 1.77 0 0 0 1.74-.23 2 2 0 0 0 .93-1.37 2 2 0 0 0-.48-1.59 1.89 1.89 0 0 0-2.17-.55 1 1 0 0 1-1.33-.95V8h-3.2a1 1 0 0 1-1-1.33 1.77 1.77 0 0 0-.23-1.74 1.939 1.939 0 0 0-3-.43A2 2 0 0 0 8 6c.002.23.046.456.13.67A1 1 0 0 1 7.18 8H5Z"></path></svg>Iterative change</p><div class="starlight-aside__content"><p>Like before, weâ€™re going to work iteratively, making changes that keep things working, and then iterate!</p></div></aside>
<p>The visuals own the concept of block size, because itâ€™s not related to the logical gameplay grid, but purely a visual concern.
The functions in <code dir="auto">Grid</code> that we had, <code dir="auto">world_to_grid</code> and the inverse, are all visual related and use those values. They belong in this system!</p>
<p>Inside <code dir="auto">grid.modifier.wren</code> we change the <code dir="auto">Grid</code> API class, removing those endpoints:</p>
<div class="expressive-code"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">system/grid.modifier.wren...Grid</span></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">class</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Grid</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#CA9EE6;--1:#8035E0">is</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">API</span><span style="--0:#C6D0F5;--1:#4C4F69"> {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight del"><div class="code"><span class="indent">  </span><span style="--0:#aeb4cb;--0fs:italic;--1:#494a56;--1fs:italic">#doc = "Convert a world space position to grid cell coordinates"</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">  </span><span style="--0:#E5C890;--1:#68430e">static</span><span style="--0:#C6D0F5;--1:#45485f"> </span><span style="--0:#99b4f0;--0fs:italic;--1:#1444a4;--1fs:italic">world_to_grid</span><span style="--0:#C6D0F5;--1:#45485f">(entity: </span><span style="--0:#E5C890;--0fs:italic;--1:#68430e;--1fs:italic">Entity</span><span style="--0:#C6D0F5;--1:#45485f">, world_x: </span><span style="--0:#E5C890;--0fs:italic;--1:#68430e;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#45485f">, world_y: </span><span style="--0:#E5C890;--0fs:italic;--1:#68430e;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#45485f">) : </span><span style="--0:#E5C890;--0fs:italic;--1:#68430e;--1fs:italic">Float2</span><span style="--0:#C6D0F5;--1:#45485f"> {</span></div></div><div class="ec-line highlight del"><div class="code">
</div></div><div class="ec-line highlight del"><div class="code"><span class="indent">    </span><span style="--0:#cea5e8;--1:#6028a8">if</span><span style="--0:#C6D0F5;--1:#45485f">(</span><span style="--0:#81C8BE;--1:#0d5356">!</span><span style="--0:#E5C890;--0fs:italic;--1:#68430e;--1fs:italic">Grid</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#99b4f0;--0fs:italic;--1:#1444a4;--1fs:italic">has</span><span style="--0:#C6D0F5;--1:#45485f">(entity)) </span><span style="--0:#cea5e8;--1:#6028a8">return</span><span style="--0:#C6D0F5;--1:#45485f"> [</span><span style="--0:#f0a27a;--1:#803205">0</span><span style="--0:#C6D0F5;--1:#45485f">, </span><span style="--0:#f0a27a;--1:#803205">0</span><span style="--0:#C6D0F5;--1:#45485f">]</span></div></div><div class="ec-line highlight del"><div class="code">
</div></div><div class="ec-line highlight del"><div class="code"><span class="indent">    </span><span style="--0:#cea5e8;--1:#6028a8">var</span><span style="--0:#C6D0F5;--1:#45485f"> system: </span><span style="--0:#E5C890;--0fs:italic;--1:#68430e;--1fs:italic">System</span><span style="--0:#C6D0F5;--1:#45485f"> </span><span style="--0:#81C8BE;--1:#0d5356">=</span><span style="--0:#C6D0F5;--1:#45485f"> </span><span style="--0:#99b4f0;--0fs:italic;--1:#1444a4;--1fs:italic">system</span><span style="--0:#C6D0F5;--1:#45485f">(entity)</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">    </span><span style="--0:#cea5e8;--1:#6028a8">var</span><span style="--0:#C6D0F5;--1:#45485f"> data: </span><span style="--0:#E5C890;--0fs:italic;--1:#68430e;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#45485f"> </span><span style="--0:#81C8BE;--1:#0d5356">=</span><span style="--0:#C6D0F5;--1:#45485f"> </span><span style="--0:#99b4f0;--0fs:italic;--1:#1444a4;--1fs:italic">get</span><span style="--0:#C6D0F5;--1:#45485f">(entity)</span></div></div><div class="ec-line highlight del"><div class="code">
</div></div><div class="ec-line highlight del"><div class="code"><span class="indent">    </span><span style="--0:#cea5e8;--1:#6028a8">return</span><span style="--0:#C6D0F5;--1:#45485f"> system</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#99b4f0;--0fs:italic;--1:#1444a4;--1fs:italic">world_to_grid</span><span style="--0:#C6D0F5;--1:#45485f">(data, world_x, world_y)</span></div></div><div class="ec-line highlight del"><div class="code">
</div></div><div class="ec-line highlight del"><div class="code"><span style="--1:#45485f"><span class="indent"><span style="--0:#C6D0F5">  </span></span><span style="--0:#C6D0F5">} </span></span><span style="--0:#aeb4cb;--0fs:italic;--1:#494a56;--1fs:italic">//world_to_grid</span></div></div><div class="ec-line highlight del"><div class="code">
</div></div><div class="ec-line highlight del"><div class="code"><span class="indent">  </span><span style="--0:#aeb4cb;--0fs:italic;--1:#494a56;--1fs:italic">#doc = "Convert a grid coordinate to world space position"</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">  </span><span style="--0:#E5C890;--1:#68430e">static</span><span style="--0:#C6D0F5;--1:#45485f"> </span><span style="--0:#99b4f0;--0fs:italic;--1:#1444a4;--1fs:italic">grid_to_world</span><span style="--0:#C6D0F5;--1:#45485f">(entity: </span><span style="--0:#E5C890;--0fs:italic;--1:#68430e;--1fs:italic">Entity</span><span style="--0:#C6D0F5;--1:#45485f">, grid_x: </span><span style="--0:#E5C890;--0fs:italic;--1:#68430e;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#45485f">, grid_y: </span><span style="--0:#E5C890;--0fs:italic;--1:#68430e;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#45485f">) : </span><span style="--0:#E5C890;--0fs:italic;--1:#68430e;--1fs:italic">Float2</span><span style="--0:#C6D0F5;--1:#45485f"> {</span></div></div><div class="ec-line highlight del"><div class="code">
</div></div><div class="ec-line highlight del"><div class="code"><span class="indent">    </span><span style="--0:#cea5e8;--1:#6028a8">if</span><span style="--0:#C6D0F5;--1:#45485f">(</span><span style="--0:#81C8BE;--1:#0d5356">!</span><span style="--0:#E5C890;--0fs:italic;--1:#68430e;--1fs:italic">Grid</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#99b4f0;--0fs:italic;--1:#1444a4;--1fs:italic">has</span><span style="--0:#C6D0F5;--1:#45485f">(entity)) </span><span style="--0:#cea5e8;--1:#6028a8">return</span><span style="--0:#C6D0F5;--1:#45485f"> [</span><span style="--0:#f0a27a;--1:#803205">0</span><span style="--0:#C6D0F5;--1:#45485f">, </span><span style="--0:#f0a27a;--1:#803205">0</span><span style="--0:#C6D0F5;--1:#45485f">]</span></div></div><div class="ec-line highlight del"><div class="code">
</div></div><div class="ec-line highlight del"><div class="code"><span class="indent">    </span><span style="--0:#cea5e8;--1:#6028a8">var</span><span style="--0:#C6D0F5;--1:#45485f"> system: </span><span style="--0:#E5C890;--0fs:italic;--1:#68430e;--1fs:italic">System</span><span style="--0:#C6D0F5;--1:#45485f"> </span><span style="--0:#81C8BE;--1:#0d5356">=</span><span style="--0:#C6D0F5;--1:#45485f"> </span><span style="--0:#99b4f0;--0fs:italic;--1:#1444a4;--1fs:italic">system</span><span style="--0:#C6D0F5;--1:#45485f">(entity)</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">    </span><span style="--0:#cea5e8;--1:#6028a8">var</span><span style="--0:#C6D0F5;--1:#45485f"> data: </span><span style="--0:#E5C890;--0fs:italic;--1:#68430e;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#45485f"> </span><span style="--0:#81C8BE;--1:#0d5356">=</span><span style="--0:#C6D0F5;--1:#45485f"> </span><span style="--0:#99b4f0;--0fs:italic;--1:#1444a4;--1fs:italic">get</span><span style="--0:#C6D0F5;--1:#45485f">(entity)</span></div></div><div class="ec-line highlight del"><div class="code">
</div></div><div class="ec-line highlight del"><div class="code"><span class="indent">    </span><span style="--0:#cea5e8;--1:#6028a8">return</span><span style="--0:#C6D0F5;--1:#45485f"> system</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#99b4f0;--0fs:italic;--1:#1444a4;--1fs:italic">grid_to_world</span><span style="--0:#C6D0F5;--1:#45485f">(data, grid_x, grid_y)</span></div></div><div class="ec-line highlight del"><div class="code">
</div></div><div class="ec-line highlight del"><div class="code"><span style="--1:#45485f"><span class="indent"><span style="--0:#C6D0F5">  </span></span><span style="--0:#C6D0F5">} </span></span><span style="--0:#aeb4cb;--0fs:italic;--1:#494a56;--1fs:italic">//grid_to_world</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">#doc = "Returns a busy task from the given coordinate, if any"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#E5C890;--1:#8B5912">static</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">get_busy</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Entity</span><span style="--0:#C6D0F5;--1:#4C4F69">, grid_x: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">, grid_y: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">) : </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Busy</span><span style="--0:#C6D0F5;--1:#4C4F69"> {</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="class Grid is API {  #doc = &#x22;Convert a world space position to grid cell coordinates&#x22;  static world_to_grid(entity: Entity, world_x: Num, world_y: Num) : Float2 {    if(!Grid.has(entity)) return [0, 0]    var system: System = system(entity)    var data: Data = get(entity)    return system.world_to_grid(data, world_x, world_y)  } //world_to_grid  #doc = &#x22;Convert a grid coordinate to world space position&#x22;  static grid_to_world(entity: Entity, grid_x: Num, grid_y: Num) : Float2 {    if(!Grid.has(entity)) return [0, 0]    var system: System = system(entity)    var data: Data = get(entity)    return system.grid_to_world(data, grid_x, grid_y)  } //grid_to_world  #doc = &#x22;Returns a busy task from the given coordinate, if any&#x22;  static get_busy(entity: Entity, grid_x: Num, grid_y: Num) : Busy {"><div></div></button></div></figure></div>
<p>And we add those directly to the <code dir="auto">GridVisuals</code> API class inside <code dir="auto">grid_visuals.modifier.wren</code>:</p>
<div class="expressive-code"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">system/grid_visuals.modifier.wren...GridVisuals</span></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">class</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">GridVisuals</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#CA9EE6;--1:#8035E0">is</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">API</span><span style="--0:#C6D0F5;--1:#4C4F69"> {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">#doc = "Convert a world space position to grid cell coordinates"</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#E5C890;--1:#6a440e">static</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">world_to_grid</span><span style="--0:#C6D0F5;--1:#474a62">(entity: </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Entity</span><span style="--0:#C6D0F5;--1:#474a62">, world_x: </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#474a62">, world_y: </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#474a62">) : </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Float2</span><span style="--0:#C6D0F5;--1:#474a62"> {</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#cfa8e9;--1:#6429af">if</span><span style="--0:#C6D0F5;--1:#474a62">(</span><span style="--0:#81C8BE;--1:#0d5458">!</span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Grid</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">has</span><span style="--0:#C6D0F5;--1:#474a62">(entity)) </span><span style="--0:#cfa8e9;--1:#6429af">return</span><span style="--0:#C6D0F5;--1:#474a62"> [</span><span style="--0:#f0a57f;--1:#833305">0</span><span style="--0:#C6D0F5;--1:#474a62">, </span><span style="--0:#f0a57f;--1:#833305">0</span><span style="--0:#C6D0F5;--1:#474a62">]</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> system: </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">System</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">system</span><span style="--0:#C6D0F5;--1:#474a62">(entity)</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> data: </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">get</span><span style="--0:#C6D0F5;--1:#474a62">(entity)</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#cfa8e9;--1:#6429af">return</span><span style="--0:#C6D0F5;--1:#474a62"> system</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">world_to_grid</span><span style="--0:#C6D0F5;--1:#474a62">(data, world_x, world_y)</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">  </span></span><span style="--0:#C6D0F5">} </span></span><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">//world_to_grid</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">#doc = "Convert a grid coordinate to world space position"</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#E5C890;--1:#6a440e">static</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">grid_to_world</span><span style="--0:#C6D0F5;--1:#474a62">(entity: </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Entity</span><span style="--0:#C6D0F5;--1:#474a62">, grid_x: </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#474a62">, grid_y: </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#474a62">) : </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Float2</span><span style="--0:#C6D0F5;--1:#474a62"> {</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#cfa8e9;--1:#6429af">if</span><span style="--0:#C6D0F5;--1:#474a62">(</span><span style="--0:#81C8BE;--1:#0d5458">!</span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Grid</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">has</span><span style="--0:#C6D0F5;--1:#474a62">(entity)) </span><span style="--0:#cfa8e9;--1:#6429af">return</span><span style="--0:#C6D0F5;--1:#474a62"> [</span><span style="--0:#f0a57f;--1:#833305">0</span><span style="--0:#C6D0F5;--1:#474a62">, </span><span style="--0:#f0a57f;--1:#833305">0</span><span style="--0:#C6D0F5;--1:#474a62">]</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> system: </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">System</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">system</span><span style="--0:#C6D0F5;--1:#474a62">(entity)</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> data: </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">get</span><span style="--0:#C6D0F5;--1:#474a62">(entity)</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#cfa8e9;--1:#6429af">return</span><span style="--0:#C6D0F5;--1:#474a62"> system</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">grid_to_world</span><span style="--0:#C6D0F5;--1:#474a62">(data, grid_x, grid_y)</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">  </span></span><span style="--0:#C6D0F5">} </span></span><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">//grid_to_world</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="class GridVisuals is API {  #doc = &#x22;Convert a world space position to grid cell coordinates&#x22;  static world_to_grid(entity: Entity, world_x: Num, world_y: Num) : Float2 {    if(!Grid.has(entity)) return [0, 0]    var system: System = system(entity)    var data: Data = get(entity)    return system.world_to_grid(data, world_x, world_y)  } //world_to_grid  #doc = &#x22;Convert a grid coordinate to world space position&#x22;  static grid_to_world(entity: Entity, grid_x: Num, grid_y: Num) : Float2 {    if(!Grid.has(entity)) return [0, 0]    var system: System = system(entity)    var data: Data = get(entity)    return system.grid_to_world(data, grid_x, grid_y)  } //grid_to_world}"><div></div></button></div></figure></div>
<p>And of course we should bring the system changes over next!</p>
<div class="sl-heading-wrapper level-h3"><h3 id="the-grid-visuals-system">The grid visuals <code dir="auto">System</code></h3><a class="sl-anchor-link" href="#the-grid-visuals-system"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œThe grid visuals Systemâ€</span></a></div>
<p>First we remove (cut) these variables from <code dir="auto">System</code> inside <code dir="auto">grid.modifier.wren</code>:</p>
<div class="expressive-code"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">system/grid.modifier.wren...System</span></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">class</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">System</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#CA9EE6;--1:#8035E0">is</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Modifier</span><span style="--0:#C6D0F5;--1:#4C4F69"> {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> rng: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Random</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Random</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#CA9EE6;--1:#8035E0">new</span><span style="--0:#C6D0F5;--1:#4C4F69">()</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//our busy handling</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> fiber: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Fiber</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#CA9EE6;--1:#8035E0">null</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> busy_cells </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> {}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight del"><div class="code"><span class="indent">  </span><span style="--0:#aeb4cb;--0fs:italic;--1:#494a56;--1fs:italic">//debug visualization</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">  </span><span style="--0:#cea5e8;--1:#6028a8">var</span><span style="--0:#C6D0F5;--1:#45485f"> draw: </span><span style="--0:#E5C890;--0fs:italic;--1:#68430e;--1fs:italic">Draw</span><span style="--0:#C6D0F5;--1:#45485f"> </span><span style="--0:#81C8BE;--1:#0d5356">=</span><span style="--0:#C6D0F5;--1:#45485f"> </span><span style="--0:#cea5e8;--1:#6028a8">null</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">  </span><span style="--0:#cea5e8;--1:#6028a8">var</span><span style="--0:#C6D0F5;--1:#45485f"> style: </span><span style="--0:#E5C890;--0fs:italic;--1:#68430e;--1fs:italic">PathStyle</span><span style="--0:#C6D0F5;--1:#45485f"> </span><span style="--0:#81C8BE;--1:#0d5356">=</span><span style="--0:#C6D0F5;--1:#45485f"> </span><span style="--0:#E5C890;--0fs:italic;--1:#68430e;--1fs:italic">PathStyle</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#cea5e8;--1:#6028a8">new</span><span style="--0:#C6D0F5;--1:#45485f">()</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">  </span><span style="--0:#cea5e8;--1:#6028a8">var</span><span style="--0:#C6D0F5;--1:#45485f"> grid_left </span><span style="--0:#81C8BE;--1:#0d5356">=</span><span style="--0:#C6D0F5;--1:#45485f"> </span><span style="--0:#f0a27a;--1:#803205">100</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">  </span><span style="--0:#cea5e8;--1:#6028a8">var</span><span style="--0:#C6D0F5;--1:#45485f"> grid_bottom </span><span style="--0:#81C8BE;--1:#0d5356">=</span><span style="--0:#C6D0F5;--1:#45485f"> </span><span style="--0:#f0a27a;--1:#803205">64</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">  </span><span style="--0:#cea5e8;--1:#6028a8">var</span><span style="--0:#C6D0F5;--1:#45485f"> block_width </span><span style="--0:#81C8BE;--1:#0d5356">=</span><span style="--0:#C6D0F5;--1:#45485f"> </span><span style="--0:#f0a27a;--1:#803205">64</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">  </span><span style="--0:#cea5e8;--1:#6028a8">var</span><span style="--0:#C6D0F5;--1:#45485f"> block_height </span><span style="--0:#81C8BE;--1:#0d5356">=</span><span style="--0:#C6D0F5;--1:#45485f"> </span><span style="--0:#f0a27a;--1:#803205">64</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">  </span><span style="--0:#cea5e8;--1:#6028a8">var</span><span style="--0:#C6D0F5;--1:#45485f"> sides </span><span style="--0:#81C8BE;--1:#0d5356">=</span><span style="--0:#C6D0F5;--1:#45485f"> [</span><span style="--0:#f0a27a;--1:#803205">32</span><span style="--0:#C6D0F5;--1:#45485f">, </span><span style="--0:#f0a27a;--1:#803205">3</span><span style="--0:#C6D0F5;--1:#45485f">, </span><span style="--0:#f0a27a;--1:#803205">4</span><span style="--0:#C6D0F5;--1:#45485f">, </span><span style="--0:#f0a27a;--1:#803205">5</span><span style="--0:#C6D0F5;--1:#45485f">, </span><span style="--0:#f0a27a;--1:#803205">6</span><span style="--0:#C6D0F5;--1:#45485f">, </span><span style="--0:#f0a27a;--1:#803205">32</span><span style="--0:#C6D0F5;--1:#45485f">]</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">  </span><span style="--0:#cea5e8;--1:#6028a8">var</span><span style="--0:#C6D0F5;--1:#45485f"> colors </span><span style="--0:#81C8BE;--1:#0d5356">=</span><span style="--0:#C6D0F5;--1:#45485f"> [</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">    </span><span style="--0:#E5C890;--0fs:italic;--1:#68430e;--1fs:italic">Color</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#99b4f0;--0fs:italic;--1:#1444a4;--1fs:italic">hex_code</span><span style="--0:#C6D0F5;--1:#45485f">( </span><span style="--0:#A6D189;--1:#225517">"#363a4f"</span><span style="--0:#C6D0F5;--1:#45485f"> ), </span><span style="--0:#aeb4cb;--0fs:italic;--1:#494a56;--1fs:italic">//1</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">    </span><span style="--0:#E5C890;--0fs:italic;--1:#68430e;--1fs:italic">Color</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#99b4f0;--0fs:italic;--1:#1444a4;--1fs:italic">hex_code</span><span style="--0:#C6D0F5;--1:#45485f">( </span><span style="--0:#A6D189;--1:#225517">"#8839ef"</span><span style="--0:#C6D0F5;--1:#45485f"> ), </span><span style="--0:#aeb4cb;--0fs:italic;--1:#494a56;--1fs:italic">//2</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">    </span><span style="--0:#E5C890;--0fs:italic;--1:#68430e;--1fs:italic">Color</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#99b4f0;--0fs:italic;--1:#1444a4;--1fs:italic">hex_code</span><span style="--0:#C6D0F5;--1:#45485f">( </span><span style="--0:#A6D189;--1:#225517">"#04a5e5"</span><span style="--0:#C6D0F5;--1:#45485f"> ), </span><span style="--0:#aeb4cb;--0fs:italic;--1:#494a56;--1fs:italic">//3</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">    </span><span style="--0:#E5C890;--0fs:italic;--1:#68430e;--1fs:italic">Color</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#99b4f0;--0fs:italic;--1:#1444a4;--1fs:italic">hex_code</span><span style="--0:#C6D0F5;--1:#45485f">( </span><span style="--0:#A6D189;--1:#225517">"#e64553"</span><span style="--0:#C6D0F5;--1:#45485f"> ), </span><span style="--0:#aeb4cb;--0fs:italic;--1:#494a56;--1fs:italic">//4</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">    </span><span style="--0:#E5C890;--0fs:italic;--1:#68430e;--1fs:italic">Color</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#99b4f0;--0fs:italic;--1:#1444a4;--1fs:italic">hex_code</span><span style="--0:#C6D0F5;--1:#45485f">( </span><span style="--0:#A6D189;--1:#225517">"#40a02b"</span><span style="--0:#C6D0F5;--1:#45485f"> ), </span><span style="--0:#aeb4cb;--0fs:italic;--1:#494a56;--1fs:italic">//5</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">    </span><span style="--0:#E5C890;--0fs:italic;--1:#68430e;--1fs:italic">Color</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#99b4f0;--0fs:italic;--1:#1444a4;--1fs:italic">hex_code</span><span style="--0:#C6D0F5;--1:#45485f">( </span><span style="--0:#A6D189;--1:#225517">"#fa8621"</span><span style="--0:#C6D0F5;--1:#45485f"> ), </span><span style="--0:#aeb4cb;--0fs:italic;--1:#494a56;--1fs:italic">//6</span></div></div><div class="ec-line highlight del"><div class="code"><span style="--1:#45485f"><span class="indent"><span style="--0:#C6D0F5">  </span></span><span style="--0:#C6D0F5">]</span></span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="class System is Modifier {  var rng: Random = Random.new()  //our busy handling  var fiber: Fiber = null  var busy_cells = {}  //debug visualization  var draw: Draw = null  var style: PathStyle = PathStyle.new()  var grid_left = 100  var grid_bottom = 64  var block_width = 64  var block_height = 64  var sides = [32, 3, 4, 5, 6, 32]  var colors = [    Color.hex_code( &#x22;#363a4f&#x22; ), //1    Color.hex_code( &#x22;#8839ef&#x22; ), //2    Color.hex_code( &#x22;#04a5e5&#x22; ), //3    Color.hex_code( &#x22;#e64553&#x22; ), //4    Color.hex_code( &#x22;#40a02b&#x22; ), //5    Color.hex_code( &#x22;#fa8621&#x22; ), //6  ]"><div></div></button></div></figure></div>
<p>Then we can paste them into our <code dir="auto">System</code> class inside <code dir="auto">grid_visuals.modifier.wren</code>.
We remove the block size here as weâ€™re moved that into our user facing Data.</p>
<div class="expressive-code"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">system/grid_visuals.modifier.wren...System</span></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">class</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">System</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#CA9EE6;--1:#8035E0">is</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Modifier</span><span style="--0:#C6D0F5;--1:#4C4F69"> {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">//debug visualization</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> draw: </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Draw</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#cfa8e9;--1:#6429af">null</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> style: </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">PathStyle</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">PathStyle</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#cfa8e9;--1:#6429af">new</span><span style="--0:#C6D0F5;--1:#474a62">()</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> grid_left </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#f0a57f;--1:#833305">100</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> grid_bottom </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#f0a57f;--1:#833305">64</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">  </span><span style="--0:#cea5e8;--1:#6028a8">var</span><span style="--0:#C6D0F5;--1:#45485f"> block_width </span><span style="--0:#81C8BE;--1:#0d5356">=</span><span style="--0:#C6D0F5;--1:#45485f"> </span><span style="--0:#f0a27a;--1:#803205">64</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">  </span><span style="--0:#cea5e8;--1:#6028a8">var</span><span style="--0:#C6D0F5;--1:#45485f"> block_height </span><span style="--0:#81C8BE;--1:#0d5356">=</span><span style="--0:#C6D0F5;--1:#45485f"> </span><span style="--0:#f0a27a;--1:#803205">64</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> sides </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> [</span><span style="--0:#f0a57f;--1:#833305">32</span><span style="--0:#C6D0F5;--1:#474a62">, </span><span style="--0:#f0a57f;--1:#833305">3</span><span style="--0:#C6D0F5;--1:#474a62">, </span><span style="--0:#f0a57f;--1:#833305">4</span><span style="--0:#C6D0F5;--1:#474a62">, </span><span style="--0:#f0a57f;--1:#833305">5</span><span style="--0:#C6D0F5;--1:#474a62">, </span><span style="--0:#f0a57f;--1:#833305">6</span><span style="--0:#C6D0F5;--1:#474a62">, </span><span style="--0:#f0a57f;--1:#833305">32</span><span style="--0:#C6D0F5;--1:#474a62">]</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> colors </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> [</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Color</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">hex_code</span><span style="--0:#C6D0F5;--1:#474a62">( </span><span style="--0:#A6D189;--1:#235817">"#363a4f"</span><span style="--0:#C6D0F5;--1:#474a62"> ), </span><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">//1</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Color</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">hex_code</span><span style="--0:#C6D0F5;--1:#474a62">( </span><span style="--0:#A6D189;--1:#235817">"#8839ef"</span><span style="--0:#C6D0F5;--1:#474a62"> ), </span><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">//2</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Color</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">hex_code</span><span style="--0:#C6D0F5;--1:#474a62">( </span><span style="--0:#A6D189;--1:#235817">"#04a5e5"</span><span style="--0:#C6D0F5;--1:#474a62"> ), </span><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">//3</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Color</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">hex_code</span><span style="--0:#C6D0F5;--1:#474a62">( </span><span style="--0:#A6D189;--1:#235817">"#e64553"</span><span style="--0:#C6D0F5;--1:#474a62"> ), </span><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">//4</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Color</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">hex_code</span><span style="--0:#C6D0F5;--1:#474a62">( </span><span style="--0:#A6D189;--1:#235817">"#40a02b"</span><span style="--0:#C6D0F5;--1:#474a62"> ), </span><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">//5</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Color</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">hex_code</span><span style="--0:#C6D0F5;--1:#474a62">( </span><span style="--0:#A6D189;--1:#235817">"#fa8621"</span><span style="--0:#C6D0F5;--1:#474a62"> ), </span><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">//6</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">  </span></span><span style="--0:#C6D0F5">]</span></span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="class System is Modifier {  //debug visualization  var draw: Draw = null  var style: PathStyle = PathStyle.new()  var grid_left = 100  var grid_bottom = 64  var block_width = 64  var block_height = 64  var sides = [32, 3, 4, 5, 6, 32]  var colors = [    Color.hex_code( &#x22;#363a4f&#x22; ), //1    Color.hex_code( &#x22;#8839ef&#x22; ), //2    Color.hex_code( &#x22;#04a5e5&#x22; ), //3    Color.hex_code( &#x22;#e64553&#x22; ), //4    Color.hex_code( &#x22;#40a02b&#x22; ), //5    Color.hex_code( &#x22;#fa8621&#x22; ), //6  ]"><div></div></button></div></figure></div>
<p>We also move the init of the <code dir="auto">Draw</code> context from <code dir="auto">grid.modifier.wren</code> to <code dir="auto">grid_visuals.modifier.wren</code></p>
<div class="expressive-code"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">system/grid.modifier.wren...System</span></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">init</span><span style="--0:#C6D0F5;--1:#4C4F69">(world: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">World</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Log</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">print</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#A6D189;--1:#2D711E">"init `%(</span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">This</span><span style="--0:#A6D189;--1:#2D711E">)` in world `%(</span><span style="--0:#C6D0F5;--1:#4C4F69">world</span><span style="--0:#A6D189;--1:#2D711E">)`"</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight del"><div class="code"><span style="--1:#45485f"><span class="indent"><span style="--0:#C6D0F5">  </span></span><span style="--0:#C6D0F5">draw </span></span><span style="--0:#81C8BE;--1:#0d5356">=</span><span style="--0:#C6D0F5;--1:#45485f"> </span><span style="--0:#E5C890;--0fs:italic;--1:#68430e;--1fs:italic">Draw</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#99b4f0;--0fs:italic;--1:#1444a4;--1fs:italic">create</span><span style="--0:#C6D0F5;--1:#45485f">(</span><span style="--0:#E5C890;--0fs:italic;--1:#68430e;--1fs:italic">World</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#99b4f0;--0fs:italic;--1:#1444a4;--1fs:italic">render_set</span><span style="--0:#C6D0F5;--1:#45485f">(world))</span></div></div><div class="ec-line highlight del"><div class="code"><span style="--1:#45485f"><span class="indent"><span style="--0:#C6D0F5">  </span></span><span style="--0:#C6D0F5">style</span></span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#C6D0F5;--1:#45485f">color </span><span style="--0:#81C8BE;--1:#0d5356">=</span><span style="--0:#C6D0F5;--1:#45485f"> </span><span style="--0:#E5C890;--0fs:italic;--1:#68430e;--1fs:italic">Color</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#C6D0F5;--1:#45485f">black</span></div></div><div class="ec-line highlight del"><div class="code"><span style="--1:#45485f"><span class="indent"><span style="--0:#C6D0F5">  </span></span><span style="--0:#C6D0F5">style</span></span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#C6D0F5;--1:#45485f">thickness </span><span style="--0:#81C8BE;--1:#0d5356">=</span><span style="--0:#C6D0F5;--1:#45485f"> </span><span style="--0:#f0a27a;--1:#803205">4</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="init(world: World) {  Log.print(&#x22;init &#x60;%(This)&#x60; in world &#x60;%(world)&#x60;&#x22;)  draw = Draw.create(World.render_set(world))  style.color = Color.black  style.thickness = 4}"><div></div></button></div></figure></div>
<div class="expressive-code"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">system/grid_visuals.modifier.wren...System</span></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">init</span><span style="--0:#C6D0F5;--1:#4C4F69">(world: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">World</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Log</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">print</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#A6D189;--1:#2D711E">"init `%(</span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">This</span><span style="--0:#A6D189;--1:#2D711E">)` in world `%(</span><span style="--0:#C6D0F5;--1:#4C4F69">world</span><span style="--0:#A6D189;--1:#2D711E">)`"</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">  </span></span><span style="--0:#C6D0F5">draw </span></span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Draw</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">create</span><span style="--0:#C6D0F5;--1:#474a62">(</span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">World</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">render_set</span><span style="--0:#C6D0F5;--1:#474a62">(world))</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">  </span></span><span style="--0:#C6D0F5">style</span></span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">color </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Color</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">black</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">  </span></span><span style="--0:#C6D0F5">style</span></span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">thickness </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#f0a57f;--1:#833305">4</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="init(world: World) {  Log.print(&#x22;init &#x60;%(This)&#x60; in world &#x60;%(world)&#x60;&#x22;)  draw = Draw.create(World.render_set(world))  style.color = Color.black  style.thickness = 4}"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="conversion-helpers">Conversion helpers</h3><a class="sl-anchor-link" href="#conversion-helpers"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œConversion helpersâ€</span></a></div>
<p>We also move the <code dir="auto">world_to_grid</code>/<code dir="auto">grid_to_world</code> from <code dir="auto">grid.modifier.wren</code> to <code dir="auto">grid_visuals.modifier.wren</code></p>
<div class="expressive-code"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">system/grid.modifier.wren...System</span></figcaption><pre data-language="wren"><code><div class="ec-line highlight del"><div class="code"><span class="indent">  </span><span style="--0:#99b4f0;--0fs:italic;--1:#1444a4;--1fs:italic">world_to_grid</span><span style="--0:#C6D0F5;--1:#45485f">(data: </span><span style="--0:#E5C890;--0fs:italic;--1:#68430e;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#45485f">, x: </span><span style="--0:#E5C890;--0fs:italic;--1:#68430e;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#45485f">, y: </span><span style="--0:#E5C890;--0fs:italic;--1:#68430e;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#45485f">) {</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">    </span><span style="--0:#cea5e8;--1:#6028a8">var</span><span style="--0:#C6D0F5;--1:#45485f"> grid_h </span><span style="--0:#81C8BE;--1:#0d5356">=</span><span style="--0:#C6D0F5;--1:#45485f"> data</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#C6D0F5;--1:#45485f">height </span><span style="--0:#81C8BE;--1:#0d5356">*</span><span style="--0:#C6D0F5;--1:#45485f"> block_height</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">    </span><span style="--0:#cea5e8;--1:#6028a8">var</span><span style="--0:#C6D0F5;--1:#45485f"> grid_x </span><span style="--0:#99b4f0;--0fs:italic;--1:#1444a4;--1fs:italic">=</span><span style="--0:#C6D0F5;--1:#45485f"> ((x </span><span style="--0:#81C8BE;--1:#0d5356">-</span><span style="--0:#C6D0F5;--1:#45485f"> grid_left) </span><span style="--0:#81C8BE;--1:#0d5356">/</span><span style="--0:#C6D0F5;--1:#45485f"> block_width)</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#C6D0F5;--1:#45485f">floor</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">    </span><span style="--0:#cea5e8;--1:#6028a8">var</span><span style="--0:#C6D0F5;--1:#45485f"> grid_y </span><span style="--0:#99b4f0;--0fs:italic;--1:#1444a4;--1fs:italic">=</span><span style="--0:#C6D0F5;--1:#45485f"> ((y </span><span style="--0:#81C8BE;--1:#0d5356">-</span><span style="--0:#C6D0F5;--1:#45485f"> grid_bottom) </span><span style="--0:#81C8BE;--1:#0d5356">/</span><span style="--0:#C6D0F5;--1:#45485f"> block_height)</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#C6D0F5;--1:#45485f">floor</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">    </span><span style="--0:#aeb4cb;--0fs:italic;--1:#494a56;--1fs:italic">//now invert the Y because we were in y+ up world</span></div></div><div class="ec-line highlight del"><div class="code"><span style="--1:#45485f"><span class="indent"><span style="--0:#C6D0F5">    </span></span><span style="--0:#C6D0F5">grid_y </span></span><span style="--0:#99b4f0;--0fs:italic;--1:#1444a4;--1fs:italic">=</span><span style="--0:#C6D0F5;--1:#45485f"> (data</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#C6D0F5;--1:#45485f">height </span><span style="--0:#81C8BE;--1:#0d5356">-</span><span style="--0:#C6D0F5;--1:#45485f"> </span><span style="--0:#f0a27a;--1:#803205">1</span><span style="--0:#C6D0F5;--1:#45485f">) </span><span style="--0:#81C8BE;--1:#0d5356">-</span><span style="--0:#C6D0F5;--1:#45485f"> grid_y</span></div></div><div class="ec-line highlight del"><div class="code">
</div></div><div class="ec-line highlight del"><div class="code"><span class="indent">    </span><span style="--0:#cea5e8;--1:#6028a8">return</span><span style="--0:#C6D0F5;--1:#45485f"> [grid_x, grid_y]</span></div></div><div class="ec-line highlight del"><div class="code"><span style="--1:#45485f"><span class="indent"><span style="--0:#C6D0F5">  </span></span><span style="--0:#C6D0F5">}</span></span></div></div><div class="ec-line highlight del"><div class="code">
</div></div><div class="ec-line highlight del"><div class="code"><span class="indent">  </span><span style="--0:#99b4f0;--0fs:italic;--1:#1444a4;--1fs:italic">grid_to_world</span><span style="--0:#C6D0F5;--1:#45485f">(data: </span><span style="--0:#E5C890;--0fs:italic;--1:#68430e;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#45485f">, x: </span><span style="--0:#E5C890;--0fs:italic;--1:#68430e;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#45485f">, y: </span><span style="--0:#E5C890;--0fs:italic;--1:#68430e;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#45485f">) {</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">    </span><span style="--0:#aeb4cb;--0fs:italic;--1:#494a56;--1fs:italic">//we subtract because y+ is up,</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">    </span><span style="--0:#aeb4cb;--0fs:italic;--1:#494a56;--1fs:italic">//and we add 1 because we want the bottom left</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">    </span><span style="--0:#aeb4cb;--0fs:italic;--1:#494a56;--1fs:italic">//(not top left) for world space!</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">    </span><span style="--0:#cea5e8;--1:#6028a8">return</span><span style="--0:#C6D0F5;--1:#45485f"> [</span></div></div><div class="ec-line highlight del"><div class="code"><span style="--1:#45485f"><span class="indent"><span style="--0:#C6D0F5">      </span></span><span style="--0:#C6D0F5">grid_left </span></span><span style="--0:#99b4f0;--0fs:italic;--1:#1444a4;--1fs:italic">+</span><span style="--0:#C6D0F5;--1:#45485f"> (x </span><span style="--0:#81C8BE;--1:#0d5356">*</span><span style="--0:#C6D0F5;--1:#45485f"> block_width),</span></div></div><div class="ec-line highlight del"><div class="code"><span style="--1:#45485f"><span class="indent"><span style="--0:#C6D0F5">      </span></span><span style="--0:#C6D0F5">grid_bottom </span></span><span style="--0:#99b4f0;--0fs:italic;--1:#1444a4;--1fs:italic">+</span><span style="--0:#C6D0F5;--1:#45485f"> ((data</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#C6D0F5;--1:#45485f">height </span><span style="--0:#81C8BE;--1:#0d5356">-</span><span style="--0:#C6D0F5;--1:#45485f"> y </span><span style="--0:#81C8BE;--1:#0d5356">-</span><span style="--0:#C6D0F5;--1:#45485f"> </span><span style="--0:#f0a27a;--1:#803205">1</span><span style="--0:#C6D0F5;--1:#45485f">) </span><span style="--0:#81C8BE;--1:#0d5356">*</span><span style="--0:#C6D0F5;--1:#45485f"> block_height)</span></div></div><div class="ec-line highlight del"><div class="code"><span style="--1:#45485f"><span class="indent"><span style="--0:#C6D0F5">    </span></span><span style="--0:#C6D0F5">]</span></span></div></div><div class="ec-line highlight del"><div class="code"><span style="--1:#45485f"><span class="indent"><span style="--0:#C6D0F5">  </span></span><span style="--0:#C6D0F5">}</span></span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="  world_to_grid(data: Data, x: Num, y: Num) {    var grid_h = data.height * block_height    var grid_x = ((x - grid_left) / block_width).floor    var grid_y = ((y - grid_bottom) / block_height).floor    //now invert the Y because we were in y+ up world    grid_y = (data.height - 1) - grid_y    return [grid_x, grid_y]  }  grid_to_world(data: Data, x: Num, y: Num) {    //we subtract because y+ is up,    //and we add 1 because we want the bottom left    //(not top left) for world space!    return [      grid_left + (x * block_width),      grid_bottom + ((data.height - y - 1) * block_height)    ]  }"><div></div></button></div></figure></div>
<p>We canâ€™t use them directly, so we need to make some modifications after copy/pasting the code.</p>
<ul>
<li><code dir="auto">data: Data</code> has changed to mean â€˜the visual Dataâ€™</li>
<li><code dir="auto">data.height</code> was the grid logical height, we fetch that from <code dir="auto">Grid</code></li>
<li>we keep <code dir="auto">grid_left</code> and <code dir="auto">grid_bottom</code> (for now)</li>
</ul>
<div class="expressive-code"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">system/grid_visuals.modifier.wren...System</span></figcaption><pre data-language="wren"><code><div class="ec-line highlight ins"><div class="code"><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">world_to_grid</span><span style="--0:#C6D0F5;--1:#474a62">(data: </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#474a62">, x: </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#474a62">, y: </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#474a62">) {</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> logical_height </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Grid</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">get</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">height</span><span style="--0:#C6D0F5;--1:#474a62">(data</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">entity)</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> grid_h </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> logical_height </span><span style="--0:#81C8BE;--1:#0d5458">*</span><span style="--0:#C6D0F5;--1:#474a62"> data</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">block_height</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> grid_x </span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">=</span><span style="--0:#C6D0F5;--1:#474a62"> ((x </span><span style="--0:#81C8BE;--1:#0d5458">-</span><span style="--0:#C6D0F5;--1:#474a62"> grid_left) </span><span style="--0:#81C8BE;--1:#0d5458">/</span><span style="--0:#C6D0F5;--1:#474a62"> data</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">block_width)</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">floor</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> grid_y </span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">=</span><span style="--0:#C6D0F5;--1:#474a62"> ((y </span><span style="--0:#81C8BE;--1:#0d5458">-</span><span style="--0:#C6D0F5;--1:#474a62"> grid_bottom) </span><span style="--0:#81C8BE;--1:#0d5458">/</span><span style="--0:#C6D0F5;--1:#474a62"> data</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">block_height)</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">floor</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">//now invert the Y because we were in y+ up world</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">  </span></span><span style="--0:#C6D0F5">grid_y </span></span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">=</span><span style="--0:#C6D0F5;--1:#474a62"> (logical_height </span><span style="--0:#81C8BE;--1:#0d5458">-</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#f0a57f;--1:#833305">1</span><span style="--0:#C6D0F5;--1:#474a62">) </span><span style="--0:#81C8BE;--1:#0d5458">-</span><span style="--0:#C6D0F5;--1:#474a62"> grid_y</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">return</span><span style="--0:#C6D0F5;--1:#474a62"> [grid_x, grid_y]</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#C6D0F5;--1:#474a62">}</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">grid_to_world</span><span style="--0:#C6D0F5;--1:#474a62">(data: </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#474a62">, x: </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#474a62">, y: </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#474a62">) {</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> logical_height </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Grid</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">get</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">height</span><span style="--0:#C6D0F5;--1:#474a62">(data</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">entity)</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">//we subtract because y+ is up,</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">//and we add 1 because we want the bottom left</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">//(not top left) for world space!</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">return</span><span style="--0:#C6D0F5;--1:#474a62"> [</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">    </span></span><span style="--0:#C6D0F5">grid_left </span></span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">+</span><span style="--0:#C6D0F5;--1:#474a62"> (x </span><span style="--0:#81C8BE;--1:#0d5458">*</span><span style="--0:#C6D0F5;--1:#474a62"> data</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">block_width),</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">    </span></span><span style="--0:#C6D0F5">grid_bottom </span></span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">+</span><span style="--0:#C6D0F5;--1:#474a62"> ((logical_height </span><span style="--0:#81C8BE;--1:#0d5458">-</span><span style="--0:#C6D0F5;--1:#474a62"> y </span><span style="--0:#81C8BE;--1:#0d5458">-</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#f0a57f;--1:#833305">1</span><span style="--0:#C6D0F5;--1:#474a62">) </span><span style="--0:#81C8BE;--1:#0d5458">*</span><span style="--0:#C6D0F5;--1:#474a62"> data</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">block_height)</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">  </span></span><span style="--0:#C6D0F5">]</span></span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#C6D0F5;--1:#474a62">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="world_to_grid(data: Data, x: Num, y: Num) {  var logical_height = Grid.get.height(data.entity)  var grid_h = logical_height * data.block_height  var grid_x = ((x - grid_left) / data.block_width).floor  var grid_y = ((y - grid_bottom) / data.block_height).floor  //now invert the Y because we were in y+ up world  grid_y = (logical_height - 1) - grid_y  return [grid_x, grid_y]}grid_to_world(data: Data, x: Num, y: Num) {  var logical_height = Grid.get.height(data.entity)  //we subtract because y+ is up,  //and we add 1 because we want the bottom left  //(not top left) for world space!  return [    grid_left + (x * data.block_width),    grid_bottom + ((logical_height - y - 1) * data.block_height)  ]}"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="the-actual-drawing">The actual drawing</h3><a class="sl-anchor-link" href="#the-actual-drawing"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œThe actual drawingâ€</span></a></div>
<p>And we need to move the actual drawing out of our <code dir="auto">System</code> class in <code dir="auto">grid.modifier.wren</code>.
You should cut everything and leave it with just the grid specifics, like this:</p>
<div class="expressive-code"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">system/grid.modifier.wren...System</span></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">tick</span><span style="--0:#C6D0F5;--1:#4C4F69">(delta: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">each {</span><span style="--0:#EA999C;--0fs:italic;--1:#B43641;--1fs:italic">|entity: Entity, data: Data|</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// tick busy tasks</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">tick_busy</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, delta)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//each entity</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//tick</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="  tick(delta: Num) {    each {|entity: Entity, data: Data|      // tick busy tasks      tick_busy(data, delta)    } //each entity  } //tick}"><div></div></button></div></figure></div>
<p>And we paste the drawing contents into our <code dir="auto">tick</code> function in <code dir="auto">grid_visuals.modifier.wren</code>.
Like before we have to change the code a little to fit its new home!</p>
<ul>
<li>We use <code dir="auto">Grid.get.*</code> to fetch grid data we need</li>
<li>We use <code dir="auto">data.block_width</code>/<code dir="auto">data.block_height</code></li>
</ul>
<p>Hereâ€™s the complete tick function after the changes:</p>
<div class="expressive-code"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">system/grid_visuals.modifier.wren...System</span></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">tick</span><span style="--0:#C6D0F5;--1:#4C4F69">(delta: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">each {</span><span style="--0:#EA999C;--0fs:italic;--1:#B43641;--1fs:italic">|entity: Entity, data: Data|</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> grid_width </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Grid</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">get</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">width</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity)</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> grid_height </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Grid</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">get</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">height</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity)</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> grid_rows </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Grid</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">get</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">rows</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> selected </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Grid</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">get</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">selected</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity)</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> cursor </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Grid</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">get</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">cursor</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity)</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> block_width </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">block_width</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> block_height </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">block_height</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//if we have a selection, draw it</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Grid</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">in_grid</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity, selected</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">x, selected</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">y)) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> draw_pos </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">grid_to_world</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, selected</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">x, selected</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">y)</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Draw</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">rect</span><span style="--0:#C6D0F5;--1:#4C4F69">(draw,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">        </span></span><span style="--0:#C6D0F5;--1:#4C4F69">draw_pos</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">x, draw_pos</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">y, </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">        </span></span><span style="--0:#C6D0F5;--1:#4C4F69">block_width, block_height, </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">, style</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">color</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Color</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">pink))</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//if we have a cursor, draw that</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Grid</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">in_grid</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity, cursor</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">x, cursor</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">y)) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> draw_pos </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">grid_to_world</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, cursor</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">x, cursor</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">y)</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Draw</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">rect</span><span style="--0:#C6D0F5;--1:#4C4F69">(draw,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">        </span></span><span style="--0:#C6D0F5;--1:#4C4F69">draw_pos</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">x, draw_pos</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">y, </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">        </span></span><span style="--0:#C6D0F5;--1:#4C4F69">block_width, block_height, </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">, style</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">color</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Color</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">black))</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69">(y </span><span style="--0:#CA9EE6;--1:#8035E0">in</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">...</span><span style="--0:#C6D0F5;--1:#4C4F69"> grid_height) {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> row: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">GridRow</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> grid_rows[y]</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69">(x </span><span style="--0:#CA9EE6;--1:#8035E0">in</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">...</span><span style="--0:#C6D0F5;--1:#4C4F69"> grid_width) {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> kind </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> row</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">columns[x]</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(kind </span><span style="--0:#81C8BE;--1:#116E73">==</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">) </span><span style="--0:#CA9EE6;--1:#8035E0">continue</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> y_offset </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> x_offset </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> scale </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">1</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> busy: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Busy</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Grid</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">get_busy</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity, x, y)</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(busy) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// how far into the wait are we?</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// this is a 0...1 range value</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> ratio </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">timer </span><span style="--0:#81C8BE;--1:#116E73">/</span><span style="--0:#C6D0F5;--1:#4C4F69"> busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">wait</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">kind </span><span style="--0:#81C8BE;--1:#116E73">==</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">DESTROY) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// since we're destroying, scale down from 1</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// and don't let it go too small</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">            </span></span><span style="--0:#C6D0F5;--1:#4C4F69">scale </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> ( </span><span style="--0:#EF9F76;--1:#AB4307">1.0</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> ratio )</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">max</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#EF9F76;--1:#AB4307">0.1</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">          </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">kind </span><span style="--0:#81C8BE;--1:#116E73">==</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">CREATE) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// since we're creating, scale from from 0 to 1</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">            </span></span><span style="--0:#C6D0F5;--1:#4C4F69">scale </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> ratio</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">max</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#EF9F76;--1:#AB4307">0.1</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">          </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">kind </span><span style="--0:#81C8BE;--1:#116E73">==</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">MOVE) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> distance </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> block_height </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">*</span><span style="--0:#C6D0F5;--1:#4C4F69"> (busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">dest_y </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">y)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">            </span></span><span style="--0:#C6D0F5;--1:#4C4F69">y_offset </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> distance </span><span style="--0:#81C8BE;--1:#116E73">*</span><span style="--0:#C6D0F5;--1:#4C4F69"> ratio</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">          </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">kind </span><span style="--0:#81C8BE;--1:#116E73">==</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">SWAP) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> dist_x </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> block_width </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">*</span><span style="--0:#C6D0F5;--1:#4C4F69"> (busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">dest_x </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">x)</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> dist_y </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> block_height </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">*</span><span style="--0:#C6D0F5;--1:#4C4F69"> (busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">dest_y </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">y)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">            </span></span><span style="--0:#C6D0F5;--1:#4C4F69">x_offset </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> dist_x </span><span style="--0:#81C8BE;--1:#116E73">*</span><span style="--0:#C6D0F5;--1:#4C4F69"> ratio</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">            </span></span><span style="--0:#C6D0F5;--1:#4C4F69">y_offset </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> dist_y </span><span style="--0:#81C8BE;--1:#116E73">*</span><span style="--0:#C6D0F5;--1:#4C4F69"> ratio</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">          </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">        </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> pos </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">grid_to_world</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x, y)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">            </span></span><span style="--0:#C6D0F5;--1:#4C4F69">pos</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">x </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> pos</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">x </span><span style="--0:#81C8BE;--1:#116E73">+</span><span style="--0:#C6D0F5;--1:#4C4F69"> x_offset</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">            </span></span><span style="--0:#C6D0F5;--1:#4C4F69">pos</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">y </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> pos</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">y </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> y_offset</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> color </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> colors[kind </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">1</span><span style="--0:#C6D0F5;--1:#4C4F69">]</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> sides </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> sides[kind </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">1</span><span style="--0:#C6D0F5;--1:#4C4F69">]</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> half_width </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> block_width </span><span style="--0:#81C8BE;--1:#116E73">/</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">2</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> half_height </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> block_height </span><span style="--0:#81C8BE;--1:#116E73">/</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">2</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> radius_x </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> half_width </span><span style="--0:#81C8BE;--1:#116E73">*</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0.9</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">*</span><span style="--0:#C6D0F5;--1:#4C4F69"> scale</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> radius_y </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> half_height </span><span style="--0:#81C8BE;--1:#116E73">*</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0.9</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">*</span><span style="--0:#C6D0F5;--1:#4C4F69"> scale</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Draw</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">ngon_solid</span><span style="--0:#C6D0F5;--1:#4C4F69">(draw, pos</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">x </span><span style="--0:#81C8BE;--1:#116E73">+</span><span style="--0:#C6D0F5;--1:#4C4F69"> half_width, pos</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">y </span><span style="--0:#81C8BE;--1:#116E73">+</span><span style="--0:#C6D0F5;--1:#4C4F69"> half_height, </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">, radius_x, radius_y, sides, </span><span style="--0:#EF9F76;--1:#AB4307">90</span><span style="--0:#C6D0F5;--1:#4C4F69">, color)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">      </span></span><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//each column</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//each row</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//each</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Draw</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">commit</span><span style="--0:#C6D0F5;--1:#4C4F69">(draw)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="tick(delta: Num) {  each {|entity: Entity, data: Data|    var grid_width = Grid.get.width(entity)    var grid_height = Grid.get.height(entity)    var grid_rows = Grid.get.rows(entity)    var selected = Grid.get.selected(entity)    var cursor = Grid.get.cursor(entity)    var block_width = data.block_width    var block_height = data.block_height    //if we have a selection, draw it    if(Grid.in_grid(entity, selected.x, selected.y)) {      var draw_pos = grid_to_world(data, selected.x, selected.y)      Draw.rect(draw,        draw_pos.x, draw_pos.y, 0,        block_width, block_height, 0, style.color(Color.pink))    }    //if we have a cursor, draw that    if(Grid.in_grid(entity, cursor.x, cursor.y)) {      var draw_pos = grid_to_world(data, cursor.x, cursor.y)      Draw.rect(draw,        draw_pos.x, draw_pos.y, 0,        block_width, block_height, 0, style.color(Color.black))    }    for(y in 0 ... grid_height) {      var row: GridRow = grid_rows[y]      for(x in 0 ... grid_width) {        var kind = row.columns[x]        if(kind == 0) continue        var y_offset = 0        var x_offset = 0        var scale = 1        var busy: Busy = Grid.get_busy(entity, x, y)        if(busy) {          // how far into the wait are we?          // this is a 0...1 range value          var ratio = busy.timer / busy.wait          if(busy.kind == Busy.DESTROY) {            // since we&#x27;re destroying, scale down from 1            // and don&#x27;t let it go too small            scale = ( 1.0 - ratio ).max(0.1)          }          if(busy.kind == Busy.CREATE) {            // since we&#x27;re creating, scale from from 0 to 1            scale = ratio.max(0.1)          }          if(busy.kind == Busy.MOVE) {            var distance = block_height * (busy.dest_y - busy.y)            y_offset = distance * ratio          }          if(busy.kind == Busy.SWAP) {            var dist_x = block_width * (busy.dest_x - busy.x)            var dist_y = block_height * (busy.dest_y - busy.y)            x_offset = dist_x * ratio            y_offset = dist_y * ratio          }        }        var pos = grid_to_world(data, x, y)            pos.x = pos.x + x_offset            pos.y = pos.y - y_offset        var color = colors[kind - 1]        var sides = sides[kind - 1]        var half_width = block_width / 2        var half_height = block_height / 2        var radius_x = half_width * 0.9 * scale        var radius_y = half_height * 0.9 * scale        Draw.ngon_solid(draw, pos.x + half_width, pos.y + half_height, 0, radius_x, radius_y, sides, 90, color)      } //each column    } //each row  } //each  Draw.commit(draw)}"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="the-gridinput-changes">The GridInput changes</h3><a class="sl-anchor-link" href="#the-gridinput-changes"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œThe GridInput changesâ€</span></a></div>
<p>Since we moved the <code dir="auto">world_to_grid</code> into our <code dir="auto">GridVisuals</code>, we should use that from <code dir="auto">GridInput</code> instead.</p>
<p>At the top of <code dir="auto">grid_input.modifier.wren</code> add this line:</p>
<div class="expressive-code"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">grid_input.modifier.wren</span></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">import</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#A6D189;--1:#2D711E">"system/grid.modifier"</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Grid</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#cfa8e9;--1:#6429af">import</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#A6D189;--1:#235817">"system/grid_visuals.modifier"</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#cfa8e9;--1:#6429af">for</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">GridVisuals</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import &#x22;system/grid.modifier&#x22; for Gridimport &#x22;system/grid_visuals.modifier&#x22; for GridVisuals"><div></div></button></div></figure></div>
<p>And then the changes to the tick function, using the new API instead:</p>
<div class="expressive-code"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">grid_input.modifier.wren...System</span></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">tick</span><span style="--0:#C6D0F5;--1:#4C4F69">(delta: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> mouse </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Camera</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">screen_point_to_world</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Camera</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">get_default</span><span style="--0:#C6D0F5;--1:#4C4F69">(world), </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Input</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">mouse_x</span><span style="--0:#C6D0F5;--1:#4C4F69">(), </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Input</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">mouse_y</span><span style="--0:#C6D0F5;--1:#4C4F69">())</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> interact </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Input</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">mouse_state_released</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">MouseButton</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">left)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">each {</span><span style="--0:#EA999C;--0fs:italic;--1:#B43641;--1fs:italic">|entity: Entity, data: Data|</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">      </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> grid_mouse </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><ins><span style="--0:#E5C890;--0fs:italic;--1:#5d3c0c;--1fs:italic">GridVisuals</span><span style="--0:#93d0c7;--1:#0b4a4d">.</span></ins><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">world_to_grid</span><span style="--0:#C6D0F5;--1:#474a62">(entity, mouse</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">x, mouse</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">y)</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#81C8BE;--1:#116E73">...</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="  tick(delta: Num) {    var mouse = Camera.screen_point_to_world(Camera.get_default(world), Input.mouse_x(), Input.mouse_y())    var interact = Input.mouse_state_released(MouseButton.left)    each {|entity: Entity, data: Data|      var grid_mouse = GridVisuals.world_to_grid(entity, mouse.x, mouse.y)      ..."><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h2"><h2 id="something-for-nothing">Something for Nothing</h2><a class="sl-anchor-link" href="#something-for-nothing"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œSomething for Nothingâ€</span></a></div>
<p>If everything goes as planned, the game will be exactly the same.
It feels like we did all that and nothing changed!</p>
<p>Thatâ€™s a good feeling, it means everything is working but a lot cleaner to maintain and build on top of.</p>
<video preload="auto" autoplay controls muted playinsline="true" loop style="max-width:100%; width:auto; margin:auto; display:block;"><source src="/video/tutorials/match3/timings.mp4" type="video/mp4"/></video>
<div class="sl-heading-wrapper level-h2"><h2 id="brief-detour-the-debug-module">Brief detour: the <code dir="auto">Debug</code> module</h2><a class="sl-anchor-link" href="#brief-detour-the-debug-module"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œBrief detour: the Debug moduleâ€</span></a></div>
<p>If we add the <code dir="auto">debug</code> module to our project, and inspect our game world, we can select the grid entity and play with <em>some</em> of the values:</p>
<p>Because the visuals are drawn every frame and use the block size data we exposed, we can change these and see the results in realtime for fun.</p>
<video preload="auto" autoplay controls muted playinsline="true" loop style="max-width:100%; width:auto; margin:auto; display:block;"><source src="/video/tutorials/match3/debug.changes.mp4" type="video/mp4"/></video>
<div class="sl-heading-wrapper level-h2"><h2 id="using-transform">Using <code dir="auto">Transform</code></h2><a class="sl-anchor-link" href="#using-transform"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œUsing Transformâ€</span></a></div>
<p>Inside <code dir="auto">grid_visuals.modifier.wren</code> we can add <code dir="auto">Transform</code> to the world import:</p>
<div class="expressive-code"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">system/grid_visuals.modifier.wren</span></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">import</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#A6D189;--1:#2D711E">"luxe: world"</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Entity</span><span style="--0:#C6D0F5;--1:#4C4F69">, </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">World</span><ins><span style="--0:#C6D0F5;--1:#474a62">, </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Transform</span></ins></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import &#x22;luxe: world&#x22; for Entity, World, Transform"><div></div></button></div></figure></div>
<p>We can remove these two variables from <code dir="auto">System</code></p>
<div class="expressive-code"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">system/grid_visuals.modifier.wren...System</span></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">class</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">System</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#CA9EE6;--1:#8035E0">is</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Modifier</span><span style="--0:#C6D0F5;--1:#4C4F69"> {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//debug visualization</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> draw: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Draw</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#CA9EE6;--1:#8035E0">null</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> style: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">PathStyle</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">PathStyle</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#CA9EE6;--1:#8035E0">new</span><span style="--0:#C6D0F5;--1:#4C4F69">()</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">  </span><span style="--0:#cea5e8;--1:#6028a8">var</span><span style="--0:#C6D0F5;--1:#45485f"> grid_left </span><span style="--0:#81C8BE;--1:#0d5356">=</span><span style="--0:#C6D0F5;--1:#45485f"> </span><span style="--0:#f0a27a;--1:#803205">100</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">  </span><span style="--0:#cea5e8;--1:#6028a8">var</span><span style="--0:#C6D0F5;--1:#45485f"> grid_bottom </span><span style="--0:#81C8BE;--1:#0d5356">=</span><span style="--0:#C6D0F5;--1:#45485f"> </span><span style="--0:#f0a27a;--1:#803205">64</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="class System is Modifier {  //debug visualization  var draw: Draw = null  var style: PathStyle = PathStyle.new()  var grid_left = 100  var grid_bottom = 64"><div></div></button></div></figure></div>
<p>And we add them locally to our conversion helpers, using Transform this time:</p>
<div class="expressive-code"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">system/grid_visuals.modifier.wren...System</span></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">world_to_grid</span><span style="--0:#C6D0F5;--1:#4C4F69">(data: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#4C4F69">, x: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">, y: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> grid_left </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Transform</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">get_pos_x_world</span><span style="--0:#C6D0F5;--1:#474a62">(data</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">entity)</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> grid_bottom </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Transform</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">get_pos_y_world</span><span style="--0:#C6D0F5;--1:#474a62">(data</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">entity)</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> logical_height </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Grid</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">get</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">height</span><span style="--0:#C6D0F5;--1:#4C4F69">(data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">entity)</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> grid_h </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> logical_height </span><span style="--0:#81C8BE;--1:#116E73">*</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">block_height</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> grid_x </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> ((x </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> grid_left) </span><span style="--0:#81C8BE;--1:#116E73">/</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">block_width)</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">floor</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> grid_y </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> ((y </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> grid_bottom) </span><span style="--0:#81C8BE;--1:#116E73">/</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">block_height)</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">floor</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//now invert the Y because we were in y+ up world</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">grid_y </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> (logical_height </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">1</span><span style="--0:#C6D0F5;--1:#4C4F69">) </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> grid_y</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">return</span><span style="--0:#C6D0F5;--1:#4C4F69"> [grid_x, grid_y]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">grid_to_world</span><span style="--0:#C6D0F5;--1:#4C4F69">(data: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#4C4F69">, x: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">, y: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> grid_left </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Transform</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">get_pos_x_world</span><span style="--0:#C6D0F5;--1:#474a62">(data</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">entity)</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> grid_bottom </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Transform</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">get_pos_y_world</span><span style="--0:#C6D0F5;--1:#474a62">(data</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">entity)</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> logical_height </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Grid</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">get</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">height</span><span style="--0:#C6D0F5;--1:#4C4F69">(data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">entity)</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//we subtract because y+ is up,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//and we add 1 because we want the bottom left</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//(not top left) for world space!</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">return</span><span style="--0:#C6D0F5;--1:#4C4F69"> [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">grid_left </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">+</span><span style="--0:#C6D0F5;--1:#4C4F69"> (x </span><span style="--0:#81C8BE;--1:#116E73">*</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">block_width),</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">grid_bottom </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">+</span><span style="--0:#C6D0F5;--1:#4C4F69"> ((logical_height </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> y </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">1</span><span style="--0:#C6D0F5;--1:#4C4F69">) </span><span style="--0:#81C8BE;--1:#116E73">*</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">block_height)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="world_to_grid(data: Data, x: Num, y: Num) {  var grid_left = Transform.get_pos_x_world(data.entity)  var grid_bottom = Transform.get_pos_y_world(data.entity)  var logical_height = Grid.get.height(data.entity)  var grid_h = logical_height * data.block_height  var grid_x = ((x - grid_left) / data.block_width).floor  var grid_y = ((y - grid_bottom) / data.block_height).floor  //now invert the Y because we were in y+ up world  grid_y = (logical_height - 1) - grid_y  return [grid_x, grid_y]}grid_to_world(data: Data, x: Num, y: Num) {  var grid_left = Transform.get_pos_x_world(data.entity)  var grid_bottom = Transform.get_pos_y_world(data.entity)  var logical_height = Grid.get.height(data.entity)  //we subtract because y+ is up,  //and we add 1 because we want the bottom left  //(not top left) for world space!  return [    grid_left + (x * data.block_width),    grid_bottom + ((logical_height - y - 1) * data.block_height)  ]}"><div></div></button></div></figure></div>
<p>And finally back in <code dir="auto">game.wren</code> we can change the Transform now with a different value:</p>
<div class="expressive-code"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">game.wren</span></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">grid </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Entity</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">create</span><span style="--0:#C6D0F5;--1:#4C4F69">(world, </span><span style="--0:#A6D189;--1:#2D711E">"grid"</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Grid</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">create</span><span style="--0:#C6D0F5;--1:#4C4F69">(grid)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">GridInput</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">create</span><span style="--0:#C6D0F5;--1:#4C4F69">(grid)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">GridVisuals</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">create</span><span style="--0:#C6D0F5;--1:#4C4F69">(grid)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Transform</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">create</span><span style="--0:#C6D0F5;--1:#4C4F69">(grid)</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Transform</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">set_pos</span><span style="--0:#C6D0F5;--1:#474a62">(grid, </span><span style="--0:#f0a57f;--1:#833305">64</span><span style="--0:#C6D0F5;--1:#474a62">, </span><span style="--0:#f0a57f;--1:#833305">64</span><span style="--0:#C6D0F5;--1:#474a62">)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="grid = Entity.create(world, &#x22;grid&#x22;)Grid.create(grid)GridInput.create(grid)GridVisuals.create(grid)Transform.create(grid)Transform.set_pos(grid, 64, 64)"><div></div></button></div></figure></div>
<p><img src="/_astro/grid.transform.lPvGd341_Z2bPUOJ.webp" alt loading="lazy" decoding="async" fetchpriority="auto" width="1200" height="800"></p>
<p>This means we can position the grid in the world easily around other entities.</p>
<p>Thereâ€™s one more step: the render depth.
We used <code dir="auto">0</code> in our tick function all along, but if we want the grid to co-exist with the world as is, we should update those.
Update the tick function in <code dir="auto">grid_visuals.modifier.wren</code> to use the depth whenever it speaks to the <code dir="auto">Draw</code> tool:</p>
<div class="expressive-code"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">system/grid_visuals.modifier.wren...System</span></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">each {</span><span style="--0:#EA999C;--0fs:italic;--1:#B43641;--1fs:italic">|entity: Entity, data: Data|</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> grid_width </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Grid</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">get</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">width</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity)</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> grid_height </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Grid</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">get</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">height</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity)</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> grid_rows </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Grid</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">get</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">rows</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> selected </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Grid</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">get</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">selected</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity)</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> cursor </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Grid</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">get</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">cursor</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity)</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> block_width </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">block_width</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> block_height </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">block_height</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> depth </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Transform</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">get_depth2D_world</span><span style="--0:#C6D0F5;--1:#474a62">(entity)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//if we have a selection, draw it</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Grid</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">in_grid</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity, selected</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">x, selected</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">y)) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> draw_pos </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">grid_to_world</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, selected</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">x, selected</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">y)</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Draw</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">rect</span><span style="--0:#C6D0F5;--1:#4C4F69">(draw,</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">      </span></span><span style="--0:#C6D0F5">draw_pos</span></span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">x, draw_pos</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">y, </span><ins><span style="--0:#C6D0F5;--1:#3e4055">depth,</span></ins></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">      </span></span><span style="--0:#C6D0F5;--1:#4C4F69">block_width, block_height, </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">, style</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">color</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Color</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">pink))</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//if we have a cursor, draw that</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Grid</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">in_grid</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity, cursor</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">x, cursor</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">y)) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> draw_pos </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">grid_to_world</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, cursor</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">x, cursor</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">y)</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Draw</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">rect</span><span style="--0:#C6D0F5;--1:#4C4F69">(draw,</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">      </span></span><span style="--0:#C6D0F5">draw_pos</span></span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">x, draw_pos</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">y, </span><ins><span style="--0:#C6D0F5;--1:#3e4055">depth,</span></ins></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">      </span></span><span style="--0:#C6D0F5;--1:#4C4F69">block_width, block_height, </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">, style</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">color</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Color</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">black))</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69">(y </span><span style="--0:#CA9EE6;--1:#8035E0">in</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">...</span><span style="--0:#C6D0F5;--1:#4C4F69"> grid_height) {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> row: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">GridRow</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> grid_rows[y]</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69">(x </span><span style="--0:#CA9EE6;--1:#8035E0">in</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">...</span><span style="--0:#C6D0F5;--1:#4C4F69"> grid_width) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#81C8BE;--1:#116E73">...</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//existing code</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">      </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Draw</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">ngon_solid</span><span style="--0:#C6D0F5;--1:#474a62">(draw, pos</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">x </span><span style="--0:#81C8BE;--1:#0d5458">+</span><span style="--0:#C6D0F5;--1:#474a62"> half_width, pos</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">y </span><span style="--0:#81C8BE;--1:#0d5458">+</span><span style="--0:#C6D0F5;--1:#474a62"> half_height, </span><ins><span style="--0:#C6D0F5;--1:#3e4055">depth,</span></ins><span style="--0:#C6D0F5;--1:#474a62"> radius_x, radius_y, sides, </span><span style="--0:#f0a57f;--1:#833305">90</span><span style="--0:#C6D0F5;--1:#474a62">, color)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//each column</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//each row</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="each {|entity: Entity, data: Data|  var grid_width = Grid.get.width(entity)  var grid_height = Grid.get.height(entity)  var grid_rows = Grid.get.rows(entity)  var selected = Grid.get.selected(entity)  var cursor = Grid.get.cursor(entity)  var block_width = data.block_width  var block_height = data.block_height  var depth = Transform.get_depth2D_world(entity)  //if we have a selection, draw it  if(Grid.in_grid(entity, selected.x, selected.y)) {    var draw_pos = grid_to_world(data, selected.x, selected.y)    Draw.rect(draw,      draw_pos.x, draw_pos.y, depth,      block_width, block_height, 0, style.color(Color.pink))  }  //if we have a cursor, draw that  if(Grid.in_grid(entity, cursor.x, cursor.y)) {    var draw_pos = grid_to_world(data, cursor.x, cursor.y)    Draw.rect(draw,      draw_pos.x, draw_pos.y, depth,      block_width, block_height, 0, style.color(Color.black))  }  for(y in 0 ... grid_height) {    var row: GridRow = grid_rows[y]    for(x in 0 ... grid_width) {      ... //existing code      Draw.ngon_solid(draw, pos.x + half_width, pos.y + half_height, depth, radius_x, radius_y, sides, 90, color)    } //each column  } //each row"><div></div></button></div></figure></div>
<p>This means if we changed our z value on the transform, it will respect it allowing us to put a background behind or things in front as expected.</p>
<div class="sl-heading-wrapper level-h2"><h2 id="next-time">Next time!</h2><a class="sl-anchor-link" href="#next-time"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œNext time!â€</span></a></div>
<p>In the next part, weâ€™re going to use the world systems to visualize the grid instead of directly with <code dir="auto">Draw</code>.</p>
<p>Onto part 4!</p> </div> <footer class="sl-flex astro-3yyafb3n"> <div class="meta sl-flex astro-3yyafb3n">   </div> <div class="pagination-links print:hidden astro-u2l5gyhi" dir="ltr"> <a href="/tutorials/match-3/part2/" rel="prev" class="astro-u2l5gyhi"> <svg aria-hidden="true" class="astro-u2l5gyhi astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.5rem;"><path d="M17 11H9.41l3.3-3.29a1.004 1.004 0 1 0-1.42-1.42l-5 5a1 1 0 0 0-.21.33 1 1 0 0 0 0 .76 1 1 0 0 0 .21.33l5 5a1.002 1.002 0 0 0 1.639-.325 1 1 0 0 0-.219-1.095L9.41 13H17a1 1 0 0 0 0-2Z"/></svg> <span class="astro-u2l5gyhi"> Previous <br class="astro-u2l5gyhi"> <span class="link-title astro-u2l5gyhi">Match 3 - Animating changes</span> </span> </a> <a href="/tutorials/match-3/part4/" rel="next" class="astro-u2l5gyhi"> <svg aria-hidden="true" class="astro-u2l5gyhi astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.5rem;"><path d="M17.92 11.62a1.001 1.001 0 0 0-.21-.33l-5-5a1.003 1.003 0 1 0-1.42 1.42l3.3 3.29H7a1 1 0 0 0 0 2h7.59l-3.3 3.29a1.002 1.002 0 0 0 .325 1.639 1 1 0 0 0 1.095-.219l5-5a1 1 0 0 0 .21-.33 1 1 0 0 0 0-.76Z"/></svg> <span class="astro-u2l5gyhi"> Next <br class="astro-u2l5gyhi"> <span class="link-title astro-u2l5gyhi">Match 3 - Sprite visuals</span> </span> </a> </div>   </footer>  </div> </div>   </main> </div> </div>  </div> </div>  </body></html>