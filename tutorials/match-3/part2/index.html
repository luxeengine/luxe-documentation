<!DOCTYPE html><html lang="en" dir="ltr" data-theme="dark" data-has-toc data-has-sidebar class="astro-bguv2lll"> <head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Match 3 - Animating changes | luxe docs</title><link rel="canonical"/><link rel="shortcut icon" href="/next/favicon.svg" type="image/svg+xml"/><meta name="generator" content="Astro v5.15.5"/><meta name="generator" content="Starlight v0.36.2"/><meta property="og:title" content="Match 3 - Animating changes"/><meta property="og:type" content="article"/><meta property="og:url"/><meta property="og:locale" content="en"/><meta property="og:description" content="A tutorial on making a match 3"/><meta property="og:site_name" content="luxe docs"/><meta name="twitter:card" content="summary_large_image"/><meta name="description" content="A tutorial on making a match 3"/><script>
	window.StarlightThemeProvider = (() => {
		const storedTheme =
			typeof localStorage !== 'undefined' && localStorage.getItem('starlight-theme');
		const theme =
			storedTheme ||
			(window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
		document.documentElement.dataset.theme = theme === 'light' ? 'light' : 'dark';
		return {
			updatePickers(theme = storedTheme || 'auto') {
				document.querySelectorAll('starlight-theme-select').forEach((picker) => {
					const select = picker.querySelector('select');
					if (select) select.value = theme;
					/** @type {HTMLTemplateElement | null} */
					const tmpl = document.querySelector(`#theme-icons`);
					const newIcon = tmpl && tmpl.content.querySelector('.' + theme);
					if (newIcon) {
						const oldIcon = picker.querySelector('svg.label-icon');
						if (oldIcon) {
							oldIcon.replaceChildren(...newIcon.cloneNode(true).childNodes);
						}
					}
				});
			},
		};
	})();
</script><template id="theme-icons"><svg aria-hidden="true" class="light astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M5 12a1 1 0 0 0-1-1H3a1 1 0 0 0 0 2h1a1 1 0 0 0 1-1Zm.64 5-.71.71a1 1 0 0 0 0 1.41 1 1 0 0 0 1.41 0l.71-.71A1 1 0 0 0 5.64 17ZM12 5a1 1 0 0 0 1-1V3a1 1 0 0 0-2 0v1a1 1 0 0 0 1 1Zm5.66 2.34a1 1 0 0 0 .7-.29l.71-.71a1 1 0 1 0-1.41-1.41l-.66.71a1 1 0 0 0 0 1.41 1 1 0 0 0 .66.29Zm-12-.29a1 1 0 0 0 1.41 0 1 1 0 0 0 0-1.41l-.71-.71a1.004 1.004 0 1 0-1.43 1.41l.73.71ZM21 11h-1a1 1 0 0 0 0 2h1a1 1 0 0 0 0-2Zm-2.64 6A1 1 0 0 0 17 18.36l.71.71a1 1 0 0 0 1.41 0 1 1 0 0 0 0-1.41l-.76-.66ZM12 6.5a5.5 5.5 0 1 0 5.5 5.5A5.51 5.51 0 0 0 12 6.5Zm0 9a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7Zm0 3.5a1 1 0 0 0-1 1v1a1 1 0 0 0 2 0v-1a1 1 0 0 0-1-1Z"/></svg><svg aria-hidden="true" class="dark astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.64 13a1 1 0 0 0-1.05-.14 8.049 8.049 0 0 1-3.37.73 8.15 8.15 0 0 1-8.14-8.1 8.59 8.59 0 0 1 .25-2A1 1 0 0 0 8 2.36a10.14 10.14 0 1 0 14 11.69 1 1 0 0 0-.36-1.05Zm-9.5 6.69A8.14 8.14 0 0 1 7.08 5.22v.27a10.15 10.15 0 0 0 10.14 10.14 9.784 9.784 0 0 0 2.1-.22 8.11 8.11 0 0 1-7.18 4.32v-.04Z"/></svg><svg aria-hidden="true" class="auto astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg></template> <script>
  window.StarlightKbdProvider = (() => {
    return {
      updateKbdPickers(type) {
        for (const select of document.querySelectorAll('starlight-kbd-picker select')) {
          const isKnownType = Array.from(select.options).some((option) => option.value === type)
          if (!isKnownType) return
          select.value = type
        }
      },
    }
  })()
</script><link rel="stylesheet" href="/next/_astro/print.DNXP8c50.css" media="print"><link rel="stylesheet" href="/next/_astro/index.CQqvigv2.css">
<style>@layer starlight.components{:root{--sl-badge-default-border: var(--sl-color-accent);--sl-badge-default-bg: var(--sl-color-accent-low);--sl-badge-default-text: #fff;--sl-badge-note-border: var(--sl-color-blue);--sl-badge-note-bg: var(--sl-color-blue-low);--sl-badge-note-text: #fff;--sl-badge-danger-border: var(--sl-color-red);--sl-badge-danger-bg: var(--sl-color-red-low);--sl-badge-danger-text: #fff;--sl-badge-success-border: var(--sl-color-green);--sl-badge-success-bg: var(--sl-color-green-low);--sl-badge-success-text: #fff;--sl-badge-caution-border: var(--sl-color-orange);--sl-badge-caution-bg: var(--sl-color-orange-low);--sl-badge-caution-text: #fff;--sl-badge-tip-border: var(--sl-color-purple);--sl-badge-tip-bg: var(--sl-color-purple-low);--sl-badge-tip-text: #fff}[data-theme=light]:root{--sl-badge-default-bg: var(--sl-color-accent-high);--sl-badge-note-bg: var(--sl-color-blue-high);--sl-badge-danger-bg: var(--sl-color-red-high);--sl-badge-success-bg: var(--sl-color-green-high);--sl-badge-caution-bg: var(--sl-color-orange-high);--sl-badge-tip-bg: var(--sl-color-purple-high)}.sl-badge:where(.astro-avdet4wd){display:inline-block;border:1px solid var(--sl-color-border-badge);border-radius:.25rem;font-family:var(--sl-font-system-mono);line-height:normal;color:var(--sl-color-text-badge);background-color:var(--sl-color-bg-badge);overflow-wrap:anywhere}.sidebar-content .sl-badge:where(.astro-avdet4wd){line-height:1;font-size:var(--sl-text-xs);padding:.125rem .375rem}.sidebar-content a[aria-current=page]>.sl-badge:where(.astro-avdet4wd){--sl-color-bg-badge: transparent;--sl-color-border-badge: currentColor;color:inherit}.default:where(.astro-avdet4wd){--sl-color-bg-badge: var(--sl-badge-default-bg);--sl-color-border-badge: var(--sl-badge-default-border);--sl-color-text-badge: var(--sl-badge-default-text)}.note:where(.astro-avdet4wd){--sl-color-bg-badge: var(--sl-badge-note-bg);--sl-color-border-badge: var(--sl-badge-note-border);--sl-color-text-badge: var(--sl-badge-note-text)}.danger:where(.astro-avdet4wd){--sl-color-bg-badge: var(--sl-badge-danger-bg);--sl-color-border-badge: var(--sl-badge-danger-border);--sl-color-text-badge: var(--sl-badge-danger-text)}.success:where(.astro-avdet4wd){--sl-color-bg-badge: var(--sl-badge-success-bg);--sl-color-border-badge: var(--sl-badge-success-border);--sl-color-text-badge: var(--sl-badge-success-text)}.tip:where(.astro-avdet4wd){--sl-color-bg-badge: var(--sl-badge-tip-bg);--sl-color-border-badge: var(--sl-badge-tip-border);--sl-color-text-badge: var(--sl-badge-tip-text)}.caution:where(.astro-avdet4wd){--sl-color-bg-badge: var(--sl-badge-caution-bg);--sl-color-border-badge: var(--sl-badge-caution-border);--sl-color-text-badge: var(--sl-badge-caution-text)}.small:where(.astro-avdet4wd){font-size:var(--sl-text-xs);padding:.125rem .25rem}.medium:where(.astro-avdet4wd){font-size:var(--sl-text-sm);padding:.175rem .35rem}.large:where(.astro-avdet4wd){font-size:var(--sl-text-base);padding:.225rem .45rem}.sl-markdown-content :is(h1,h2,h3,h4,h5,h6) .sl-badge:where(.astro-avdet4wd){vertical-align:middle}}
@layer starlight.components{.card:where(.astro-v5tidmuc){--sl-card-border: var(--sl-color-purple);--sl-card-bg: var(--sl-color-purple-low);border:1px solid var(--sl-color-gray-5);background-color:var(--sl-color-black);padding:clamp(1rem,calc(.125rem + 3vw),2.5rem);flex-direction:column;gap:clamp(.5rem,calc(.125rem + 1vw),1rem)}.card:where(.astro-v5tidmuc):nth-child(4n+1){--sl-card-border: var(--sl-color-orange);--sl-card-bg: var(--sl-color-orange-low)}.card:where(.astro-v5tidmuc):nth-child(4n+3){--sl-card-border: var(--sl-color-green);--sl-card-bg: var(--sl-color-green-low)}.card:where(.astro-v5tidmuc):nth-child(4n+4){--sl-card-border: var(--sl-color-red);--sl-card-bg: var(--sl-color-red-low)}.card:where(.astro-v5tidmuc):nth-child(4n+5){--sl-card-border: var(--sl-color-blue);--sl-card-bg: var(--sl-color-blue-low)}.title:where(.astro-v5tidmuc){font-weight:600;font-size:var(--sl-text-h4);color:var(--sl-color-white);line-height:var(--sl-line-height-headings);gap:1rem;align-items:center}.card:where(.astro-v5tidmuc) .icon:where(.astro-v5tidmuc){border:1px solid var(--sl-card-border);background-color:var(--sl-card-bg);padding:.2em;border-radius:.25rem;flex-shrink:0}.card:where(.astro-v5tidmuc) .body:where(.astro-v5tidmuc){margin:0;font-size:clamp(var(--sl-text-sm),calc(.5rem + 1vw),var(--sl-text-body))}}
@layer starlight.components{svg:where(.astro-c6vsoqas){color:var(--sl-icon-color);font-size:var(--sl-icon-size, 1em);width:1em;height:1em}}
.sl-markdown-content starlight-kbd-picker:where(.astro-k5ijk5yq){display:inline-block}
@layer starlight.components{.sl-link-card:where(.astro-mf7fz2mj){display:grid;grid-template-columns:1fr auto;gap:.5rem;border:1px solid var(--sl-color-gray-5);border-radius:.5rem;padding:1rem;box-shadow:var(--sl-shadow-sm);position:relative}a:where(.astro-mf7fz2mj){text-decoration:none;line-height:var(--sl-line-height-headings)}a:where(.astro-mf7fz2mj):before{content:"";position:absolute;inset:0}.stack:where(.astro-mf7fz2mj){flex-direction:column;gap:.5rem}.title:where(.astro-mf7fz2mj){color:var(--sl-color-white);font-weight:600;font-size:var(--sl-text-lg)}.description:where(.astro-mf7fz2mj){color:var(--sl-color-gray-3);line-height:1.5}.icon:where(.astro-mf7fz2mj){color:var(--sl-color-gray-3)}.sl-link-card:where(.astro-mf7fz2mj):hover{background:var(--sl-color-gray-7, var(--sl-color-gray-6));border-color:var(--sl-color-gray-2)}.sl-link-card:where(.astro-mf7fz2mj):hover .icon:where(.astro-mf7fz2mj){color:var(--sl-color-white)}}
label:where(.astro-e2vmghfl){--sl-label-icon-size: 1rem;--sl-caret-size: 1.25rem;--sl-inline-padding: .5rem;align-items:center;color:var(--sl-color-gray-1);display:inline-flex;gap:.25rem;position:relative}label:where(.astro-e2vmghfl):hover:not(:where(.sl-markdown-content *)){color:var(--sl-color-gray-2)}.sl-markdown-content label:where(.astro-e2vmghfl):hover{color:var(--sl-color-text-accent)}.icon:where(.astro-e2vmghfl){color:var(--sl-icon-color);font-size:var(--sl-icon-size, 1em);height:1em;pointer-events:none;position:absolute;top:50%;transform:translateY(-50%);width:1em}.label-icon:where(.astro-e2vmghfl){font-size:var(--sl-label-icon-size);inset-inline-start:0}.sl-markdown-content .label-icon:where(.astro-e2vmghfl){left:var(--sl-inline-padding)}.caret:where(.astro-e2vmghfl){font-size:var(--sl-caret-size);inset-inline-end:0}.sl-markdown-content .caret:where(.astro-e2vmghfl){right:var(--sl-inline-padding)}select:where(.astro-e2vmghfl){appearance:none;background-color:transparent;border:0;color:inherit;cursor:pointer;padding-block:.25rem;padding-inline:calc(var(--sl-label-icon-size) + var(--sl-inline-padding) + .25rem) calc(var(--sl-caret-size) + var(--sl-inline-padding) + .25rem);text-overflow:ellipsis}.sl-markdown-content select:where(.astro-e2vmghfl){border:1px solid var(--sl-color-white);border-radius:999rem;outline-offset:.1875rem}.sl-markdown-content label:where(.astro-e2vmghfl):hover select:where(.astro-e2vmghfl){border-color:var(--sl-color-text-accent)}option:where(.astro-e2vmghfl){background-color:var(--sl-color-bg-nav);color:var(--sl-color-gray-1)}@media (min-width: 50rem){select:where(.astro-e2vmghfl){font-size:var(--sl-text-sm)}}select:where(.astro-e2vmghfl):not(:where(.sl-markdown-content *)){margin-inline:calc(var(--sl-inline-padding) * -1);padding-block:.625rem}
@layer starlight.components{.sl-steps{--bullet-size: calc(var(--sl-line-height) * 1rem);--bullet-margin: .375rem;list-style:none;counter-reset:steps-counter var(--sl-steps-start, 0);padding-inline-start:0}.sl-steps>li{counter-increment:steps-counter;position:relative;padding-inline-start:calc(var(--bullet-size) + 1rem);padding-bottom:1px;min-height:calc(var(--bullet-size) + var(--bullet-margin))}.sl-steps>li+li{margin-top:0}.sl-steps>li:before{content:counter(steps-counter);position:absolute;top:0;inset-inline-start:0;width:var(--bullet-size);height:var(--bullet-size);line-height:var(--bullet-size);font-size:var(--sl-text-xs);font-weight:600;text-align:center;color:var(--sl-color-white);background-color:var(--sl-color-gray-6);border-radius:99rem;box-shadow:inset 0 0 0 1px var(--sl-color-gray-5)}.sl-steps>li:after{--guide-width: 1px;content:"";position:absolute;top:calc(var(--bullet-size) + var(--bullet-margin));bottom:var(--bullet-margin);inset-inline-start:calc((var(--bullet-size) - var(--guide-width)) / 2);width:var(--guide-width);background-color:var(--sl-color-hairline-light)}}@layer starlight.content{.sl-steps>li>:first-child{--lh: calc(1em * var(--sl-line-height));--shift-y: calc(.5 * (var(--bullet-size) - var(--lh)));transform:translateY(var(--shift-y));margin-bottom:var(--shift-y)}.sl-steps>li>:first-child:where(h1,h2,h3,h4,h5,h6){--lh: calc(1em * var(--sl-line-height-headings))}@supports (--prop: 1lh){.sl-steps>li>:first-child{--lh: 1lh}}}
@layer starlight.components{starlight-file-tree:where(.astro-p67cqifm){--x-space: 1.5rem;--y-space: .125rem;--y-pad: 0;display:block;border:1px solid var(--sl-color-gray-5);padding:1rem;background-color:var(--sl-color-gray-6);font-size:var(--sl-text-xs);font-family:var(--__sl-font-mono);overflow-x:auto}starlight-file-tree:where(.astro-p67cqifm) .directory>details{border:0;padding:0;padding-inline-start:var(--x-space);background:transparent}starlight-file-tree:where(.astro-p67cqifm) .directory>details>summary{margin-inline-start:calc(-1 * var(--x-space));border:0;padding:var(--y-pad) .625rem;font-weight:400;color:var(--sl-color-white);max-width:100%}starlight-file-tree:where(.astro-p67cqifm) .directory>details>summary::marker,starlight-file-tree:where(.astro-p67cqifm) .directory>details>summary::-webkit-details-marker{color:var(--sl-color-gray-3)}starlight-file-tree:where(.astro-p67cqifm) .directory>details>summary:hover,starlight-file-tree:where(.astro-p67cqifm) .directory>details>summary:hover .tree-icon{cursor:pointer;color:var(--sl-color-text-accent);fill:currentColor}starlight-file-tree:where(.astro-p67cqifm) .directory>details>summary:hover~ul{border-color:var(--sl-color-gray-4)}starlight-file-tree:where(.astro-p67cqifm) .directory>details>summary:hover .highlight .tree-icon{color:var(--sl-color-text-invert);fill:currentColor}starlight-file-tree:where(.astro-p67cqifm) ul{margin-inline-start:.5rem;border-inline-start:1px solid var(--sl-color-gray-5);padding:0;padding-inline-start:.125rem;list-style:none}starlight-file-tree:where(.astro-p67cqifm)>ul{margin:0;border:0;padding:0}starlight-file-tree:where(.astro-p67cqifm) li{margin:var(--y-space) 0;padding:var(--y-pad) 0}starlight-file-tree:where(.astro-p67cqifm) .file{margin-inline-start:calc(var(--x-space) - .125rem);color:var(--sl-color-white)}starlight-file-tree:where(.astro-p67cqifm) .tree-entry{display:inline-flex;align-items:flex-start;flex-wrap:wrap;max-width:calc(100% - 1rem)}@media (min-width: 30em){starlight-file-tree:where(.astro-p67cqifm) .tree-entry{flex-wrap:nowrap}}starlight-file-tree:where(.astro-p67cqifm) .tree-entry>:first-child{flex-shrink:0}starlight-file-tree:where(.astro-p67cqifm) .empty{color:var(--sl-color-gray-3);padding-inline-start:.375rem}starlight-file-tree:where(.astro-p67cqifm) .comment{color:var(--sl-color-gray-3);padding-inline-start:1.625rem;max-width:24rem;min-width:12rem}starlight-file-tree:where(.astro-p67cqifm) .highlight{display:inline-block;border-radius:.25rem;padding-inline-end:.5rem;color:var(--sl-color-text-invert);background-color:var(--sl-color-text-accent)}starlight-file-tree:where(.astro-p67cqifm) svg{display:inline;fill:var(--sl-color-gray-3);vertical-align:middle;margin-inline:.25rem .375rem;width:.875rem;height:.875rem}starlight-file-tree:where(.astro-p67cqifm) .highlight svg.tree-icon{fill:currentColor}}
@layer starlight.components{.sl-link-button:where(.astro-xwgiixxa){align-items:center;border:1px solid transparent;border-radius:999rem;display:inline-flex;font-size:var(--sl-text-sm);gap:.5em;line-height:1.1875;outline-offset:.25rem;padding:.4375rem 1.125rem;text-decoration:none}.sl-link-button:where(.astro-xwgiixxa).primary{background:var(--sl-color-text-accent);border-color:var(--sl-color-text-accent);color:var(--sl-color-black)}.sl-link-button:where(.astro-xwgiixxa).primary:hover{color:var(--sl-color-black)}.sl-link-button:where(.astro-xwgiixxa).secondary{border-color:inherit;color:var(--sl-color-white)}.sl-link-button:where(.astro-xwgiixxa).minimal{color:var(--sl-color-white);padding-inline:0}.sl-link-button:where(.astro-xwgiixxa) svg{flex-shrink:0}@media (min-width: 50rem){.sl-link-button:where(.astro-xwgiixxa){font-size:var(--sl-text-base);padding:.9375rem 1.25rem}}.sl-markdown-content .sl-link-button:where(.astro-xwgiixxa){margin-inline-end:1rem}.sl-markdown-content .sl-link-button:where(.astro-xwgiixxa):not(:where(p *)){margin-block:1rem}}
</style><script type="module" src="/next/_astro/page.B1D-nYk3.js"></script></head> <body class="astro-bguv2lll"> <a href="#_top" class="astro-7q3lir66">Skip to content</a>  <div class="page sl-flex astro-vrdttmbt"> <header class="header astro-vrdttmbt"><div class="header astro-kmkmnagf"> <div class="title-wrapper sl-flex astro-kmkmnagf"> <a href="/next/" class="site-title sl-flex astro-m46x6ez3">  <img class="astro-m46x6ez3" alt src="/next/_astro/luxe-dark.NVYNGKCT.svg" width="239" height="380">  <span class="astro-m46x6ez3" translate="no"> luxe docs </span> </a>  </div> <div class="sl-flex print:hidden astro-kmkmnagf"> <site-search class="astro-kmkmnagf astro-v37mnknz" data-translations="{&#34;placeholder&#34;:&#34;Search&#34;}"> <button data-open-modal disabled aria-label="Search" aria-keyshortcuts="Control+K" class="astro-v37mnknz"> <svg aria-hidden="true" class="astro-v37mnknz astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.71 20.29 18 16.61A9 9 0 1 0 16.61 18l3.68 3.68a.999.999 0 0 0 1.42 0 1 1 0 0 0 0-1.39ZM11 18a7 7 0 1 1 0-14 7 7 0 0 1 0 14Z"/></svg> <span class="sl-hidden md:sl-block astro-v37mnknz" aria-hidden="true">Search</span> <kbd class="sl-hidden md:sl-flex astro-v37mnknz" style="display: none;"> <kbd class="astro-v37mnknz">Ctrl</kbd><kbd class="astro-v37mnknz">K</kbd> </kbd> </button> <dialog style="padding:0" aria-label="Search" class="astro-v37mnknz"> <div class="dialog-frame sl-flex astro-v37mnknz">  <button data-close-modal class="sl-flex md:sl-hidden astro-v37mnknz"> Cancel </button> <div class="search-container astro-v37mnknz"> <div id="starlight__search" class="astro-v37mnknz"></div> </div> </div> </dialog> </site-search>  <script>
	(() => {
		const openBtn = document.querySelector('button[data-open-modal]');
		const shortcut = openBtn?.querySelector('kbd');
		if (!openBtn || !(shortcut instanceof HTMLElement)) return;
		const platformKey = shortcut.querySelector('kbd');
		if (platformKey && /(Mac|iPhone|iPod|iPad)/i.test(navigator.platform)) {
			platformKey.textContent = 'âŒ˜';
			openBtn.setAttribute('aria-keyshortcuts', 'Meta+K');
		}
		shortcut.style.display = '';
	})();
</script> <script type="module" src="/next/_astro/Search.astro_astro_type_script_index_0_lang.B0XZjlg4.js"></script>   </div> <div class="sl-hidden md:sl-flex print:hidden right-group astro-kmkmnagf"> <div class="sl-flex social-icons astro-kmkmnagf"> <a href="https://github.com/withastro/starlight" rel="me" class="sl-flex astro-wy4te6ga"><span class="sr-only astro-wy4te6ga">GitHub</span><svg aria-hidden="true" class="astro-wy4te6ga astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"/></svg></a> </div> <starlight-kbd-picker class="astro-k5ijk5yq"> <label class="not-content astro-e2vmghfl"> <span class="sr-only astro-e2vmghfl">Select keyboard type</span> <svg xmlns="http://www.w3.org/2000/svg" class="icon label-icon astro-e2vmghfl" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"> <path d="M6.21 13.29a.93.93 0 0 0-.33-.21 1 1 0 0 0-.76 0 .9.9 0 0 0-.54.54 1 1 0 1 0 1.84 0 1 1 0 0 0-.21-.33ZM13.5 11h1a1 1 0 0 0 0-2h-1a1 1 0 0 0 0 2Zm-4 0h1a1 1 0 0 0 0-2h-1a1 1 0 0 0 0 2Zm-3-2h-1a1 1 0 0 0 0 2h1a1 1 0 0 0 0-2ZM20 5H4a3 3 0 0 0-3 3v8a3 3 0 0 0 3 3h16a3 3 0 0 0 3-3V8a3 3 0 0 0-3-3Zm1 11a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1h16a1 1 0 0 1 1 1Zm-6-3H9a1 1 0 0 0 0 2h6a1 1 0 0 0 0-2Zm3.5-4h-1a1 1 0 0 0 0 2h1a1 1 0 0 0 0-2Zm.71 4.29a1 1 0 0 0-.33-.21 1 1 0 0 0-.76 0 .93.93 0 0 0-.33.21 1 1 0 0 0-.21.33 1 1 0 1 0 1.92.38.84.84 0 0 0-.08-.38 1 1 0 0 0-.21-.33Z" class="astro-e2vmghfl"></path> </svg> <select autocomplete="off" value="default" class="astro-e2vmghfl"> <option selected value="default" class="astro-e2vmghfl">Default Keys</option><option value="windows" class="astro-e2vmghfl">Windows</option><option value="mac" class="astro-e2vmghfl">macOS</option> </select> <svg aria-hidden="true" class="icon caret astro-e2vmghfl astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg> </label>  </starlight-kbd-picker> <script>
  StarlightKbdProvider.updateKbdPickers(typeof localStorage !== 'undefined' && localStorage.getItem('sl-kbd-type'))
</script> <script type="module">customElements.define("starlight-kbd-picker",class extends HTMLElement{constructor(){super(),this.querySelector("select")?.addEventListener("change",e=>{if(e.currentTarget instanceof HTMLSelectElement){StarlightKbdProvider.updateKbdPickers(e.currentTarget.value);for(const t of document.querySelectorAll("[data-sl-kbd-type]"))t.getAttribute("data-sl-kbd-type")===e.currentTarget.value?t.setAttribute("data-sl-kbd-active",""):t.removeAttribute("data-sl-kbd-active");typeof localStorage<"u"&&localStorage.setItem("sl-kbd-type",e.currentTarget.value)}})}});</script>  <starlight-theme-select>  <label style="--sl-select-width: 6.25em" class="astro-4yphtoen"> <span class="sr-only astro-4yphtoen">Select theme</span> <svg aria-hidden="true" class="icon label-icon astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg> <select autocomplete="off" class="astro-4yphtoen"> <option value="dark" class="astro-4yphtoen">Dark</option><option value="light" class="astro-4yphtoen">Light</option><option value="auto" selected class="astro-4yphtoen">Auto</option> </select> <svg aria-hidden="true" class="icon caret astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg> </label>  </starlight-theme-select>  <script>
	StarlightThemeProvider.updatePickers();
</script> <script type="module">const r="starlight-theme",o=e=>e==="auto"||e==="dark"||e==="light"?e:"auto",c=()=>o(typeof localStorage<"u"&&localStorage.getItem(r));function n(e){typeof localStorage<"u"&&localStorage.setItem(r,e==="light"||e==="dark"?e:"")}const l=()=>matchMedia("(prefers-color-scheme: light)").matches?"light":"dark";function t(e){StarlightThemeProvider.updatePickers(e),document.documentElement.dataset.theme=e==="auto"?l():e,n(e)}matchMedia("(prefers-color-scheme: light)").addEventListener("change",()=>{c()==="auto"&&t("auto")});class s extends HTMLElement{constructor(){super(),t(c()),this.querySelector("select")?.addEventListener("change",a=>{a.currentTarget instanceof HTMLSelectElement&&t(o(a.currentTarget.value))})}}customElements.define("starlight-theme-select",s);</script> <script type="module">class s extends HTMLElement{constructor(){super();const e=this.querySelector("select");e&&(e.addEventListener("change",t=>{t.currentTarget instanceof HTMLSelectElement&&(window.location.pathname=t.currentTarget.value)}),window.addEventListener("pageshow",t=>{if(!t.persisted)return;const n=e.querySelector("option[selected]")?.index;n!==e.selectedIndex&&(e.selectedIndex=n??0)}))}}customElements.define("starlight-lang-select",s);</script> </div> </div> </header> <nav class="sidebar print:hidden astro-vrdttmbt" aria-label="Main"> <starlight-menu-button class="print:hidden astro-jif73yzw"> <button aria-expanded="false" aria-label="Menu" aria-controls="starlight__sidebar" class="sl-flex md:sl-hidden astro-jif73yzw"> <svg aria-hidden="true" class="open-menu astro-jif73yzw astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M3 8h18a1 1 0 1 0 0-2H3a1 1 0 0 0 0 2Zm18 8H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Zm0-5H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Z"/></svg> <svg aria-hidden="true" class="close-menu astro-jif73yzw astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="m13.41 12 6.3-6.29a1.004 1.004 0 1 0-1.42-1.42L12 10.59l-6.29-6.3a1.004 1.004 0 0 0-1.42 1.42l6.3 6.29-6.3 6.29a1 1 0 0 0 0 1.42.998.998 0 0 0 1.42 0l6.29-6.3 6.29 6.3a.999.999 0 0 0 1.42 0 1 1 0 0 0 0-1.42L13.41 12Z"/></svg> </button> </starlight-menu-button> <script type="module">class s extends HTMLElement{constructor(){super(),this.btn=this.querySelector("button"),this.btn.addEventListener("click",()=>this.toggleExpanded());const t=this.closest("nav");t&&t.addEventListener("keyup",e=>this.closeOnEscape(e))}setExpanded(t){this.setAttribute("aria-expanded",String(t)),document.body.toggleAttribute("data-mobile-menu-expanded",t)}toggleExpanded(){this.setExpanded(this.getAttribute("aria-expanded")!=="true")}closeOnEscape(t){t.code==="Escape"&&(this.setExpanded(!1),this.btn.focus())}}customElements.define("starlight-menu-button",s);</script>   <div id="starlight__sidebar" class="sidebar-pane astro-vrdttmbt"> <div class="sidebar-content sl-flex astro-vrdttmbt"> <sl-sidebar-state-persist data-hash="0vlr3o6" class="astro-kku4brbg"> <script aria-hidden="true">
		(() => {
			try {
				if (!matchMedia('(min-width: 50em)').matches) return;
				/** @type {HTMLElement | null} */
				const target = document.querySelector('sl-sidebar-state-persist');
				const state = JSON.parse(sessionStorage.getItem('sl-sidebar-state') || '0');
				if (!target || !state || target.dataset.hash !== state.hash) return;
				window._starlightScrollRestore = state.scroll;
				customElements.define(
					'sl-sidebar-restore',
					class SidebarRestore extends HTMLElement {
						connectedCallback() {
							try {
								const idx = parseInt(this.dataset.index || '');
								const details = this.closest('details');
								if (details && typeof state.open[idx] === 'boolean') details.open = state.open[idx];
							} catch {}
						}
					}
				);
			} catch {}
		})();
	</script>  <ul class="top-level astro-3ii7xxms"> <li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Welcome</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="0"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/next/welcome/about/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">About</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/next/welcome/get/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Installing Luxe</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Getting Started</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="1"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/next/getting-started/luxe-101/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Luxe 101</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/next/getting-started/create-a-project/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Create and run a project</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/next/getting-started/draw-and-input/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Drawing and input</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/next/getting-started/world/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">World systems</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/next/getting-started/luxe-editor/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">The luxe editor</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/next/getting-started/build/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Making a build</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/next/getting-started/audio/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Adding sounds</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Tutorials</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="2"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Concepts</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="3"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/next/tutorials/concepts/overview/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Overview</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/next/tutorials/concepts/yarn/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Dialogue</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Cards &amp; Decks</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="4"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/next/tutorials/cards--decks/cardsdecks/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Cards &amp; Decks</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Match 3</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="5"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/next/tutorials/match-3/part1/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Match 3 - Game logic</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/next/tutorials/match-3/part2/" aria-current="page" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Match 3 - Animating changes</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/next/tutorials/match-3/part3/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Match 3 - After the prototype</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/next/tutorials/match-3/part4/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Match 3 - Sprite visuals</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Platformer</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="6"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/next/tutorials/platformer/platformer-first-steps/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">First steps</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/next/tutorials/platformer/platformer-next-steps/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Next steps</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/next/tutorials/platformer/platformer-the-rest/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">The rest</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Top down</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="7"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/next/tutorials/topdown/topdown-first-steps/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">First steps</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/next/tutorials/topdown/topdown-next-steps/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Next steps</span>  </a> </li> </ul>  </details> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Manual</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="8"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/next/manual/overview/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Overview</span>  </a> </li><li class="astro-3ii7xxms"> <details class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">modules</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="9"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/next/manual/modules/modules/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Using Modules</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">project</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="10"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/next/manual/project/anatomy/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Anatomy</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">render</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="11"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/next/manual/render/draw/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Draw tool</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">scripting</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="12"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/next/manual/scripting/multiple-files/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Multiple Wren files</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/next/manual/scripting/random/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Random numbers</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">tools</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="13"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/next/manual/tools/save/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Save data</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">world</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="14"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/next/manual/world/camera/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Camera</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/next/manual/world/custom-modifiers/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Custom Modifiers</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/next/manual/world/states/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">States</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/next/manual/world/tilemaps/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Tile maps</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/next/manual/world/ui/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">UI</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/next/manual/world/wires/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Wires (events)</span>  </a> </li> </ul>  </details> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <a href="https://api.luxeengine.com/" aria-current="false" class="large astro-3ii7xxms"> <span class="astro-3ii7xxms">API reference</span>  </a> </li> </ul>   <script aria-hidden="true">
		(() => {
			const scroller = document.getElementById('starlight__sidebar');
			if (!window._starlightScrollRestore || !scroller) return;
			scroller.scrollTop = window._starlightScrollRestore;
			delete window._starlightScrollRestore;
		})();
	</script> </sl-sidebar-state-persist>  <div class="md:sl-hidden"> <div class="mobile-preferences sl-flex astro-wu23bvmt"> <div class="social-icons astro-wu23bvmt"> <a href="https://github.com/withastro/starlight" rel="me" class="sl-flex astro-wy4te6ga"><span class="sr-only astro-wy4te6ga">GitHub</span><svg aria-hidden="true" class="astro-wy4te6ga astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"/></svg></a> </div> <starlight-kbd-picker class="astro-k5ijk5yq"> <label class="not-content astro-e2vmghfl"> <span class="sr-only astro-e2vmghfl">Select keyboard type</span> <svg xmlns="http://www.w3.org/2000/svg" class="icon label-icon astro-e2vmghfl" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"> <path d="M6.21 13.29a.93.93 0 0 0-.33-.21 1 1 0 0 0-.76 0 .9.9 0 0 0-.54.54 1 1 0 1 0 1.84 0 1 1 0 0 0-.21-.33ZM13.5 11h1a1 1 0 0 0 0-2h-1a1 1 0 0 0 0 2Zm-4 0h1a1 1 0 0 0 0-2h-1a1 1 0 0 0 0 2Zm-3-2h-1a1 1 0 0 0 0 2h1a1 1 0 0 0 0-2ZM20 5H4a3 3 0 0 0-3 3v8a3 3 0 0 0 3 3h16a3 3 0 0 0 3-3V8a3 3 0 0 0-3-3Zm1 11a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1h16a1 1 0 0 1 1 1Zm-6-3H9a1 1 0 0 0 0 2h6a1 1 0 0 0 0-2Zm3.5-4h-1a1 1 0 0 0 0 2h1a1 1 0 0 0 0-2Zm.71 4.29a1 1 0 0 0-.33-.21 1 1 0 0 0-.76 0 .93.93 0 0 0-.33.21 1 1 0 0 0-.21.33 1 1 0 1 0 1.92.38.84.84 0 0 0-.08-.38 1 1 0 0 0-.21-.33Z" class="astro-e2vmghfl"></path> </svg> <select autocomplete="off" value="default" class="astro-e2vmghfl"> <option selected value="default" class="astro-e2vmghfl">Default Keys</option><option value="windows" class="astro-e2vmghfl">Windows</option><option value="mac" class="astro-e2vmghfl">macOS</option> </select> <svg aria-hidden="true" class="icon caret astro-e2vmghfl astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg> </label>  </starlight-kbd-picker> <script>
  StarlightKbdProvider.updateKbdPickers(typeof localStorage !== 'undefined' && localStorage.getItem('sl-kbd-type'))
</script>   <starlight-theme-select>  <label style="--sl-select-width: 6.25em" class="astro-4yphtoen"> <span class="sr-only astro-4yphtoen">Select theme</span> <svg aria-hidden="true" class="icon label-icon astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg> <select autocomplete="off" class="astro-4yphtoen"> <option value="dark" class="astro-4yphtoen">Dark</option><option value="light" class="astro-4yphtoen">Light</option><option value="auto" selected class="astro-4yphtoen">Auto</option> </select> <svg aria-hidden="true" class="icon caret astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg> </label>  </starlight-theme-select>  <script>
	StarlightThemeProvider.updatePickers();
</script>   </div>  </div> </div> </div> </nav> <div class="main-frame astro-vrdttmbt">  <script type="module">const a=document.getElementById("starlight__sidebar"),n=a?.querySelector("sl-sidebar-state-persist"),o="sl-sidebar-state",i=()=>{let t=[];const e=n?.dataset.hash||"";try{const s=sessionStorage.getItem(o),r=JSON.parse(s||"{}");Array.isArray(r.open)&&r.hash===e&&(t=r.open)}catch{}return{hash:e,open:t,scroll:a?.scrollTop||0}},c=t=>{try{sessionStorage.setItem(o,JSON.stringify(t))}catch{}},d=()=>c(i()),l=(t,e)=>{const s=i();s.open[e]=t,c(s)};n?.addEventListener("click",t=>{if(!(t.target instanceof Element))return;const e=t.target.closest("summary")?.closest("details");if(!e)return;const s=e.querySelector("sl-sidebar-restore"),r=parseInt(s?.dataset.index||"");isNaN(r)||l(!e.open,r)});addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&d()});addEventListener("pageHide",d);</script> <div class="lg:sl-flex astro-67yu43on"> <aside class="right-sidebar-container print:hidden astro-67yu43on"> <div class="right-sidebar astro-67yu43on"> <div class="lg:sl-hidden astro-pb3aqygn"><mobile-starlight-toc data-min-h="2" data-max-h="3" class="astro-doynk5tl"><nav aria-labelledby="starlight__on-this-page--mobile" class="astro-doynk5tl"><details id="starlight__mobile-toc" class="astro-doynk5tl"><summary id="starlight__on-this-page--mobile" class="sl-flex astro-doynk5tl"><span class="toggle sl-flex astro-doynk5tl">On this page<svg aria-hidden="true" class="caret astro-doynk5tl astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg></span><span class="display-current astro-doynk5tl"></span></summary><div class="dropdown astro-doynk5tl"><ul class="isMobile astro-g2bywc46" style="--depth: 0;"> <li class="astro-g2bywc46" style="--depth: 0;"> <a href="#_top" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Overview</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#see-it-in-motion" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">See it in motion</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#feedback-for-the-player-is-crucial" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Feedback for the player is crucial</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#changing-the-flow-of-code" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Changing the flow of code</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#what-would-we-like-to-happen" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">What would we like to happen?</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#what-is-a-fiber" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">What is a Fiber?</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#the-game-as-a-fiber" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">The game as a fiber</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#how-to-make-a-fiber" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">How to make a fiber</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#running-a-fiber" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Running a fiber</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#pausing-a-fiber" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Pausing a fiber</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#loops-in-a-fiber" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Loops in a fiber</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#how-we-will-use-a-fiber" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">How we will use a fiber</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#tracking-busy-state" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Tracking busy state</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#tracking-the-busy-state" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Tracking the busy state</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#updating-the-busy-state" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Updating the busy state</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#adding-our-fiber" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Adding our fiber</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#our-first-task-destroyed-blocks" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Our first task: destroyed blocks</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#animate-the-destroy" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Animate the destroy</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#animate-the-create" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Animate the create</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#animate-drops" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Animate drops</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#animate-the-swap" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Animate the swap</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#final-touches" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Final touches</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#next-time" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Next time!</span> </a>  </li> </ul> </div></details></nav></mobile-starlight-toc><script type="module" src="/next/_astro/MobileTableOfContents.astro_astro_type_script_index_0_lang.C181hMzK.js"></script></div><div class="right-sidebar-panel sl-hidden lg:sl-block astro-pb3aqygn"><div class="sl-container astro-pb3aqygn"><starlight-toc data-min-h="2" data-max-h="3"><nav aria-labelledby="starlight__on-this-page"><h2 id="starlight__on-this-page">On this page</h2><ul class="astro-g2bywc46" style="--depth: 0;"> <li class="astro-g2bywc46" style="--depth: 0;"> <a href="#_top" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Overview</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#see-it-in-motion" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">See it in motion</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#feedback-for-the-player-is-crucial" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Feedback for the player is crucial</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#changing-the-flow-of-code" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Changing the flow of code</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#what-would-we-like-to-happen" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">What would we like to happen?</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#what-is-a-fiber" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">What is a Fiber?</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#the-game-as-a-fiber" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">The game as a fiber</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#how-to-make-a-fiber" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">How to make a fiber</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#running-a-fiber" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Running a fiber</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#pausing-a-fiber" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Pausing a fiber</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#loops-in-a-fiber" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Loops in a fiber</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#how-we-will-use-a-fiber" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">How we will use a fiber</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#tracking-busy-state" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Tracking busy state</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#tracking-the-busy-state" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Tracking the busy state</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#updating-the-busy-state" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Updating the busy state</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#adding-our-fiber" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Adding our fiber</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#our-first-task-destroyed-blocks" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Our first task: destroyed blocks</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#animate-the-destroy" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Animate the destroy</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#animate-the-create" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Animate the create</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#animate-drops" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Animate drops</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#animate-the-swap" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Animate the swap</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#final-touches" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Final touches</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#next-time" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Next time!</span> </a>  </li> </ul> </nav></starlight-toc><script type="module" src="/next/_astro/TableOfContents.astro_astro_type_script_index_0_lang.CKWWgpjV.js"></script></div></div> </div> </aside> <div class="main-pane astro-67yu43on">  <main data-pagefind-body class="astro-bguv2lll" lang="en" dir="ltr">    <div class="content-panel astro-7nkwcw3z"> <div class="sl-container astro-7nkwcw3z"> <h1 id="_top" class="astro-j6tvhyss">Match 3 - Animating changes</h1>  </div> </div>  <div class="content-panel astro-7nkwcw3z"> <div class="sl-container astro-7nkwcw3z"> <div class="sl-markdown-content"> <span class="sl-badge success small astro-avdet4wd">Complexity: low</span>
<span class="sl-badge tip small astro-avdet4wd">Game Tutorial</span>
<br>
<br>
<aside aria-label="Outcome / Goals" class="starlight-aside starlight-aside--tip"><p class="starlight-aside__title" aria-hidden="true"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="starlight-aside__icon"><path d="M17 22H5a3 3 0 0 1-3-3V9a3 3 0 0 1 3-3h1a4 4 0 0 1 7.3-2.18c.448.64.692 1.4.7 2.18h3a1 1 0 0 1 1 1v3a4 4 0 0 1 2.18 7.3A3.86 3.86 0 0 1 18 18v3a1 1 0 0 1-1 1ZM5 8a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h11v-3.18a1 1 0 0 1 1.33-.95 1.77 1.77 0 0 0 1.74-.23 2 2 0 0 0 .93-1.37 2 2 0 0 0-.48-1.59 1.89 1.89 0 0 0-2.17-.55 1 1 0 0 1-1.33-.95V8h-3.2a1 1 0 0 1-1-1.33 1.77 1.77 0 0 0-.23-1.74 1.939 1.939 0 0 0-3-.43A2 2 0 0 0 8 6c.002.23.046.456.13.67A1 1 0 0 1 7.18 8H5Z"></path></svg>Outcome / Goals</p><div class="starlight-aside__content"><p>In this tutorial weâ€™ll:</p><ul>
<li>Continue from part 1 to animate changes</li>
<li>Learn about Wren Fibers to â€˜pauseâ€™ code</li>
<li>Implement simple animated changes using a timer</li>
</ul></div></aside>
<div class="sl-heading-wrapper level-h2"><h2 id="see-it-in-motion">See it in motion</h2><a class="sl-anchor-link" href="#see-it-in-motion"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œSee it in motionâ€</span></a></div>
<p>Part 2 will animate the changes to the grid, and looks something like this:</p>
<video preload="auto" autoplay controls muted playsinline loop style="max-width:100%; width:auto; margin:auto; display:block;"> <source src="/next/video/tutorials/match3/timings.mp4" type="video/mp4"> </video>
<div class="sl-heading-wrapper level-h2"><h2 id="feedback-for-the-player-is-crucial">Feedback for the player is crucial</h2><a class="sl-anchor-link" href="#feedback-for-the-player-is-crucial"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œFeedback for the player is crucialâ€</span></a></div>
<p>As you may have found out from the previous part, the game doesnâ€™t feel good even though itâ€™s technically complete.
We need to be able to animate the changes as visual feedback for the player, to make sense of whatâ€™s actually happening.</p>
<p>As you get more experience making more games, youâ€™ll learn when and where that feedback is easiest added, and most beneficial.
Sometimes polishing too early can be unhelpful, so try to find a balance.</p>
<div class="sl-heading-wrapper level-h2"><h2 id="changing-the-flow-of-code">Changing the flow of code</h2><a class="sl-anchor-link" href="#changing-the-flow-of-code"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œChanging the flow of codeâ€</span></a></div>
<p>Thereâ€™s a lot of different ways to approach this particular problem, but weâ€™re going to lean on a feature in the Wren language weâ€™re using to make it easy - Fibers.</p>
<p>As weâ€™ve learned by now, code is executed one line after the other. Our gameâ€™s match logic looks like this:</p>
<div class="expressive-code"><link rel="stylesheet" href="/next/_astro/ec.9unvh.css"><script type="module" src="/next/_astro/ec.p1z7b.js"></script><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> matches </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">find_all_matches</span><span style="--0:#C6D0F5;--1:#4C4F69">(data)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">while</span><span style="--0:#C6D0F5;--1:#4C4F69">(matches</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">count </span><span style="--0:#81C8BE;--1:#116E73">></span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69">(match </span><span style="--0:#CA9EE6;--1:#8035E0">in</span><span style="--0:#C6D0F5;--1:#4C4F69"> matches) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> x </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> match[</span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">]</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> y </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> match[</span><span style="--0:#EF9F76;--1:#AB4307">1</span><span style="--0:#C6D0F5;--1:#4C4F69">]</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">set_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x, y, </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//drop tiles downward</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">drop_blocks</span><span style="--0:#C6D0F5;--1:#4C4F69">(data)</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//fill the new spaces made</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">fill_top</span><span style="--0:#C6D0F5;--1:#4C4F69">(data)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// cascading changes if we find any more</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">matches </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">find_all_matches</span><span style="--0:#C6D0F5;--1:#4C4F69">(data)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="var matches = find_all_matches(data)while(matches.count > 0) {  for(match in matches) {    var x = match[0]    var y = match[1]    set_cell(data, x, y, 0)  }  //drop tiles downward  drop_blocks(data)  //fill the new spaces made  fill_top(data)  // cascading changes if we find any more  matches = find_all_matches(data)}"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h2"><h2 id="what-would-we-like-to-happen">What would we like to happen?</h2><a class="sl-anchor-link" href="#what-would-we-like-to-happen"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œWhat would we like to happen?â€</span></a></div>
<p>This would be an easy way to handle the visual feedback problem (see the comments):</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> matches </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">find_all_matches</span><span style="--0:#C6D0F5;--1:#4C4F69">(data)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">while</span><span style="--0:#C6D0F5;--1:#4C4F69">(matches</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">count </span><span style="--0:#81C8BE;--1:#116E73">></span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69">(match </span><span style="--0:#CA9EE6;--1:#8035E0">in</span><span style="--0:#C6D0F5;--1:#4C4F69"> matches) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> x </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> match[</span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">]</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> y </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> match[</span><span style="--0:#EF9F76;--1:#AB4307">1</span><span style="--0:#C6D0F5;--1:#4C4F69">]</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">set_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x, y, </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//STOP: ANIMATE BLOCKS DISAPPEARING</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">drop_blocks</span><span style="--0:#C6D0F5;--1:#4C4F69">(data)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//STOP: ANIMATE BLOCKS FALLING</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">fill_top</span><span style="--0:#C6D0F5;--1:#4C4F69">(data)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//STOP: ANIMATE BLOCKS APPEARING</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">matches </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">find_all_matches</span><span style="--0:#C6D0F5;--1:#4C4F69">(data)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="var matches = find_all_matches(data)while(matches.count > 0) {  for(match in matches) {    var x = match[0]    var y = match[1]    set_cell(data, x, y, 0)  }  //STOP: ANIMATE BLOCKS DISAPPEARING  drop_blocks(data)  //STOP: ANIMATE BLOCKS FALLING  fill_top(data)  //STOP: ANIMATE BLOCKS APPEARING  matches = find_all_matches(data)}"><div></div></button></div></figure></div>
<p>If we could stop the code while we do some animation, that would work. Thatâ€™s what fibers can do!</p>
<div class="sl-heading-wrapper level-h2"><h2 id="what-is-a-fiber">What is a Fiber?</h2><a class="sl-anchor-link" href="#what-is-a-fiber"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œWhat is a Fiber?â€</span></a></div>
<p>It sounds more complicated than it is!</p>
<p>In a previous tutorial, we spoke about <a href="next/getting-started/draw-and-input/#functions-what-are-they">function calls as a series of doors</a> in a hallway.
Each door is entered, and returns to the hallway to continue. The hallway itself the lines of code.</p>
<p><strong>What a fiber can do is say â€œhold that thoughtâ€, leave the hallway, and come back later,</strong> to the same spot. As if it never left!</p>
<p>It can suspend what itâ€™s doing, and resume. That sounds a lot like what we want.</p>
<div class="sl-heading-wrapper level-h2"><h2 id="the-game-as-a-fiber">The game as a fiber</h2><a class="sl-anchor-link" href="#the-game-as-a-fiber"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œThe game as a fiberâ€</span></a></div>
<p>Your <code dir="auto">ready</code> function is the entry point to your game, and it also runs in â€˜the main fiberâ€™.</p>
<p>We do want the game to keep drawing thoughâ€¦ so we canâ€™t suspend the main fiber. That would make the game hang.</p>
<div class="sl-heading-wrapper level-h2"><h2 id="how-to-make-a-fiber">How to make a fiber</h2><a class="sl-anchor-link" href="#how-to-make-a-fiber"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œHow to make a fiberâ€</span></a></div>
<p>So how do we use a fiber? The <code dir="auto">Fiber</code> API is built into Wren and allows us to make one on demand, giving it a chunk of code to run when the fiber runs.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> fiber </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Fiber</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#CA9EE6;--1:#8035E0">new</span><span style="--0:#C6D0F5;--1:#4C4F69"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Log</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">print</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#A6D189;--1:#2D711E">"This code will not run until it's told to"</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="var fiber = Fiber.new {  Log.print(&#x22;This code will not run until it&#x27;s told to&#x22;)}"><div></div></button></div></figure></div>
<p>Notice that the code wonâ€™t do anything yet, all we have is a fiber in our hand. We are holding the option to enter the hallway.</p>
<div class="sl-heading-wrapper level-h2"><h2 id="running-a-fiber">Running a fiber</h2><a class="sl-anchor-link" href="#running-a-fiber"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œRunning a fiberâ€</span></a></div>
<p>So how do we run that code inside the fiber? We use <code dir="auto">call()</code> to make it happen.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//we are in the main hallway here</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Log</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">print</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#A6D189;--1:#2D711E">"Hello here"</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> fiber </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Fiber</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#CA9EE6;--1:#8035E0">new</span><span style="--0:#C6D0F5;--1:#4C4F69"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Log</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">print</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#A6D189;--1:#2D711E">"This code will run"</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//enter the new hallway</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">fiber</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">call</span><span style="--0:#C6D0F5;--1:#4C4F69">()</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//when that hallway ends, we continue our main hallway</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Log</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">print</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#A6D189;--1:#2D711E">"This will happen after"</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="//we are in the main hallway hereLog.print(&#x22;Hello here&#x22;)var fiber = Fiber.new {  Log.print(&#x22;This code will run&#x22;)}//enter the new hallwayfiber.call()//when that hallway ends, we continue our main hallwayLog.print(&#x22;This will happen after&#x22;)"><div></div></button></div></figure></div>
<p>If you drop that into your <code dir="auto">ready</code> function inside <code dir="auto">game.wren</code> - youâ€™ll see this in the output:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Hello</span><span style="--0:#C6D0F5;--1:#4C4F69"> here</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">This</span><span style="--0:#C6D0F5;--1:#4C4F69"> code will run</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">This</span><span style="--0:#C6D0F5;--1:#4C4F69"> will happen after</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="Hello hereThis code will runThis will happen after"><div></div></button></div></figure></div>
<p>We can <code dir="auto">call</code> a fiber multiple times, if the hallway hasnâ€™t ended (if it has we will get an error).
That allows us to suspend / leave the hallway any time from within.</p>
<div class="sl-heading-wrapper level-h2"><h2 id="pausing-a-fiber">Pausing a fiber</h2><a class="sl-anchor-link" href="#pausing-a-fiber"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œPausing a fiberâ€</span></a></div>
<p>We â€œyieldâ€ control of our hallway to the one that we came from (the main one, in this case).</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//main hallway</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Log</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">print</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#A6D189;--1:#2D711E">"Hello here"</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> fiber </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Fiber</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#CA9EE6;--1:#8035E0">new</span><span style="--0:#C6D0F5;--1:#4C4F69"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Log</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">print</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#A6D189;--1:#2D711E">"1. This code will run first"</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//leave this hallway. "yield" to the main hallway</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Fiber</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">yield</span><span style="--0:#C6D0F5;--1:#4C4F69">()</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Log</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">print</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#A6D189;--1:#2D711E">"3. This code will run last"</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// enter the new hallway</span></div></div><div class="ec-line"><div class="code"><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// until it leaves OR ends: prints 1.</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">fiber</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">call</span><span style="--0:#C6D0F5;--1:#4C4F69">()</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// when it pauses, we come back here</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Log</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">print</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#A6D189;--1:#2D711E">"2. This will happen second"</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// re-enter the new hallway</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">fiber</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">call</span><span style="--0:#C6D0F5;--1:#4C4F69">()</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Log</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">print</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#A6D189;--1:#2D711E">"Hello there"</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="//main hallwayLog.print(&#x22;Hello here&#x22;)var fiber = Fiber.new {  Log.print(&#x22;1. This code will run first&#x22;)  //leave this hallway. &#x22;yield&#x22; to the main hallway  Fiber.yield()  Log.print(&#x22;3. This code will run last&#x22;)}// enter the new hallway// until it leaves OR ends: prints 1.fiber.call()// when it pauses, we come back hereLog.print(&#x22;2. This will happen second&#x22;)// re-enter the new hallwayfiber.call()Log.print(&#x22;Hello there&#x22;)"><div></div></button></div></figure></div>
<p>Even though our code isnâ€™t in the numbered order, the log should print it in order like this!</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Hello</span><span style="--0:#C6D0F5;--1:#4C4F69"> here</span></div></div><div class="ec-line"><div class="code"><span style="--0:#EF9F76;--1:#AB4307">1</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">This</span><span style="--0:#C6D0F5;--1:#4C4F69"> code will run first</span></div></div><div class="ec-line"><div class="code"><span style="--0:#EF9F76;--1:#AB4307">2</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">This</span><span style="--0:#C6D0F5;--1:#4C4F69"> will happen second</span></div></div><div class="ec-line"><div class="code"><span style="--0:#EF9F76;--1:#AB4307">3</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">This</span><span style="--0:#C6D0F5;--1:#4C4F69"> code will run last</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Hello</span><span style="--0:#C6D0F5;--1:#4C4F69"> there</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="Hello here1. This code will run first2. This will happen second3. This code will run lastHello there"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h2"><h2 id="loops-in-a-fiber">Loops in a fiber</h2><a class="sl-anchor-link" href="#loops-in-a-fiber"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œLoops in a fiberâ€</span></a></div>
<p>Fibers become especially handy when you can loop repeatedly.
One example is fading out a <code dir="auto">Sprite</code> by setting itâ€™s alpha (opacity) value.</p>
<p>It would be nice if we could do this:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">while</span><span style="--0:#C6D0F5;--1:#4C4F69">(alpha </span><span style="--0:#81C8BE;--1:#116E73">></span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">alpha </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> alpha </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0.1</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="while(alpha > 0) {  alpha = alpha - 0.1}"><div></div></button></div></figure></div>
<p>But the problem is this would block our main fiber, causing the game to hang, and we wouldnâ€™t SEE the changes animate.</p>
<p>We can wrap it in a fiber, and call it once per frame:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> fiber </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Fiber</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#CA9EE6;--1:#8035E0">new</span><span style="--0:#C6D0F5;--1:#4C4F69"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">while</span><span style="--0:#C6D0F5;--1:#4C4F69">(alpha </span><span style="--0:#81C8BE;--1:#116E73">></span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">alpha </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> alpha </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0.1</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Fiber</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">yield</span><span style="--0:#C6D0F5;--1:#4C4F69">()</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//inside `tick`, update the fiber every frame</span></div></div><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#81C8BE;--1:#116E73">!</span><span style="--0:#C6D0F5;--1:#4C4F69">fiber</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">isDone) fiber</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">call</span><span style="--0:#C6D0F5;--1:#4C4F69">()</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="var fiber = Fiber.new {  while(alpha > 0) {    alpha = alpha - 0.1    Fiber.yield()  }}//inside &#x60;tick&#x60;, update the fiber every frameif(!fiber.isDone) fiber.call()"><div></div></button></div></figure></div>
<p>The important thing to understand is that the game loop is still running, and the game loop is updating the fiber every frame.
This is exactly how we will tackle the problem!</p>
<div class="sl-heading-wrapper level-h2"><h2 id="how-we-will-use-a-fiber">How we will use a fiber</h2><a class="sl-anchor-link" href="#how-we-will-use-a-fiber"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œHow we will use a fiberâ€</span></a></div>
<ul>
<li>We can put our process matches logic into a fiber</li>
<li>We can <code dir="auto">call</code> the fiber one per frame, from our system tick</li>
<li>BUT only if there are no visual changes pending</li>
</ul>
<p>So hereâ€™s what we need:</p>
<ul>
<li>A variable to store the fiber</li>
<li>A list of â€˜Busyâ€™ items.</li>
<li>If something is busy, the logic part will wait</li>
<li>If nothing is busy, progress the logic</li>
</ul>
<div class="sl-heading-wrapper level-h2"><h2 id="tracking-busy-state">Tracking busy state</h2><a class="sl-anchor-link" href="#tracking-busy-state"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œTracking busy stateâ€</span></a></div>
<p>â€¦ using a unique key for each grid location.</p>
<p>Our game is grid based, so we can track whether a cell is busy using itâ€™s x/y location.
An easy way to do that is using a <code dir="auto">Map</code>. A map is similar to a list, it is a collection but each item in the collection has a <em>key</em>, like a name, to fetch the value.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> value </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> map[key]</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="var value = map[key]"><div></div></button></div></figure></div>
<p>To keep things simple, we can use a <code dir="auto">String</code> as the key, making a unique key for our grid location.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> key </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#A6D189;--1:#2D711E">"%(</span><span style="--0:#C6D0F5;--1:#4C4F69">x</span><span style="--0:#A6D189;--1:#2D711E">)-%(</span><span style="--0:#C6D0F5;--1:#4C4F69">y</span><span style="--0:#A6D189;--1:#2D711E">)"</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="var key = &#x22;%(x)-%(y)&#x22;"><div></div></button></div></figure></div>
<details><p><summary>Cantor pairing - <code dir="auto">IO.pair_16</code> in luxe</summary>
Luxe provides a tool - <code dir="auto">IO.pair_16(x, y)</code> - which returns a number that matches the unique location.
The reverse is possible, with <code dir="auto">IO.unpair_16(key, into)</code>.</p><p>This allows you to use a single number as the key, and get the x/y location back easily.
This is a 16 bit function, so has a limited range of values, and works with negative coordinates.
Itâ€™s used by the Arcade module spatial hash.</p></details>
<div class="sl-heading-wrapper level-h4"><h4 id="types-of-busy-state">Types of Busy state</h4><a class="sl-anchor-link" href="#types-of-busy-state"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œTypes of Busy stateâ€</span></a></div>
<p>We have the following states weâ€™d like to animate:</p>
<ul>
<li>Creating a block</li>
<li>Removing a block</li>
<li>Moving a block downward</li>
<li>Swapping two blocks</li>
</ul>
<p>Weâ€™ll make a small helper class in our <code dir="auto">grid.modifier.wren</code> file that looks like this.
You can put it <em>before</em> your <code dir="auto">System</code> class.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">class</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Busy</span><span style="--0:#C6D0F5;--1:#4C4F69"> {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// the type of busy we're tracking</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> kind: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// our grid location</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> x: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">-1</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> y: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">-1</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// the destination location for a move</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> dest_x: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">-1</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> dest_y: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">-1</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// for a swap, one of them is the primary cell</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> primary: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Bool</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#A6D189;--1:#2D711E">true</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// how long the busy has been going</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> timer: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// how long the busy will want to run for</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> wait: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">1</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// The Busy kinds we're tracking</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#E5C890;--1:#8B5912">static</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">CREATE</span><span style="--0:#C6D0F5;--1:#4C4F69"> { </span><span style="--0:#EF9F76;--1:#AB4307">1</span><span style="--0:#C6D0F5;--1:#4C4F69"> }</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#E5C890;--1:#8B5912">static</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">DESTROY</span><span style="--0:#C6D0F5;--1:#4C4F69"> { </span><span style="--0:#EF9F76;--1:#AB4307">2</span><span style="--0:#C6D0F5;--1:#4C4F69"> }</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#E5C890;--1:#8B5912">static</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">MOVE</span><span style="--0:#C6D0F5;--1:#4C4F69"> { </span><span style="--0:#EF9F76;--1:#AB4307">3</span><span style="--0:#C6D0F5;--1:#4C4F69"> }</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#E5C890;--1:#8B5912">static</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">SWAP</span><span style="--0:#C6D0F5;--1:#4C4F69"> { </span><span style="--0:#EF9F76;--1:#AB4307">4</span><span style="--0:#C6D0F5;--1:#4C4F69"> }</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// We'll also add helpers</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">valid { x </span><span style="--0:#81C8BE;--1:#116E73">!=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">-1</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">&#x26;&#x26;</span><span style="--0:#C6D0F5;--1:#4C4F69"> y </span><span style="--0:#81C8BE;--1:#116E73">!=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">-1</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">&#x26;&#x26;</span><span style="--0:#C6D0F5;--1:#4C4F69"> kind </span><span style="--0:#81C8BE;--1:#116E73">!=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69"> }</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">done { timer </span><span style="--0:#81C8BE;--1:#116E73">>=</span><span style="--0:#C6D0F5;--1:#4C4F69"> wait }</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// We use this to create a busy state</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#E5C890;--1:#8B5912">construct</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#CA9EE6;--1:#8035E0">new</span><span style="--0:#C6D0F5;--1:#4C4F69">(in_x: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">, in_y: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">, in_kind: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">x </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> in_x</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">y </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> in_y</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">kind </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> in_kind</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// And a function to update our state</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">tick</span><span style="--0:#C6D0F5;--1:#4C4F69">(delta: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">timer </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> timer </span><span style="--0:#81C8BE;--1:#116E73">+</span><span style="--0:#C6D0F5;--1:#4C4F69"> delta</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//Busy</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="class Busy {  // the type of busy we&#x27;re tracking  var kind: Num = 0  // our grid location  var x: Num = -1  var y: Num = -1  // the destination location for a move  var dest_x: Num = -1  var dest_y: Num = -1  // for a swap, one of them is the primary cell  var primary: Bool = true  // how long the busy has been going  var timer: Num = 0  // how long the busy will want to run for  var wait: Num = 1  // The Busy kinds we&#x27;re tracking  static CREATE { 1 }  static DESTROY { 2 }  static MOVE { 3 }  static SWAP { 4 }  // We&#x27;ll also add helpers  valid { x != -1 &#x26;&#x26; y != -1 &#x26;&#x26; kind != 0 }  done { timer >= wait }  // We use this to create a busy state  construct new(in_x: Num, in_y: Num, in_kind: Num) {    x = in_x    y = in_y    kind = in_kind  }  // And a function to update our state  tick(delta: Num) {    timer = timer + delta  }} //Busy"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h2"><h2 id="tracking-the-busy-state">Tracking the busy state</h2><a class="sl-anchor-link" href="#tracking-the-busy-state"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œTracking the busy stateâ€</span></a></div>
<p>In our <code dir="auto">System</code> class we add some variables for handling this.</p>
<p>One for the fiber weâ€™ll use later, and one for the busy state of each cell.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">class</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">System</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#CA9EE6;--1:#8035E0">is</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Modifier</span><span style="--0:#C6D0F5;--1:#4C4F69"> {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> rng: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Random</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Random</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#CA9EE6;--1:#8035E0">new</span><span style="--0:#C6D0F5;--1:#4C4F69">()</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">//our busy handling</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> fiber: </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Fiber</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#cfa8e9;--1:#6429af">null</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> busy_cells </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> {}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="class System is Modifier {  var rng: Random = Random.new()  //our busy handling  var fiber: Fiber = null  var busy_cells = {}"><div></div></button></div></figure></div>
<p>Weâ€™ll also add a new function to our <code dir="auto">System</code> class called <code dir="auto">mark_busy</code>.
This will track the busy state for the cell and return the busy object for further configuring.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">mark_busy</span><span style="--0:#C6D0F5;--1:#4C4F69">(x: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">, y: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">, kind: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">) : </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Busy</span><span style="--0:#C6D0F5;--1:#4C4F69"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> busy </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#CA9EE6;--1:#8035E0">new</span><span style="--0:#C6D0F5;--1:#4C4F69">(x, y, kind)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">busy_cells[</span><span style="--0:#A6D189;--1:#2D711E">"%(</span><span style="--0:#C6D0F5;--1:#4C4F69">x</span><span style="--0:#A6D189;--1:#2D711E">)-%(</span><span style="--0:#C6D0F5;--1:#4C4F69">y</span><span style="--0:#A6D189;--1:#2D711E">)"</span><span style="--0:#C6D0F5;--1:#4C4F69">] </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> busy</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">return</span><span style="--0:#C6D0F5;--1:#4C4F69"> busy</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="mark_busy(x: Num, y: Num, kind: Num) : Busy {  var busy = Busy.new(x, y, kind)  busy_cells[&#x22;%(x)-%(y)&#x22;] = busy  return busy}"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h2"><h2 id="updating-the-busy-state">Updating the busy state</h2><a class="sl-anchor-link" href="#updating-the-busy-state"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œUpdating the busy stateâ€</span></a></div>
<p>Add a new function to our <code dir="auto">System</code> called <code dir="auto">tick_busy</code>:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">tick_busy</span><span style="--0:#C6D0F5;--1:#4C4F69">(data: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#4C4F69">, delta: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// If there's a fiber, and we're not busy, progress it</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// If we're busy, do nothing</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(fiber </span><span style="--0:#81C8BE;--1:#116E73">&#x26;&#x26;</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">!</span><span style="--0:#C6D0F5;--1:#4C4F69">fiber</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">isDone) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(busy_cells</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">count </span><span style="--0:#81C8BE;--1:#116E73">==</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">) fiber</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">call</span><span style="--0:#C6D0F5;--1:#4C4F69">()</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(fiber</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">isDone) fiber </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#CA9EE6;--1:#8035E0">null</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// If there's any busy tasks, update them</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69">(busy: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Busy</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#CA9EE6;--1:#8035E0">in</span><span style="--0:#C6D0F5;--1:#4C4F69"> busy_cells</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">values) {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">tick</span><span style="--0:#C6D0F5;--1:#4C4F69">(delta)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// If the task is done, handle the outcome</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">done) {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">kind </span><span style="--0:#81C8BE;--1:#116E73">==</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">DESTROY) {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">      </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//if busy.done</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// Clean up completed tasks</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">valid </span><span style="--0:#81C8BE;--1:#116E73">==</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#A6D189;--1:#2D711E">false</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">||</span><span style="--0:#C6D0F5;--1:#4C4F69"> busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">done) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">      </span></span><span style="--0:#C6D0F5;--1:#4C4F69">busy_cells</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">remove</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#A6D189;--1:#2D711E">"%(</span><span style="--0:#C6D0F5;--1:#4C4F69">busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#A6D189;--1:#2D711E">x)-%(</span><span style="--0:#C6D0F5;--1:#4C4F69">busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#A6D189;--1:#2D711E">y)"</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//tick_busy</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="tick_busy(data: Data, delta: Num) {  // If there&#x27;s a fiber, and we&#x27;re not busy, progress it  // If we&#x27;re busy, do nothing  if(fiber &#x26;&#x26; !fiber.isDone) {    if(busy_cells.count == 0) fiber.call()    if(fiber.isDone) fiber = null  }  // If there&#x27;s any busy tasks, update them  for(busy: Busy in busy_cells.values) {    busy.tick(delta)    // If the task is done, handle the outcome    if(busy.done) {      if(busy.kind == Busy.DESTROY) {      }    } //if busy.done    // Clean up completed tasks    if(busy.valid == false || busy.done) {      busy_cells.remove(&#x22;%(busy.x)-%(busy.y)&#x22;)    }  }} //tick_busy"><div></div></button></div></figure></div>
<p>We call it from our <code dir="auto">tick</code> function inside our <code dir="auto">System</code>.
We can add it right at the beginning of the each loop.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">tick</span><span style="--0:#C6D0F5;--1:#4C4F69">(delta: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> mouse </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Camera</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">screen_point_to_world</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Camera</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">get_default</span><span style="--0:#C6D0F5;--1:#4C4F69">(world), </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Input</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">mouse_x</span><span style="--0:#C6D0F5;--1:#4C4F69">(), </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Input</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">mouse_y</span><span style="--0:#C6D0F5;--1:#4C4F69">())</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">each {</span><span style="--0:#EA999C;--0fs:italic;--1:#B43641;--1fs:italic">|entity: Entity, data: Data|</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">// tick busy tasks</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">tick_busy</span><span style="--0:#C6D0F5;--1:#474a62">(data, delta)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#81C8BE;--1:#116E73">...</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="tick(delta: Num) {  var mouse = Camera.screen_point_to_world(Camera.get_default(world), Input.mouse_x(), Input.mouse_y())  each {|entity: Entity, data: Data|    // tick busy tasks    tick_busy(data, delta)..."><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h2"><h2 id="adding-our-fiber">Adding our fiber</h2><a class="sl-anchor-link" href="#adding-our-fiber"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œAdding our fiberâ€</span></a></div>
<p>Letâ€™s add the fiber to our <code dir="auto">process_matches</code> function.</p>
<p>Weâ€™re going to wrap the while loop inside of it using <code dir="auto">Fiber.new</code>.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">process_matches</span><span style="--0:#C6D0F5;--1:#4C4F69">(data: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> matches </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">find_all_matches</span><span style="--0:#C6D0F5;--1:#4C4F69">(data)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">  </span></span><span style="--0:#C6D0F5">fiber </span></span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Fiber</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#cfa8e9;--1:#6429af">new</span><span style="--0:#C6D0F5;--1:#474a62"> {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">while</span><span style="--0:#C6D0F5;--1:#4C4F69">(matches</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">count </span><span style="--0:#81C8BE;--1:#116E73">></span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#81C8BE;--1:#116E73">...</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">  </span></span><span style="--0:#C6D0F5">} </span></span><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">//Fiber.new</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//process_matches</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="process_matches(data: Data) {  var matches = find_all_matches(data)  fiber = Fiber.new {    while(matches.count > 0) {      ...    }  } //Fiber.new} //process_matches"><div></div></button></div></figure></div>
<p>If you run the game, itâ€™ll still work!</p>
<p>Thatâ€™s because our tick function is running the fiber every frame, and when itâ€™s done it clears it.</p>
<div class="sl-heading-wrapper level-h2"><h2 id="our-first-task-destroyed-blocks">Our first task: destroyed blocks</h2><a class="sl-anchor-link" href="#our-first-task-destroyed-blocks"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œOur first task: destroyed blocksâ€</span></a></div>
<p>Instead of immediately changing the grid like we did before, weâ€™re going to mark the cell as busy.</p>
<aside aria-label="Stuck" class="starlight-aside starlight-aside--caution"><p class="starlight-aside__title" aria-hidden="true"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="starlight-aside__icon"><path d="M12 16C11.8022 16 11.6089 16.0587 11.4444 16.1686C11.28 16.2784 11.1518 16.4346 11.0761 16.6173C11.0004 16.8001 10.9806 17.0011 11.0192 17.1951C11.0578 17.3891 11.153 17.5673 11.2929 17.7071C11.4327 17.847 11.6109 17.9422 11.8049 17.9808C11.9989 18.0194 12.2 17.9996 12.3827 17.9239C12.5654 17.8482 12.7216 17.72 12.8315 17.5556C12.9413 17.3911 13 17.1978 13 17C13 16.7348 12.8946 16.4805 12.7071 16.2929C12.5196 16.1054 12.2652 16 12 16ZM22.67 17.47L14.62 3.47003C14.3598 3.00354 13.9798 2.61498 13.5192 2.3445C13.0586 2.07401 12.5341 1.9314 12 1.9314C11.4659 1.9314 10.9414 2.07401 10.4808 2.3445C10.0202 2.61498 9.64019 3.00354 9.38 3.47003L1.38 17.47C1.11079 17.924 0.966141 18.441 0.960643 18.9688C0.955144 19.4966 1.089 20.0166 1.34868 20.4761C1.60837 20.9356 1.9847 21.3185 2.43968 21.5861C2.89466 21.8536 3.41218 21.9964 3.94 22H20.06C20.5921 22.0053 21.1159 21.8689 21.5779 21.6049C22.0399 21.341 22.4234 20.9589 22.689 20.4978C22.9546 20.0368 23.0928 19.5134 23.0895 18.9814C23.0862 18.4493 22.9414 17.9277 22.67 17.47ZM20.94 19.47C20.8523 19.626 20.7245 19.7556 20.5697 19.8453C20.4149 19.935 20.2389 19.9815 20.06 19.98H3.94C3.76111 19.9815 3.5851 19.935 3.43032 19.8453C3.27553 19.7556 3.14765 19.626 3.06 19.47C2.97223 19.318 2.92602 19.1456 2.92602 18.97C2.92602 18.7945 2.97223 18.622 3.06 18.47L11.06 4.47003C11.1439 4.30623 11.2714 4.16876 11.4284 4.07277C11.5855 3.97678 11.766 3.92599 11.95 3.92599C12.134 3.92599 12.3145 3.97678 12.4716 4.07277C12.6286 4.16876 12.7561 4.30623 12.84 4.47003L20.89 18.47C20.9892 18.6199 21.0462 18.7937 21.055 18.9732C21.0638 19.1527 21.0241 19.3312 20.94 19.49V19.47ZM12 8.00003C11.7348 8.00003 11.4804 8.10538 11.2929 8.29292C11.1054 8.48046 11 8.73481 11 9.00003V13C11 13.2652 11.1054 13.5196 11.2929 13.7071C11.4804 13.8947 11.7348 14 12 14C12.2652 14 12.5196 13.8947 12.7071 13.7071C12.8946 13.5196 13 13.2652 13 13V9.00003C13 8.73481 12.8946 8.48046 12.7071 8.29292C12.5196 8.10538 12.2652 8.00003 12 8.00003Z"></path></svg>Stuck</p><div class="starlight-aside__content"><p>Donâ€™t miss the second bit! If you donâ€™t pause the fiber, the matches are never cleared, and the while loop becomes infinite.</p></div></aside>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">process_matches</span><span style="--0:#C6D0F5;--1:#4C4F69">(data: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> matches </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">find_all_matches</span><span style="--0:#C6D0F5;--1:#4C4F69">(data)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">fiber </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Fiber</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#CA9EE6;--1:#8035E0">new</span><span style="--0:#C6D0F5;--1:#4C4F69"> {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">while</span><span style="--0:#C6D0F5;--1:#4C4F69">(matches</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">count </span><span style="--0:#81C8BE;--1:#116E73">></span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69">(match </span><span style="--0:#CA9EE6;--1:#8035E0">in</span><span style="--0:#C6D0F5;--1:#4C4F69"> matches) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> x </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> match[</span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">]</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> y </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> match[</span><span style="--0:#EF9F76;--1:#AB4307">1</span><span style="--0:#C6D0F5;--1:#4C4F69">]</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">        </span><span style="--0:#99b4f0;--0fs:italic;--1:#1444a4;--1fs:italic">set_cell</span><span style="--0:#C6D0F5;--1:#45485f">(data, x, y, </span><span style="--0:#f0a27a;--1:#803205">0</span><span style="--0:#C6D0F5;--1:#45485f">)</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">        </span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">mark_busy</span><span style="--0:#C6D0F5;--1:#474a62">(x, y, </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Busy</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">DESTROY)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">      </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">      </span><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">//pause while tasks are happening</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">      </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Fiber</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">yield</span><span style="--0:#C6D0F5;--1:#474a62">()</span></div></div><div class="ec-line"><div class="code"><span class="indent">   </span><span style="--0:#81C8BE;--1:#116E73">...</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="process_matches(data: Data) {  var matches = find_all_matches(data)  fiber = Fiber.new {    while(matches.count > 0) {      for(match in matches) {        var x = match[0]        var y = match[1]        set_cell(data, x, y, 0)        mark_busy(x, y, Busy.DESTROY)      }      //pause while tasks are happening      Fiber.yield()   ..."><div></div></button></div></figure></div>
<p>And inside our <code dir="auto">tick_busy</code> function, when a destroy task completes, thatâ€™s where we change the grid:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// If the task is done, handle the outcome</span></div></div><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">done) {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">kind </span><span style="--0:#81C8BE;--1:#116E73">==</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">DESTROY) {</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">set_cell</span><span style="--0:#C6D0F5;--1:#474a62">(data, busy</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">x, busy</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">y, </span><span style="--0:#f0a57f;--1:#833305">0</span><span style="--0:#C6D0F5;--1:#474a62">)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//if busy.done</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="// If the task is done, handle the outcomeif(busy.done) {  if(busy.kind == Busy.DESTROY) {    set_cell(data, busy.x, busy.y, 0)  }} //if busy.done"><div></div></button></div></figure></div>
<p>If we ran the game, we can see that the match happens, it waits for 1 second, and then it does the rest! And thereâ€™s a second match as a result, it also waits.</p>
<video preload="auto" autoplay controls muted playsinline loop style="max-width:100%; width:auto; margin:auto; display:block;"> <source src="/next/video/tutorials/match3/destroy.wait.mp4" type="video/mp4"> </video>
<div class="sl-heading-wrapper level-h2"><h2 id="animate-the-destroy">Animate the destroy</h2><a class="sl-anchor-link" href="#animate-the-destroy"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œAnimate the destroyâ€</span></a></div>
<p>Now that our destroy is waiting for us, we can change our drawing code to animate the change.</p>
<p>Inside the tick function, where we do our drawing, we can add the busy handling.
Keeping it simple, weâ€™ll add an x/y offset for movement, and a scale for create/destroy.</p>
<p>We</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69">(y </span><span style="--0:#CA9EE6;--1:#8035E0">in</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">...</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">height) {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> row: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">GridRow</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">rows[y]</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69">(x </span><span style="--0:#CA9EE6;--1:#8035E0">in</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">...</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">width) {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> kind </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> row</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">columns[x]</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(kind </span><span style="--0:#81C8BE;--1:#116E73">==</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">) </span><span style="--0:#CA9EE6;--1:#8035E0">continue</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> y_offset </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#f0a57f;--1:#833305">0</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> x_offset </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#f0a57f;--1:#833305">0</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> scale </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#f0a57f;--1:#833305">1</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> busy: </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Busy</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> busy_cells[</span><span style="--0:#A6D189;--1:#235817">"%(</span><span style="--0:#C6D0F5;--1:#474a62">x</span><span style="--0:#A6D189;--1:#235817">)-%(</span><span style="--0:#C6D0F5;--1:#474a62">y</span><span style="--0:#A6D189;--1:#235817">)"</span><span style="--0:#C6D0F5;--1:#474a62">]</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#cfa8e9;--1:#6429af">if</span><span style="--0:#C6D0F5;--1:#474a62">(busy) {</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">      </span><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">// how far into the wait are we?</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">      </span><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">// this is a 0...1 range value</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">      </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> ratio </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> busy</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">timer </span><span style="--0:#81C8BE;--1:#0d5458">/</span><span style="--0:#C6D0F5;--1:#474a62"> busy</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">wait</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">      </span><span style="--0:#cfa8e9;--1:#6429af">if</span><span style="--0:#C6D0F5;--1:#474a62">(busy</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">kind </span><span style="--0:#81C8BE;--1:#0d5458">==</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Busy</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">DESTROY) {</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">        </span><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">// since we're destroying, scale down from 1</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">        </span><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">// and don't let it go too small</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">        </span></span><span style="--0:#C6D0F5">scale </span></span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">=</span><span style="--0:#C6D0F5;--1:#474a62"> ( </span><span style="--0:#f0a57f;--1:#833305">1.0</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#81C8BE;--1:#0d5458">-</span><span style="--0:#C6D0F5;--1:#474a62"> ratio )</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">max</span><span style="--0:#C6D0F5;--1:#474a62">(</span><span style="--0:#f0a57f;--1:#833305">0.1</span><span style="--0:#C6D0F5;--1:#474a62">)</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">      </span></span><span style="--0:#C6D0F5">}</span></span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">    </span></span><span style="--0:#C6D0F5">}</span></span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> pos </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">grid_to_world</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x, y)</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">        </span></span><span style="--0:#C6D0F5">pos</span></span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">x </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> pos</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">x </span><span style="--0:#81C8BE;--1:#0d5458">+</span><span style="--0:#C6D0F5;--1:#474a62"> x_offset</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">        </span></span><span style="--0:#C6D0F5">pos</span></span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">y </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> pos</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">y </span><span style="--0:#81C8BE;--1:#0d5458">-</span><span style="--0:#C6D0F5;--1:#474a62"> y_offset</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> color </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> colors[kind </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">1</span><span style="--0:#C6D0F5;--1:#4C4F69">]</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> sides </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> sides[kind </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">1</span><span style="--0:#C6D0F5;--1:#4C4F69">]</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> half_width </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> block_width </span><span style="--0:#81C8BE;--1:#116E73">/</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">2</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> half_height </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> block_height </span><span style="--0:#81C8BE;--1:#116E73">/</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">2</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> radius_x </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> half_width </span><span style="--0:#81C8BE;--1:#0d5458">*</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#f0a57f;--1:#833305">0.9</span><span style="--0:#C6D0F5;--1:#474a62"> </span><mark><span style="--0:#a9d9d3;--1:#0b4548">*</span><span style="--0:#C6D0F5;--1:#3b3e52"> scale</span></mark></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> radius_y </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> half_height </span><span style="--0:#81C8BE;--1:#0d5458">*</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#f0a57f;--1:#833305">0.9</span><span style="--0:#C6D0F5;--1:#474a62"> </span><mark><span style="--0:#a9d9d3;--1:#0b4548">*</span><span style="--0:#C6D0F5;--1:#3b3e52"> scale</span></mark></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="for(y in 0 ... data.height) {  var row: GridRow = data.rows[y]  for(x in 0 ... data.width) {    var kind = row.columns[x]    if(kind == 0) continue    var y_offset = 0    var x_offset = 0    var scale = 1    var busy: Busy = busy_cells[&#x22;%(x)-%(y)&#x22;]    if(busy) {      // how far into the wait are we?      // this is a 0...1 range value      var ratio = busy.timer / busy.wait      if(busy.kind == Busy.DESTROY) {        // since we&#x27;re destroying, scale down from 1        // and don&#x27;t let it go too small        scale = ( 1.0 - ratio ).max(0.1)      }    }    var pos = grid_to_world(data, x, y)        pos.x = pos.x + x_offset        pos.y = pos.y - y_offset    var color = colors[kind - 1]    var sides = sides[kind - 1]    var half_width = block_width / 2    var half_height = block_height / 2    var radius_x = half_width * 0.9 * scale    var radius_y = half_height * 0.9 * scale"><div></div></button></div></figure></div>
<p>And there we go! If we run the game, notice how much easier it is to understand the changes:</p>
<video preload="auto" autoplay controls muted playsinline loop style="max-width:100%; width:auto; margin:auto; display:block;"> <source src="/next/video/tutorials/match3/destroy.animate.mp4" type="video/mp4"> </video>
<div class="sl-heading-wrapper level-h2"><h2 id="animate-the-create">Animate the create</h2><a class="sl-anchor-link" href="#animate-the-create"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œAnimate the createâ€</span></a></div>
<p>For create, we DO want to modify the grid immediately because otherwise there wonâ€™t be anything to animate!
So we add a busy task for the create after we modify the grid:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">fill_top</span><span style="--0:#C6D0F5;--1:#4C4F69">(data: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69"> (x </span><span style="--0:#CA9EE6;--1:#8035E0">in</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">...</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">width) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69"> (y </span><span style="--0:#CA9EE6;--1:#8035E0">in</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">...</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">height) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69"> (</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">get_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x, y) </span><span style="--0:#81C8BE;--1:#116E73">==</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">set_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x, y, rng</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">int</span><span style="--0:#C6D0F5;--1:#4C4F69">(data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">block_kinds) </span><span style="--0:#81C8BE;--1:#116E73">+</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">1</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">        </span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">mark_busy</span><span style="--0:#C6D0F5;--1:#474a62">(x, y, </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Busy</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">CREATE)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">      </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//each row</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//each column</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//fill_top</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="fill_top(data: Data) {  for (x in 0 ... data.width) {    for (y in 0 ... data.height) {      if (get_cell(data, x, y) == 0) {        set_cell(data, x, y, rng.int(data.block_kinds) + 1)        mark_busy(x, y, Busy.CREATE)      }    } //each row  } //each column} //fill_top"><div></div></button></div></figure></div>
<p>And we have to pause the logic inside <code dir="auto">process_matches</code>, after we create the blocks:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//fill the new spaces made</span></div></div><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">fill_top</span><span style="--0:#C6D0F5;--1:#4C4F69">(data)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Fiber</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">yield</span><span style="--0:#C6D0F5;--1:#474a62">()</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="//fill the new spaces madefill_top(data)Fiber.yield()"><div></div></button></div></figure></div>
<p>And finally inside our <code dir="auto">tick</code> function, handle the create behaviour by scaling upward, after the destroy:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">kind </span><span style="--0:#81C8BE;--1:#116E73">==</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">DESTROY) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// since we're destroying, scale down from 1</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// and don't let it go too small</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">scale </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> ( </span><span style="--0:#EF9F76;--1:#AB4307">1.0</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> ratio )</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">max</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#EF9F76;--1:#AB4307">0.1</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">if</span><span style="--0:#C6D0F5;--1:#474a62">(busy</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">kind </span><span style="--0:#81C8BE;--1:#0d5458">==</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Busy</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">CREATE) {</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">// since we're creating, scale from from 0 to 1</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">  </span></span><span style="--0:#C6D0F5">scale </span></span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> ratio</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">max</span><span style="--0:#C6D0F5;--1:#474a62">(</span><span style="--0:#f0a57f;--1:#833305">0.1</span><span style="--0:#C6D0F5;--1:#474a62">)</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#C6D0F5;--1:#474a62">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="if(busy.kind == Busy.DESTROY) {  // since we&#x27;re destroying, scale down from 1  // and don&#x27;t let it go too small  scale = ( 1.0 - ratio ).max(0.1)}  if(busy.kind == Busy.CREATE) {  // since we&#x27;re creating, scale from from 0 to 1  scale = ratio.max(0.1)}"><div></div></button></div></figure></div>
<p>Now we can see the new tiles are animating too:</p>
<video preload="auto" autoplay controls muted playsinline loop style="max-width:100%; width:auto; margin:auto; display:block;"> <source src="/next/video/tutorials/match3/create.animate.mp4" type="video/mp4"> </video>
<div class="sl-heading-wrapper level-h2"><h2 id="animate-drops">Animate drops</h2><a class="sl-anchor-link" href="#animate-drops"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œAnimate dropsâ€</span></a></div>
<p>Similar to the others, we first change <code dir="auto">drop_blocks</code> to add the busy task.</p>
<p>Also note that we add another <code dir="auto">Fiber.yield()</code> here, this is because we add one busy task for each tile dropping,
we can wait for each one to finish, which can feel satisfying to watch. Thatâ€™s why we have a <code dir="auto">wait = 1</code> here,
weâ€™re going to tweak the timing later!</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">drop_blocks</span><span style="--0:#C6D0F5;--1:#4C4F69">(data: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69"> (x </span><span style="--0:#CA9EE6;--1:#8035E0">in</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">...</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">width) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> write_y </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">height </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">1</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69"> (y </span><span style="--0:#CA9EE6;--1:#8035E0">in</span><span style="--0:#C6D0F5;--1:#4C4F69"> (data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">height </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">1</span><span style="--0:#C6D0F5;--1:#4C4F69">) </span><span style="--0:#81C8BE;--1:#116E73">..</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69"> (</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">get_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x, y) </span><span style="--0:#81C8BE;--1:#116E73">!=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69"> (y </span><span style="--0:#81C8BE;--1:#116E73">!=</span><span style="--0:#C6D0F5;--1:#4C4F69"> write_y) {</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">          </span><span style="--0:#99b4f0;--0fs:italic;--1:#1444a4;--1fs:italic">set_cell</span><span style="--0:#C6D0F5;--1:#45485f">(data, x, write_y, </span><span style="--0:#99b4f0;--0fs:italic;--1:#1444a4;--1fs:italic">get_cell</span><span style="--0:#C6D0F5;--1:#45485f">(data, x, y))</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">          </span><span style="--0:#99b4f0;--0fs:italic;--1:#1444a4;--1fs:italic">set_cell</span><span style="--0:#C6D0F5;--1:#45485f">(data, x, y, </span><span style="--0:#f0a27a;--1:#803205">0</span><span style="--0:#C6D0F5;--1:#45485f">)</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">          </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> busy </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">mark_busy</span><span style="--0:#C6D0F5;--1:#474a62">(x, y, </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Busy</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">MOVE)</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">          </span></span><span style="--0:#C6D0F5">busy</span></span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">dest_y </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> write_y</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">          </span></span><span style="--0:#C6D0F5">busy</span></span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">wait </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#f0a57f;--1:#833305">1</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">        </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">        </span></span><span style="--0:#C6D0F5;--1:#4C4F69">write_y </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> write_y </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">1</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">      </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">      </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Fiber</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">yield</span><span style="--0:#C6D0F5;--1:#474a62">()</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//drop_blocks</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="drop_blocks(data: Data) {  for (x in 0 ... data.width) {    var write_y = data.height - 1    for (y in (data.height - 1) .. 0) {      if (get_cell(data, x, y) != 0) {        if (y != write_y) {          set_cell(data, x, write_y, get_cell(data, x, y))          set_cell(data, x, y, 0)          var busy = mark_busy(x, y, Busy.MOVE)          busy.dest_y = write_y          busy.wait = 1        }        write_y = write_y - 1      }      Fiber.yield()    }  }} //drop_blocks"><div></div></button></div></figure></div>
<p>Then we add the main pause into <code dir="auto">process_matches</code> after <code dir="auto">drop_blocks</code>:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//drop tiles downward</span></div></div><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">drop_blocks</span><span style="--0:#C6D0F5;--1:#4C4F69">(data)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Fiber</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">yield</span><span style="--0:#C6D0F5;--1:#474a62">()</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="//drop tiles downwarddrop_blocks(data)Fiber.yield()"><div></div></button></div></figure></div>
<p>We move the grid change logic to the <code dir="auto">tick_busy</code> function where we handle complete tasks,
we use the data from the task to update the grid when it completes:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// If the task is done, handle the outcome</span></div></div><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">done) {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">kind </span><span style="--0:#81C8BE;--1:#116E73">==</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">DESTROY) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">set_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">x, busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">y, </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">if</span><span style="--0:#C6D0F5;--1:#474a62">(busy</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">kind </span><span style="--0:#81C8BE;--1:#0d5458">==</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Busy</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">MOVE) {</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">set_cell</span><span style="--0:#C6D0F5;--1:#474a62">(data, busy</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">x, busy</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">dest_y, </span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">get_cell</span><span style="--0:#C6D0F5;--1:#474a62">(data, busy</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">x, busy</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">y))</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">set_cell</span><span style="--0:#C6D0F5;--1:#474a62">(data, busy</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">x, busy</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">y, </span><span style="--0:#f0a57f;--1:#833305">0</span><span style="--0:#C6D0F5;--1:#474a62">)</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">  </span></span><span style="--0:#C6D0F5">}</span></span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//if busy.done</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="// If the task is done, handle the outcomeif(busy.done) {  if(busy.kind == Busy.DESTROY) {    set_cell(data, busy.x, busy.y, 0)  }  if(busy.kind == Busy.MOVE) {    set_cell(data, busy.x, busy.dest_y, get_cell(data, busy.x, busy.y))    set_cell(data, busy.x, busy.y, 0)  }} //if busy.done"><div></div></button></div></figure></div>
<p>Inside our <code dir="auto">tick</code> function where we do the drawing, we calculate the distance the block wants to travel.
We use our ratio (how far into the timer we are) to offset our <code dir="auto">y_offset</code>. This moves the block visually.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">kind </span><span style="--0:#81C8BE;--1:#116E73">==</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">DESTROY) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// since we're destroying, scale down from 1</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// and don't let it go too small</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">scale </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> ( </span><span style="--0:#EF9F76;--1:#AB4307">1.0</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> ratio )</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">max</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#EF9F76;--1:#AB4307">0.1</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">kind </span><span style="--0:#81C8BE;--1:#116E73">==</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">CREATE) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// since we're creating, scale from from 0 to 1</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">scale </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> ratio</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">max</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#EF9F76;--1:#AB4307">0.1</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">if</span><span style="--0:#C6D0F5;--1:#474a62">(busy</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">kind </span><span style="--0:#81C8BE;--1:#0d5458">==</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Busy</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">MOVE) {</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> distance </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> block_height </span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">*</span><span style="--0:#C6D0F5;--1:#474a62"> (busy</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">dest_y </span><span style="--0:#81C8BE;--1:#0d5458">-</span><span style="--0:#C6D0F5;--1:#474a62"> busy</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">y)</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">  </span></span><span style="--0:#C6D0F5">y_offset </span></span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> distance </span><span style="--0:#81C8BE;--1:#0d5458">*</span><span style="--0:#C6D0F5;--1:#474a62"> ratio</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#C6D0F5;--1:#474a62">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="if(busy.kind == Busy.DESTROY) {  // since we&#x27;re destroying, scale down from 1  // and don&#x27;t let it go too small  scale = ( 1.0 - ratio ).max(0.1)}if(busy.kind == Busy.CREATE) {  // since we&#x27;re creating, scale from from 0 to 1  scale = ratio.max(0.1)}  if(busy.kind == Busy.MOVE) {  var distance = block_height * (busy.dest_y - busy.y)  y_offset = distance * ratio}"><div></div></button></div></figure></div>
<p>Even easier to understand whatâ€™s happening visually! Weâ€™re going to tweak the timings later to feel better.</p>
<video preload="auto" autoplay controls muted playsinline loop style="max-width:100%; width:auto; margin:auto; display:block;"> <source src="/next/video/tutorials/match3/move.animate.mp4" type="video/mp4"> </video>
<div class="sl-heading-wrapper level-h2"><h2 id="animate-the-swap">Animate the swap</h2><a class="sl-anchor-link" href="#animate-the-swap"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œAnimate the swapâ€</span></a></div>
<p>Our final piece is animating the swap. This one is very similar to move, but has a little extra details.
We already have all the pauses we need, so this will just be handling the busy tasks.</p>
<p>Previously we split our swap function into 2 steps, so we remove the second step, and add 2 busy tasks:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">swap</span><span style="--0:#C6D0F5;--1:#4C4F69">(data: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#4C4F69">, x1: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">, y1: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">, x2: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">, y2: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69"> (</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">!is_adjacent</span><span style="--0:#C6D0F5;--1:#4C4F69">(x1, y1, x2, y2)) </span><span style="--0:#CA9EE6;--1:#8035E0">return</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#A6D189;--1:#2D711E">false</span></div></div><div class="ec-line highlight del"><div class="code"><span class="indent">  </span><span style="--0:#99b4f0;--0fs:italic;--1:#1444a4;--1fs:italic">complete_swap</span><span style="--0:#C6D0F5;--1:#45485f">(data, x1, y1, x2, y2)</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> busy </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">mark_busy</span><span style="--0:#C6D0F5;--1:#474a62">(x1, y1, </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Busy</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">SWAP)</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">      </span></span><span style="--0:#C6D0F5">busy</span></span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">dest_x </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> x2</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">      </span></span><span style="--0:#C6D0F5">busy</span></span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">dest_y </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> y2</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> busy2 </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">mark_busy</span><span style="--0:#C6D0F5;--1:#474a62">(x2, y2, </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Busy</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">SWAP)</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">      </span></span><span style="--0:#C6D0F5">busy2</span></span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">primary </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#A6D189;--1:#235817">false</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">      </span></span><span style="--0:#C6D0F5">busy2</span></span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">dest_x </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> x1</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">      </span></span><span style="--0:#C6D0F5">busy2</span></span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">dest_y </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> y1</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="swap(data: Data, x1: Num, y1: Num, x2: Num, y2: Num) {  if (!is_adjacent(x1, y1, x2, y2)) return false  complete_swap(data, x1, y1, x2, y2)  var busy = mark_busy(x1, y1, Busy.SWAP)      busy.dest_x = x2      busy.dest_y = y2  var busy2 = mark_busy(x2, y2, Busy.SWAP)      busy2.primary = false      busy2.dest_x = x1      busy2.dest_y = y1}"><div></div></button></div></figure></div>
<p>Inside <code dir="auto">tick_busy</code> where we process busy tasks completing, we add another case for <code dir="auto">Busy.SWAP</code>.
Thatâ€™s where we complete the swap!</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">done) {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">kind </span><span style="--0:#81C8BE;--1:#116E73">==</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">DESTROY) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">set_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">x, busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">y, </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">kind </span><span style="--0:#81C8BE;--1:#116E73">==</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">MOVE) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">set_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">x, busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">dest_y, </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">get_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">x, busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">y))</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">set_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">x, busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">y, </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">if</span><span style="--0:#C6D0F5;--1:#474a62">(busy</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">kind </span><span style="--0:#81C8BE;--1:#0d5458">==</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Busy</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">SWAP) {</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#cfa8e9;--1:#6429af">if</span><span style="--0:#C6D0F5;--1:#474a62">(busy</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">primary) {</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">      </span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">complete_swap</span><span style="--0:#C6D0F5;--1:#474a62">(data, busy</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">x, busy</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">y, busy</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">dest_x, busy</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">dest_y)</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">    </span></span><span style="--0:#C6D0F5">}</span></span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">  </span></span><span style="--0:#C6D0F5">}</span></span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//if busy.done</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="if(busy.done) {  if(busy.kind == Busy.DESTROY) {    set_cell(data, busy.x, busy.y, 0)  }  if(busy.kind == Busy.MOVE) {    set_cell(data, busy.x, busy.dest_y, get_cell(data, busy.x, busy.y))    set_cell(data, busy.x, busy.y, 0)  }  if(busy.kind == Busy.SWAP) {    if(busy.primary) {      complete_swap(data, busy.x, busy.y, busy.dest_x, busy.dest_y)    }  }} //if busy.done"><div></div></button></div></figure></div>
<p>And the last step is the visual change, inside <code dir="auto">tick</code> with the others.
This is similar to the move: calculate the distance</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">kind </span><span style="--0:#81C8BE;--1:#116E73">==</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">DESTROY) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// since we're destroying, scale down from 1</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// and don't let it go too small</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">scale </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> ( </span><span style="--0:#EF9F76;--1:#AB4307">1.0</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> ratio )</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">max</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#EF9F76;--1:#AB4307">0.1</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">kind </span><span style="--0:#81C8BE;--1:#116E73">==</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">CREATE) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// since we're creating, scale from from 0 to 1</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">scale </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> ratio</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">max</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#EF9F76;--1:#AB4307">0.1</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">kind </span><span style="--0:#81C8BE;--1:#116E73">==</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">MOVE) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> distance </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> block_height </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">*</span><span style="--0:#C6D0F5;--1:#4C4F69"> (busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">dest_y </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> busy</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">y)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">y_offset </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> distance </span><span style="--0:#81C8BE;--1:#116E73">*</span><span style="--0:#C6D0F5;--1:#4C4F69"> ratio</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#cfa8e9;--1:#6429af">if</span><span style="--0:#C6D0F5;--1:#474a62">(busy</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">kind </span><span style="--0:#81C8BE;--1:#0d5458">==</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Busy</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">SWAP) {</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> dist_x </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> block_width </span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">*</span><span style="--0:#C6D0F5;--1:#474a62"> (busy</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">dest_x </span><span style="--0:#81C8BE;--1:#0d5458">-</span><span style="--0:#C6D0F5;--1:#474a62"> busy</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">x)</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> dist_y </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> block_height </span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">*</span><span style="--0:#C6D0F5;--1:#474a62"> (busy</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">dest_y </span><span style="--0:#81C8BE;--1:#0d5458">-</span><span style="--0:#C6D0F5;--1:#474a62"> busy</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">y)</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">  </span></span><span style="--0:#C6D0F5">x_offset </span></span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> dist_x </span><span style="--0:#81C8BE;--1:#0d5458">*</span><span style="--0:#C6D0F5;--1:#474a62"> ratio</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">  </span></span><span style="--0:#C6D0F5">y_offset </span></span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> dist_y </span><span style="--0:#81C8BE;--1:#0d5458">*</span><span style="--0:#C6D0F5;--1:#474a62"> ratio</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#C6D0F5;--1:#474a62">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="if(busy.kind == Busy.DESTROY) {  // since we&#x27;re destroying, scale down from 1  // and don&#x27;t let it go too small  scale = ( 1.0 - ratio ).max(0.1)}if(busy.kind == Busy.CREATE) {  // since we&#x27;re creating, scale from from 0 to 1  scale = ratio.max(0.1)}if(busy.kind == Busy.MOVE) {  var distance = block_height * (busy.dest_y - busy.y)  y_offset = distance * ratio}if(busy.kind == Busy.SWAP) {  var dist_x = block_width * (busy.dest_x - busy.x)  var dist_y = block_height * (busy.dest_y - busy.y)  x_offset = dist_x * ratio  y_offset = dist_y * ratio}"><div></div></button></div></figure></div>
<p>Now we can see all the mechanics in the game working with animated timingâ€¦</p>
<video preload="auto" autoplay controls muted playsinline loop style="max-width:100%; width:auto; margin:auto; display:block;"> <source src="/next/video/tutorials/match3/swap.animate.mp4" type="video/mp4"> </video>
<div class="sl-heading-wrapper level-h2"><h2 id="final-touches">Final touches</h2><a class="sl-anchor-link" href="#final-touches"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œFinal touchesâ€</span></a></div>
<p>The timing is a little too slow to feel good, so letâ€™s adjust them.</p>
<p>Inside our <code dir="auto">Busy</code> class variables, we adjust the wait timing to <code dir="auto">0.3</code> seconds.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// how long the busy will want to run for</span></div></div><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> wait: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><ins><span style="--0:#f0a57f;--1:#833305">0.3</span></ins></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="// how long the busy will want to run forvar wait: Num = 0.3"><div></div></button></div></figure></div>
<p>And the wait for falling blocks is a little too long even at <code dir="auto">0.3</code>, weâ€™ll set it to <code dir="auto">0.1</code>.</p>
<p>Inside <code dir="auto">drop_blocks</code> weâ€™ll change the wait line:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line highlight del"><div class="code"><span style="--0:#C6D0F5;--1:#45485f">busy</span><span style="--0:#81C8BE;--1:#0d5356">.</span><span style="--0:#C6D0F5;--1:#45485f">wait </span><span style="--0:#81C8BE;--1:#0d5356">=</span><span style="--0:#C6D0F5;--1:#45485f"> </span><span style="--0:#f0a27a;--1:#803205">1</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--0:#C6D0F5;--1:#474a62">busy</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">wait </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#f0a57f;--1:#833305">0.1</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="busy.wait = 1busy.wait = 0.1"><div></div></button></div></figure></div>
<p>And if we run the game now, it plays a lot more fluid!</p>
<video preload="auto" autoplay controls muted playsinline loop style="max-width:100%; width:auto; margin:auto; display:block;"> <source src="/next/video/tutorials/match3/timings.mp4" type="video/mp4"> </video>
<div class="sl-heading-wrapper level-h2"><h2 id="next-time">Next time!</h2><a class="sl-anchor-link" href="#next-time"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œNext time!â€</span></a></div>
<p>Weâ€™ve successfully used Wren Fibers to pause logic in our game, so that we can animate the visual state!</p>
<p>In the next part, weâ€™re going to re-organize our code into a more manageable structure.</p> </div> <footer class="sl-flex astro-3yyafb3n"> <div class="meta sl-flex astro-3yyafb3n">   </div> <div class="pagination-links print:hidden astro-u2l5gyhi" dir="ltr"> <a href="/next/tutorials/match-3/part1/" rel="prev" class="astro-u2l5gyhi"> <svg aria-hidden="true" class="astro-u2l5gyhi astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.5rem;"><path d="M17 11H9.41l3.3-3.29a1.004 1.004 0 1 0-1.42-1.42l-5 5a1 1 0 0 0-.21.33 1 1 0 0 0 0 .76 1 1 0 0 0 .21.33l5 5a1.002 1.002 0 0 0 1.639-.325 1 1 0 0 0-.219-1.095L9.41 13H17a1 1 0 0 0 0-2Z"/></svg> <span class="astro-u2l5gyhi"> Previous <br class="astro-u2l5gyhi"> <span class="link-title astro-u2l5gyhi">Match 3 - Game logic</span> </span> </a> <a href="/next/tutorials/match-3/part3/" rel="next" class="astro-u2l5gyhi"> <svg aria-hidden="true" class="astro-u2l5gyhi astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.5rem;"><path d="M17.92 11.62a1.001 1.001 0 0 0-.21-.33l-5-5a1.003 1.003 0 1 0-1.42 1.42l3.3 3.29H7a1 1 0 0 0 0 2h7.59l-3.3 3.29a1.002 1.002 0 0 0 .325 1.639 1 1 0 0 0 1.095-.219l5-5a1 1 0 0 0 .21-.33 1 1 0 0 0 0-.76Z"/></svg> <span class="astro-u2l5gyhi"> Next <br class="astro-u2l5gyhi"> <span class="link-title astro-u2l5gyhi">Match 3 - After the prototype</span> </span> </a> </div>   </footer>  </div> </div>   </main> </div> </div>  </div> </div>  </body></html>