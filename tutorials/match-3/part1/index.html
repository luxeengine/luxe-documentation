<!DOCTYPE html><html lang="en" dir="ltr" data-theme="dark" data-has-toc data-has-sidebar class="astro-bguv2lll"> <head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Match 3 - Game logic | luxe docs</title><link rel="canonical"/><link rel="shortcut icon" href="/next/favicon.svg" type="image/svg+xml"/><meta name="generator" content="Astro v5.15.5"/><meta name="generator" content="Starlight v0.36.2"/><meta property="og:title" content="Match 3 - Game logic"/><meta property="og:type" content="article"/><meta property="og:url"/><meta property="og:locale" content="en"/><meta property="og:description" content="A tutorial on making a match 3"/><meta property="og:site_name" content="luxe docs"/><meta name="twitter:card" content="summary_large_image"/><meta name="description" content="A tutorial on making a match 3"/><script>
	window.StarlightThemeProvider = (() => {
		const storedTheme =
			typeof localStorage !== 'undefined' && localStorage.getItem('starlight-theme');
		const theme =
			storedTheme ||
			(window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
		document.documentElement.dataset.theme = theme === 'light' ? 'light' : 'dark';
		return {
			updatePickers(theme = storedTheme || 'auto') {
				document.querySelectorAll('starlight-theme-select').forEach((picker) => {
					const select = picker.querySelector('select');
					if (select) select.value = theme;
					/** @type {HTMLTemplateElement | null} */
					const tmpl = document.querySelector(`#theme-icons`);
					const newIcon = tmpl && tmpl.content.querySelector('.' + theme);
					if (newIcon) {
						const oldIcon = picker.querySelector('svg.label-icon');
						if (oldIcon) {
							oldIcon.replaceChildren(...newIcon.cloneNode(true).childNodes);
						}
					}
				});
			},
		};
	})();
</script><template id="theme-icons"><svg aria-hidden="true" class="light astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M5 12a1 1 0 0 0-1-1H3a1 1 0 0 0 0 2h1a1 1 0 0 0 1-1Zm.64 5-.71.71a1 1 0 0 0 0 1.41 1 1 0 0 0 1.41 0l.71-.71A1 1 0 0 0 5.64 17ZM12 5a1 1 0 0 0 1-1V3a1 1 0 0 0-2 0v1a1 1 0 0 0 1 1Zm5.66 2.34a1 1 0 0 0 .7-.29l.71-.71a1 1 0 1 0-1.41-1.41l-.66.71a1 1 0 0 0 0 1.41 1 1 0 0 0 .66.29Zm-12-.29a1 1 0 0 0 1.41 0 1 1 0 0 0 0-1.41l-.71-.71a1.004 1.004 0 1 0-1.43 1.41l.73.71ZM21 11h-1a1 1 0 0 0 0 2h1a1 1 0 0 0 0-2Zm-2.64 6A1 1 0 0 0 17 18.36l.71.71a1 1 0 0 0 1.41 0 1 1 0 0 0 0-1.41l-.76-.66ZM12 6.5a5.5 5.5 0 1 0 5.5 5.5A5.51 5.51 0 0 0 12 6.5Zm0 9a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7Zm0 3.5a1 1 0 0 0-1 1v1a1 1 0 0 0 2 0v-1a1 1 0 0 0-1-1Z"/></svg><svg aria-hidden="true" class="dark astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.64 13a1 1 0 0 0-1.05-.14 8.049 8.049 0 0 1-3.37.73 8.15 8.15 0 0 1-8.14-8.1 8.59 8.59 0 0 1 .25-2A1 1 0 0 0 8 2.36a10.14 10.14 0 1 0 14 11.69 1 1 0 0 0-.36-1.05Zm-9.5 6.69A8.14 8.14 0 0 1 7.08 5.22v.27a10.15 10.15 0 0 0 10.14 10.14 9.784 9.784 0 0 0 2.1-.22 8.11 8.11 0 0 1-7.18 4.32v-.04Z"/></svg><svg aria-hidden="true" class="auto astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg></template> <script>
  window.StarlightKbdProvider = (() => {
    return {
      updateKbdPickers(type) {
        for (const select of document.querySelectorAll('starlight-kbd-picker select')) {
          const isKnownType = Array.from(select.options).some((option) => option.value === type)
          if (!isKnownType) return
          select.value = type
        }
      },
    }
  })()
</script><link rel="stylesheet" href="/next/_astro/print.DNXP8c50.css" media="print"><link rel="stylesheet" href="/next/_astro/index.CQqvigv2.css">
<style>@layer starlight.components{:root{--sl-badge-default-border: var(--sl-color-accent);--sl-badge-default-bg: var(--sl-color-accent-low);--sl-badge-default-text: #fff;--sl-badge-note-border: var(--sl-color-blue);--sl-badge-note-bg: var(--sl-color-blue-low);--sl-badge-note-text: #fff;--sl-badge-danger-border: var(--sl-color-red);--sl-badge-danger-bg: var(--sl-color-red-low);--sl-badge-danger-text: #fff;--sl-badge-success-border: var(--sl-color-green);--sl-badge-success-bg: var(--sl-color-green-low);--sl-badge-success-text: #fff;--sl-badge-caution-border: var(--sl-color-orange);--sl-badge-caution-bg: var(--sl-color-orange-low);--sl-badge-caution-text: #fff;--sl-badge-tip-border: var(--sl-color-purple);--sl-badge-tip-bg: var(--sl-color-purple-low);--sl-badge-tip-text: #fff}[data-theme=light]:root{--sl-badge-default-bg: var(--sl-color-accent-high);--sl-badge-note-bg: var(--sl-color-blue-high);--sl-badge-danger-bg: var(--sl-color-red-high);--sl-badge-success-bg: var(--sl-color-green-high);--sl-badge-caution-bg: var(--sl-color-orange-high);--sl-badge-tip-bg: var(--sl-color-purple-high)}.sl-badge:where(.astro-avdet4wd){display:inline-block;border:1px solid var(--sl-color-border-badge);border-radius:.25rem;font-family:var(--sl-font-system-mono);line-height:normal;color:var(--sl-color-text-badge);background-color:var(--sl-color-bg-badge);overflow-wrap:anywhere}.sidebar-content .sl-badge:where(.astro-avdet4wd){line-height:1;font-size:var(--sl-text-xs);padding:.125rem .375rem}.sidebar-content a[aria-current=page]>.sl-badge:where(.astro-avdet4wd){--sl-color-bg-badge: transparent;--sl-color-border-badge: currentColor;color:inherit}.default:where(.astro-avdet4wd){--sl-color-bg-badge: var(--sl-badge-default-bg);--sl-color-border-badge: var(--sl-badge-default-border);--sl-color-text-badge: var(--sl-badge-default-text)}.note:where(.astro-avdet4wd){--sl-color-bg-badge: var(--sl-badge-note-bg);--sl-color-border-badge: var(--sl-badge-note-border);--sl-color-text-badge: var(--sl-badge-note-text)}.danger:where(.astro-avdet4wd){--sl-color-bg-badge: var(--sl-badge-danger-bg);--sl-color-border-badge: var(--sl-badge-danger-border);--sl-color-text-badge: var(--sl-badge-danger-text)}.success:where(.astro-avdet4wd){--sl-color-bg-badge: var(--sl-badge-success-bg);--sl-color-border-badge: var(--sl-badge-success-border);--sl-color-text-badge: var(--sl-badge-success-text)}.tip:where(.astro-avdet4wd){--sl-color-bg-badge: var(--sl-badge-tip-bg);--sl-color-border-badge: var(--sl-badge-tip-border);--sl-color-text-badge: var(--sl-badge-tip-text)}.caution:where(.astro-avdet4wd){--sl-color-bg-badge: var(--sl-badge-caution-bg);--sl-color-border-badge: var(--sl-badge-caution-border);--sl-color-text-badge: var(--sl-badge-caution-text)}.small:where(.astro-avdet4wd){font-size:var(--sl-text-xs);padding:.125rem .25rem}.medium:where(.astro-avdet4wd){font-size:var(--sl-text-sm);padding:.175rem .35rem}.large:where(.astro-avdet4wd){font-size:var(--sl-text-base);padding:.225rem .45rem}.sl-markdown-content :is(h1,h2,h3,h4,h5,h6) .sl-badge:where(.astro-avdet4wd){vertical-align:middle}}
@layer starlight.components{.card:where(.astro-v5tidmuc){--sl-card-border: var(--sl-color-purple);--sl-card-bg: var(--sl-color-purple-low);border:1px solid var(--sl-color-gray-5);background-color:var(--sl-color-black);padding:clamp(1rem,calc(.125rem + 3vw),2.5rem);flex-direction:column;gap:clamp(.5rem,calc(.125rem + 1vw),1rem)}.card:where(.astro-v5tidmuc):nth-child(4n+1){--sl-card-border: var(--sl-color-orange);--sl-card-bg: var(--sl-color-orange-low)}.card:where(.astro-v5tidmuc):nth-child(4n+3){--sl-card-border: var(--sl-color-green);--sl-card-bg: var(--sl-color-green-low)}.card:where(.astro-v5tidmuc):nth-child(4n+4){--sl-card-border: var(--sl-color-red);--sl-card-bg: var(--sl-color-red-low)}.card:where(.astro-v5tidmuc):nth-child(4n+5){--sl-card-border: var(--sl-color-blue);--sl-card-bg: var(--sl-color-blue-low)}.title:where(.astro-v5tidmuc){font-weight:600;font-size:var(--sl-text-h4);color:var(--sl-color-white);line-height:var(--sl-line-height-headings);gap:1rem;align-items:center}.card:where(.astro-v5tidmuc) .icon:where(.astro-v5tidmuc){border:1px solid var(--sl-card-border);background-color:var(--sl-card-bg);padding:.2em;border-radius:.25rem;flex-shrink:0}.card:where(.astro-v5tidmuc) .body:where(.astro-v5tidmuc){margin:0;font-size:clamp(var(--sl-text-sm),calc(.5rem + 1vw),var(--sl-text-body))}}
@layer starlight.components{svg:where(.astro-c6vsoqas){color:var(--sl-icon-color);font-size:var(--sl-icon-size, 1em);width:1em;height:1em}}
.sl-markdown-content starlight-kbd-picker:where(.astro-k5ijk5yq){display:inline-block}
@layer starlight.components{.sl-link-card:where(.astro-mf7fz2mj){display:grid;grid-template-columns:1fr auto;gap:.5rem;border:1px solid var(--sl-color-gray-5);border-radius:.5rem;padding:1rem;box-shadow:var(--sl-shadow-sm);position:relative}a:where(.astro-mf7fz2mj){text-decoration:none;line-height:var(--sl-line-height-headings)}a:where(.astro-mf7fz2mj):before{content:"";position:absolute;inset:0}.stack:where(.astro-mf7fz2mj){flex-direction:column;gap:.5rem}.title:where(.astro-mf7fz2mj){color:var(--sl-color-white);font-weight:600;font-size:var(--sl-text-lg)}.description:where(.astro-mf7fz2mj){color:var(--sl-color-gray-3);line-height:1.5}.icon:where(.astro-mf7fz2mj){color:var(--sl-color-gray-3)}.sl-link-card:where(.astro-mf7fz2mj):hover{background:var(--sl-color-gray-7, var(--sl-color-gray-6));border-color:var(--sl-color-gray-2)}.sl-link-card:where(.astro-mf7fz2mj):hover .icon:where(.astro-mf7fz2mj){color:var(--sl-color-white)}}
label:where(.astro-e2vmghfl){--sl-label-icon-size: 1rem;--sl-caret-size: 1.25rem;--sl-inline-padding: .5rem;align-items:center;color:var(--sl-color-gray-1);display:inline-flex;gap:.25rem;position:relative}label:where(.astro-e2vmghfl):hover:not(:where(.sl-markdown-content *)){color:var(--sl-color-gray-2)}.sl-markdown-content label:where(.astro-e2vmghfl):hover{color:var(--sl-color-text-accent)}.icon:where(.astro-e2vmghfl){color:var(--sl-icon-color);font-size:var(--sl-icon-size, 1em);height:1em;pointer-events:none;position:absolute;top:50%;transform:translateY(-50%);width:1em}.label-icon:where(.astro-e2vmghfl){font-size:var(--sl-label-icon-size);inset-inline-start:0}.sl-markdown-content .label-icon:where(.astro-e2vmghfl){left:var(--sl-inline-padding)}.caret:where(.astro-e2vmghfl){font-size:var(--sl-caret-size);inset-inline-end:0}.sl-markdown-content .caret:where(.astro-e2vmghfl){right:var(--sl-inline-padding)}select:where(.astro-e2vmghfl){appearance:none;background-color:transparent;border:0;color:inherit;cursor:pointer;padding-block:.25rem;padding-inline:calc(var(--sl-label-icon-size) + var(--sl-inline-padding) + .25rem) calc(var(--sl-caret-size) + var(--sl-inline-padding) + .25rem);text-overflow:ellipsis}.sl-markdown-content select:where(.astro-e2vmghfl){border:1px solid var(--sl-color-white);border-radius:999rem;outline-offset:.1875rem}.sl-markdown-content label:where(.astro-e2vmghfl):hover select:where(.astro-e2vmghfl){border-color:var(--sl-color-text-accent)}option:where(.astro-e2vmghfl){background-color:var(--sl-color-bg-nav);color:var(--sl-color-gray-1)}@media (min-width: 50rem){select:where(.astro-e2vmghfl){font-size:var(--sl-text-sm)}}select:where(.astro-e2vmghfl):not(:where(.sl-markdown-content *)){margin-inline:calc(var(--sl-inline-padding) * -1);padding-block:.625rem}
@layer starlight.components{.sl-steps{--bullet-size: calc(var(--sl-line-height) * 1rem);--bullet-margin: .375rem;list-style:none;counter-reset:steps-counter var(--sl-steps-start, 0);padding-inline-start:0}.sl-steps>li{counter-increment:steps-counter;position:relative;padding-inline-start:calc(var(--bullet-size) + 1rem);padding-bottom:1px;min-height:calc(var(--bullet-size) + var(--bullet-margin))}.sl-steps>li+li{margin-top:0}.sl-steps>li:before{content:counter(steps-counter);position:absolute;top:0;inset-inline-start:0;width:var(--bullet-size);height:var(--bullet-size);line-height:var(--bullet-size);font-size:var(--sl-text-xs);font-weight:600;text-align:center;color:var(--sl-color-white);background-color:var(--sl-color-gray-6);border-radius:99rem;box-shadow:inset 0 0 0 1px var(--sl-color-gray-5)}.sl-steps>li:after{--guide-width: 1px;content:"";position:absolute;top:calc(var(--bullet-size) + var(--bullet-margin));bottom:var(--bullet-margin);inset-inline-start:calc((var(--bullet-size) - var(--guide-width)) / 2);width:var(--guide-width);background-color:var(--sl-color-hairline-light)}}@layer starlight.content{.sl-steps>li>:first-child{--lh: calc(1em * var(--sl-line-height));--shift-y: calc(.5 * (var(--bullet-size) - var(--lh)));transform:translateY(var(--shift-y));margin-bottom:var(--shift-y)}.sl-steps>li>:first-child:where(h1,h2,h3,h4,h5,h6){--lh: calc(1em * var(--sl-line-height-headings))}@supports (--prop: 1lh){.sl-steps>li>:first-child{--lh: 1lh}}}
@layer starlight.components{starlight-file-tree:where(.astro-p67cqifm){--x-space: 1.5rem;--y-space: .125rem;--y-pad: 0;display:block;border:1px solid var(--sl-color-gray-5);padding:1rem;background-color:var(--sl-color-gray-6);font-size:var(--sl-text-xs);font-family:var(--__sl-font-mono);overflow-x:auto}starlight-file-tree:where(.astro-p67cqifm) .directory>details{border:0;padding:0;padding-inline-start:var(--x-space);background:transparent}starlight-file-tree:where(.astro-p67cqifm) .directory>details>summary{margin-inline-start:calc(-1 * var(--x-space));border:0;padding:var(--y-pad) .625rem;font-weight:400;color:var(--sl-color-white);max-width:100%}starlight-file-tree:where(.astro-p67cqifm) .directory>details>summary::marker,starlight-file-tree:where(.astro-p67cqifm) .directory>details>summary::-webkit-details-marker{color:var(--sl-color-gray-3)}starlight-file-tree:where(.astro-p67cqifm) .directory>details>summary:hover,starlight-file-tree:where(.astro-p67cqifm) .directory>details>summary:hover .tree-icon{cursor:pointer;color:var(--sl-color-text-accent);fill:currentColor}starlight-file-tree:where(.astro-p67cqifm) .directory>details>summary:hover~ul{border-color:var(--sl-color-gray-4)}starlight-file-tree:where(.astro-p67cqifm) .directory>details>summary:hover .highlight .tree-icon{color:var(--sl-color-text-invert);fill:currentColor}starlight-file-tree:where(.astro-p67cqifm) ul{margin-inline-start:.5rem;border-inline-start:1px solid var(--sl-color-gray-5);padding:0;padding-inline-start:.125rem;list-style:none}starlight-file-tree:where(.astro-p67cqifm)>ul{margin:0;border:0;padding:0}starlight-file-tree:where(.astro-p67cqifm) li{margin:var(--y-space) 0;padding:var(--y-pad) 0}starlight-file-tree:where(.astro-p67cqifm) .file{margin-inline-start:calc(var(--x-space) - .125rem);color:var(--sl-color-white)}starlight-file-tree:where(.astro-p67cqifm) .tree-entry{display:inline-flex;align-items:flex-start;flex-wrap:wrap;max-width:calc(100% - 1rem)}@media (min-width: 30em){starlight-file-tree:where(.astro-p67cqifm) .tree-entry{flex-wrap:nowrap}}starlight-file-tree:where(.astro-p67cqifm) .tree-entry>:first-child{flex-shrink:0}starlight-file-tree:where(.astro-p67cqifm) .empty{color:var(--sl-color-gray-3);padding-inline-start:.375rem}starlight-file-tree:where(.astro-p67cqifm) .comment{color:var(--sl-color-gray-3);padding-inline-start:1.625rem;max-width:24rem;min-width:12rem}starlight-file-tree:where(.astro-p67cqifm) .highlight{display:inline-block;border-radius:.25rem;padding-inline-end:.5rem;color:var(--sl-color-text-invert);background-color:var(--sl-color-text-accent)}starlight-file-tree:where(.astro-p67cqifm) svg{display:inline;fill:var(--sl-color-gray-3);vertical-align:middle;margin-inline:.25rem .375rem;width:.875rem;height:.875rem}starlight-file-tree:where(.astro-p67cqifm) .highlight svg.tree-icon{fill:currentColor}}
@layer starlight.components{.sl-link-button:where(.astro-xwgiixxa){align-items:center;border:1px solid transparent;border-radius:999rem;display:inline-flex;font-size:var(--sl-text-sm);gap:.5em;line-height:1.1875;outline-offset:.25rem;padding:.4375rem 1.125rem;text-decoration:none}.sl-link-button:where(.astro-xwgiixxa).primary{background:var(--sl-color-text-accent);border-color:var(--sl-color-text-accent);color:var(--sl-color-black)}.sl-link-button:where(.astro-xwgiixxa).primary:hover{color:var(--sl-color-black)}.sl-link-button:where(.astro-xwgiixxa).secondary{border-color:inherit;color:var(--sl-color-white)}.sl-link-button:where(.astro-xwgiixxa).minimal{color:var(--sl-color-white);padding-inline:0}.sl-link-button:where(.astro-xwgiixxa) svg{flex-shrink:0}@media (min-width: 50rem){.sl-link-button:where(.astro-xwgiixxa){font-size:var(--sl-text-base);padding:.9375rem 1.25rem}}.sl-markdown-content .sl-link-button:where(.astro-xwgiixxa){margin-inline-end:1rem}.sl-markdown-content .sl-link-button:where(.astro-xwgiixxa):not(:where(p *)){margin-block:1rem}}
</style><script type="module" src="/next/_astro/page.B1D-nYk3.js"></script></head> <body class="astro-bguv2lll"> <a href="#_top" class="astro-7q3lir66">Skip to content</a>  <div class="page sl-flex astro-vrdttmbt"> <header class="header astro-vrdttmbt"><div class="header astro-kmkmnagf"> <div class="title-wrapper sl-flex astro-kmkmnagf"> <a href="/next/" class="site-title sl-flex astro-m46x6ez3">  <img class="astro-m46x6ez3" alt src="/next/_astro/luxe-dark.NVYNGKCT.svg" width="239" height="380">  <span class="astro-m46x6ez3" translate="no"> luxe docs </span> </a>  </div> <div class="sl-flex print:hidden astro-kmkmnagf"> <site-search class="astro-kmkmnagf astro-v37mnknz" data-translations="{&#34;placeholder&#34;:&#34;Search&#34;}"> <button data-open-modal disabled aria-label="Search" aria-keyshortcuts="Control+K" class="astro-v37mnknz"> <svg aria-hidden="true" class="astro-v37mnknz astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.71 20.29 18 16.61A9 9 0 1 0 16.61 18l3.68 3.68a.999.999 0 0 0 1.42 0 1 1 0 0 0 0-1.39ZM11 18a7 7 0 1 1 0-14 7 7 0 0 1 0 14Z"/></svg> <span class="sl-hidden md:sl-block astro-v37mnknz" aria-hidden="true">Search</span> <kbd class="sl-hidden md:sl-flex astro-v37mnknz" style="display: none;"> <kbd class="astro-v37mnknz">Ctrl</kbd><kbd class="astro-v37mnknz">K</kbd> </kbd> </button> <dialog style="padding:0" aria-label="Search" class="astro-v37mnknz"> <div class="dialog-frame sl-flex astro-v37mnknz">  <button data-close-modal class="sl-flex md:sl-hidden astro-v37mnknz"> Cancel </button> <div class="search-container astro-v37mnknz"> <div id="starlight__search" class="astro-v37mnknz"></div> </div> </div> </dialog> </site-search>  <script>
	(() => {
		const openBtn = document.querySelector('button[data-open-modal]');
		const shortcut = openBtn?.querySelector('kbd');
		if (!openBtn || !(shortcut instanceof HTMLElement)) return;
		const platformKey = shortcut.querySelector('kbd');
		if (platformKey && /(Mac|iPhone|iPod|iPad)/i.test(navigator.platform)) {
			platformKey.textContent = 'âŒ˜';
			openBtn.setAttribute('aria-keyshortcuts', 'Meta+K');
		}
		shortcut.style.display = '';
	})();
</script> <script type="module" src="/next/_astro/Search.astro_astro_type_script_index_0_lang.B0XZjlg4.js"></script>   </div> <div class="sl-hidden md:sl-flex print:hidden right-group astro-kmkmnagf"> <div class="sl-flex social-icons astro-kmkmnagf"> <a href="https://github.com/withastro/starlight" rel="me" class="sl-flex astro-wy4te6ga"><span class="sr-only astro-wy4te6ga">GitHub</span><svg aria-hidden="true" class="astro-wy4te6ga astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"/></svg></a> </div> <starlight-kbd-picker class="astro-k5ijk5yq"> <label class="not-content astro-e2vmghfl"> <span class="sr-only astro-e2vmghfl">Select keyboard type</span> <svg xmlns="http://www.w3.org/2000/svg" class="icon label-icon astro-e2vmghfl" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"> <path d="M6.21 13.29a.93.93 0 0 0-.33-.21 1 1 0 0 0-.76 0 .9.9 0 0 0-.54.54 1 1 0 1 0 1.84 0 1 1 0 0 0-.21-.33ZM13.5 11h1a1 1 0 0 0 0-2h-1a1 1 0 0 0 0 2Zm-4 0h1a1 1 0 0 0 0-2h-1a1 1 0 0 0 0 2Zm-3-2h-1a1 1 0 0 0 0 2h1a1 1 0 0 0 0-2ZM20 5H4a3 3 0 0 0-3 3v8a3 3 0 0 0 3 3h16a3 3 0 0 0 3-3V8a3 3 0 0 0-3-3Zm1 11a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1h16a1 1 0 0 1 1 1Zm-6-3H9a1 1 0 0 0 0 2h6a1 1 0 0 0 0-2Zm3.5-4h-1a1 1 0 0 0 0 2h1a1 1 0 0 0 0-2Zm.71 4.29a1 1 0 0 0-.33-.21 1 1 0 0 0-.76 0 .93.93 0 0 0-.33.21 1 1 0 0 0-.21.33 1 1 0 1 0 1.92.38.84.84 0 0 0-.08-.38 1 1 0 0 0-.21-.33Z" class="astro-e2vmghfl"></path> </svg> <select autocomplete="off" value="default" class="astro-e2vmghfl"> <option selected value="default" class="astro-e2vmghfl">Default Keys</option><option value="windows" class="astro-e2vmghfl">Windows</option><option value="mac" class="astro-e2vmghfl">macOS</option> </select> <svg aria-hidden="true" class="icon caret astro-e2vmghfl astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg> </label>  </starlight-kbd-picker> <script>
  StarlightKbdProvider.updateKbdPickers(typeof localStorage !== 'undefined' && localStorage.getItem('sl-kbd-type'))
</script> <script type="module">customElements.define("starlight-kbd-picker",class extends HTMLElement{constructor(){super(),this.querySelector("select")?.addEventListener("change",e=>{if(e.currentTarget instanceof HTMLSelectElement){StarlightKbdProvider.updateKbdPickers(e.currentTarget.value);for(const t of document.querySelectorAll("[data-sl-kbd-type]"))t.getAttribute("data-sl-kbd-type")===e.currentTarget.value?t.setAttribute("data-sl-kbd-active",""):t.removeAttribute("data-sl-kbd-active");typeof localStorage<"u"&&localStorage.setItem("sl-kbd-type",e.currentTarget.value)}})}});</script>  <starlight-theme-select>  <label style="--sl-select-width: 6.25em" class="astro-4yphtoen"> <span class="sr-only astro-4yphtoen">Select theme</span> <svg aria-hidden="true" class="icon label-icon astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg> <select autocomplete="off" class="astro-4yphtoen"> <option value="dark" class="astro-4yphtoen">Dark</option><option value="light" class="astro-4yphtoen">Light</option><option value="auto" selected class="astro-4yphtoen">Auto</option> </select> <svg aria-hidden="true" class="icon caret astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg> </label>  </starlight-theme-select>  <script>
	StarlightThemeProvider.updatePickers();
</script> <script type="module">const r="starlight-theme",o=e=>e==="auto"||e==="dark"||e==="light"?e:"auto",c=()=>o(typeof localStorage<"u"&&localStorage.getItem(r));function n(e){typeof localStorage<"u"&&localStorage.setItem(r,e==="light"||e==="dark"?e:"")}const l=()=>matchMedia("(prefers-color-scheme: light)").matches?"light":"dark";function t(e){StarlightThemeProvider.updatePickers(e),document.documentElement.dataset.theme=e==="auto"?l():e,n(e)}matchMedia("(prefers-color-scheme: light)").addEventListener("change",()=>{c()==="auto"&&t("auto")});class s extends HTMLElement{constructor(){super(),t(c()),this.querySelector("select")?.addEventListener("change",a=>{a.currentTarget instanceof HTMLSelectElement&&t(o(a.currentTarget.value))})}}customElements.define("starlight-theme-select",s);</script> <script type="module">class s extends HTMLElement{constructor(){super();const e=this.querySelector("select");e&&(e.addEventListener("change",t=>{t.currentTarget instanceof HTMLSelectElement&&(window.location.pathname=t.currentTarget.value)}),window.addEventListener("pageshow",t=>{if(!t.persisted)return;const n=e.querySelector("option[selected]")?.index;n!==e.selectedIndex&&(e.selectedIndex=n??0)}))}}customElements.define("starlight-lang-select",s);</script> </div> </div> </header> <nav class="sidebar print:hidden astro-vrdttmbt" aria-label="Main"> <starlight-menu-button class="print:hidden astro-jif73yzw"> <button aria-expanded="false" aria-label="Menu" aria-controls="starlight__sidebar" class="sl-flex md:sl-hidden astro-jif73yzw"> <svg aria-hidden="true" class="open-menu astro-jif73yzw astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M3 8h18a1 1 0 1 0 0-2H3a1 1 0 0 0 0 2Zm18 8H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Zm0-5H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Z"/></svg> <svg aria-hidden="true" class="close-menu astro-jif73yzw astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="m13.41 12 6.3-6.29a1.004 1.004 0 1 0-1.42-1.42L12 10.59l-6.29-6.3a1.004 1.004 0 0 0-1.42 1.42l6.3 6.29-6.3 6.29a1 1 0 0 0 0 1.42.998.998 0 0 0 1.42 0l6.29-6.3 6.29 6.3a.999.999 0 0 0 1.42 0 1 1 0 0 0 0-1.42L13.41 12Z"/></svg> </button> </starlight-menu-button> <script type="module">class s extends HTMLElement{constructor(){super(),this.btn=this.querySelector("button"),this.btn.addEventListener("click",()=>this.toggleExpanded());const t=this.closest("nav");t&&t.addEventListener("keyup",e=>this.closeOnEscape(e))}setExpanded(t){this.setAttribute("aria-expanded",String(t)),document.body.toggleAttribute("data-mobile-menu-expanded",t)}toggleExpanded(){this.setExpanded(this.getAttribute("aria-expanded")!=="true")}closeOnEscape(t){t.code==="Escape"&&(this.setExpanded(!1),this.btn.focus())}}customElements.define("starlight-menu-button",s);</script>   <div id="starlight__sidebar" class="sidebar-pane astro-vrdttmbt"> <div class="sidebar-content sl-flex astro-vrdttmbt"> <sl-sidebar-state-persist data-hash="0vlr3o6" class="astro-kku4brbg"> <script aria-hidden="true">
		(() => {
			try {
				if (!matchMedia('(min-width: 50em)').matches) return;
				/** @type {HTMLElement | null} */
				const target = document.querySelector('sl-sidebar-state-persist');
				const state = JSON.parse(sessionStorage.getItem('sl-sidebar-state') || '0');
				if (!target || !state || target.dataset.hash !== state.hash) return;
				window._starlightScrollRestore = state.scroll;
				customElements.define(
					'sl-sidebar-restore',
					class SidebarRestore extends HTMLElement {
						connectedCallback() {
							try {
								const idx = parseInt(this.dataset.index || '');
								const details = this.closest('details');
								if (details && typeof state.open[idx] === 'boolean') details.open = state.open[idx];
							} catch {}
						}
					}
				);
			} catch {}
		})();
	</script>  <ul class="top-level astro-3ii7xxms"> <li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Welcome</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="0"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/next/welcome/about/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">About</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/next/welcome/get/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Installing Luxe</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Getting Started</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="1"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/next/getting-started/luxe-101/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Luxe 101</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/next/getting-started/create-a-project/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Create and run a project</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/next/getting-started/draw-and-input/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Drawing and input</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/next/getting-started/world/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">World systems</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/next/getting-started/luxe-editor/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">The luxe editor</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/next/getting-started/build/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Making a build</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/next/getting-started/audio/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Adding sounds</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Tutorials</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="2"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Concepts</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="3"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/next/tutorials/concepts/overview/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Overview</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/next/tutorials/concepts/yarn/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Dialogue</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Cards &amp; Decks</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="4"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/next/tutorials/cards--decks/cardsdecks/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Cards &amp; Decks</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Match 3</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="5"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/next/tutorials/match-3/part1/" aria-current="page" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Match 3 - Game logic</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/next/tutorials/match-3/part2/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Match 3 - Animating changes</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/next/tutorials/match-3/part3/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Match 3 - After the prototype</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/next/tutorials/match-3/part4/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Match 3 - Sprite visuals</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Platformer</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="6"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/next/tutorials/platformer/platformer-first-steps/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">First steps</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/next/tutorials/platformer/platformer-next-steps/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Next steps</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/next/tutorials/platformer/platformer-the-rest/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">The rest</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Top down</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="7"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/next/tutorials/topdown/topdown-first-steps/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">First steps</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/next/tutorials/topdown/topdown-next-steps/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Next steps</span>  </a> </li> </ul>  </details> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Manual</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="8"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/next/manual/overview/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Overview</span>  </a> </li><li class="astro-3ii7xxms"> <details class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">modules</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="9"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/next/manual/modules/modules/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Using Modules</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">project</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="10"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/next/manual/project/anatomy/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Anatomy</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">render</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="11"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/next/manual/render/draw/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Draw tool</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">scripting</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="12"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/next/manual/scripting/multiple-files/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Multiple Wren files</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/next/manual/scripting/random/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Random numbers</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">tools</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="13"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/next/manual/tools/save/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Save data</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">world</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="14"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/next/manual/world/camera/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Camera</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/next/manual/world/custom-modifiers/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Custom Modifiers</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/next/manual/world/states/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">States</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/next/manual/world/tilemaps/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Tile maps</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/next/manual/world/ui/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">UI</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/next/manual/world/wires/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Wires (events)</span>  </a> </li> </ul>  </details> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <a href="https://api.luxeengine.com/" aria-current="false" class="large astro-3ii7xxms"> <span class="astro-3ii7xxms">API reference</span>  </a> </li> </ul>   <script aria-hidden="true">
		(() => {
			const scroller = document.getElementById('starlight__sidebar');
			if (!window._starlightScrollRestore || !scroller) return;
			scroller.scrollTop = window._starlightScrollRestore;
			delete window._starlightScrollRestore;
		})();
	</script> </sl-sidebar-state-persist>  <div class="md:sl-hidden"> <div class="mobile-preferences sl-flex astro-wu23bvmt"> <div class="social-icons astro-wu23bvmt"> <a href="https://github.com/withastro/starlight" rel="me" class="sl-flex astro-wy4te6ga"><span class="sr-only astro-wy4te6ga">GitHub</span><svg aria-hidden="true" class="astro-wy4te6ga astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"/></svg></a> </div> <starlight-kbd-picker class="astro-k5ijk5yq"> <label class="not-content astro-e2vmghfl"> <span class="sr-only astro-e2vmghfl">Select keyboard type</span> <svg xmlns="http://www.w3.org/2000/svg" class="icon label-icon astro-e2vmghfl" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"> <path d="M6.21 13.29a.93.93 0 0 0-.33-.21 1 1 0 0 0-.76 0 .9.9 0 0 0-.54.54 1 1 0 1 0 1.84 0 1 1 0 0 0-.21-.33ZM13.5 11h1a1 1 0 0 0 0-2h-1a1 1 0 0 0 0 2Zm-4 0h1a1 1 0 0 0 0-2h-1a1 1 0 0 0 0 2Zm-3-2h-1a1 1 0 0 0 0 2h1a1 1 0 0 0 0-2ZM20 5H4a3 3 0 0 0-3 3v8a3 3 0 0 0 3 3h16a3 3 0 0 0 3-3V8a3 3 0 0 0-3-3Zm1 11a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1h16a1 1 0 0 1 1 1Zm-6-3H9a1 1 0 0 0 0 2h6a1 1 0 0 0 0-2Zm3.5-4h-1a1 1 0 0 0 0 2h1a1 1 0 0 0 0-2Zm.71 4.29a1 1 0 0 0-.33-.21 1 1 0 0 0-.76 0 .93.93 0 0 0-.33.21 1 1 0 0 0-.21.33 1 1 0 1 0 1.92.38.84.84 0 0 0-.08-.38 1 1 0 0 0-.21-.33Z" class="astro-e2vmghfl"></path> </svg> <select autocomplete="off" value="default" class="astro-e2vmghfl"> <option selected value="default" class="astro-e2vmghfl">Default Keys</option><option value="windows" class="astro-e2vmghfl">Windows</option><option value="mac" class="astro-e2vmghfl">macOS</option> </select> <svg aria-hidden="true" class="icon caret astro-e2vmghfl astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg> </label>  </starlight-kbd-picker> <script>
  StarlightKbdProvider.updateKbdPickers(typeof localStorage !== 'undefined' && localStorage.getItem('sl-kbd-type'))
</script>   <starlight-theme-select>  <label style="--sl-select-width: 6.25em" class="astro-4yphtoen"> <span class="sr-only astro-4yphtoen">Select theme</span> <svg aria-hidden="true" class="icon label-icon astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg> <select autocomplete="off" class="astro-4yphtoen"> <option value="dark" class="astro-4yphtoen">Dark</option><option value="light" class="astro-4yphtoen">Light</option><option value="auto" selected class="astro-4yphtoen">Auto</option> </select> <svg aria-hidden="true" class="icon caret astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg> </label>  </starlight-theme-select>  <script>
	StarlightThemeProvider.updatePickers();
</script>   </div>  </div> </div> </div> </nav> <div class="main-frame astro-vrdttmbt">  <script type="module">const a=document.getElementById("starlight__sidebar"),n=a?.querySelector("sl-sidebar-state-persist"),o="sl-sidebar-state",i=()=>{let t=[];const e=n?.dataset.hash||"";try{const s=sessionStorage.getItem(o),r=JSON.parse(s||"{}");Array.isArray(r.open)&&r.hash===e&&(t=r.open)}catch{}return{hash:e,open:t,scroll:a?.scrollTop||0}},c=t=>{try{sessionStorage.setItem(o,JSON.stringify(t))}catch{}},d=()=>c(i()),l=(t,e)=>{const s=i();s.open[e]=t,c(s)};n?.addEventListener("click",t=>{if(!(t.target instanceof Element))return;const e=t.target.closest("summary")?.closest("details");if(!e)return;const s=e.querySelector("sl-sidebar-restore"),r=parseInt(s?.dataset.index||"");isNaN(r)||l(!e.open,r)});addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&d()});addEventListener("pageHide",d);</script> <div class="lg:sl-flex astro-67yu43on"> <aside class="right-sidebar-container print:hidden astro-67yu43on"> <div class="right-sidebar astro-67yu43on"> <div class="lg:sl-hidden astro-pb3aqygn"><mobile-starlight-toc data-min-h="2" data-max-h="3" class="astro-doynk5tl"><nav aria-labelledby="starlight__on-this-page--mobile" class="astro-doynk5tl"><details id="starlight__mobile-toc" class="astro-doynk5tl"><summary id="starlight__on-this-page--mobile" class="sl-flex astro-doynk5tl"><span class="toggle sl-flex astro-doynk5tl">On this page<svg aria-hidden="true" class="caret astro-doynk5tl astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg></span><span class="display-current astro-doynk5tl"></span></summary><div class="dropdown astro-doynk5tl"><ul class="isMobile astro-g2bywc46" style="--depth: 0;"> <li class="astro-g2bywc46" style="--depth: 0;"> <a href="#_top" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Overview</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#see-it-in-motion" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">See it in motion</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#moving-parts" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Moving parts</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#project-phases" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Project phases</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#create-the-project" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Create the project</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#the-grid-system" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">The grid system</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#grid-data" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Grid data</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#initialize-the-grid-data" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Initialize the grid data</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#visualize-the-grid" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Visualize the grid</span> </a> <ul class="isMobile astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#fill-the-grid-with-random-values" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Fill the grid with random values</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#draw-the-grid" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Draw the grid</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#adding-an-instance-in-gamewren" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Adding an instance in game.wren</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#fill-the-grid-nicely" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Fill the grid nicely</span> </a> <ul class="isMobile astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#grid-helper-functions" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Grid helper functions</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#resetting-the-grid-safely" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Resetting the grid safely</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#shapes--color" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Shapes + Color</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#debug-input" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Debug input</span> </a> <ul class="isMobile astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#mouse-conversions" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Mouse conversions</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#selected-state" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Selected state</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#swap" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Swap</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#finding-matches" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Finding matches</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#processing-matches" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Processing matches</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#dropping-blocks" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Dropping blocks</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#filling-the-gaps" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Filling the gaps</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#cascading-changes" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Cascading changes</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#bonus-logic" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Bonus logic</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#next-time" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Next time!</span> </a>  </li> </ul> </div></details></nav></mobile-starlight-toc><script type="module" src="/next/_astro/MobileTableOfContents.astro_astro_type_script_index_0_lang.C181hMzK.js"></script></div><div class="right-sidebar-panel sl-hidden lg:sl-block astro-pb3aqygn"><div class="sl-container astro-pb3aqygn"><starlight-toc data-min-h="2" data-max-h="3"><nav aria-labelledby="starlight__on-this-page"><h2 id="starlight__on-this-page">On this page</h2><ul class="astro-g2bywc46" style="--depth: 0;"> <li class="astro-g2bywc46" style="--depth: 0;"> <a href="#_top" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Overview</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#see-it-in-motion" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">See it in motion</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#moving-parts" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Moving parts</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#project-phases" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Project phases</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#create-the-project" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Create the project</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#the-grid-system" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">The grid system</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#grid-data" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Grid data</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#initialize-the-grid-data" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Initialize the grid data</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#visualize-the-grid" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Visualize the grid</span> </a> <ul class="astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#fill-the-grid-with-random-values" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Fill the grid with random values</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#draw-the-grid" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Draw the grid</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#adding-an-instance-in-gamewren" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Adding an instance in game.wren</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#fill-the-grid-nicely" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Fill the grid nicely</span> </a> <ul class="astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#grid-helper-functions" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Grid helper functions</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#resetting-the-grid-safely" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Resetting the grid safely</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#shapes--color" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Shapes + Color</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#debug-input" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Debug input</span> </a> <ul class="astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#mouse-conversions" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Mouse conversions</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#selected-state" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Selected state</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#swap" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Swap</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#finding-matches" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Finding matches</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#processing-matches" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Processing matches</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#dropping-blocks" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Dropping blocks</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#filling-the-gaps" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Filling the gaps</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#cascading-changes" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Cascading changes</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#bonus-logic" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Bonus logic</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#next-time" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Next time!</span> </a>  </li> </ul> </nav></starlight-toc><script type="module" src="/next/_astro/TableOfContents.astro_astro_type_script_index_0_lang.CKWWgpjV.js"></script></div></div> </div> </aside> <div class="main-pane astro-67yu43on">  <main data-pagefind-body class="astro-bguv2lll" lang="en" dir="ltr">    <div class="content-panel astro-7nkwcw3z"> <div class="sl-container astro-7nkwcw3z"> <h1 id="_top" class="astro-j6tvhyss">Match 3 - Game logic</h1>  </div> </div>  <div class="content-panel astro-7nkwcw3z"> <div class="sl-container astro-7nkwcw3z"> <div class="sl-markdown-content"> <span class="sl-badge success small astro-avdet4wd">Complexity: low</span>
<span class="sl-badge tip small astro-avdet4wd">Game Tutorial</span>
<br>
<br>
<aside aria-label="Outcome / Goals" class="starlight-aside starlight-aside--tip"><p class="starlight-aside__title" aria-hidden="true"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="starlight-aside__icon"><path d="M17 22H5a3 3 0 0 1-3-3V9a3 3 0 0 1 3-3h1a4 4 0 0 1 7.3-2.18c.448.64.692 1.4.7 2.18h3a1 1 0 0 1 1 1v3a4 4 0 0 1 2.18 7.3A3.86 3.86 0 0 1 18 18v3a1 1 0 0 1-1 1ZM5 8a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h11v-3.18a1 1 0 0 1 1.33-.95 1.77 1.77 0 0 0 1.74-.23 2 2 0 0 0 .93-1.37 2 2 0 0 0-.48-1.59 1.89 1.89 0 0 0-2.17-.55 1 1 0 0 1-1.33-.95V8h-3.2a1 1 0 0 1-1-1.33 1.77 1.77 0 0 0-.23-1.74 1.939 1.939 0 0 0-3-.43A2 2 0 0 0 8 6c.002.23.046.456.13.67A1 1 0 0 1 7.18 8H5Z"></path></svg>Outcome / Goals</p><div class="starlight-aside__content"><p>In this tutorial weâ€™ll:</p><ul>
<li>Make a simple match 3 game grid</li>
<li>Visualize the grid using <code dir="auto">Draw</code></li>
<li>Add mouse input to test the game</li>
<li>Add the Swap, Matching, Dropping, Filling mechanics</li>
<li>Add cascading matches + a bonus â€˜has any movesâ€™ function</li>
</ul></div></aside>
<div class="sl-heading-wrapper level-h2"><h2 id="see-it-in-motion">See it in motion</h2><a class="sl-anchor-link" href="#see-it-in-motion"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œSee it in motionâ€</span></a></div>
<p>In part 1, weâ€™ll be making something that looks like this:</p>
<video preload="auto" autoplay controls muted playinsline="true" loop style="max-width:100%; width:auto; margin:auto; display:block;"><source src="/video/tutorials/match3/swap.mp4" type="video/mp4"/></video>
<div class="sl-heading-wrapper level-h2"><h2 id="moving-parts">Moving parts</h2><a class="sl-anchor-link" href="#moving-parts"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œMoving partsâ€</span></a></div>
<p>Letâ€™s think about the game weâ€™re making and decide how weâ€™re going to structure it.
In luxe we have several tools we can use like Modifiers, Prototypes, Scenes and so on, which do we use for this game?</p>
<p>The game consists of:</p>
<ul>
<li>A grid with the state of the game board (logic)</li>
<li>Visuals to represent that grid state</li>
<li>A potential (very simple) hud to display the score</li>
</ul>
<div class="sl-heading-wrapper level-h2"><h2 id="project-phases">Project phases</h2><a class="sl-anchor-link" href="#project-phases"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œProject phasesâ€</span></a></div>
<p>Weâ€™re going to approach this in phases:</p>
<ul>
<li>Weâ€™ll start simple with the logic parts of the game
<ul>
<li>Then we use <code dir="auto">Draw</code> to visualize the state of the board</li>
</ul>
</li>
<li>Then weâ€™ll make it so we can wait on logic to animate changes
<ul>
<li>This will use Wren Fibers - a concept that allows us to pause code logic</li>
</ul>
</li>
<li>Lastly weâ€™ll convert it to use the world systems
<ul>
<li>So we can use Sprite, Anim, and more to make it nicer</li>
</ul>
</li>
</ul>
<p>This should allow us to see a journey from a prototype to a game while keeping the same core concepts.</p>
<div class="sl-heading-wrapper level-h2"><h2 id="create-the-project">Create the project</h2><a class="sl-anchor-link" href="#create-the-project"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œCreate the projectâ€</span></a></div>
<p>Weâ€™ll start this project using the <strong>Empty</strong> project outline.</p>
<p>Letâ€™s delete all the logo code, leaving our game an empty class like this:</p>
<div class="expressive-code"><link rel="stylesheet" href="/next/_astro/ec.9unvh.css"><script type="module" src="/next/_astro/ec.p1z7b.js"></script><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">class</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Game</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#CA9EE6;--1:#8035E0">is</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Ready</span><span style="--0:#C6D0F5;--1:#4C4F69"> {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#E5C890;--1:#8B5912">construct</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">ready</span><span style="--0:#C6D0F5;--1:#4C4F69">() {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">super</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#A6D189;--1:#2D711E">"ready! %(</span><span style="--0:#C6D0F5;--1:#4C4F69">width</span><span style="--0:#A6D189;--1:#2D711E">) x %(</span><span style="--0:#C6D0F5;--1:#4C4F69">height</span><span style="--0:#A6D189;--1:#2D711E">) @ %(</span><span style="--0:#C6D0F5;--1:#4C4F69">scale</span><span style="--0:#A6D189;--1:#2D711E">)x"</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//ready</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">tick</span><span style="--0:#C6D0F5;--1:#4C4F69">(delta: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Input</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">key_state_released</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Key</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">escape)) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">IO</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">shutdown</span><span style="--0:#C6D0F5;--1:#4C4F69">()</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//tick</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//Game</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="class Game is Ready {  construct ready() {    super(&#x22;ready! %(width) x %(height) @ %(scale)x&#x22;)  } //ready  tick(delta: Num) {    if(Input.key_state_released(Key.escape)) {      IO.shutdown()    }  } //tick} //Game"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h2"><h2 id="the-grid-system">The grid system</h2><a class="sl-anchor-link" href="#the-grid-system"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œThe grid systemâ€</span></a></div>
<p>Since we know that our later goal is to use the world systems, weâ€™re going to start by making our grid a modifier.
It could just as well be plain class, but we donâ€™t have to rewrite a lot of stuff over and over.</p>
<p>Whatâ€™s important is thinking about how we work so that we donâ€™t paint ourselves into a corner!</p>
<ol role="list" class="sl-steps">
<li>
<div class="sl-heading-wrapper level-h4"><h4 id="system"><code dir="auto">system/</code></h4><a class="sl-anchor-link" href="#system"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œsystem/â€</span></a></div>
<p>Create an empty <strong>folder</strong> named <code dir="auto">system/</code> in the project folder.</p>
</li>
<li>
<div class="sl-heading-wrapper level-h4"><h4 id="systemgridmodifierwren"><code dir="auto">system/grid.modifier.wren</code></h4><a class="sl-anchor-link" href="#systemgridmodifierwren"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œsystem/grid.modifier.wrenâ€</span></a></div>
<p>Create an empty <strong>file</strong> named <code dir="auto">grid.modifier.wren</code> in the new <code dir="auto">system/</code> folder.</p>
</li>
<li>
<div class="sl-heading-wrapper level-h4"><h4 id="run-the-build">Run the build</h4><a class="sl-anchor-link" href="#run-the-build"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œRun the buildâ€</span></a></div>
<p>This will generate the contents for you to edit.</p>
</li>
<li>
<div class="sl-heading-wrapper level-h4"><h4 id="edit-details">Edit details</h4><a class="sl-anchor-link" href="#edit-details"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œEdit detailsâ€</span></a></div>
<p>We update our system definition with some details.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">#api</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">#display = "</span><ins><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">Match3 Grid</span></ins><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">#desc = "</span><ins><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">**A match 3 grid**. Contains the core logic and grid state of the game</span></ins><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">#icon = "luxe: image/modifier/modifier.svg"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">class</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><ins><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Grid</span></ins><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#CA9EE6;--1:#8035E0">is</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">API</span><span style="--0:#C6D0F5;--1:#4C4F69"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//add public facing API here</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="  #api  #display = &#x22;Match3 Grid&#x22;  #desc = &#x22;**A match 3 grid**. Contains the core logic and grid state of the game&#x22;  #icon = &#x22;luxe: image/modifier/modifier.svg&#x22;  class Grid is API {    //add public facing API here  }"><div></div></button></div></figure></div>
</li>
</ol>
<div class="sl-heading-wrapper level-h2"><h2 id="grid-data">Grid data</h2><a class="sl-anchor-link" href="#grid-data"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œGrid dataâ€</span></a></div>
<p>Now we can think about our Modifier data, what do we need for a match 3 game grid?
If we imagined creating a match3 grid as a modifier and editing the properties, we
can think of settings the user might want to control:</p>
<ul>
<li>A width and height</li>
<li>A number of unique block types the grid can hold</li>
<li>A 2D grid of numbers to store the game state</li>
</ul>
<aside aria-label="Remember!" class="starlight-aside starlight-aside--caution"><p class="starlight-aside__title" aria-hidden="true"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="starlight-aside__icon"><path d="M12 16C11.8022 16 11.6089 16.0587 11.4444 16.1686C11.28 16.2784 11.1518 16.4346 11.0761 16.6173C11.0004 16.8001 10.9806 17.0011 11.0192 17.1951C11.0578 17.3891 11.153 17.5673 11.2929 17.7071C11.4327 17.847 11.6109 17.9422 11.8049 17.9808C11.9989 18.0194 12.2 17.9996 12.3827 17.9239C12.5654 17.8482 12.7216 17.72 12.8315 17.5556C12.9413 17.3911 13 17.1978 13 17C13 16.7348 12.8946 16.4805 12.7071 16.2929C12.5196 16.1054 12.2652 16 12 16ZM22.67 17.47L14.62 3.47003C14.3598 3.00354 13.9798 2.61498 13.5192 2.3445C13.0586 2.07401 12.5341 1.9314 12 1.9314C11.4659 1.9314 10.9414 2.07401 10.4808 2.3445C10.0202 2.61498 9.64019 3.00354 9.38 3.47003L1.38 17.47C1.11079 17.924 0.966141 18.441 0.960643 18.9688C0.955144 19.4966 1.089 20.0166 1.34868 20.4761C1.60837 20.9356 1.9847 21.3185 2.43968 21.5861C2.89466 21.8536 3.41218 21.9964 3.94 22H20.06C20.5921 22.0053 21.1159 21.8689 21.5779 21.6049C22.0399 21.341 22.4234 20.9589 22.689 20.4978C22.9546 20.0368 23.0928 19.5134 23.0895 18.9814C23.0862 18.4493 22.9414 17.9277 22.67 17.47ZM20.94 19.47C20.8523 19.626 20.7245 19.7556 20.5697 19.8453C20.4149 19.935 20.2389 19.9815 20.06 19.98H3.94C3.76111 19.9815 3.5851 19.935 3.43032 19.8453C3.27553 19.7556 3.14765 19.626 3.06 19.47C2.97223 19.318 2.92602 19.1456 2.92602 18.97C2.92602 18.7945 2.97223 18.622 3.06 18.47L11.06 4.47003C11.1439 4.30623 11.2714 4.16876 11.4284 4.07277C11.5855 3.97678 11.766 3.92599 11.95 3.92599C12.134 3.92599 12.3145 3.97678 12.4716 4.07277C12.6286 4.16876 12.7561 4.30623 12.84 4.47003L20.89 18.47C20.9892 18.6199 21.0462 18.7937 21.055 18.9732C21.0638 19.1527 21.0241 19.3312 20.94 19.49V19.47ZM12 8.00003C11.7348 8.00003 11.4804 8.10538 11.2929 8.29292C11.1054 8.48046 11 8.73481 11 9.00003V13C11 13.2652 11.1054 13.5196 11.2929 13.7071C11.4804 13.8947 11.7348 14 12 14C12.2652 14 12.5196 13.8947 12.7071 13.7071C12.8946 13.5196 13 13.2652 13 13V9.00003C13 8.73481 12.8946 8.48046 12.7071 8.29292C12.5196 8.10538 12.2652 8.00003 12 8.00003Z"></path></svg>Remember!</p><div class="starlight-aside__content"><p>Luxe data blocks have special rules and canâ€™t use normal Wren objects!
So we have to think in terms of data block types.</p></div></aside>
<p>For the grid state, weâ€™ll use an array of objects in the block data.
To do that weâ€™ll also define another data block class to use!</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">#block = data</span></div></div><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">class</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#4C4F69"> {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">#doc = "The height of the grid (in cells)"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> width: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">8</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">#doc = "The width of the grid (in cells)"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> height: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">8</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">#doc = "The number of distinct block types"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> block_kinds: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">6</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">#no_inspector</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">#count = 8</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">#type = GridRow</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> rows: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">List</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> []</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">class</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">GridRow</span><span style="--0:#C6D0F5;--1:#4C4F69"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">#count = 8</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">#type = Num</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> columns: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">List</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> []</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#block = dataclass Data {  #doc = &#x22;The height of the grid (in cells)&#x22;  var width: Num = 8  #doc = &#x22;The width of the grid (in cells)&#x22;  var height: Num = 8  #doc = &#x22;The number of distinct block types&#x22;  var block_kinds: Num = 6  #no_inspector  #count = 8  #type = GridRow  var rows: List = []}class GridRow {  #count = 8  #type = Num  var columns: List = []}"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h2"><h2 id="initialize-the-grid-data">Initialize the grid data</h2><a class="sl-anchor-link" href="#initialize-the-grid-data"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œInitialize the grid dataâ€</span></a></div>
<p>Inside <code dir="auto">attach</code> we can initialize our grid data.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">attach</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Entity</span><span style="--0:#C6D0F5;--1:#4C4F69">, data: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Log</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">print</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#A6D189;--1:#2D711E">"attached to `%(</span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Entity</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">name</span><span style="--0:#A6D189;--1:#2D711E">(</span><span style="--0:#C6D0F5;--1:#4C4F69">entity</span><span style="--0:#A6D189;--1:#2D711E">))` `%(</span><span style="--0:#C6D0F5;--1:#4C4F69">entity</span><span style="--0:#A6D189;--1:#2D711E">)` - `%(</span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">This</span><span style="--0:#A6D189;--1:#2D711E">)`"</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">//create the grid data</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">for</span><span style="--0:#C6D0F5;--1:#474a62">(y </span><span style="--0:#cfa8e9;--1:#6429af">in</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#f0a57f;--1:#833305">0</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#81C8BE;--1:#0d5458">...</span><span style="--0:#C6D0F5;--1:#474a62"> data</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">height) {</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> row: </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">GridRow</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> data</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">rows</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">add</span><span style="--0:#C6D0F5;--1:#474a62">()</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#cfa8e9;--1:#6429af">for</span><span style="--0:#C6D0F5;--1:#474a62">(x </span><span style="--0:#cfa8e9;--1:#6429af">in</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#f0a57f;--1:#833305">0</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#81C8BE;--1:#0d5458">...</span><span style="--0:#C6D0F5;--1:#474a62"> data</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">width) {</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">      </span></span><span style="--0:#C6D0F5">row</span></span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">columns</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">add</span><span style="--0:#C6D0F5;--1:#474a62">(</span><span style="--0:#f0a57f;--1:#833305">0</span><span style="--0:#C6D0F5;--1:#474a62">)</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">    </span></span><span style="--0:#C6D0F5">}</span></span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">  </span></span><span style="--0:#C6D0F5">}</span></span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="attach(entity: Entity, data: Data) {  Log.print(&#x22;attached to &#x60;%(Entity.name(entity))&#x60; &#x60;%(entity)&#x60; - &#x60;%(This)&#x60;&#x22;)  //create the grid data  for(y in 0 ... data.height) {    var row: GridRow = data.rows.add()    for(x in 0 ... data.width) {      row.columns.add(0)    }  }}"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h2"><h2 id="visualize-the-grid">Visualize the grid</h2><a class="sl-anchor-link" href="#visualize-the-grid"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œVisualize the gridâ€</span></a></div>
<p>Even though itâ€™s empty, it can still be much easier to reason about our changes if we can visualize them on screen.</p>
<p>To do that weâ€™re going to need a few imports at the top of your <code dir="auto">grid.modifier.wren</code> file:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">import</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#A6D189;--1:#2D711E">"luxe: input"</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Input</span><span style="--0:#C6D0F5;--1:#4C4F69">, </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">MouseButton</span><span style="--0:#C6D0F5;--1:#4C4F69">, </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Key</span></div></div><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">import</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#A6D189;--1:#2D711E">"luxe: draw"</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Draw</span><span style="--0:#C6D0F5;--1:#4C4F69">, </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">PathStyle</span></div></div><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">import</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#A6D189;--1:#2D711E">"luxe: world"</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Camera</span></div></div><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">import</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#A6D189;--1:#2D711E">"luxe: color"</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Color</span></div></div><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">import</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#A6D189;--1:#2D711E">"random"</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Random</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import &#x22;luxe: input&#x22; for Input, MouseButton, Keyimport &#x22;luxe: draw&#x22; for Draw, PathStyleimport &#x22;luxe: world&#x22; for Cameraimport &#x22;luxe: color&#x22; for Colorimport &#x22;random&#x22; for Random"><div></div></button></div></figure></div>
<p>And inside our system, weâ€™ll create a draw context, and a random number generator, and some colors and sizes for debugging the board:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">class</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">System</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#CA9EE6;--1:#8035E0">is</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Modifier</span><span style="--0:#C6D0F5;--1:#4C4F69"> {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> rng: </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Random</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Random</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#cfa8e9;--1:#6429af">new</span><span style="--0:#C6D0F5;--1:#474a62">()</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">//debug visualization</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> draw: </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Draw</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#cfa8e9;--1:#6429af">null</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> style: </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">PathStyle</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">PathStyle</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#cfa8e9;--1:#6429af">new</span><span style="--0:#C6D0F5;--1:#474a62">()</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> grid_left </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#f0a57f;--1:#833305">100</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> grid_bottom </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#f0a57f;--1:#833305">64</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> block_width </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#f0a57f;--1:#833305">64</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> block_height </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#f0a57f;--1:#833305">64</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> colors </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> [</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Color</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">hex_code</span><span style="--0:#C6D0F5;--1:#474a62">( </span><span style="--0:#A6D189;--1:#235817">"#363a4f"</span><span style="--0:#C6D0F5;--1:#474a62"> ), </span><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">//1</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Color</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">hex_code</span><span style="--0:#C6D0F5;--1:#474a62">( </span><span style="--0:#A6D189;--1:#235817">"#8839ef"</span><span style="--0:#C6D0F5;--1:#474a62"> ), </span><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">//2</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Color</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">hex_code</span><span style="--0:#C6D0F5;--1:#474a62">( </span><span style="--0:#A6D189;--1:#235817">"#04a5e5"</span><span style="--0:#C6D0F5;--1:#474a62"> ), </span><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">//3</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Color</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">hex_code</span><span style="--0:#C6D0F5;--1:#474a62">( </span><span style="--0:#A6D189;--1:#235817">"#e64553"</span><span style="--0:#C6D0F5;--1:#474a62"> ), </span><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">//4</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Color</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">hex_code</span><span style="--0:#C6D0F5;--1:#474a62">( </span><span style="--0:#A6D189;--1:#235817">"#40a02b"</span><span style="--0:#C6D0F5;--1:#474a62"> ), </span><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">//5</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Color</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">hex_code</span><span style="--0:#C6D0F5;--1:#474a62">( </span><span style="--0:#A6D189;--1:#235817">"#fa8621"</span><span style="--0:#C6D0F5;--1:#474a62"> ), </span><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">//6</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">  </span></span><span style="--0:#C6D0F5">]</span></span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//required atm</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#E5C890;--1:#8B5912">construct</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#CA9EE6;--1:#8035E0">new</span><span style="--0:#C6D0F5;--1:#4C4F69">(world: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">World</span><span style="--0:#C6D0F5;--1:#4C4F69">) { </span><span style="--0:#CA9EE6;--1:#8035E0">super</span><span style="--0:#C6D0F5;--1:#4C4F69">(world) }</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">init</span><span style="--0:#C6D0F5;--1:#4C4F69">(world: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">World</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Log</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">print</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#A6D189;--1:#2D711E">"init `%(</span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">This</span><span style="--0:#A6D189;--1:#2D711E">)` in world `%(</span><span style="--0:#C6D0F5;--1:#4C4F69">world</span><span style="--0:#A6D189;--1:#2D711E">)`"</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">    </span></span><span style="--0:#C6D0F5">draw </span></span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Draw</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">create</span><span style="--0:#C6D0F5;--1:#474a62">(</span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">World</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">render_set</span><span style="--0:#C6D0F5;--1:#474a62">(world))</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">    </span></span><span style="--0:#C6D0F5">style</span></span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">color </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Color</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">black</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">    </span></span><span style="--0:#C6D0F5">style</span></span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">thickness </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#f0a57f;--1:#833305">4</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="class System is Modifier {  var rng: Random = Random.new()  //debug visualization  var draw: Draw = null  var style: PathStyle = PathStyle.new()  var grid_left = 100  var grid_bottom = 64  var block_width = 64  var block_height = 64  var colors = [    Color.hex_code( &#x22;#363a4f&#x22; ), //1    Color.hex_code( &#x22;#8839ef&#x22; ), //2    Color.hex_code( &#x22;#04a5e5&#x22; ), //3    Color.hex_code( &#x22;#e64553&#x22; ), //4    Color.hex_code( &#x22;#40a02b&#x22; ), //5    Color.hex_code( &#x22;#fa8621&#x22; ), //6  ]  //required atm  construct new(world: World) { super(world) }  init(world: World) {    Log.print(&#x22;init &#x60;%(This)&#x60; in world &#x60;%(world)&#x60;&#x22;)    draw = Draw.create(World.render_set(world))    style.color = Color.black    style.thickness = 4  }"><div></div></button></div></figure></div>
<p>Because we put the # color code there, the code editor (vscode) can show us the color!</p>
<p><img src="/next/_astro/colors.BaXqYq-I_14g89W.webp" alt loading="lazy" decoding="async" fetchpriority="auto" width="577" height="226"></p>
<aside aria-label="Tip" class="starlight-aside starlight-aside--tip"><p class="starlight-aside__title" aria-hidden="true"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="starlight-aside__icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.43909 8.85483L1.44039 8.85354L4.96668 5.33815C5.30653 4.99386 5.7685 4.79662 6.2524 4.78972L6.26553 4.78963L12.9014 4.78962L13.8479 3.84308C16.9187 0.772319 20.0546 0.770617 21.4678 0.975145C21.8617 1.02914 22.2271 1.21053 22.5083 1.4917C22.7894 1.77284 22.9708 2.13821 23.0248 2.53199C23.2294 3.94517 23.2278 7.08119 20.1569 10.1521L19.2107 11.0983V17.7338L19.2106 17.7469C19.2037 18.2308 19.0067 18.6933 18.6624 19.0331L15.1456 22.5608C14.9095 22.7966 14.6137 22.964 14.29 23.0449C13.9663 23.1259 13.6267 23.1174 13.3074 23.0204C12.9881 22.9235 12.7011 22.7417 12.4771 22.4944C12.2533 22.2473 12.1006 21.9441 12.0355 21.6171L11.1783 17.3417L6.65869 12.822L4.34847 12.3589L2.38351 11.965C2.05664 11.8998 1.75272 11.747 1.50564 11.5232C1.25835 11.2992 1.07653 11.0122 0.979561 10.6929C0.882595 10.3736 0.874125 10.034 0.955057 9.7103C1.03599 9.38659 1.20328 9.09092 1.43909 8.85483ZM6.8186 10.8724L2.94619 10.096L6.32006 6.73268H10.9583L6.8186 10.8724ZM15.2219 5.21703C17.681 2.75787 20.0783 2.75376 21.1124 2.8876C21.2462 3.92172 21.2421 6.31895 18.783 8.77812L12.0728 15.4883L8.51172 11.9272L15.2219 5.21703ZM13.9042 21.0538L13.1279 17.1811L17.2676 13.0414V17.68L13.9042 21.0538Z"></path><path d="M9.31827 18.3446C9.45046 17.8529 9.17864 17.3369 8.68945 17.1724C8.56178 17.1294 8.43145 17.1145 8.30512 17.1243C8.10513 17.1398 7.91519 17.2172 7.76181 17.3434C7.62613 17.455 7.51905 17.6048 7.45893 17.7835C6.97634 19.2186 5.77062 19.9878 4.52406 20.4029C4.08525 20.549 3.6605 20.644 3.29471 20.7053C3.35607 20.3395 3.45098 19.9148 3.59711 19.476C4.01221 18.2294 4.78141 17.0237 6.21648 16.5411C6.39528 16.481 6.54504 16.3739 6.65665 16.2382C6.85126 16.0016 6.92988 15.678 6.84417 15.3647C6.83922 15.3466 6.83373 15.3286 6.82767 15.3106C6.74106 15.053 6.55701 14.8557 6.33037 14.7459C6.10949 14.6389 5.84816 14.615 5.59715 14.6994C5.47743 14.7397 5.36103 14.7831 5.24786 14.8294C3.22626 15.6569 2.2347 17.4173 1.75357 18.8621C1.49662 19.6337 1.36993 20.3554 1.30679 20.8818C1.27505 21.1464 1.25893 21.3654 1.25072 21.5213C1.24662 21.5993 1.24448 21.6618 1.24337 21.7066L1.243 21.7226L1.24235 21.7605L1.2422 21.7771L1.24217 21.7827L1.24217 21.7856C1.24217 22.3221 1.67703 22.7579 2.2137 22.7579L2.2155 22.7579L2.22337 22.7578L2.23956 22.7577C2.25293 22.7575 2.27096 22.7572 2.29338 22.7567C2.33821 22.7555 2.40073 22.7534 2.47876 22.7493C2.63466 22.7411 2.85361 22.725 3.11822 22.6932C3.64462 22.6301 4.36636 22.5034 5.13797 22.2464C6.58274 21.7653 8.3431 20.7738 9.17063 18.7522C9.21696 18.639 9.26037 18.5226 9.30064 18.4029C9.30716 18.3835 9.31304 18.364 9.31827 18.3446Z"></path></svg>Tip</p><div class="starlight-aside__content"><p>These colors come from the catppuccin palettes: <a href="https://catppuccin.com/palette/">https://catppuccin.com/palette/</a></p></div></aside>
<div class="sl-heading-wrapper level-h3"><h3 id="fill-the-grid-with-random-values">Fill the grid with random values</h3><a class="sl-anchor-link" href="#fill-the-grid-with-random-values"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œFill the grid with random valuesâ€</span></a></div>
<p>In our <code dir="auto">attach</code> we can change the <code dir="auto">0</code> we used to a random value:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69">(y </span><span style="--0:#CA9EE6;--1:#8035E0">in</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">...</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">height) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> row: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">GridRow</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">rows</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">add</span><span style="--0:#C6D0F5;--1:#4C4F69">()</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69">(x </span><span style="--0:#CA9EE6;--1:#8035E0">in</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">...</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">width) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">row</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">columns</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">add</span><span style="--0:#C6D0F5;--1:#4C4F69">( </span><ins><span style="--0:#f0a57f;--1:#833305">1</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#81C8BE;--1:#0d5458">+</span><span style="--0:#C6D0F5;--1:#474a62"> rng</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">int</span><span style="--0:#C6D0F5;--1:#474a62">(data</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">block_kinds)</span></ins><span style="--0:#C6D0F5;--1:#4C4F69"> )</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="for(y in 0 ... data.height) {  var row: GridRow = data.rows.add()  for(x in 0 ... data.width) {    row.columns.add( 1 + rng.int(data.block_kinds) )  }}"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="draw-the-grid">Draw the grid</h3><a class="sl-anchor-link" href="#draw-the-grid"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œDraw the gridâ€</span></a></div>
<p>Letâ€™s create a helper function to convert the grid coordinate spaces to world space.</p>
<p>Somewhere in your <code dir="auto">System</code> class add these two functions:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">world_to_grid</span><span style="--0:#C6D0F5;--1:#4C4F69">(data: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#4C4F69">, x: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">, y: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> grid_h </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">height </span><span style="--0:#81C8BE;--1:#116E73">*</span><span style="--0:#C6D0F5;--1:#4C4F69"> block_height</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> grid_x </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> ((x </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> grid_left) </span><span style="--0:#81C8BE;--1:#116E73">/</span><span style="--0:#C6D0F5;--1:#4C4F69"> block_width)</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">floor</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> grid_y </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> ((y </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> grid_bottom) </span><span style="--0:#81C8BE;--1:#116E73">/</span><span style="--0:#C6D0F5;--1:#4C4F69"> block_height)</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">floor</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//now invert the Y because we were in y+ up world</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">grid_y </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> (data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">height </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">1</span><span style="--0:#C6D0F5;--1:#4C4F69">) </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> grid_y</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">return</span><span style="--0:#C6D0F5;--1:#4C4F69"> [grid_x, grid_y]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">grid_to_world</span><span style="--0:#C6D0F5;--1:#4C4F69">(data: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#4C4F69">, x: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">, y: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//we subtract because y+ is up,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//and we add 1 because we want the bottom left</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//(not top left) for world space!</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">return</span><span style="--0:#C6D0F5;--1:#4C4F69"> [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">grid_left </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">+</span><span style="--0:#C6D0F5;--1:#4C4F69"> (x </span><span style="--0:#81C8BE;--1:#116E73">*</span><span style="--0:#C6D0F5;--1:#4C4F69"> block_width),</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">grid_bottom </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">+</span><span style="--0:#C6D0F5;--1:#4C4F69"> ((data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">height </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> y </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">1</span><span style="--0:#C6D0F5;--1:#4C4F69">) </span><span style="--0:#81C8BE;--1:#116E73">*</span><span style="--0:#C6D0F5;--1:#4C4F69"> block_height)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="world_to_grid(data: Data, x: Num, y: Num) {  var grid_h = data.height * block_height  var grid_x = ((x - grid_left) / block_width).floor  var grid_y = ((y - grid_bottom) / block_height).floor  //now invert the Y because we were in y+ up world  grid_y = (data.height - 1) - grid_y  return [grid_x, grid_y]}grid_to_world(data: Data, x: Num, y: Num) {  //we subtract because y+ is up,  //and we add 1 because we want the bottom left  //(not top left) for world space!  return [    grid_left + (x * block_width),    grid_bottom + ((data.height - y - 1) * block_height)  ]}"><div></div></button></div></figure></div>
<p>Now we can jump to our <code dir="auto">tick</code> method, and using <code dir="auto">Draw</code> we can draw the state of the grid.
This requires looping over the grid, first along the rows (y) and then across the columns (x).
We can then fetch the random value from the grid, use it to pick the color, and draw a box.</p>
<aside aria-label="Note" class="starlight-aside starlight-aside--note"><p class="starlight-aside__title" aria-hidden="true"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="starlight-aside__icon"><path d="M12 11C11.7348 11 11.4804 11.1054 11.2929 11.2929C11.1054 11.4804 11 11.7348 11 12V16C11 16.2652 11.1054 16.5196 11.2929 16.7071C11.4804 16.8946 11.7348 17 12 17C12.2652 17 12.5196 16.8946 12.7071 16.7071C12.8946 16.5196 13 16.2652 13 16V12C13 11.7348 12.8946 11.4804 12.7071 11.2929C12.5196 11.1054 12.2652 11 12 11ZM12.38 7.08C12.1365 6.97998 11.8635 6.97998 11.62 7.08C11.4973 7.12759 11.3851 7.19896 11.29 7.29C11.2017 7.3872 11.1306 7.49882 11.08 7.62C11.024 7.73868 10.9966 7.86882 11 8C10.9992 8.13161 11.0245 8.26207 11.0742 8.38391C11.124 8.50574 11.1973 8.61656 11.29 8.71C11.3872 8.79833 11.4988 8.86936 11.62 8.92C11.7715 8.98224 11.936 9.00632 12.099 8.99011C12.2619 8.97391 12.4184 8.91792 12.5547 8.82707C12.691 8.73622 12.8029 8.61328 12.8805 8.46907C12.9582 8.32486 12.9992 8.16378 13 8C12.9963 7.73523 12.8927 7.48163 12.71 7.29C12.6149 7.19896 12.5028 7.12759 12.38 7.08ZM12 2C10.0222 2 8.08879 2.58649 6.4443 3.6853C4.79981 4.78412 3.51809 6.3459 2.76121 8.17317C2.00433 10.0004 1.8063 12.0111 2.19215 13.9509C2.578 15.8907 3.53041 17.6725 4.92894 19.0711C6.32746 20.4696 8.10929 21.422 10.0491 21.8079C11.9889 22.1937 13.9996 21.9957 15.8268 21.2388C17.6541 20.4819 19.2159 19.2002 20.3147 17.5557C21.4135 15.9112 22 13.9778 22 12C22 10.6868 21.7413 9.38642 21.2388 8.17317C20.7363 6.95991 19.9997 5.85752 19.0711 4.92893C18.1425 4.00035 17.0401 3.26375 15.8268 2.7612C14.6136 2.25866 13.3132 2 12 2ZM12 20C10.4178 20 8.87104 19.5308 7.55544 18.6518C6.23985 17.7727 5.21447 16.5233 4.60897 15.0615C4.00347 13.5997 3.84504 11.9911 4.15372 10.4393C4.4624 8.88743 5.22433 7.46197 6.34315 6.34315C7.46197 5.22433 8.88743 4.4624 10.4393 4.15372C11.9911 3.84504 13.5997 4.00346 15.0615 4.60896C16.5233 5.21447 17.7727 6.23984 18.6518 7.55544C19.5308 8.87103 20 10.4177 20 12C20 14.1217 19.1572 16.1566 17.6569 17.6569C16.1566 19.1571 14.1217 20 12 20Z"></path></svg>Note</p><div class="starlight-aside__content"><p>Weâ€™ll add shapes soon so itâ€™s easier to distinguish without color alone.</p></div></aside>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">tick</span><span style="--0:#C6D0F5;--1:#4C4F69">(delta: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">  </span></span><span style="--0:#C6D0F5">each {</span></span><span style="--0:#eca4a7;--0fs:italic;--1:#8a2932;--1fs:italic">|entity: Entity, data: Data|</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#cfa8e9;--1:#6429af">for</span><span style="--0:#C6D0F5;--1:#474a62">(y </span><span style="--0:#cfa8e9;--1:#6429af">in</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#f0a57f;--1:#833305">0</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#81C8BE;--1:#0d5458">...</span><span style="--0:#C6D0F5;--1:#474a62"> data</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">height) {</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">      </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> row: </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">GridRow</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> data</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">rows[y]</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">      </span><span style="--0:#cfa8e9;--1:#6429af">for</span><span style="--0:#C6D0F5;--1:#474a62">(x </span><span style="--0:#cfa8e9;--1:#6429af">in</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#f0a57f;--1:#833305">0</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#81C8BE;--1:#0d5458">...</span><span style="--0:#C6D0F5;--1:#474a62"> data</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">width) {</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">        </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> kind </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> row</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">columns[x]</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">        </span><span style="--0:#cfa8e9;--1:#6429af">if</span><span style="--0:#C6D0F5;--1:#474a62">(kind </span><span style="--0:#81C8BE;--1:#0d5458">==</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#f0a57f;--1:#833305">0</span><span style="--0:#C6D0F5;--1:#474a62">) </span><span style="--0:#cfa8e9;--1:#6429af">continue</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">        </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> color </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> colors[kind </span><span style="--0:#81C8BE;--1:#0d5458">-</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#f0a57f;--1:#833305">1</span><span style="--0:#C6D0F5;--1:#474a62">]</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">        </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> pos </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">grid_to_world</span><span style="--0:#C6D0F5;--1:#474a62">(data, x, y)</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">        </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Draw</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">quad</span><span style="--0:#C6D0F5;--1:#474a62">(draw, pos</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">x, pos</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">y, </span><span style="--0:#f0a57f;--1:#833305">0</span><span style="--0:#C6D0F5;--1:#474a62">, block_width, block_height, </span><span style="--0:#f0a57f;--1:#833305">0</span><span style="--0:#C6D0F5;--1:#474a62">, color)</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">      </span></span><span style="--0:#C6D0F5">} </span></span><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">//each column</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">    </span></span><span style="--0:#C6D0F5">} </span></span><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">//each row</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">  </span></span><span style="--0:#C6D0F5">} </span></span><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">//each entity</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Draw</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">commit</span><span style="--0:#C6D0F5;--1:#474a62">(draw)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="tick(delta: Num) {  each {|entity: Entity, data: Data|    for(y in 0 ... data.height) {      var row: GridRow = data.rows[y]      for(x in 0 ... data.width) {        var kind = row.columns[x]        if(kind == 0) continue        var color = colors[kind - 1]        var pos = grid_to_world(data, x, y)        Draw.quad(draw, pos.x, pos.y, 0, block_width, block_height, 0, color)      } //each column    } //each row  } //each entity  Draw.commit(draw)}"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h2"><h2 id="adding-an-instance-in-gamewren">Adding an instance in <code dir="auto">game.wren</code></h2><a class="sl-anchor-link" href="#adding-an-instance-in-gamewren"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œAdding an instance in game.wrenâ€</span></a></div>
<p>If we ran thisâ€¦ there would be nothing shown. Thatâ€™s because we never attached our modifier to an Entity.</p>
<p>Inside <code dir="auto">game.wren</code> weâ€™ll import and create a grid instance.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line highlight ins"><div class="code"><span style="--0:#cfa8e9;--1:#6429af">import</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#A6D189;--1:#235817">"system/grid.modifier"</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#cfa8e9;--1:#6429af">for</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Grid</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">class</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Game</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#CA9EE6;--1:#8035E0">is</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Ready</span><span style="--0:#C6D0F5;--1:#4C4F69"> {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> grid: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Entity</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Entity</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">none</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#E5C890;--1:#8B5912">construct</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">ready</span><span style="--0:#C6D0F5;--1:#4C4F69">() {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">super</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#A6D189;--1:#2D711E">"ready! %(</span><span style="--0:#C6D0F5;--1:#4C4F69">width</span><span style="--0:#A6D189;--1:#2D711E">) x %(</span><span style="--0:#C6D0F5;--1:#4C4F69">height</span><span style="--0:#A6D189;--1:#2D711E">) @ %(</span><span style="--0:#C6D0F5;--1:#4C4F69">scale</span><span style="--0:#A6D189;--1:#2D711E">)x"</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">    </span></span><span style="--0:#C6D0F5">grid </span></span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Entity</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">create</span><span style="--0:#C6D0F5;--1:#474a62">(world, </span><span style="--0:#A6D189;--1:#235817">"grid"</span><span style="--0:#C6D0F5;--1:#474a62">)</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Grid</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">create</span><span style="--0:#C6D0F5;--1:#474a62">(grid)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//ready</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#81C8BE;--1:#116E73">...</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//Game</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import &#x22;system/grid.modifier&#x22; for Gridclass Game is Ready {  var grid: Entity = Entity.none  construct ready() {    super(&#x22;ready! %(width) x %(height) @ %(scale)x&#x22;)    grid = Entity.create(world, &#x22;grid&#x22;)    Grid.create(grid)  } //ready  ...} //Game"><div></div></button></div></figure></div>
<p>Now if we run the game, we can see that it shows a grid of random colors!</p>
<p><img src="/next/_astro/grid.random.TWnX4Fm__Z2vgg2b.webp" alt loading="lazy" decoding="async" fetchpriority="auto" width="1200" height="800"></p>
<div class="sl-heading-wrapper level-h2"><h2 id="fill-the-grid-nicely">Fill the grid nicely</h2><a class="sl-anchor-link" href="#fill-the-grid-nicely"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œFill the grid nicelyâ€</span></a></div>
<p>Thereâ€™s an interesting issue that comes up with randomness, is that things can repeat.
In a match 3, the starting grid ideally shouldnâ€™t already have matches.</p>
<p>If we look at our image, it has quite a few!</p>
<p>Letâ€™s fix that.</p>
<div class="sl-heading-wrapper level-h3"><h3 id="grid-helper-functions">Grid helper functions</h3><a class="sl-anchor-link" href="#grid-helper-functions"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œGrid helper functionsâ€</span></a></div>
<p>Before we continue, letâ€™s add a few helper functions to make our grid logic easier.
Add these functions to your <code dir="auto">System</code> class. Each one should be self explanatory!</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">in_grid</span><span style="--0:#C6D0F5;--1:#4C4F69">(data: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#4C4F69">, x: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">, y: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">) : </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Bool</span><span style="--0:#C6D0F5;--1:#4C4F69"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(x </span><span style="--0:#81C8BE;--1:#116E73">&#x3C;</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">||</span><span style="--0:#C6D0F5;--1:#4C4F69"> x </span><span style="--0:#81C8BE;--1:#116E73">>=</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">width) </span><span style="--0:#CA9EE6;--1:#8035E0">return</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#A6D189;--1:#2D711E">false</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(y </span><span style="--0:#81C8BE;--1:#116E73">&#x3C;</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">||</span><span style="--0:#C6D0F5;--1:#4C4F69"> y </span><span style="--0:#81C8BE;--1:#116E73">>=</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">height) </span><span style="--0:#CA9EE6;--1:#8035E0">return</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#A6D189;--1:#2D711E">false</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">return</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#A6D189;--1:#2D711E">true</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">set_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#4C4F69">, x: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">, y: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">, kind: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">) : </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Bool</span><span style="--0:#C6D0F5;--1:#4C4F69"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">!in_grid</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x, y)) </span><span style="--0:#CA9EE6;--1:#8035E0">return</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#A6D189;--1:#2D711E">false</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> row: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">GridRow</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">rows[y]</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">row</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">columns[x] </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> kind</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">return</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#A6D189;--1:#2D711E">true</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">get_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#4C4F69">, x: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">, y: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">) : </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">!in_grid</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x, y)) </span><span style="--0:#CA9EE6;--1:#8035E0">return</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#A6D189;--1:#2D711E">false</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> row: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">GridRow</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">rows[y]</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">return</span><span style="--0:#C6D0F5;--1:#4C4F69"> row</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">columns[x]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">is_adjacent</span><span style="--0:#C6D0F5;--1:#4C4F69">(x1: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">, y1: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">, x2: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">, y2: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">) : </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Bool</span><span style="--0:#C6D0F5;--1:#4C4F69"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> dx </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> (x1 </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> x2)</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">abs</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> dy </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> (y1 </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> y2)</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">abs</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">return</span><span style="--0:#C6D0F5;--1:#4C4F69"> (dx </span><span style="--0:#81C8BE;--1:#116E73">==</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">1</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">&#x26;&#x26;</span><span style="--0:#C6D0F5;--1:#4C4F69"> dy </span><span style="--0:#81C8BE;--1:#116E73">==</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">) </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">||</span><span style="--0:#C6D0F5;--1:#4C4F69"> (dx </span><span style="--0:#81C8BE;--1:#116E73">==</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">&#x26;&#x26;</span><span style="--0:#C6D0F5;--1:#4C4F69"> dy </span><span style="--0:#81C8BE;--1:#116E73">==</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">1</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="in_grid(data: Data, x: Num, y: Num) : Bool {  if(x < 0 || x >= data.width) return false  if(y < 0 || y >= data.height) return false  return true}set_cell(data: Data, x: Num, y: Num, kind: Num) : Bool {  if(!in_grid(data, x, y)) return false  var row: GridRow = data.rows[y]  row.columns[x] = kind  return true}get_cell(data: Data, x: Num, y: Num) : Num {  if(!in_grid(data, x, y)) return false  var row: GridRow = data.rows[y]  return row.columns[x]}is_adjacent(x1: Num, y1: Num, x2: Num, y2: Num) : Bool {  var dx = (x1 - x2).abs  var dy = (y1 - y2).abs  return (dx == 1 &#x26;&#x26; dy == 0) || (dx == 0 &#x26;&#x26; dy == 1)}"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="resetting-the-grid-safely">Resetting the grid safely</h3><a class="sl-anchor-link" href="#resetting-the-grid-safely"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œResetting the grid safelyâ€</span></a></div>
<p>Letâ€™s make a <code dir="auto">reset_grid</code> function that will try to fill it without matches.</p>
<p>First weâ€™re going to change our <code dir="auto">attach</code> method. Put the 0 back as the default value, and then add a call to <code dir="auto">reset_grid</code>.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">attach</span><span style="--0:#C6D0F5;--1:#4C4F69">(entity: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Entity</span><span style="--0:#C6D0F5;--1:#4C4F69">, data: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Log</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">print</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#A6D189;--1:#2D711E">"attached to `%(</span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Entity</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">name</span><span style="--0:#A6D189;--1:#2D711E">(</span><span style="--0:#C6D0F5;--1:#4C4F69">entity</span><span style="--0:#A6D189;--1:#2D711E">))` `%(</span><span style="--0:#C6D0F5;--1:#4C4F69">entity</span><span style="--0:#A6D189;--1:#2D711E">)` - `%(</span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">This</span><span style="--0:#A6D189;--1:#2D711E">)`"</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//create the grid data</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69">(y </span><span style="--0:#CA9EE6;--1:#8035E0">in</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">...</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">height) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> row: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">GridRow</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">rows</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">add</span><span style="--0:#C6D0F5;--1:#4C4F69">()</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69">(x </span><span style="--0:#CA9EE6;--1:#8035E0">in</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">...</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">width) {</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">       </span></span><span style="--0:#C6D0F5">row</span></span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">columns</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">add</span><ins><span style="--0:#C6D0F5;--1:#3e4055">(</span><span style="--0:#f3b799;--1:#732d05">0</span><span style="--0:#C6D0F5;--1:#3e4055">)</span></ins></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">   </span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">reset_grid</span><span style="--0:#C6D0F5;--1:#474a62">(data)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="attach(entity: Entity, data: Data) {  Log.print(&#x22;attached to &#x60;%(Entity.name(entity))&#x60; &#x60;%(entity)&#x60; - &#x60;%(This)&#x60;&#x22;)  //create the grid data  for(y in 0 ... data.height) {    var row: GridRow = data.rows.add()    for(x in 0 ... data.width) {       row.columns.add(0)    }  }   reset_grid(data)}"><div></div></button></div></figure></div>
<p>Then we can make a <code dir="auto">fill_grid</code> function, adding it to our <code dir="auto">System</code> class.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">reset_grid</span><span style="--0:#C6D0F5;--1:#4C4F69">(data: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69"> (y </span><span style="--0:#CA9EE6;--1:#8035E0">in</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">...</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">height) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69"> (x </span><span style="--0:#CA9EE6;--1:#8035E0">in</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">...</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">width) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> kind </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">safe_tile</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x, y)</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">set_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x, y, kind)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="reset_grid(data: Data) {  for (y in 0 ... data.height) {    for (x in 0 ... data.width) {      var kind = safe_tile(data, x, y)      set_cell(data, x, y, kind)    }  }}"><div></div></button></div></figure></div>
<p>And finally weâ€™ll need that <code dir="auto">safe_tile</code> function.</p>
<p>Because weâ€™re filling the grid in one row at a time, and one column at a time,
we can look to our left and above to check if thereâ€™s a match. If there is, we try another kind.
We repeat that up to 10 times, and if we fail, then thatâ€™s fine.</p>
<p>Add this to your <code dir="auto">System</code> class as well:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//Safe tile prevents filling the grid with matches</span></div></div><div class="ec-line"><div class="code"><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//by checking for matches while choosing a random kind</span></div></div><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">safe_tile</span><span style="--0:#C6D0F5;--1:#4C4F69">(data: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#4C4F69">, x: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">, y: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//pick a random kind to start</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> kind </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> rng</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">int</span><span style="--0:#C6D0F5;--1:#4C4F69">(data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">block_kinds) </span><span style="--0:#81C8BE;--1:#116E73">+</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">1</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> tries </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">while</span><span style="--0:#C6D0F5;--1:#4C4F69"> (tries </span><span style="--0:#81C8BE;--1:#116E73">&#x3C;</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">10</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> match </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#A6D189;--1:#2D711E">false</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// check for horizontal matches</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(x </span><span style="--0:#81C8BE;--1:#116E73">>=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">2</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> left1 </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">get_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">1</span><span style="--0:#C6D0F5;--1:#4C4F69">, y)</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> left2 </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">get_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">2</span><span style="--0:#C6D0F5;--1:#4C4F69">, y)</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69"> (left1 </span><span style="--0:#81C8BE;--1:#116E73">==</span><span style="--0:#C6D0F5;--1:#4C4F69"> kind </span><span style="--0:#81C8BE;--1:#116E73">&#x26;&#x26;</span><span style="--0:#C6D0F5;--1:#4C4F69"> left2 </span><span style="--0:#81C8BE;--1:#116E73">==</span><span style="--0:#C6D0F5;--1:#4C4F69"> kind) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">        </span></span><span style="--0:#C6D0F5;--1:#4C4F69">match </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#A6D189;--1:#2D711E">true</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">      </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// check for vertical match</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69"> (y </span><span style="--0:#81C8BE;--1:#116E73">>=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">2</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> above1 </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">get_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x, y </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">1</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> above2 </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">get_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x, y </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">2</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(above1 </span><span style="--0:#81C8BE;--1:#116E73">==</span><span style="--0:#C6D0F5;--1:#4C4F69"> kind </span><span style="--0:#81C8BE;--1:#116E73">&#x26;&#x26;</span><span style="--0:#C6D0F5;--1:#4C4F69"> above2 </span><span style="--0:#81C8BE;--1:#116E73">==</span><span style="--0:#C6D0F5;--1:#4C4F69"> kind) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">        </span></span><span style="--0:#C6D0F5;--1:#4C4F69">match </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#A6D189;--1:#2D711E">true</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">      </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// no matches, this is a safe kind to create at this position</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69"> (</span><span style="--0:#81C8BE;--1:#116E73">!</span><span style="--0:#C6D0F5;--1:#4C4F69">match) </span><span style="--0:#CA9EE6;--1:#8035E0">return</span><span style="--0:#C6D0F5;--1:#4C4F69"> kind</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// if not safe, try again</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">kind </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> rng</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">int</span><span style="--0:#C6D0F5;--1:#4C4F69">(data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">block_kinds) </span><span style="--0:#81C8BE;--1:#116E73">+</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">1</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">tries </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> tries </span><span style="--0:#81C8BE;--1:#116E73">+</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">1</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//if we run out of tries, just return it anyway</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">return</span><span style="--0:#C6D0F5;--1:#4C4F69"> kind</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//safe_tile</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="//Safe tile prevents filling the grid with matches//by checking for matches while choosing a random kindsafe_tile(data: Data, x: Num, y: Num) {  //pick a random kind to start  var kind = rng.int(data.block_kinds) + 1  var tries = 0  while (tries < 10) {    var match = false    // check for horizontal matches    if(x >= 2) {      var left1 = get_cell(data, x - 1, y)      var left2 = get_cell(data, x - 2, y)      if (left1 == kind &#x26;&#x26; left2 == kind) {        match = true      }    }    // check for vertical match    if (y >= 2) {      var above1 = get_cell(data, x, y - 1)      var above2 = get_cell(data, x, y - 2)      if(above1 == kind &#x26;&#x26; above2 == kind) {        match = true      }    }    // no matches, this is a safe kind to create at this position    if (!match) return kind    // if not safe, try again    kind = rng.int(data.block_kinds) + 1    tries = tries + 1  }  //if we run out of tries, just return it anyway  return kind} //safe_tile"><div></div></button></div></figure></div>
<p>Thatâ€™s much better! Thereâ€™s no visible matches at the start of our grid.</p>
<p><img src="/next/_astro/grid.better._mYy0MOP_2t4SoH.webp" alt loading="lazy" decoding="async" fetchpriority="auto" width="1200" height="800"></p>
<div class="sl-heading-wrapper level-h2"><h2 id="shapes--color">Shapes + Color</h2><a class="sl-anchor-link" href="#shapes--color"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œShapes + Colorâ€</span></a></div>
<p>Color alone isnâ€™t always enough information. Some people canâ€™t percieve all colors, and sometimes they are a bit too similar and hard to tell apart.</p>
<p>What we can do is draw shapes instead, which will make it a lot easier to see whatâ€™s going on.</p>
<p>Alongside our list of colors, we can add a list of sides. A triangle has 3 sides, a square has 4, and so on. We use 32 to approximate a circle for now.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> block_height </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">64</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent"> </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> sides </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> [</span><span style="--0:#f0a57f;--1:#833305">32</span><span style="--0:#C6D0F5;--1:#474a62">, </span><span style="--0:#f0a57f;--1:#833305">3</span><span style="--0:#C6D0F5;--1:#474a62">, </span><span style="--0:#f0a57f;--1:#833305">4</span><span style="--0:#C6D0F5;--1:#474a62">, </span><span style="--0:#f0a57f;--1:#833305">5</span><span style="--0:#C6D0F5;--1:#474a62">, </span><span style="--0:#f0a57f;--1:#833305">6</span><span style="--0:#C6D0F5;--1:#474a62">, </span><span style="--0:#f0a57f;--1:#833305">32</span><span style="--0:#C6D0F5;--1:#474a62">]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> colors </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> [</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="var block_height = 64 var sides = [32, 3, 4, 5, 6, 32]var colors = ["><div></div></button></div></figure></div>
<p>Change the drawing code inside of <code dir="auto">tick</code> to this instead:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> pos </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">grid_to_world</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x, y)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> color </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> colors[kind </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">1</span><span style="--0:#C6D0F5;--1:#4C4F69">]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> sides </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> sides[kind </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">1</span><span style="--0:#C6D0F5;--1:#4C4F69">]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> half_width </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> block_width </span><span style="--0:#81C8BE;--1:#116E73">/</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">2</span></div></div><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> half_height </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> block_height </span><span style="--0:#81C8BE;--1:#116E73">/</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">2</span></div></div><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> radius_x </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> half_width </span><span style="--0:#81C8BE;--1:#116E73">*</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0.9</span></div></div><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> radius_y </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> half_height </span><span style="--0:#81C8BE;--1:#116E73">*</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0.9</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Draw</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">ngon_solid</span><span style="--0:#C6D0F5;--1:#4C4F69">(draw, pos</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">x </span><span style="--0:#81C8BE;--1:#116E73">+</span><span style="--0:#C6D0F5;--1:#4C4F69"> half_width, pos</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">y </span><span style="--0:#81C8BE;--1:#116E73">+</span><span style="--0:#C6D0F5;--1:#4C4F69"> half_height, </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">, radius_x, radius_y, sides, </span><span style="--0:#EF9F76;--1:#AB4307">90</span><span style="--0:#C6D0F5;--1:#4C4F69">, color)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="var pos = grid_to_world(data, x, y)var color = colors[kind - 1]var sides = sides[kind - 1]var half_width = block_width / 2var half_height = block_height / 2var radius_x = half_width * 0.9var radius_y = half_height * 0.9Draw.ngon_solid(draw, pos.x + half_width, pos.y + half_height, 0, radius_x, radius_y, sides, 90, color)"><div></div></button></div></figure></div>
<p><img src="/next/_astro/grid.shapes.CwIA7Yym_ZvWn88.webp" alt loading="lazy" decoding="async" fetchpriority="auto" width="1200" height="800"></p>
<p>Thatâ€™s starting to look like a game. Letâ€™s get started on the game logic!</p>
<div class="sl-heading-wrapper level-h2"><h2 id="debug-input">Debug input</h2><a class="sl-anchor-link" href="#debug-input"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œDebug inputâ€</span></a></div>
<p>In order to test the game logic, we really should have the ability to affect the game.</p>
<p>Weâ€™ll do that by using the mouse to interact with the game.
When we click, itâ€™ll mark the cell as selected, and when we click an adjacent cell, it will swap them.</p>
<div class="sl-heading-wrapper level-h3"><h3 id="mouse-conversions">Mouse conversions</h3><a class="sl-anchor-link" href="#mouse-conversions"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œMouse conversionsâ€</span></a></div>
<p>The start weâ€™ll draw a mouse cursor on the grid.
We have to convert between a few spaces here:</p>
<ul>
<li>From window space (<code dir="auto">Input.mouse_x()</code>) to world space (using Camera)</li>
<li>Then from world space to grid space</li>
<li>And to draw it, from grid space back to world space</li>
</ul>
<p>We also make sure we track if itâ€™s inside the grid, because we donâ€™t need to interact outside of it.</p>
<p>Add the code to <code dir="auto">tick</code> like this:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">tick</span><span style="--0:#C6D0F5;--1:#4C4F69">(delta: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> mouse </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Camera</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">screen_point_to_world</span><span style="--0:#C6D0F5;--1:#474a62">(</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Camera</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">get_default</span><span style="--0:#C6D0F5;--1:#474a62">(world),</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Input</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">mouse_x</span><span style="--0:#C6D0F5;--1:#474a62">(),</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Input</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">mouse_y</span><span style="--0:#C6D0F5;--1:#474a62">())</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">each {</span><span style="--0:#EA999C;--0fs:italic;--1:#B43641;--1fs:italic">|entity: Entity, data: Data|</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> grid_mouse </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">world_to_grid</span><span style="--0:#C6D0F5;--1:#474a62">(data, mouse</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">x, mouse</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">y)</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> valid_mouse </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">in_grid</span><span style="--0:#C6D0F5;--1:#474a62">(data, grid_mouse</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">x, grid_mouse</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">y)</span></div></div><div class="ec-line highlight ins"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#cfa8e9;--1:#6429af">if</span><span style="--0:#C6D0F5;--1:#474a62">(valid_mouse) {</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">      </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> mouse_draw_pos </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">grid_to_world</span><span style="--0:#C6D0F5;--1:#474a62">(data, grid_mouse</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">x, grid_mouse</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">y)</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">      </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Draw</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">rect</span><span style="--0:#C6D0F5;--1:#474a62">(draw,</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">        </span></span><span style="--0:#C6D0F5">mouse_draw_pos</span></span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">x, mouse_draw_pos</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">y, </span><span style="--0:#f0a57f;--1:#833305">0</span><span style="--0:#C6D0F5;--1:#474a62">,</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">        </span></span><span style="--0:#C6D0F5">block_width, block_height, </span></span><span style="--0:#f0a57f;--1:#833305">0</span><span style="--0:#C6D0F5;--1:#474a62">, style)</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">    </span></span><span style="--0:#C6D0F5">}</span></span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69">(y </span><span style="--0:#CA9EE6;--1:#8035E0">in</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">...</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">height) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#81C8BE;--1:#116E73">...</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//existing code</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//each row</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//each entity</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Draw</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">commit</span><span style="--0:#C6D0F5;--1:#4C4F69">(draw)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="tick(delta: Num) {  var mouse = Camera.screen_point_to_world(    Camera.get_default(world),    Input.mouse_x(),    Input.mouse_y())  each {|entity: Entity, data: Data|    var grid_mouse = world_to_grid(data, mouse.x, mouse.y)    var valid_mouse = in_grid(data, grid_mouse.x, grid_mouse.y)    if(valid_mouse) {      var mouse_draw_pos = grid_to_world(data, grid_mouse.x, grid_mouse.y)      Draw.rect(draw,        mouse_draw_pos.x, mouse_draw_pos.y, 0,        block_width, block_height, 0, style)    }    for(y in 0 ... data.height) {      ... //existing code    } //each row  } //each entity  Draw.commit(draw)}"><div></div></button></div></figure></div>
<p>Now whenever we move the mouse, this square will follow.</p>
<p><img src="/next/_astro/grid.mouse.jEjUOy5Y_ZIO79P.webp" alt loading="lazy" decoding="async" fetchpriority="auto" width="1200" height="800"></p>
<div class="sl-heading-wrapper level-h3"><h3 id="selected-state">Selected state</h3><a class="sl-anchor-link" href="#selected-state"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œSelected stateâ€</span></a></div>
<p>Weâ€™ll track the selected state in our <code dir="auto">Data</code> class. We use -1 to mean â€œnothing selectedâ€.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#CA9EE6;--1:#8035E0">class</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#4C4F69"> {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#81C8BE;--1:#116E73">...</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//existing code</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">#doc = "Currently selected cell"</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> selected: </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Float2</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> [</span><span style="--0:#f0a57f;--1:#833305">-1</span><span style="--0:#C6D0F5;--1:#474a62">,</span><span style="--0:#f0a57f;--1:#833305">-1</span><span style="--0:#C6D0F5;--1:#474a62">]</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="class Data {  ... //existing code  #doc = &#x22;Currently selected cell&#x22;  var selected: Float2 = [-1,-1]}"><div></div></button></div></figure></div>
<p>When a mouse click happens:</p>
<ul>
<li>If we had a selection
<ul>
<li>and clicked on the same spot, deselect</li>
<li>clicked somewhere else, check if we can swap</li>
</ul>
</li>
<li>If we didnâ€™t have a selection
<ul>
<li>select it</li>
</ul>
</li>
</ul>
<p>We can add to the tick function</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">each {</span><span style="--0:#EA999C;--0fs:italic;--1:#B43641;--1fs:italic">|entity: Entity, data: Data|</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> grid_mouse </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">world_to_grid</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, mouse</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">x, mouse</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">y)</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> valid_mouse </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">in_grid</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, grid_mouse</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">x, grid_mouse</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">y)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> selected </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> data</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">selected</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> had_selected </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> selected</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">x </span><span style="--0:#81C8BE;--1:#0d5458">!=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#f0a57f;--1:#833305">-1</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#81C8BE;--1:#0d5458">&#x26;&#x26;</span><span style="--0:#C6D0F5;--1:#474a62"> selected</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">y </span><span style="--0:#81C8BE;--1:#0d5458">!=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#f0a57f;--1:#833305">-1</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">if</span><span style="--0:#C6D0F5;--1:#474a62">(had_selected) {</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> selected_pos </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">grid_to_world</span><span style="--0:#C6D0F5;--1:#474a62">(data, selected</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">x, selected</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">y)</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Draw</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">rect</span><span style="--0:#C6D0F5;--1:#474a62">(draw,</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">      </span></span><span style="--0:#C6D0F5">selected_pos</span></span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">x, selected_pos</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">y, </span><span style="--0:#f0a57f;--1:#833305">0</span><span style="--0:#C6D0F5;--1:#474a62">,</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">      </span></span><span style="--0:#C6D0F5">block_width, block_height, </span></span><span style="--0:#f0a57f;--1:#833305">0</span><span style="--0:#C6D0F5;--1:#474a62">, style</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">color</span><span style="--0:#C6D0F5;--1:#474a62">(</span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Color</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">pink))</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">  </span></span><span style="--0:#C6D0F5">}</span></span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(valid_mouse) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> mouse_draw_pos </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">grid_to_world</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, grid_mouse</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">x, grid_mouse</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">y)</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Draw</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">rect</span><span style="--0:#C6D0F5;--1:#4C4F69">(draw,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">      </span></span><span style="--0:#C6D0F5;--1:#4C4F69">mouse_draw_pos</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">x, mouse_draw_pos</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">y, </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">      </span></span><span style="--0:#C6D0F5;--1:#4C4F69">block_width, block_height, </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">, style</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">color</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Color</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">black))</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#cfa8e9;--1:#6429af">if</span><span style="--0:#C6D0F5;--1:#474a62">(</span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Input</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">mouse_state_released</span><span style="--0:#C6D0F5;--1:#474a62">(</span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">MouseButton</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">left)) {</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">      </span><span style="--0:#cfa8e9;--1:#6429af">if</span><span style="--0:#C6D0F5;--1:#474a62">(had_selected) {</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">        </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> allow_swap </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">is_adjacent</span><span style="--0:#C6D0F5;--1:#474a62">(selected</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">x, selected</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">y, grid_mouse</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">x, grid_mouse</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">y)</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">        </span><span style="--0:#cfa8e9;--1:#6429af">if</span><span style="--0:#C6D0F5;--1:#474a62">(selected</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">x </span><span style="--0:#81C8BE;--1:#0d5458">==</span><span style="--0:#C6D0F5;--1:#474a62"> grid_mouse</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">x </span><span style="--0:#81C8BE;--1:#0d5458">&#x26;&#x26;</span><span style="--0:#C6D0F5;--1:#474a62"> selected</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">y </span><span style="--0:#81C8BE;--1:#0d5458">==</span><span style="--0:#C6D0F5;--1:#474a62"> grid_mouse</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">y) {</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">          </span></span><span style="--0:#C6D0F5">data</span></span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">selected </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> [</span><span style="--0:#f0a57f;--1:#833305">-1</span><span style="--0:#C6D0F5;--1:#474a62">, </span><span style="--0:#f0a57f;--1:#833305">-1</span><span style="--0:#C6D0F5;--1:#474a62">]</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">        </span></span><span style="--0:#C6D0F5">} </span></span><span style="--0:#cfa8e9;--1:#6429af">else</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#cfa8e9;--1:#6429af">if</span><span style="--0:#C6D0F5;--1:#474a62">(allow_swap) {</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">          </span><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">// swap(selected.x, selected.y, grid_mouse.x, grid_mouse.y)</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">          </span></span><span style="--0:#C6D0F5">data</span></span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">selected </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> [</span><span style="--0:#f0a57f;--1:#833305">-1</span><span style="--0:#C6D0F5;--1:#474a62">, </span><span style="--0:#f0a57f;--1:#833305">-1</span><span style="--0:#C6D0F5;--1:#474a62">]</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">        </span></span><span style="--0:#C6D0F5">}</span></span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">      </span></span><span style="--0:#C6D0F5">} </span></span><span style="--0:#cfa8e9;--1:#6429af">else</span><span style="--0:#C6D0F5;--1:#474a62"> {</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">        </span></span><span style="--0:#C6D0F5">data</span></span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">selected </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> grid_mouse</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">      </span></span><span style="--0:#C6D0F5">}</span></span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">    </span></span><span style="--0:#C6D0F5">} </span></span><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">//if left click</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//if valid mouse</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#81C8BE;--1:#116E73">...</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// each</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="each {|entity: Entity, data: Data|  var grid_mouse = world_to_grid(data, mouse.x, mouse.y)  var valid_mouse = in_grid(data, grid_mouse.x, grid_mouse.y)  var selected = data.selected  var had_selected = selected.x != -1 &#x26;&#x26; selected.y != -1  if(had_selected) {    var selected_pos = grid_to_world(data, selected.x, selected.y)    Draw.rect(draw,      selected_pos.x, selected_pos.y, 0,      block_width, block_height, 0, style.color(Color.pink))  }  if(valid_mouse) {    var mouse_draw_pos = grid_to_world(data, grid_mouse.x, grid_mouse.y)    Draw.rect(draw,      mouse_draw_pos.x, mouse_draw_pos.y, 0,      block_width, block_height, 0, style.color(Color.black))    if(Input.mouse_state_released(MouseButton.left)) {      if(had_selected) {        var allow_swap = is_adjacent(selected.x, selected.y, grid_mouse.x, grid_mouse.y)        if(selected.x == grid_mouse.x &#x26;&#x26; selected.y == grid_mouse.y) {          data.selected = [-1, -1]        } else if(allow_swap) {          // swap(selected.x, selected.y, grid_mouse.x, grid_mouse.y)          data.selected = [-1, -1]        }      } else {        data.selected = grid_mouse      }    } //if left click  } //if valid mouse  ...} // each"><div></div></button></div></figure></div>
<p>We can now select a grid cell, deselect it, and see the mouse and the selection at the same time:</p>
<p><img src="/next/_astro/grid.selected.mZ2XtJ60_ZwyKUE.webp" alt loading="lazy" decoding="async" fetchpriority="auto" width="1200" height="800"></p>
<div class="sl-heading-wrapper level-h2"><h2 id="swap">Swap</h2><a class="sl-anchor-link" href="#swap"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œSwapâ€</span></a></div>
<p>One of the most important concepts of the game, is being able to swap two pieces on the grid!</p>
<p>So letâ€™s implement it but with a small bit of nuance. Weâ€™re going to split our swap into two parts,
the initial step, and a â€˜completeâ€™ step. This is for the future, because weâ€™re going to want to be able to animate the swap visually.</p>
<p>For now, weâ€™ll immediately call <code dir="auto">complete_swap</code> anyway. Add these to your <code dir="auto">System</code> class.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">swap</span><span style="--0:#C6D0F5;--1:#4C4F69">(data: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#4C4F69">, x1: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">, y1: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">, x2: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">, y2: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69"> (</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">!is_adjacent</span><span style="--0:#C6D0F5;--1:#4C4F69">(x1, y1, x2, y2)) </span><span style="--0:#CA9EE6;--1:#8035E0">return</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#A6D189;--1:#2D711E">false</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">complete_swap</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x1, y1, x2, y2)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">complete_swap</span><span style="--0:#C6D0F5;--1:#4C4F69">(data: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#4C4F69">, x1: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">, y1: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">, x2: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">, y2: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> temp </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">get_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x1, y1)</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">set_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x1, y1, </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">get_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x2, y2))</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">set_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x2, y2, temp)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="swap(data: Data, x1: Num, y1: Num, x2: Num, y2: Num) {  if (!is_adjacent(x1, y1, x2, y2)) return false  complete_swap(data, x1, y1, x2, y2)}complete_swap(data: Data, x1: Num, y1: Num, x2: Num, y2: Num) {  var temp = get_cell(data, x1, y1)  set_cell(data, x1, y1, get_cell(data, x2, y2))  set_cell(data, x2, y2, temp)}"><div></div></button></div></figure></div>
<p>Hereâ€™s what that looks like now:</p>
<video preload="auto" autoplay controls muted playinsline="true" loop style="max-width:100%; width:auto; margin:auto; display:block;"><source src="/video/tutorials/match3/swap.mp4" type="video/mp4"/></video>
<div class="sl-heading-wrapper level-h2"><h2 id="finding-matches">Finding matches</h2><a class="sl-anchor-link" href="#finding-matches"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œFinding matchesâ€</span></a></div>
<p>The next important piece of logic for the game is finding where we have matches on the board.</p>
<p>Weâ€™ll add a function to our <code dir="auto">System</code> class that will return a list of matched cells to use in the next step.</p>
<p>The function walks horizontally on each row, looking for tiles with a match. Then it does the same for vertical.
It uses a temporary grid to remember which cells itâ€™s already looked at (<code dir="auto">marked</code>).</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//return a list of matches found on the grid</span></div></div><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">find_all_matches</span><span style="--0:#C6D0F5;--1:#4C4F69">(data: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#4C4F69">) : </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">List</span><span style="--0:#C6D0F5;--1:#4C4F69"> {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> matches </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> []</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> marked </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">List</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">filled</span><span style="--0:#C6D0F5;--1:#4C4F69">(data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">height, </span><span style="--0:#CA9EE6;--1:#8035E0">null</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69"> (i </span><span style="--0:#CA9EE6;--1:#8035E0">in</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#81C8BE;--1:#116E73">...</span><span style="--0:#C6D0F5;--1:#4C4F69">data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">height) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">marked[i] </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">List</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">filled</span><span style="--0:#C6D0F5;--1:#4C4F69">(data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">width, </span><span style="--0:#A6D189;--1:#2D711E">false</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// check for horizontal matches</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69"> (y </span><span style="--0:#CA9EE6;--1:#8035E0">in</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">...</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">height) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> x </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">while</span><span style="--0:#C6D0F5;--1:#4C4F69"> (x </span><span style="--0:#81C8BE;--1:#116E73">&#x3C;</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">width) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> kind </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">get_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x, y)</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69"> (kind </span><span style="--0:#81C8BE;--1:#116E73">==</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">        </span></span><span style="--0:#C6D0F5;--1:#4C4F69">x </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> x </span><span style="--0:#81C8BE;--1:#116E73">+</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">1</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#CA9EE6;--1:#8035E0">continue</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">      </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> count </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">1</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#CA9EE6;--1:#8035E0">while</span><span style="--0:#C6D0F5;--1:#4C4F69"> (x </span><span style="--0:#81C8BE;--1:#116E73">+</span><span style="--0:#C6D0F5;--1:#4C4F69"> count </span><span style="--0:#81C8BE;--1:#116E73">&#x3C;</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">width </span><span style="--0:#81C8BE;--1:#116E73">&#x26;&#x26;</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">get_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x </span><span style="--0:#81C8BE;--1:#116E73">+</span><span style="--0:#C6D0F5;--1:#4C4F69"> count, y) </span><span style="--0:#81C8BE;--1:#116E73">==</span><span style="--0:#C6D0F5;--1:#4C4F69"> kind) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">        </span></span><span style="--0:#C6D0F5;--1:#4C4F69">count </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> count </span><span style="--0:#81C8BE;--1:#116E73">+</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">1</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">      </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69"> (count </span><span style="--0:#81C8BE;--1:#116E73">>=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">3</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69"> (i </span><span style="--0:#CA9EE6;--1:#8035E0">in</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#81C8BE;--1:#116E73">...</span><span style="--0:#C6D0F5;--1:#4C4F69">count) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69"> (</span><span style="--0:#81C8BE;--1:#116E73">!</span><span style="--0:#C6D0F5;--1:#4C4F69">marked[y][x </span><span style="--0:#81C8BE;--1:#116E73">+</span><span style="--0:#C6D0F5;--1:#4C4F69"> i]) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">            </span></span><span style="--0:#C6D0F5;--1:#4C4F69">matches</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">add</span><span style="--0:#C6D0F5;--1:#4C4F69">([x </span><span style="--0:#81C8BE;--1:#116E73">+</span><span style="--0:#C6D0F5;--1:#4C4F69"> i, y])</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">            </span></span><span style="--0:#C6D0F5;--1:#4C4F69">marked[y][x </span><span style="--0:#81C8BE;--1:#116E73">+</span><span style="--0:#C6D0F5;--1:#4C4F69"> i] </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#A6D189;--1:#2D711E">true</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">          </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">        </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">      </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">      </span></span><span style="--0:#C6D0F5;--1:#4C4F69">x </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> x </span><span style="--0:#81C8BE;--1:#116E73">+</span><span style="--0:#C6D0F5;--1:#4C4F69"> count</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//each column</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//each row</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// check for vertical matches</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69"> (x </span><span style="--0:#CA9EE6;--1:#8035E0">in</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">...</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">width) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> y </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">while</span><span style="--0:#C6D0F5;--1:#4C4F69"> (y </span><span style="--0:#81C8BE;--1:#116E73">&#x3C;</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">height) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> kind </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">get_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x, y)</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69"> (kind </span><span style="--0:#81C8BE;--1:#116E73">==</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">        </span></span><span style="--0:#C6D0F5;--1:#4C4F69">y </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> y </span><span style="--0:#81C8BE;--1:#116E73">+</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">1</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#CA9EE6;--1:#8035E0">continue</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">      </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> count </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">1</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#CA9EE6;--1:#8035E0">while</span><span style="--0:#C6D0F5;--1:#4C4F69"> (y </span><span style="--0:#81C8BE;--1:#116E73">+</span><span style="--0:#C6D0F5;--1:#4C4F69"> count </span><span style="--0:#81C8BE;--1:#116E73">&#x3C;</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">height </span><span style="--0:#81C8BE;--1:#116E73">&#x26;&#x26;</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">get_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x, y </span><span style="--0:#81C8BE;--1:#116E73">+</span><span style="--0:#C6D0F5;--1:#4C4F69"> count) </span><span style="--0:#81C8BE;--1:#116E73">==</span><span style="--0:#C6D0F5;--1:#4C4F69"> kind) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">        </span></span><span style="--0:#C6D0F5;--1:#4C4F69">count </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> count </span><span style="--0:#81C8BE;--1:#116E73">+</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">1</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">      </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69"> (count </span><span style="--0:#81C8BE;--1:#116E73">>=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">3</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69"> (i </span><span style="--0:#CA9EE6;--1:#8035E0">in</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#81C8BE;--1:#116E73">...</span><span style="--0:#C6D0F5;--1:#4C4F69">count) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69"> (</span><span style="--0:#81C8BE;--1:#116E73">!</span><span style="--0:#C6D0F5;--1:#4C4F69">marked[y </span><span style="--0:#81C8BE;--1:#116E73">+</span><span style="--0:#C6D0F5;--1:#4C4F69"> i][x]) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">            </span></span><span style="--0:#C6D0F5;--1:#4C4F69">matches</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">add</span><span style="--0:#C6D0F5;--1:#4C4F69">([x, y </span><span style="--0:#81C8BE;--1:#116E73">+</span><span style="--0:#C6D0F5;--1:#4C4F69"> i])</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">            </span></span><span style="--0:#C6D0F5;--1:#4C4F69">marked[y </span><span style="--0:#81C8BE;--1:#116E73">+</span><span style="--0:#C6D0F5;--1:#4C4F69"> i][x] </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#A6D189;--1:#2D711E">true</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">          </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">        </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">      </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">      </span></span><span style="--0:#C6D0F5;--1:#4C4F69">y </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> y </span><span style="--0:#81C8BE;--1:#116E73">+</span><span style="--0:#C6D0F5;--1:#4C4F69"> count</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">return</span><span style="--0:#C6D0F5;--1:#4C4F69"> matches</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//find_all_matches</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="//return a list of matches found on the gridfind_all_matches(data: Data) : List {  var matches = []  var marked = List.filled(data.height, null)  for (i in 0...data.height) {    marked[i] = List.filled(data.width, false)  }  // check for horizontal matches  for (y in 0 ... data.height) {    var x = 0    while (x < data.width) {      var kind = get_cell(data, x, y)      if (kind == 0) {        x = x + 1        continue      }      var count = 1      while (x + count < data.width &#x26;&#x26; get_cell(data, x + count, y) == kind) {        count = count + 1      }      if (count >= 3) {        for (i in 0...count) {          if (!marked[y][x + i]) {            matches.add([x + i, y])            marked[y][x + i] = true          }        }      }      x = x + count    } //each column  } //each row  // check for vertical matches  for (x in 0 ... data.width) {    var y = 0    while (y < data.height) {      var kind = get_cell(data, x, y)      if (kind == 0) {        y = y + 1        continue      }      var count = 1      while (y + count < data.height &#x26;&#x26; get_cell(data, x, y + count) == kind) {        count = count + 1      }      if (count >= 3) {        for (i in 0...count) {          if (!marked[y + i][x]) {            matches.add([x, y + i])            marked[y + i][x] = true          }        }      }      y = y + count    }  }  return matches} //find_all_matches"><div></div></button></div></figure></div>
<p>Weâ€™ll also call it from <code dir="auto">complete_swap</code>, which is when we check for matches.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">complete_swap</span><span style="--0:#C6D0F5;--1:#4C4F69">(data: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#4C4F69">, x1: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">, y1: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">, x2: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">, y2: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> temp </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">get_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x1, y1)</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">set_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x1, y1, </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">get_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x2, y2))</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">set_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x2, y2, temp)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> matches </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">find_all_matches</span><span style="--0:#C6D0F5;--1:#474a62">(data)</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#E5C890;--0fs:italic;--1:#6a440e;--1fs:italic">Log</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">print</span><span style="--0:#C6D0F5;--1:#474a62">(</span><span style="--0:#A6D189;--1:#235817">"found %(</span><span style="--0:#C6D0F5;--1:#474a62">matches</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#A6D189;--1:#235817">count) matches"</span><span style="--0:#C6D0F5;--1:#474a62">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="complete_swap(data: Data, x1: Num, y1: Num, x2: Num, y2: Num) {  var temp = get_cell(data, x1, y1)  set_cell(data, x1, y1, get_cell(data, x2, y2))  set_cell(data, x2, y2, temp)  var matches = find_all_matches(data)  Log.print(&#x22;found %(matches.count) matches&#x22;)}"><div></div></button></div></figure></div>
<p>If we look in the log below the window, weâ€™ll see the number of matches being printed:</p>
<video preload="auto" autoplay controls muted playinsline="true" loop style="max-width:100%; width:auto; margin:auto; display:block;"><source src="/video/tutorials/match3/matches.mp4" type="video/mp4"/></video>
<div class="sl-heading-wrapper level-h2"><h2 id="processing-matches">Processing matches</h2><a class="sl-anchor-link" href="#processing-matches"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œProcessing matchesâ€</span></a></div>
<p>With a list of matches, we need to process them which will remove the state from the grid.
For now weâ€™ll immediately clear them from the board.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">process_matches</span><span style="--0:#C6D0F5;--1:#4C4F69">(data: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> matches </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">find_all_matches</span><span style="--0:#C6D0F5;--1:#4C4F69">(data)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">while</span><span style="--0:#C6D0F5;--1:#4C4F69">(matches</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">count </span><span style="--0:#81C8BE;--1:#116E73">></span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69">(match </span><span style="--0:#CA9EE6;--1:#8035E0">in</span><span style="--0:#C6D0F5;--1:#4C4F69"> matches) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> x </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> match[</span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">]</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> y </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> match[</span><span style="--0:#EF9F76;--1:#AB4307">1</span><span style="--0:#C6D0F5;--1:#4C4F69">]</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">set_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x, y, </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">matches</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">clear</span><span style="--0:#C6D0F5;--1:#4C4F69">()</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//process_matches</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="process_matches(data: Data) {  var matches = find_all_matches(data)  while(matches.count > 0) {    for(match in matches) {      var x = match[0]      var y = match[1]      set_cell(data, x, y, 0)    }    matches.clear()  }} //process_matches"><div></div></button></div></figure></div>
<p>And we actually need to call it! Weâ€™ll add to <code dir="auto">complete_swap</code>:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">complete_swap</span><span style="--0:#C6D0F5;--1:#4C4F69">(data: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#4C4F69">, x1: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">, y1: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">, x2: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">, y2: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> temp </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">get_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x1, y1)</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">set_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x1, y1, </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">get_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x2, y2))</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">set_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x2, y2, temp)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">var</span><span style="--0:#C6D0F5;--1:#474a62"> matches </span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">find_all_matches</span><span style="--0:#C6D0F5;--1:#474a62">(data)</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">  </span><span style="--0:#cfa8e9;--1:#6429af">if</span><span style="--0:#C6D0F5;--1:#474a62">(matches</span><span style="--0:#81C8BE;--1:#0d5458">.</span><span style="--0:#C6D0F5;--1:#474a62">count </span><span style="--0:#81C8BE;--1:#0d5458">></span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#f0a57f;--1:#833305">0</span><span style="--0:#C6D0F5;--1:#474a62">) {</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">process_matches</span><span style="--0:#C6D0F5;--1:#474a62">(data)</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">  </span></span><span style="--0:#C6D0F5">}</span></span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="complete_swap(data: Data, x1: Num, y1: Num, x2: Num, y2: Num) {  var temp = get_cell(data, x1, y1)  set_cell(data, x1, y1, get_cell(data, x2, y2))  set_cell(data, x2, y2, temp)  var matches = find_all_matches(data)  if(matches.count > 0) {    process_matches(data)  }}"><div></div></button></div></figure></div>
<p>And now whenever thereâ€™s a swap, we can see the pieces being removed from the board:</p>
<video preload="auto" autoplay controls muted playinsline="true" loop style="max-width:100%; width:auto; margin:auto; display:block;"><source src="/video/tutorials/match3/process_matches.mp4" type="video/mp4"/></video>
<div class="sl-heading-wrapper level-h2"><h2 id="dropping-blocks">Dropping blocks</h2><a class="sl-anchor-link" href="#dropping-blocks"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œDropping blocksâ€</span></a></div>
<p>When we remove blocks from the grid, we typically want the blocks to fall down and fill the empty space below them.</p>
<p>We walk over the grid horizontally, and check for empty tiles.
If itâ€™s empty, we loop vertically and move the items downward.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// drop tiles down to fill empty spaces</span></div></div><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">drop_blocks</span><span style="--0:#C6D0F5;--1:#4C4F69">(data: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69"> (x </span><span style="--0:#CA9EE6;--1:#8035E0">in</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">...</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">width) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> write_y </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">height </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">1</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69"> (y </span><span style="--0:#CA9EE6;--1:#8035E0">in</span><span style="--0:#C6D0F5;--1:#4C4F69"> (data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">height </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">1</span><span style="--0:#C6D0F5;--1:#4C4F69">) </span><span style="--0:#81C8BE;--1:#116E73">..</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69"> (</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">get_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x, y) </span><span style="--0:#81C8BE;--1:#116E73">!=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69"> (y </span><span style="--0:#81C8BE;--1:#116E73">!=</span><span style="--0:#C6D0F5;--1:#4C4F69"> write_y) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">set_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x, write_y, </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">get_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x, y))</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">set_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x, y, </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">        </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">        </span></span><span style="--0:#C6D0F5;--1:#4C4F69">write_y </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> write_y </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">1</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">      </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//each row</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//each column</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//drop_blocks</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="// drop tiles down to fill empty spacesdrop_blocks(data: Data) {  for (x in 0 ... data.width) {    var write_y = data.height - 1    for (y in (data.height - 1) .. 0) {      if (get_cell(data, x, y) != 0) {        if (y != write_y) {          set_cell(data, x, write_y, get_cell(data, x, y))          set_cell(data, x, y, 0)        }        write_y = write_y - 1      }    } //each row  } //each column} //drop_blocks"><div></div></button></div></figure></div>
<p>And inside of <code dir="auto">process_matches</code>, drop the blocks downward after clearing them from the grid.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">process_matches</span><span style="--0:#C6D0F5;--1:#4C4F69">(data: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> matches </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">find_all_matches</span><span style="--0:#C6D0F5;--1:#4C4F69">(data)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">while</span><span style="--0:#C6D0F5;--1:#4C4F69">(matches</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">count </span><span style="--0:#81C8BE;--1:#116E73">></span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69">(match </span><span style="--0:#CA9EE6;--1:#8035E0">in</span><span style="--0:#C6D0F5;--1:#4C4F69"> matches) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> x </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> match[</span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">]</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> y </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> match[</span><span style="--0:#EF9F76;--1:#AB4307">1</span><span style="--0:#C6D0F5;--1:#4C4F69">]</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">set_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x, y, </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">//drop tiles downward</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">drop_blocks</span><span style="--0:#C6D0F5;--1:#474a62">(data)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">matches</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">clear</span><span style="--0:#C6D0F5;--1:#4C4F69">()</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//process_matches</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="process_matches(data: Data) {  var matches = find_all_matches(data)  while(matches.count > 0) {    for(match in matches) {      var x = match[0]      var y = match[1]      set_cell(data, x, y, 0)    }    //drop tiles downward    drop_blocks(data)    matches.clear()  }} //process_matches"><div></div></button></div></figure></div>
<p>If you look closely at the grid before and after, you can see the items above the match are moved down to fill the space where the match takes place.</p>
<video preload="auto" autoplay controls muted playinsline="true" loop style="max-width:100%; width:auto; margin:auto; display:block;"><source src="/video/tutorials/match3/dropping_blocks.mp4" type="video/mp4"/></video>
<div class="sl-heading-wrapper level-h2"><h2 id="filling-the-gaps">Filling the gaps</h2><a class="sl-anchor-link" href="#filling-the-gaps"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œFilling the gapsâ€</span></a></div>
<p>When blocks fall down, it creates space at the top. We want to fill these spaces with new blocks.</p>
<p>We walk over the grid, if thereâ€™s an empty space, put something random there.</p>
<p>Hereâ€™s the function to add to the <code dir="auto">System</code> class:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//fill in empty spaces created by falling blocks</span></div></div><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">fill_top</span><span style="--0:#C6D0F5;--1:#4C4F69">(data: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69"> (x </span><span style="--0:#CA9EE6;--1:#8035E0">in</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">...</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">width) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69"> (y </span><span style="--0:#CA9EE6;--1:#8035E0">in</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">...</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">height) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69"> (</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">get_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x, y) </span><span style="--0:#81C8BE;--1:#116E73">==</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">set_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x, y, rng</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">int</span><span style="--0:#C6D0F5;--1:#4C4F69">(data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">block_kinds) </span><span style="--0:#81C8BE;--1:#116E73">+</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">1</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">      </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//each row</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//each column</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//fill_top</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="//fill in empty spaces created by falling blocksfill_top(data: Data) {  for (x in 0 ... data.width) {    for (y in 0 ... data.height) {      if (get_cell(data, x, y) == 0) {        set_cell(data, x, y, rng.int(data.block_kinds) + 1)      }    } //each row  } //each column} //fill_top"><div></div></button></div></figure></div>
<p>And we do need to call it in <code dir="auto">process_matches</code>:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">process_matches</span><span style="--0:#C6D0F5;--1:#4C4F69">(data: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> matches </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">find_all_matches</span><span style="--0:#C6D0F5;--1:#4C4F69">(data)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">while</span><span style="--0:#C6D0F5;--1:#4C4F69">(matches</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">count </span><span style="--0:#81C8BE;--1:#116E73">></span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69">(match </span><span style="--0:#CA9EE6;--1:#8035E0">in</span><span style="--0:#C6D0F5;--1:#4C4F69"> matches) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> x </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> match[</span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">]</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> y </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> match[</span><span style="--0:#EF9F76;--1:#AB4307">1</span><span style="--0:#C6D0F5;--1:#4C4F69">]</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">set_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x, y, </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">//drop tiles downward</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">drop_blocks</span><span style="--0:#C6D0F5;--1:#474a62">(data)</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">//fill the new spaces made</span></div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">fill_top</span><span style="--0:#C6D0F5;--1:#474a62">(data)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">matches</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">clear</span><span style="--0:#C6D0F5;--1:#4C4F69">()</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//process_matches</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="process_matches(data: Data) {  var matches = find_all_matches(data)  while(matches.count > 0) {    for(match in matches) {      var x = match[0]      var y = match[1]      set_cell(data, x, y, 0)    }    //drop tiles downward    drop_blocks(data)    //fill the new spaces made    fill_top(data)    matches.clear()  }} //process_matches"><div></div></button></div></figure></div>
<p>And if we look closely again (it can be tricky to tell!) the spaces are now filled in.</p>
<video preload="auto" autoplay controls muted playinsline="true" loop style="max-width:100%; width:auto; margin:auto; display:block;"><source src="/video/tutorials/match3/filling_blocks.mp4" type="video/mp4"/></video>
<div class="sl-heading-wrapper level-h2"><h2 id="cascading-changes">Cascading changes</h2><a class="sl-anchor-link" href="#cascading-changes"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œCascading changesâ€</span></a></div>
<p>One final piece of gameplay logic is that matches cause blocks to fall, new blocks to spawn, and then more matches can happen as a result.</p>
<p>In <code dir="auto">process_matches</code> we donâ€™t clear the matches, we check for new ones!</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">process_matches</span><span style="--0:#C6D0F5;--1:#4C4F69">(data: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> matches </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">find_all_matches</span><span style="--0:#C6D0F5;--1:#4C4F69">(data)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">while</span><span style="--0:#C6D0F5;--1:#4C4F69">(matches</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">count </span><span style="--0:#81C8BE;--1:#116E73">></span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69">(match </span><span style="--0:#CA9EE6;--1:#8035E0">in</span><span style="--0:#C6D0F5;--1:#4C4F69"> matches) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> x </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> match[</span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">]</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> y </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> match[</span><span style="--0:#EF9F76;--1:#AB4307">1</span><span style="--0:#C6D0F5;--1:#4C4F69">]</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">set_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x, y, </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//drop tiles downward</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">drop_blocks</span><span style="--0:#C6D0F5;--1:#4C4F69">(data)</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//fill the new spaces made</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">fill_top</span><span style="--0:#C6D0F5;--1:#4C4F69">(data)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line highlight ins"><div class="code"><span class="indent">    </span><span style="--0:#b0b6cd;--0fs:italic;--1:#4a4c58;--1fs:italic">// cascading changes if we find any more</span></div></div><div class="ec-line highlight ins"><div class="code"><span style="--1:#474a62"><span class="indent"><span style="--0:#C6D0F5">    </span></span><span style="--0:#C6D0F5">matches </span></span><span style="--0:#81C8BE;--1:#0d5458">=</span><span style="--0:#C6D0F5;--1:#474a62"> </span><span style="--0:#9cb6f0;--0fs:italic;--1:#1546a7;--1fs:italic">find_all_matches</span><span style="--0:#C6D0F5;--1:#474a62">(data)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//process_matches</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="process_matches(data: Data) {  var matches = find_all_matches(data)  while(matches.count > 0) {    for(match in matches) {      var x = match[0]      var y = match[1]      set_cell(data, x, y, 0)    }    //drop tiles downward    drop_blocks(data)    //fill the new spaces made    fill_top(data)    // cascading changes if we find any more    matches = find_all_matches(data)  }} //process_matches"><div></div></button></div></figure></div>
<p>Itâ€™s still pretty hard to tell whatâ€™s happening! Especially when there are multiple rounds of changes!</p>
<video preload="auto" autoplay controls muted playinsline="true" loop style="max-width:100%; width:auto; margin:auto; display:block;"><source src="/video/tutorials/match3/cascading_changes.mp4" type="video/mp4"/></video>
<div class="sl-heading-wrapper level-h2"><h2 id="bonus-logic">Bonus logic</h2><a class="sl-anchor-link" href="#bonus-logic"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œBonus logicâ€</span></a></div>
<p>One more piece for a more complete game, is a check if there are any valid moves.</p>
<p>We can do that by walking the grid, swapping horizontally and looking for matches.
Then we can swap vertically, and look for matches. If we have any along the way, we return true.</p>
<p>(This is how you would handle game over).</p>
<p>You can add this to your <code dir="auto">System</code> class:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">has_valid_moves</span><span style="--0:#C6D0F5;--1:#4C4F69">(data: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69"> (y </span><span style="--0:#CA9EE6;--1:#8035E0">in</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">...</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">height) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#CA9EE6;--1:#8035E0">for</span><span style="--0:#C6D0F5;--1:#4C4F69"> (x </span><span style="--0:#CA9EE6;--1:#8035E0">in</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#81C8BE;--1:#116E73">...</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">width) {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// try swapping with right neighbor</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69"> (x </span><span style="--0:#81C8BE;--1:#116E73">&#x3C;</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">width </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">1</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> temp </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">get_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x, y)</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">set_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x, y, </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">get_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x</span><span style="--0:#81C8BE;--1:#116E73">+</span><span style="--0:#EF9F76;--1:#AB4307">1</span><span style="--0:#C6D0F5;--1:#4C4F69">, y))</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">set_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x</span><span style="--0:#81C8BE;--1:#116E73">+</span><span style="--0:#EF9F76;--1:#AB4307">1</span><span style="--0:#C6D0F5;--1:#4C4F69">, y, temp)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> matches </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">find_all_matches</span><span style="--0:#C6D0F5;--1:#4C4F69">(data)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// swap back</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> temp2 </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">get_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x, y)</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">set_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x, y, </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">get_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x</span><span style="--0:#81C8BE;--1:#116E73">+</span><span style="--0:#EF9F76;--1:#AB4307">1</span><span style="--0:#C6D0F5;--1:#4C4F69">, y))</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">set_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x</span><span style="--0:#81C8BE;--1:#116E73">+</span><span style="--0:#EF9F76;--1:#AB4307">1</span><span style="--0:#C6D0F5;--1:#4C4F69">, y, temp2)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69"> (matches</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">count </span><span style="--0:#81C8BE;--1:#116E73">></span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">) </span><span style="--0:#CA9EE6;--1:#8035E0">return</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#A6D189;--1:#2D711E">true</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">      </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// try swapping with bottom neighbor</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69"> (y </span><span style="--0:#81C8BE;--1:#116E73">&#x3C;</span><span style="--0:#C6D0F5;--1:#4C4F69"> data</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">height </span><span style="--0:#81C8BE;--1:#116E73">-</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">1</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> temp </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">get_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x, y)</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">set_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x, y, </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">get_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x, y</span><span style="--0:#81C8BE;--1:#116E73">+</span><span style="--0:#EF9F76;--1:#AB4307">1</span><span style="--0:#C6D0F5;--1:#4C4F69">))</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">set_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x, y</span><span style="--0:#81C8BE;--1:#116E73">+</span><span style="--0:#EF9F76;--1:#AB4307">1</span><span style="--0:#C6D0F5;--1:#4C4F69">, temp)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> matches </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">find_all_matches</span><span style="--0:#C6D0F5;--1:#4C4F69">(data)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">// Swap back</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> temp2 </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">get_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x, y)</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">set_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x, y, </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">get_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x, y</span><span style="--0:#81C8BE;--1:#116E73">+</span><span style="--0:#EF9F76;--1:#AB4307">1</span><span style="--0:#C6D0F5;--1:#4C4F69">))</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">set_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x, y</span><span style="--0:#81C8BE;--1:#116E73">+</span><span style="--0:#EF9F76;--1:#AB4307">1</span><span style="--0:#C6D0F5;--1:#4C4F69">, temp2)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69"> (matches</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">count </span><span style="--0:#81C8BE;--1:#116E73">></span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">) </span><span style="--0:#CA9EE6;--1:#8035E0">return</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#A6D189;--1:#2D711E">true</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">      </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">    </span></span><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//each column</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//each row</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">return</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#A6D189;--1:#2D711E">false</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">} </span><span style="--0:#949CBB;--0fs:italic;--1:#616373;--1fs:italic">//has_valid_moves</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="has_valid_moves(data: Data) {  for (y in 0 ... data.height) {    for (x in 0 ... data.width) {      // try swapping with right neighbor      if (x < data.width - 1) {        var temp = get_cell(data, x, y)        set_cell(data, x, y, get_cell(data, x+1, y))        set_cell(data, x+1, y, temp)        var matches = find_all_matches(data)        // swap back        var temp2 = get_cell(data, x, y)        set_cell(data, x, y, get_cell(data, x+1, y))        set_cell(data, x+1, y, temp2)        if (matches.count > 0) return true      }      // try swapping with bottom neighbor      if (y < data.height - 1) {        var temp = get_cell(data, x, y)        set_cell(data, x, y, get_cell(data, x, y+1))        set_cell(data, x, y+1, temp)        var matches = find_all_matches(data)        // Swap back        var temp2 = get_cell(data, x, y)        set_cell(data, x, y, get_cell(data, x, y+1))        set_cell(data, x, y+1, temp2)        if (matches.count > 0) return true      }    } //each column  } //each row  return false} //has_valid_moves"><div></div></button></div></figure></div>
<p>We can also test it by calling it at the end of <code dir="auto">complete_swap</code>.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="wren"><code><div class="ec-line"><div class="code"><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">complete_swap</span><span style="--0:#C6D0F5;--1:#4C4F69">(data: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Data</span><span style="--0:#C6D0F5;--1:#4C4F69">, x1: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">, y1: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">, x2: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">, y2: </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Num</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> temp </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">get_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x1, y1)</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">set_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x1, y1, </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">get_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x2, y2))</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">set_cell</span><span style="--0:#C6D0F5;--1:#4C4F69">(data, x2, y2, temp)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> matches </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">find_all_matches</span><span style="--0:#C6D0F5;--1:#4C4F69">(data)</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">if</span><span style="--0:#C6D0F5;--1:#4C4F69">(matches</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#C6D0F5;--1:#4C4F69">count </span><span style="--0:#81C8BE;--1:#116E73">></span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#EF9F76;--1:#AB4307">0</span><span style="--0:#C6D0F5;--1:#4C4F69">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">process_matches</span><span style="--0:#C6D0F5;--1:#4C4F69">(data)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C6D0F5;--1:#4C4F69">  </span></span><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#CA9EE6;--1:#8035E0">var</span><span style="--0:#C6D0F5;--1:#4C4F69"> has_moves </span><span style="--0:#81C8BE;--1:#116E73">=</span><span style="--0:#C6D0F5;--1:#4C4F69"> </span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">has_valid_moves</span><span style="--0:#C6D0F5;--1:#4C4F69">(data)</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#E5C890;--0fs:italic;--1:#8B5912;--1fs:italic">Log</span><span style="--0:#81C8BE;--1:#116E73">.</span><span style="--0:#8CAAEE;--0fs:italic;--1:#1B5BDA;--1fs:italic">print</span><span style="--0:#C6D0F5;--1:#4C4F69">(</span><span style="--0:#A6D189;--1:#2D711E">"has moves left `%(</span><span style="--0:#C6D0F5;--1:#4C4F69">has_moves</span><span style="--0:#A6D189;--1:#2D711E">)`"</span><span style="--0:#C6D0F5;--1:#4C4F69">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C6D0F5;--1:#4C4F69">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="complete_swap(data: Data, x1: Num, y1: Num, x2: Num, y2: Num) {  var temp = get_cell(data, x1, y1)  set_cell(data, x1, y1, get_cell(data, x2, y2))  set_cell(data, x2, y2, temp)  var matches = find_all_matches(data)  if(matches.count > 0) {    process_matches(data)  }  var has_moves = has_valid_moves(data)  Log.print(&#x22;has moves left &#x60;%(has_moves)&#x60;&#x22;)}"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h2"><h2 id="next-time">Next time!</h2><a class="sl-anchor-link" href="#next-time"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled â€œNext time!â€</span></a></div>
<p>Thatâ€™s all for this tutorial.</p>
<p>We have a working match 3 game, but itâ€™s a little difficult to understand the changes happening visually.</p>
<p>In the next tutorial, weâ€™re going to add animation to the grid changes, so we can see whatâ€™s actually happening.</p> </div> <footer class="sl-flex astro-3yyafb3n"> <div class="meta sl-flex astro-3yyafb3n">   </div> <div class="pagination-links print:hidden astro-u2l5gyhi" dir="ltr"> <a href="/next/tutorials/cards--decks/cardsdecks/" rel="prev" class="astro-u2l5gyhi"> <svg aria-hidden="true" class="astro-u2l5gyhi astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.5rem;"><path d="M17 11H9.41l3.3-3.29a1.004 1.004 0 1 0-1.42-1.42l-5 5a1 1 0 0 0-.21.33 1 1 0 0 0 0 .76 1 1 0 0 0 .21.33l5 5a1.002 1.002 0 0 0 1.639-.325 1 1 0 0 0-.219-1.095L9.41 13H17a1 1 0 0 0 0-2Z"/></svg> <span class="astro-u2l5gyhi"> Previous <br class="astro-u2l5gyhi"> <span class="link-title astro-u2l5gyhi">Cards &amp; Decks</span> </span> </a> <a href="/next/tutorials/match-3/part2/" rel="next" class="astro-u2l5gyhi"> <svg aria-hidden="true" class="astro-u2l5gyhi astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.5rem;"><path d="M17.92 11.62a1.001 1.001 0 0 0-.21-.33l-5-5a1.003 1.003 0 1 0-1.42 1.42l3.3 3.29H7a1 1 0 0 0 0 2h7.59l-3.3 3.29a1.002 1.002 0 0 0 .325 1.639 1 1 0 0 0 1.095-.219l5-5a1 1 0 0 0 .21-.33 1 1 0 0 0 0-.76Z"/></svg> <span class="astro-u2l5gyhi"> Next <br class="astro-u2l5gyhi"> <span class="link-title astro-u2l5gyhi">Match 3 - Animating changes</span> </span> </a> </div>   </footer>  </div> </div>   </main> </div> </div>  </div> </div>  </body></html>